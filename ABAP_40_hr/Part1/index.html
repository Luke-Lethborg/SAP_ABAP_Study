<!DOCTYPE html>
<html>
<head>
<title>ABAP_40_hr</title>

<style>
.pre-green { 
  background-color: #90ee90;
  }

.pre-cyan { 
  background-color: #90ffff;
  }

.pre-yellow { 
  background-color: #ffff90;
  }

</style>

</head>
<body>

<a href="#End_link">Jump to Bottom</a>

<h1>About!</h1>
<p>This is to track my source code as I do SAP Exercises</p>
<p>Bulk was created Thu 06/11/2025. When done the page count was 173 Pages!</p>
<h3><a href="#S4D400_PracSyst">S4D400 - Basic ABAP Programming - Practice System</a></h3>
<h3>S4D400 - Basic ABAP Programming - Trail System (??? Where is it? )</h3>
<h3><a href="#SAP_BTP_TrialSystm">Learning the Basics of ABAP Programming on SAP BTP - Trail System</a></h3>
<h3><a href="#ABAP_40hr_Part1_Sub1">ABAP 40hr - Part 1 - Sub-Part 1 - Trail System</a></h3>
<h3><a href="#ABAP_40hr_Part1_Sub2">ABAP 40hr - Part 1 - Sub-Part 2 - Trail System</a></h3>
<h3>ABAP 40hr - Part 1 - Sub-Part 3 - Trail System</h3>
<h3>ABAP 40hr - Part 2 - Sub-Part 1 - Trail System</h3>
<h3>ABAP 40hr - Part 2 - Sub-Part 2 - Trail System</h3>
<h3>Expected to Find: ZCL_S4D400_DEBUGGING (The one that uses Loan Calculator) | Check: zcl_ufh8n_debug_ex07</h3>
<h3>Where are my two program files from month 1 of 3 of Trail System?</h3>

<h1>Links to code back ups</h1>

<h3>*** Nothing for "S4D400 - Basic ABAP Programming - Practice System" ***</h3>
<h3>*** Learning the Basics of ABAP Programming on SAP BTP ***</h3>
<h3><a href="#Code_List_01">Code Backup #01 - My Code: Tue 23_09_2025</a></h3>
<h3><a href="#Code_List_02">Code Backup #02 - My Code: Tue 25_09_2025</a></h3>
<h3>*** ABAP 40hr - Part 1 - Sub-Part 1 ***</h3>
<h3><a href="#Code_List_03">Code Backup #03 - Global Class zcl_ufh8n_hello_world (From Exercise 30)</a></h3>
<h3><a href="#Code_List_04">Code Backup #04 - Local Class lcl_ufh8n_connection (From Exercise 30)</a></h3>
<h3><a href="#Code_List_05">Code Backup #05 - Global Class zcl_ufh8n_hello_world | Again</a></h3>
<h3><a href="#Code_List_06">Code Backup #06 - Local Class lcl_ufh8n_connection | Again</a></h3>
<h3><a href="#Code_List_07">Code Backup #07 - Globl Class zcl_ufh8n_hello_world | (From Exercise 36)</a></h3>
<h3><a href="#Code_List_08">Code Backup #08 - Local Class lcl_ufh8n_connection | (From Exercise 36)</a></h3>
<h3>*** ABAP 40hr - Part 1 - Sub-Part 2 ***</h3>
<h3><a href="#Code_List_09">Code Backup #09 - Code Back Up - WHEN 12.</a></h3>
<h3><a href="#Code_List_10">Code Backup #10 - Code Back Up - Loca Class lcl_ufh8n_connection</a></h3>
<h3><a href="#Code_List_11">Code Backup #11 - Global Class zcl_ufh8n_hello_world (End of ABAP 40hr - Part 1 - Sub-Part 2)</a></h3>
<h3><a href="#Code_List_12">Code Backup #12 - Local Class lcl_ufh8n_connection (End of ABAP 40hr - Part 1 - Sub-Part 2)</a></h3>
<h3>Code Backup #13</h3>

<pre>
** Acer Nitro Laptop files

D:\Luke-No_C_Space
SAP_S4_Random (1).docx		| This just a random loose file.
SAP_Training_Exercise.docx	| Done
S4D400.docx			| Done

Downloads
Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises.docx
Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 1 - Exercises.docx
</pre>

<h1 id="S4D400_PracSyst">S4D400 - Basic ABAP Programming - Practice System</h1>
<pre class="pre-cyan">
SAP_LA_S4D400_EN_24_EX.pdf on Learning System ______ between dd/mm/yyy to dd/mm/yyy captured in file S4D400.docx
This PDF was a 126 pages consisting of 21 Exercises.
S4D400 - Basic ABAP Programming

The Source code is:
S4D400.docx
This file is 142 Pages and 3.51MB
This was done around 15/08/2025 to 28/08/2025

With this exercise I followed the naming standard where in latter attempts I used CASE.
The code I did comes from S4D400.docx
Note: SAP_LA_S4D400_EN_24_EX.pdf consisted of:
</pre>

<br/>
<a href="#S4D400_docx_Ex01">Exercise 1 - Create an ABAP Cloud Project and Investigate ABAP Coding</a> <br/>
<a href="#S4D400_docx_Ex02">Exercise 2 - Create an ABAP Package</a> <br/>
<a href="#S4D400_docx_Ex03">Exercise 3 - Create a 'Hello World' Application</a> <br/>
<a href="#S4D400_docx_Ex04">Exercise 4 - Declare Variables and Process Data</a> <br/>
<a href="#S4D400_docx_Ex05">Exercise 5 - Implement Conditional Branching</a> <br/>
<a href="#S4D400_docx_Ex06">Exercise 6 - Work with Simple Internal Tables</a> <br/>
<a href="#S4D400_docx_Ex07">Exercise 7 - Debug ABAP Code</a> <br/>
<a href="#S4D400_docx_Ex08">Exercise 8 - Define a Local Class</a> <br/>
<a href="#S4D400_docx_Ex09">Exercise 9 - Create and Manage Instances</a> <br/>
<a href="#S4D400_docx_Ex10">Exercise 10 - Define and Call Methods</a> <br/>
<a href="#S4D400_docx_Ex11">Exercise 11 - Use Private Attributes and a Constructor</a> <br/>
<a href="#S4D400_docx_Ex12">Exercise 12 - Read Data from a Database Table</a> <br/>
<a href="#S4D400_docx_Ex13">Exercise 13 - Analyze and Use a CDS View Entity</a> <br/>
<a href="#S4D400_docx_Ex14">Exercise 14 - Use a Structured Data Object</a> <br/>
<a href="#S4D400_docx_Ex15">Exercise 15 - Use a Complex Internal Table</a> <br/>
<a href="#S4D400_docx_Ex16">Exercise 16 - Analyze a Business Object</a> <br/>
<a href="#S4D400_docx_Ex17">Exercise 17 - Modify Data Using EML</a> <br/>
<a href="#S4D400_docx_Ex18">Exercise 18 - Copy a Database Table</a> <br/>
<a href="#S4D400_docx_Ex19">Exercise 19 - Generate and Preview an OData UI Service</a> <br/>
<a href="#S4D400_docx_Ex20">Exercise 20 - Validate Price and Currency</a> <br/>
<a href="#S4D400_docx_Ex21">Exercise 21 - Adjust the User Interface</a> <br/>


<h2>Differences in the Cloud</h2>
<pre class="pre-cyan">
   SELECT * FROM SFLIGHT INTO TABLE @DATA(lt_data) UP TO 10 ROWS.
    "ENDSELECT.
</pre>
<pre class="pre-cyan">
    out->write( sy-datum ).
    "The old variant of SY-DATUM should not be used in the current ABAP language version.
    "But the code still runs
</pre>
<pre class="pre-cyan">
"They use
output = |{ number1 } { op } { number2 } = { result }|.
"But you can still use this
      DATA lv_str_1b TYPE string.
      DATA lv_str_2b TYPE string.
      DATA lv_str_3b TYPE string.
      lv_str_1b = number1.
      lv_str_2b = number2.
      lv_str_3b = result.

      out->write( 'Can Still use CONCATENATE' ).
      CONCATENATE lv_str_1b op lv_str_2b '=' lv_str_3b INTO output SEPARATED BY space.
      out->write( output ).
</pre>
<pre class="pre-cyan">
    DATA connection TYPE REF TO lcl_connection. "declare a reference variable
    "create an instance of your local class.
    connection = new #( ).
</pre>
<pre class="pre-cyan">
    connection = NEW #( ).
    connection->carrier_id = 'SQ'.
    connection->connection_id = '0001'.
    APPEND connection TO connections.
</pre>
<pre class="pre-cyan">
    CREATE OBJECT connection.
    connection->carrier_id = 'QA'.
    connection->connection_id = '9999'.
    APPEND connection TO connections.
</pre>


<h2 id="S4D400_docx_Ex01">Exercise 1 - Create an ABAP Cloud Project and Investigate ABAP Coding</h2>
<pre class="pre-cyan">
No Code
</pre>

<h2 id="S4D400_docx_Ex02">Exercise 2 - Create an ABAP Package</h2>
<pre class="pre-cyan">
No Code
</pre>

<h2 id="S4D400_docx_Ex03">Exercise 3 - Create a 'Hello World' Application</h2>
<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.
  "Activate: CTRL F3
  "Run:      F9
    out->write( 'Hello World UFH8N' ).

    "WRITE: 'This is my Text'. NEW-LINE.
    "WRITE is not allowed in the current ABAP language version
    "NEW-LINE is not allowed in the current ABAP language version

    out->write( sy-datum ).
    "The old variant of SY-DATUM should not be used in the current ABAP language version.
    "But the code still runs.

    "SELECT * FROM sflight INTO TABLE @DATA(lt_sflight).
    "Use of table SFLIGHT is not permitted
    "Why? F2 shows details
  ENDMETHOD.
</pre>

<h2 id="S4D400_docx_Ex04">Exercise 4 - Declare Variables and Process Data</h2>
<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.
    DATA number1 TYPE i.
    DATA number2 TYPE i.
    DATA result TYPE p LENGTH 8 DECIMALS 2.

    number1 = -8.
    number2 = 3."= 3. "0 Does give an error | Runtime Error: BCD_ZERODIVIDE

    "inline declaration
    "DATA(result) = number1 / number2.
    result = number1 / number2.

    "string template
    DATA(output) = |{ number1 } / { number2 } = { result }|.
    out->write( output ).

    "Activate = CTRL + F3
    "Run      = F9

    "“half-up” rounding rule.

  ENDMETHOD.
</pre>

<h2 id="S4D400_docx_Ex05">Exercise 5 - Implement Conditional Branching</h2>
<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.

* Declarations
**************************



    DATA number1 TYPE i.
    DATA number2 TYPE i.

    DATA result TYPE p LENGTH 8 DECIMALS 2.

    DATA op TYPE c LENGTH 1.

    DATA output TYPE string.


* Input Values
**************************
    number1 = 123.
    number2 = 0.
    op = '^'.

* Calculation
**************************

*    DATA(result) = number1 / number2.

    "result = number1 / number2.



    CASE op.
      WHEN '+'.
        result = number1 + number2.
      WHEN '-'.
        result = number1 - number2.
      WHEN '*'.
        result = number1 * number2.
      WHEN '/'.
        TRY.
          result = number1 / number2.
          CATCH cx_sy_zerodivide.
            output = |Division by zero is not defined|.
            out->write( output ).
        ENDTRY.
      WHEN '%'.
        "out->write( '#1 ~ Sorry, not implemented yet!' ).
        output = |#1 ~ Sorry, not implemented yet!|.
        out->write( output ).
      WHEN OTHERS.
        out->write( '#2 ~ Please enter + - * or /' ).
        output = |'{ op }' is not a valid operator!|.
        out->write( output ).
    ENDCASE.

    IF output IS INITIAL. "no error so far
      output = |{ number1 } { op } { number2 } = { result }|.
      out->write( '#3 ~' ).
      out->write( output ).
    ENDIF.

    "Activate = CTRL + F3
    "Run      = F9

* Output
**************************
    "DATA(output) = |{ number1 } / { number2 } = { result }|.
    "output = |{ number1 } { op } { number2 } = { result }|.
    "out->write( '#4 ~').
    "out->write( output ).

  ENDMETHOD.
</pre>

<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.

* Declarations
**************************



    DATA number1 TYPE i.
    DATA number2 TYPE i.

    DATA result TYPE p LENGTH 8 DECIMALS 2.

    DATA op TYPE c LENGTH 1.

    DATA output TYPE string.


* Input Values
**************************
    number1 = 40.
    number2 = 50.
    op = '+'.

* Calculation
**************************

*    DATA(result) = number1 / number2.

    "result = number1 / number2.



    CASE op.
      WHEN '+'.
        result = number1 + number2.
      WHEN '-'.
        result = number1 - number2.
      WHEN '*'.
        result = number1 * number2.
      WHEN '/'.
        TRY.
          result = number1 / number2.
          CATCH cx_sy_zerodivide.
            output = |Division by zero is not defined|.
            out->write( output ).
        ENDTRY.
      WHEN '%'.
        "out->write( '#1 ~ Sorry, not implemented yet!' ).
        output = |#1 ~ Sorry, not implemented yet!|.
        out->write( output ).
      WHEN OTHERS.
        out->write( '#2 ~ Please enter + - * or /' ).
        output = |'{ op }' is not a valid operator!|.
        out->write( output ).
    ENDCASE.

    IF output IS INITIAL. "no error so far
      output = |{ number1 } { op } { number2 } = { result }|.

      "Error: number1 must be a character-like data objects (data type C,N,D,T,String)
      DATA(lv_str_1) = '0'.
      DATA(lv_str_2) = '0'.
      DATA(lv_str_3) = '0'.
      DATA lv_str_1b TYPE string.
      DATA lv_str_2b TYPE string.
      DATA lv_str_3b TYPE string.
      lv_str_1b = number1.
      lv_str_2b = number2.
      lv_str_3b = result.

      out->write( '#3 ~' ).
      out->write( output ).

      out->write( 'Can Still use CONCATENATE' ).
      CONCATENATE lv_str_1b op lv_str_2b '=' lv_str_3b INTO output SEPARATED BY space.
      out->write( output ).

    ENDIF.

    "Activate = CTRL + F3
    "Run      = F9

* Output
**************************
    "DATA(output) = |{ number1 } / { number2 } = { result }|.
    "output = |{ number1 } { op } { number2 } = { result }|.
    "out->write( '#4 ~').
    "out->write( output ).


   "SELECT * FROM SFLIGHT INTO TABLE @DATA(lt_data) UP TO 10 ROWS.
    "ENDSELECT.

  ENDMETHOD.
</pre>
<h2 id="S4D400_docx_Ex06">Exercise 6 - Work with Simple Internal Tables</h2>
<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.
    CONSTANTS max_count TYPE i VALUE 20.
    DATA numbers TYPE TABLE OF i. "Declare a simple internal table to store the Fibonacci numbers
    DO max_count TIMES.
      "The built-in iteration counter is system field sy-index.
      CASE sy-index.
        WHEN 1.
          APPEND 0 TO numbers.
        WHEN 2.
          APPEND 1 TO numbers.
        WHEN OTHERS.
        "Add a branch that is executed for all other values.
        "calculate the new entry as the sum of the two preceding entries
          APPEND numbers[ sy-index - 2 ] + numbers[ sy-index - 1 ] TO numbers.
      ENDCASE.
    ENDDO.

    DATA(counter) = 0.
    "declare an internal table of row type string (suggested name: output).
    DATA output TYPE TABLE OF string. "Added by code editor.

    LOOP AT numbers INTO DATA(number).
      counter = counter + 1.
      "In each iteration, add a new row to the internal table output which contains the
      " content of counter
      "(l4 characters wide, left-justified), a colon (;)
      "and the content of number (10 characters wide, right justified).
      "Use a string template with suitable format options to adjust the format.
      APPEND |{ counter WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output.
    ENDLOOP.

    out->write(
      data = output
      name = |The first { max_count } Fibonacci Numbers|
      ) .


  ENDMETHOD.
</pre>

<pre class="pre-cyan">
The first 20 Fibonacci Numbers
1   :          0  
2   :          1  
3   :          1  
4   :          2  
5   :          3  
6   :          5  
7   :          8  
8   :         13  
9   :         21  
10  :         34  
11  :         55  
12  :         89  
13  :        144  
14  :        233  
15  :        377  
16  :        610  
17  :        987  
18  :       1597  
19  :       2584  
20  :       4181 
</pre>

<h2 id="S4D400_docx_Ex07">Exercise 7 - Debug ABAP Code</h2>
<pre class="pre-cyan">
Template: /LRN/CL_S4D400_BTT_DEBUG 
</pre>

<pre class="pre-cyan">
CLASS zcl_ufh8n_debug_ex07 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS ZCL_UFH8N_DEBUG_EX07 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.

* Declarations
**********************************************************************
    " Types
    TYPES t_amount     TYPE p LENGTH 8 DECIMALS 2.
    TYPES t_percentage TYPE p LENGTH 2 DECIMALS 1.

    " Input for the calculation
    CONSTANTS loan_total        TYPE t_amount     VALUE '50000.00'.
    CONSTANTS interest_rate     TYPE t_percentage VALUE '2.0'.
    CONSTANTS payment_month     TYPE t_amount     VALUE '1000.00'.
    CONSTANTS spec_repay_year   TYPE t_amount     VALUE '10000.00'.  " Extra payment per year
    CONSTANTS spec_repay_mode   TYPE c LENGTH 1   VALUE 'Q'.         "'A' Annual, 'H' every half year, 'Q' 'every Quarter

    " Output
    DATA repayment_plan TYPE TABLE OF string.

    " Helper Variables
    DATA loan_remaining         TYPE t_amount.
    DATA interest_month         TYPE t_amount.
    DATA repayment_month        TYPE t_amount.
    DATA interest_total         TYPE t_amount.
    DATA special_repayment      TYPE t_amount.

    DATA months_counter         TYPE i.
    DATA months_btw_spec_pay    TYPE i.


* Processing
**********************************************************************

    " Initializations
    loan_remaining = loan_total.

    CASE spec_repay_mode.
      WHEN 'A'.
        months_btw_spec_pay = 12.
        special_repayment   = spec_repay_year.
      WHEN 'H'.
        months_btw_spec_pay = 6.
        special_repayment   = spec_repay_year / 2.
      WHEN 'Q'.
        months_btw_spec_pay = 3.
        special_repayment   = spec_repay_year / 4.
      WHEN OTHERS.
        out->write( 'Invalid extra payment mode'  ).
        EXIT.
    ENDCASE.

    " Calculations
    DO.

      IF loan_remaining <= 0.
        EXIT.
      ENDIF.

      DO months_btw_spec_pay TIMES.

        months_counter = months_counter + 1.

        " calculate interest and back payment for current month
        interest_month    = loan_remaining *  ( interest_rate / 100 ) / 12 .
        repayment_month   = payment_month - interest_month.

        " add monthly interest to total interest
        interest_total = interest_total + interest_month.

        " deduct repayment
        loan_remaining = loan_remaining - repayment_month.

        " add payment to repayment plan
        APPEND |Month {  months_counter } - Interest: { interest_month } Remaining loan: { loan_remaining } |
            TO repayment_plan.

        IF loan_remaining < 0.
          EXIT.
        ENDIF.
      ENDDO.

      IF loan_remaining < 0.
        EXIT.
      ENDIF.

      " deduct the special repayment (n times a year, spec_repay_year over the year )
      loan_remaining = loan_remaining - special_repayment.

      "add special repayment to repayment plan
      APPEND |Special repayment of { special_repayment }! Remaining loan { loan_remaining } |
          TO repayment_plan.
    ENDDO.

* Output
**********************************************************************

    out->write( |Starting value of loan:   { loan_total        }| ).
    out->write( |Monthly payment:          { payment_month     }| ).
    out->write( |Special repayment         { special_repayment } every { months_btw_spec_pay } months. | ).

    out->write( |-----------------------Result-----------------------| ).
    out->write( |Total repayment after { months_counter DIV 12 } years and { months_counter MOD 12 } months. | ).
    out->write( |Total interest paid: { interest_total } | ).

    "Repayment Plan
    out->write(
                name = `Repayment Plan:`
                data = repayment_plan
              ).

  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
Starting value of loan:   50000.00
Monthly payment:          1000.00
Special repayment         2500.00 every 3 months. 
-----------------------Result-----------------------
Total repayment after 2 years and 5 months. 
Total interest paid: 1254.37 
Repayment Plan:
Month 1 - Interest: 83.33 Remaining loan: 49083.33      
Month 2 - Interest: 81.81 Remaining loan: 48165.14      
Month 3 - Interest: 80.28 Remaining loan: 47245.42      
Special repayment of 2500.00! Remaining loan 44745.42   
Month 4 - Interest: 74.58 Remaining loan: 43820.00      
Month 5 - Interest: 73.03 Remaining loan: 42893.03      
Month 6 - Interest: 71.49 Remaining loan: 41964.52      
Special repayment of 2500.00! Remaining loan 39464.52   
Month 7 - Interest: 65.77 Remaining loan: 38530.29      
Month 8 - Interest: 64.22 Remaining loan: 37594.51      
Month 9 - Interest: 62.66 Remaining loan: 36657.17      
Special repayment of 2500.00! Remaining loan 34157.17   
Month 10 - Interest: 56.93 Remaining loan: 33214.10     
Month 11 - Interest: 55.36 Remaining loan: 32269.46     
Month 12 - Interest: 53.78 Remaining loan: 31323.24     
Special repayment of 2500.00! Remaining loan 28823.24   
Month 13 - Interest: 48.04 Remaining loan: 27871.28     
Month 14 - Interest: 46.45 Remaining loan: 26917.73     
Month 15 - Interest: 44.86 Remaining loan: 25962.59     
Special repayment of 2500.00! Remaining loan 23462.59   
Month 16 - Interest: 39.10 Remaining loan: 22501.69     
Month 17 - Interest: 37.50 Remaining loan: 21539.19     
Month 18 - Interest: 35.90 Remaining loan: 20575.09     
Special repayment of 2500.00! Remaining loan 18075.09   
Month 19 - Interest: 30.13 Remaining loan: 17105.22     
Month 20 - Interest: 28.51 Remaining loan: 16133.73     
Month 21 - Interest: 26.89 Remaining loan: 15160.62     
Special repayment of 2500.00! Remaining loan 12660.62   
Month 22 - Interest: 21.10 Remaining loan: 11681.72     
Month 23 - Interest: 19.47 Remaining loan: 10701.19     
Month 24 - Interest: 17.84 Remaining loan: 9719.03      
Special repayment of 2500.00! Remaining loan 7219.03    
Month 25 - Interest: 12.03 Remaining loan: 6231.06      
Month 26 - Interest: 10.39 Remaining loan: 5241.45      
Month 27 - Interest: 8.74 Remaining loan: 4250.19       
Special repayment of 2500.00! Remaining loan 1750.19    
Month 28 - Interest: 2.92 Remaining loan: 753.11        
Month 29 - Interest: 1.26 Remaining loan: -245.63       
</pre>

<h2 id="S4D400_docx_Ex08">Exercise 8 - Define a Local Class</h2>
<pre class="pre-cyan">
class lcl_connection definition create private.
        
  public section.
  protected section.
  private section.
  
endclass. 

class lcl_connection implementation.

endclass.
</pre>

<pre class="pre-cyan">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.
  DATA       carrier_id    TYPE /dmo/carrier_id.       " Scope instance
  DATA       connection_id TYPE /dmo/connection_id.    " Scope instance
  CLASS-DATA conn_counter  TYPE i.                     " Scope static

  protected section.
  private section.

endclass.

class lcl_connection implementation.

endclass.
</pre>

<h2 id="S4D400_docx_Ex09">Exercise 9 - Create and Manage Instances</h2>
<pre class="pre-cyan">
  METHOD if_oo_adt_classrun~main.
    DATA connection TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    connection = new #( ).
    connection->carrier_id    = 'LH'.
    connection->connection_id = '0400'.
    APPEND connection TO connections.

    connection = NEW #( ).
    connection->carrier_id = 'AA'.
    connection->connection_id = '0017'.
    APPEND connection TO connections.

    connection = NEW #( ).
    connection->carrier_id = 'SQ'.
    connection->connection_id = '0001'.
    APPEND connection TO connections.

  ENDMETHOD.
</pre>

<pre class="pre-cyan">
"Local Class Stays at:
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.
  DATA       carrier_id    TYPE /dmo/carrier_id.       " Scope instance
  DATA       connection_id TYPE /dmo/connection_id.    " Scope instance
  CLASS-DATA conn_counter  TYPE i.                     " Scope static

  protected section.
  private section.

endclass.

class lcl_connection implementation.

endclass.
</pre>

<pre class="pre-cyan">
" After I messed around a bit
  METHOD if_oo_adt_classrun~main.
    DATA connection TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    connection = new #( ).
    connection->carrier_id    = 'LH'.
    connection->connection_id = '0400'.
    APPEND connection TO connections.

    connection = NEW #( ).
    connection->carrier_id = 'AA'.
    connection->connection_id = '0017'.
    APPEND connection TO connections.

    connection = NEW #( ).
    connection->carrier_id = 'SQ'.
    connection->connection_id = '0001'.
    APPEND connection TO connections.

    CREATE OBJECT connection.
    connection->carrier_id = 'QA'.
    connection->connection_id = '9999'.
    APPEND connection TO connections.
  ENDMETHOD.
</pre>

<h2 id="S4D400_docx_Ex10">Exercise 10 - Define and Call Methods</h2>
<pre class="pre-cyan">
"Local
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.
  DATA       carrier_id    TYPE /dmo/carrier_id.       " Scope instance
  DATA       connection_id TYPE /dmo/connection_id.    " Scope instance
  CLASS-DATA conn_counter  TYPE i.                     " Scope static

  METHODS set_attributes
    IMPORTING
      i_carrier_id    TYPE /dmo/carrier_id
      i_connection_id TYPE /dmo/connection_id
   RAISING
     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.

endclass.

class lcl_connection implementation.

  method get_output.
    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    APPEND |Carrier: { carrier_id }| TO r_output.
    APPEND |Connection: { connection_id }| TO r_output.
  endmethod.

  method set_attributes.
    "If either of the two importing parameters is empty (IS INITIAL),
    " raise exception CX_ABAP_INVALID_VALUE.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    carrier_id    = i_carrier_id.
    connection_id = i_connection_id.

  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
"Global
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    connection = new #( ).

    TRY.
      connection->set_attributes(
        EXPORTING
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    connection = NEW #( ).

    TRY.
      connection->set_attributes(
        EXPORTING
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    connection = NEW #( ).

    TRY.
      connection->set_attributes(
        EXPORTING
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    CREATE OBJECT connection.

    TRY.
    connection->set_attributes(
      EXPORTING
      i_carrier_id    = 'QA'
      i_connection_id = '9999'
    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
Output
------------------------------  
Carrier: LH                     
Connection: 0400                
------------------------------  
Carrier: AA                     
Connection: 0017                
------------------------------  
Carrier: SQ                     
Connection: 0001                
------------------------------  
Carrier: QA                     
Connection: 9999 
</pre>

<pre class="pre-cyan">
"Note: In this example we did not look at what happens when cx_abap_invalid_value is raised.
"We did set it to raise in local as:
    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.
</pre>

<h2 id="S4D400_docx_Ex11">Exercise 11 - Use Private Attributes and a Constructor</h2>

<pre class="pre-cyan">
"My Constructor Looked like

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id TYPE /dmo/carrier_id.
</pre>

<pre class="pre-cyan">
"They Wanted

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.
</pre>

<pre class="pre-cyan">
" Local
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.

  CLASS-DATA conn_counter  TYPE i READ-ONLY..

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.

*  METHODS set_attributes
*    IMPORTING
*      i_carrier_id    TYPE /dmo/carrier_id
*      i_connection_id TYPE /dmo/connection_id
*   RAISING
*     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.
    " Scope instance
    DATA       connection_id TYPE /dmo/connection_id.
    DATA       carrier_id    TYPE /dmo/carrier_id.

endclass.

class lcl_connection implementation.

  method constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  endmethod.

  method get_output.
    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    APPEND |Carrier: { carrier_id }| TO r_output.
    APPEND |Connection: { connection_id }| TO r_output.
  endmethod.

*  method set_attributes.
*    "If either of the two importing parameters is empty (IS INITIAL),
*    " raise exception CX_ABAP_INVALID_VALUE.
*
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*
*  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
" Global
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    "connection = new #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'LH'
*        i_connection_id = '0400'
*      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    " connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'AA'
*        i_connection_id = '0017'
*      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
        ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'SQ'
*        i_connection_id = '0001'
*      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    TRY.
    "CREATE OBJECT connection.
      connection = NEW #(
        i_carrier_id    = 'QA'
        i_connection_id = '9999'
        ).

*    connection->set_attributes(
*      EXPORTING
*      i_carrier_id    = 'QA'
*      i_connection_id = '9999'
*    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
------------------------------  
Carrier: LH                     
Connection: 0400                
------------------------------  
Carrier: AA                     
Connection: 0017                
------------------------------  
Carrier: SQ                     
Connection: 0001                
------------------------------  
Carrier: QA                     
Connection: 9999                
</pre>

<h2 id="S4D400_docx_Ex12">Exercise 12 - Read Data from a Database Table</h2>
<pre class="pre-cyan">
@EndUserText.label : 'Flight Reference Scenario: Connection'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/connection {

  key client        : abap.clnt not null;
  key carrier_id    : /dmo/carrier_id not null;
  key connection_id : /dmo/connection_id not null;
  airport_from_id   : /dmo/airport_from_id;
  airport_to_id     : /dmo/airport_to_id;
  departure_time    : /dmo/flight_departure_time;
  arrival_time      : /dmo/flight_arrival_time;
  distance          : /dmo/flight_distance;
  distance_unit     : msehi;

}
</pre>

<pre class="pre-cyan">
"Local
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.

  DATA lv_table_size TYPE int4.
  CLASS-DATA conn_counter  TYPE i READ-ONLY..

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.

*  METHODS set_attributes
*    IMPORTING
*      i_carrier_id    TYPE /dmo/carrier_id
*      i_connection_id TYPE /dmo/connection_id
*   RAISING
*     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.
    " Scope instance
    DATA       connection_id TYPE /dmo/connection_id.
    DATA       carrier_id    TYPE /dmo/carrier_id.
    DATA airport_from_id     TYPE /dmo/airport_from_id. "New Ex12
    DATA airport_to_id       TYPE /dmo/airport_to_id.    "New Ex12

endclass.

class lcl_connection implementation.

  method constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    SELECT SINGLE
      FROM /dmo/connection
      FIELDS airport_from_id, airport_to_id
      WHERE carrier_id    = @i_carrier_id
        AND connection_id = @i_connection_id
        INTO ( @airport_from_id, @airport_to_id ).
                                       "FIELDS DepartureAirport, DestinationAirport
                                       "Who is correct?

*   SELECT * FROM /dmo/flight
*      INTO TABLE @DATA(flights_test).
*   LOOP AT flights_test ASSIGNING FIELD-SYMBOL(<flight>).
*     <flight>-price = <flight>-price + 100.
*   ENDLOOP.

   "This code seems to make program run really slow
   SELECT Count( * ) FROM /dmo/flight
      INTO @DATA(number_of_flights).
      lv_table_size = number_of_flights.

   "out->write( `Table /dmo/flight has ` + number_of_flights + `Entries`  ).

   "BREAK-POINT. "Not Allowed

    IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.




    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  endmethod.

  method get_output.
    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    APPEND |Carrier: { carrier_id }| TO r_output.
    APPEND |Connection: { connection_id }| TO r_output.
    APPEND |Departure: { airport_from_id }| TO r_output. "New Ex12
    APPEND |Destination: { airport_to_id }| TO r_output. "New Ex12

  endmethod.

*  method set_attributes.
*    "If either of the two importing parameters is empty (IS INITIAL),
*    " raise exception CX_ABAP_INVALID_VALUE.
*
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*
*  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
" Global
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    "connection = new #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'LH'
*        i_connection_id = '0400'
*      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    " connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
        ).


       " out->write( `Table /dmo/flight size is: ` + connection->lv_table_size ).
        out->write( `Table /dmo/flight size is: ` ).
        out->write( connection->lv_table_size ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'AA'
*        i_connection_id = '0017'
*      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
        ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'SQ'
*        i_connection_id = '0001'
*      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    TRY.
    "CREATE OBJECT connection.
      connection = NEW #(
        i_carrier_id    = 'QA'
        i_connection_id = '9999'
        ).

*    connection->set_attributes(
*      EXPORTING
*      i_carrier_id    = 'QA'
*      i_connection_id = '9999'
*    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

    out->write( `Work will ya! - Will Yah Today - 21st Aug...` ).


  ENDMETHOD.
ENDCLASS.
</pre>

<h2 id="S4D400_docx_Ex13">Exercise 13 - Analyze and Use a CDS View Entity</h2>
<pre class="pre-cyan">
" /DMO/I_CONNECTION (Data Definition)
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Connection View - CDS Data Model'

@Search.searchable: true

define view entity /DMO/I_Connection
  as select from /dmo/connection as Connection

  association [1..1] to /DMO/I_Carrier as _Airline            on $projection.AirlineID = _Airline.AirlineID
  association [1..1] to /DMO/I_Airport as _DepartureAirport   on $projection.DepartureAirport = _DepartureAirport.AirportID
  association [1..1] to /DMO/I_Airport as _DestinationAirport on $projection.DestinationAirport = _DestinationAirport.AirportID

{
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @ObjectModel.text.association: '_Airline'
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier', element: 'AirlineID' }, useForValidation: true}]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier_StdVH', element: 'AirlineID' }, useForValidation: true}]
  key Connection.carrier_id      as AirlineID,

      @Search.defaultSearchElement: true
  key Connection.connection_id   as ConnectionID,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_from_id as DepartureAirport,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_to_id   as DestinationAirport,

      Connection.departure_time  as DepartureTime,

      Connection.arrival_time    as ArrivalTime,

      //@Semantics.quantity.unitOfMeasure: 'DistanceUnit'
      Connection.distance        as Distance,

      Connection.distance_unit   as DistanceUnit,

      /* Associations */
      _Airline,
      _DepartureAirport,
      _DestinationAirport
}
</pre>

<pre class="pre-cyan">
"Local

*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.

  DATA lv_table_size TYPE int4.
  CLASS-DATA conn_counter  TYPE i READ-ONLY..

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.

*  METHODS set_attributes
*    IMPORTING
*      i_carrier_id    TYPE /dmo/carrier_id
*      i_connection_id TYPE /dmo/connection_id
*   RAISING
*     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.
    " Scope instance
    DATA connection_id   TYPE /dmo/connection_id.
    DATA carrier_id      TYPE /dmo/carrier_id.
    DATA airport_from_id TYPE /dmo/airport_from_id. "New Ex12
    DATA airport_to_id   TYPE /dmo/airport_to_id.   "New Ex12
    DATA carrier_name    TYPE /dmo/carrier_name.    "Ex 13


endclass.

class lcl_connection implementation.

  method constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*    SELECT SINGLE
*      FROM /dmo/connection
*      FIELDS airport_from_id, airport_to_id
*      WHERE carrier_id    = @i_carrier_id
*        AND connection_id = @i_connection_id
*        INTO ( @airport_from_id, @airport_to_id ).
*                                       "FIELDS DepartureAirport, DestinationAirport
*                                       "Who is correct?
    "SELECT statement that reads from CDS view entity /DMO/I_Connection.
    "read view element Name from the target of association _Airline.
    SELECT SINGLE
      FROM /DMO/I_Connection
      FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
      WHERE AirlineID    = @i_carrier_id
        AND ConnectionID = @i_connection_id
        INTO ( @airport_from_id, @airport_to_id, @carrier_name ).

*   SELECT * FROM /dmo/flight
*      INTO TABLE @DATA(flights_test).
*   LOOP AT flights_test ASSIGNING FIELD-SYMBOL(<flight>).
*     <flight>-price = <flight>-price + 100.
*   ENDLOOP.

   "This code seems to make program run really slow
   SELECT Count( * ) FROM /dmo/flight
      INTO @DATA(number_of_flights).
      lv_table_size = number_of_flights.

   "out->write( `Table /dmo/flight has ` + number_of_flights + `Entries`  ).

   "BREAK-POINT. "Not Allowed

    IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  endmethod.

  method get_output.
    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    "APPEND |Carrier: { carrier_id }| TO r_output.
    "APPEND |Carrier: { carrier_id } { carrier_name }| TO r_output. "I Improve
    APPEND |Carrier ID: { carrier_id } { carrier_name }| TO r_output.
    APPEND |Connection: { connection_id }| TO r_output.
    APPEND |Departure: { airport_from_id }| TO r_output. "New Ex12
    APPEND |Destination: { airport_to_id }| TO r_output. "New Ex12

  endmethod.

*  method set_attributes.
*    "If either of the two importing parameters is empty (IS INITIAL),
*    " raise exception CX_ABAP_INVALID_VALUE.
*
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*
*  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
" Global
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    "connection = new #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'LH'
*        i_connection_id = '0400'
*      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    " connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
        ).


       " out->write( `Table /dmo/flight size is: ` + connection->lv_table_size ).
        out->write( `Table /dmo/flight size is: ` ).
        out->write( connection->lv_table_size ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'AA'
*        i_connection_id = '0017'
*      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
        ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'SQ'
*        i_connection_id = '0001'
*      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    TRY.
    "CREATE OBJECT connection.
      connection = NEW #(
        i_carrier_id    = 'QA'
        i_connection_id = '9999'
        ).

*    connection->set_attributes(
*      EXPORTING
*      i_carrier_id    = 'QA'
*      i_connection_id = '9999'
*    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

    out->write( `Work will ya! - Will Yah Today - 21st Aug... Ex13` ).


  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
Table /dmo/flight size is: 
40  
------------------------------  
Carrier ID: LH                  
Connection: 0400                
Departure:                      
Destination:                    
------------------------------         
Carrier ID: AA American Airlines Inc.  
Connection: 0017                       
Departure: MIA                         
Destination: HAV                       
------------------------------             
Carrier ID: SQ Singapore Airlines Limited  
Connection: 0001                           
Departure: SFO                             
Destination: SIN                           
------------------------------  
Carrier ID: QA                  
Connection: 9999                
Departure:                      
Destination:                    
Work will ya! - Will Yah Today - 21st Aug... Ex13
</pre>

<h2 id="S4D400_docx_Ex14">Exercise 14 - Use a Structured Data Object</h2>
<pre class="pre-cyan">
" Local
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.

  DATA lv_table_size TYPE int4.
  CLASS-DATA conn_counter  TYPE i READ-ONLY..

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.

*  METHODS set_attributes
*    IMPORTING
*      i_carrier_id    TYPE /dmo/carrier_id
*      i_connection_id TYPE /dmo/connection_id
*   RAISING
*     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.
    TYPES:
      BEGIN OF st_details, "Added Ex14
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE /dmo/airport_to_id,
        AirlineName       TYPE /dmo/carrier_name,
      END OF st_details.


    " Scope instance
    DATA connection_id   TYPE /dmo/connection_id.
    DATA carrier_id      TYPE /dmo/carrier_id.
    "DATA airport_from_id TYPE /dmo/airport_from_id. "New Ex12 "Removed Ex14
    "DATA airport_to_id   TYPE /dmo/airport_to_id.   "New Ex12 "Removed Ex14
    "DATA carrier_name    TYPE /dmo/carrier_name.    "Ex 13    "Removed Ex14
    DATA details TYPE st_details. "Added Ex14



endclass.

class lcl_connection implementation.

  method constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*    SELECT SINGLE
*      FROM /dmo/connection
*      FIELDS airport_from_id, airport_to_id
*      WHERE carrier_id    = @i_carrier_id
*        AND connection_id = @i_connection_id
*        INTO ( @airport_from_id, @airport_to_id ).
*                                       "FIELDS DepartureAirport, DestinationAirport
*                                       "Who is correct?
    "SELECT statement that reads from CDS view entity /DMO/I_Connection.
    "read view element Name from the target of association _Airline.
    "as AirlineName | Added Ex14
    SELECT SINGLE
      FROM /DMO/I_Connection
      FIELDS DepartureAirport, DestinationAirport, \_Airline-Name as AirlineName
      WHERE AirlineID    = @i_carrier_id
        AND ConnectionID = @i_connection_id
        "INTO ( @airport_from_id, @airport_to_id, @carrier_name )."Removed Ex14
        "INTO @details. "Added Ex14. Removed Ex14
        INTO CORRESPONDING FIELDS OF @details. "Added Ex14.

*   SELECT * FROM /dmo/flight
*      INTO TABLE @DATA(flights_test).
*   LOOP AT flights_test ASSIGNING FIELD-SYMBOL(<flight>).
*     <flight>-price = <flight>-price + 100.
*   ENDLOOP.

   "This code seems to make program run really slow
   SELECT Count( * ) FROM /dmo/flight
      INTO @DATA(number_of_flights).
      lv_table_size = number_of_flights.

   "out->write( `Table /dmo/flight has ` + number_of_flights + `Entries`  ).

   "BREAK-POINT. "Not Allowed

    IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  endmethod.

  method get_output.
    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    "APPEND |Carrier: { carrier_id }| TO r_output.
    "APPEND |Carrier: { carrier_id } { carrier_name }| TO r_output. "I Improve
    "APPEND |Carrier ID: { carrier_id } { carrier_name }| TO r_output. "Removed Ex14
    "APPEND |Connection: { connection_id }| TO r_output.               "Removed Ex14
    "APPEND |Departure: { airport_from_id }| TO r_output. "New Ex12    "Removed Ex14
    "APPEND |Destination: { airport_to_id }| TO r_output. "New Ex12    "Removed Ex14

    APPEND |Carrier: { carrier_id } { details-airlinename }| TO r_output. "Added Ex14
    APPEND |Connection: { connection_id }| TO r_output.                   "Added Ex14
    APPEND |Departure: { details-departureairport }| TO r_output.         "Added Ex14
    APPEND |Destination: { details-destinationairport }| TO r_output.     "Added Ex14


  endmethod.

*  method set_attributes.
*    "If either of the two importing parameters is empty (IS INITIAL),
*    " raise exception CX_ABAP_INVALID_VALUE.
*
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*
*  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
"Global
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    "connection = new #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'LH'
*        i_connection_id = '0400'
*      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    " connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
        ).


       " out->write( `Table /dmo/flight size is: ` + connection->lv_table_size ).
        out->write( `Table /dmo/flight size is: ` ).
        out->write( connection->lv_table_size ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'AA'
*        i_connection_id = '0017'
*      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
        ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'SQ'
*        i_connection_id = '0001'
*      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    TRY.
    "CREATE OBJECT connection.
      connection = NEW #(
        i_carrier_id    = 'QA'
        i_connection_id = '9999'
        ).

*    connection->set_attributes(
*      EXPORTING
*      i_carrier_id    = 'QA'
*      i_connection_id = '9999'
*    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

    out->write( `Work will ya! - Will Yah Today - 21st Aug... Ex14` ).


  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
Table /dmo/flight size is: 
40  
------------------------------  
Carrier: LH                     
Connection: 0400                
Departure:                      
Destination:                    
------------------------------      
Carrier: AA American Airlines Inc.  
Connection: 0017                    
Departure: MIA                      
Destination: HAV                    
------------------------------          
Carrier: SQ Singapore Airlines Limited  
Connection: 0001                        
Departure: SFO                          
Destination: SIN                        
------------------------------  
Carrier: QA                     
Connection: 9999                
Departure:                      
Destination:                    
Work will ya! - Will Yah Today - 21st Aug... Ex14
</pre>

<h2 id="S4D400_docx_Ex15">Exercise 15 - Use a Complex Internal Table</h2>

<pre class="pre-cyan">
" Local (This is mine and it did not Run)
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

class lcl_connection definition.

  public section.

  DATA lv_table_size TYPE int4.
  CLASS-DATA conn_counter  TYPE i READ-ONLY.
  CLASS-METHODS class_constructor. "Added Ex15

  METHODS constructor
    IMPORTING
      i_connection_id TYPE /dmo/connection_id
      i_carrier_id    TYPE /dmo/carrier_id
    RAISING
      cx_ABAP_INVALID_VALUE.

*  METHODS set_attributes
*    IMPORTING
*      i_carrier_id    TYPE /dmo/carrier_id
*      i_connection_id TYPE /dmo/connection_id
*   RAISING
*     cx_abap_invalid_value.

  METHODS get_output
    returning
      value(r_output) type string_table.

  protected section.
  private section.
    TYPES:
      BEGIN OF st_details, "Added Ex14
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE /dmo/airport_to_id,
        AirlineName       TYPE /dmo/carrier_name,
      END OF st_details.

      TYPES:
        BEGIN OF st_airport, "Added Ex15
          AirportId TYPE /dmo/airport_id,
          Name      TYPE /dmo/airport_name,
        END OF st_airport.

      TYPES tt_airports TYPE STANDARD TABLE OF st_airport  "Added Ex15
        WITH NON-UNIQUE DEFAULT KEY.


    " Scope instance
    DATA connection_id   TYPE /dmo/connection_id.
    DATA carrier_id      TYPE /dmo/carrier_id.
    "DATA airport_from_id TYPE /dmo/airport_from_id. "New Ex12 "Removed Ex14
    "DATA airport_to_id   TYPE /dmo/airport_to_id.   "New Ex12 "Removed Ex14
    "DATA carrier_name    TYPE /dmo/carrier_name.    "Ex 13    "Removed Ex14
    DATA details TYPE st_details. "Added Ex14
    CLASS-DATA airports TYPE tt_airports.


endclass.

class lcl_connection implementation.

  method class_constructor. "Added Ex15
    SELECT FROM /DMO/I_Airport
      FIELDS AirportID, Name
        INTO TABLE @airports.
  endmethod.

  method constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*    SELECT SINGLE
*      FROM /dmo/connection
*      FIELDS airport_from_id, airport_to_id
*      WHERE carrier_id    = @i_carrier_id
*        AND connection_id = @i_connection_id
*        INTO ( @airport_from_id, @airport_to_id ).
*                                       "FIELDS DepartureAirport, DestinationAirport
*                                       "Who is correct?
    "SELECT statement that reads from CDS view entity /DMO/I_Connection.
    "read view element Name from the target of association _Airline.
    "as AirlineName | Added Ex14
    SELECT SINGLE
      FROM /DMO/I_Connection
      FIELDS DepartureAirport, DestinationAirport, \_Airline-Name as AirlineName
      WHERE AirlineID    = @i_carrier_id
        AND ConnectionID = @i_connection_id
        INTO @details. "Added Ex14. Removed Ex14
        "INTO ( @airport_from_id, @airport_to_id, @carrier_name )."Removed Ex14
        "INTO CORRESPONDING FIELDS OF @details. "Added Ex14.

*   SELECT * FROM /dmo/flight
*      INTO TABLE @DATA(flights_test).
*   LOOP AT flights_test ASSIGNING FIELD-SYMBOL(<flight>).
*     <flight>-price = <flight>-price + 100.
*   ENDLOOP.

   "This code seems to make program run really slow
   SELECT Count( * ) FROM /dmo/flight
      INTO @DATA(number_of_flights).
      lv_table_size = number_of_flights.

   "out->write( `Table /dmo/flight has ` + number_of_flights + `Entries`  ).

   "BREAK-POINT. "Not Allowed

    IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  endmethod.

  method get_output.

  DATA(departure)   = airports[ airportID = details-departureairport ].     "Added Ex15
  DATA(destination) = airports[ airportID = details-destinationairport ]. "Added Ex15
  APPEND |Departure: { details-departureairport } { departure-name }| TO r_output.  "Added Ex15
  APPEND |Destination: { details-destinationairport } { destination-name }| TO r_output.  "Added Ex15
  "string template

  ""The Following was optional but I think it make the code harder to read
  "APPEND |Departure: { details-departureairport } { airports[ airportid = details-departureairport ]-name }| TO r_output.  "Added Ex15
  "APPEND |Destination: { details-destinationairport } { airports[ airportid = details-DestinationAirport ]-name }| TO r_output.  "Added Ex15

    "string templates
    "embedded expressions to add the
    "  values of attributes carrier_id and connection_id.
    APPEND |------------------------------| TO r_output.
    "APPEND |Carrier: { carrier_id }| TO r_output.
    "APPEND |Carrier: { carrier_id } { carrier_name }| TO r_output. "I Improve
    "APPEND |Carrier ID: { carrier_id } { carrier_name }| TO r_output. "Removed Ex14
    "APPEND |Connection: { connection_id }| TO r_output.               "Removed Ex14
    "APPEND |Departure: { airport_from_id }| TO r_output. "New Ex12    "Removed Ex14
    "APPEND |Destination: { airport_to_id }| TO r_output. "New Ex12    "Removed Ex14

    APPEND |Carrier: { carrier_id } { details-airlinename }| TO r_output. "Added Ex14
    APPEND |Connection: { connection_id }| TO r_output.                   "Added Ex14
    APPEND |Departure: { details-departureairport }| TO r_output.         "Added Ex14
    APPEND |Destination: { details-destinationairport }| TO r_output.     "Added Ex14


  endmethod.

*  method set_attributes.
*    "If either of the two importing parameters is empty (IS INITIAL),
*    " raise exception CX_ABAP_INVALID_VALUE.
*
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*
*  endmethod.

endclass.
</pre>

<pre class="pre-cyan">
" Local – Clean
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations
CLASS lcl_connection DEFINITION.

  PUBLIC SECTION.

    CLASS-DATA conn_counter TYPE i.
    CLASS-METHODS class_constructor.

    METHODS constructor
      IMPORTING
        i_connection_id TYPE /dmo/connection_id
        i_carrier_id    TYPE /dmo/carrier_id
      RAISING
        cx_ABAP_INVALID_VALUE .

    METHODS get_output
      RETURNING
        VALUE(r_output) TYPE string_table.

  PROTECTED SECTION.

  PRIVATE SECTION.


    TYPES:
      BEGIN OF st_details,
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE /dmo/airport_to_id,
        AirlineName        TYPE /dmo/carrier_name,
      END OF st_details.

    TYPES:
      BEGIN OF st_airport,
        AirportId TYPE /dmo/airport_id,
        Name      TYPE /dmo/airport_name,
      END OF st_airport.

    TYPES tt_airports TYPE STANDARD TABLE OF st_airport
                           WITH NON-UNIQUE DEFAULT KEY.

    DATA carrier_id    TYPE /dmo/carrier_id.
    DATA connection_id TYPE /dmo/connection_id.

*    DATA airport_from_id TYPE /dmo/airport_from_id.
*    DATA airport_to_id   TYPE /dmo/airport_to_id.
*
*    DATA carrier_name    TYPE /dmo/carrier_name.

    DATA details TYPE st_details.

    CLASS-DATA airports TYPE tt_airports.

ENDCLASS.

CLASS lcl_connection IMPLEMENTATION.

  METHOD class_constructor.

    SELECT FROM /DMO/I_Airport
         FIELDS AirportID, Name
       INTO TABLE @airports.

  ENDMETHOD.

  METHOD constructor.

    " ensure non-initial input
    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    " check existence and read additional data
    SELECT SINGLE
      FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name AS AirlineName
     WHERE AirlineID    = @i_carrier_id
       AND ConnectionID = @i_connection_id
*      INTO ( @airport_from_id, @airport_to_id, @carrier_name  ).
      INTO CORRESPONDING FIELDS OF @details.

    IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->connection_id = i_connection_id.
    me->carrier_id    = i_carrier_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.

  METHOD get_output.

    " Read airport names from internal table airports
    DATA(departure)   = airports[ airportID = details-departureairport   ].
    DATA(destination) = airports[ airportID = details-destinationairport ].

    APPEND |--------------------------------|                    TO r_output.
    APPEND |Carrier:     { carrier_id } { details-airlinename }| TO r_output.
    APPEND |Connection:  { connection_id   }|                    TO r_output.
    "APPEND |Departure:   { details-departureairport     }|       TO r_output.
    "APPEND |Destination: { details-destinationairport   }|       TO r_output.
    APPEND |Departure:   { details-departureairport   } { departure-name   }| TO r_output.
    APPEND |Destination: { details-destinationairport } { destination-name }| TO r_output.

* Optional: Chained expressions without helper variables departure and destination
*    APPEND |Departure:   { details-departureairport   } { airports[ airportid = details-departureairport   ]-name }| TO r_output.
*    APPEND |Destination: { details-destinationairport } { airports[ airportid = details-destinationairport ]-name }| TO r_output.

  ENDMETHOD.

ENDCLASS.
</pre>

<pre class="pre-cyan">
" Global (This is mine and it did not Run)
CLASS zcl_ufh8n_local_class_ex08 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_local_class_ex08 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA connection  TYPE REF TO lcl_connection. "declare a reference variable
    DATA connections TYPE TABLE OF REF TO lcl_connection.

    "create an instance of your local class.
    "connection = new #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'LH'
        i_connection_id = '0400'
        ).


*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'LH'
*        i_connection_id = '0400'
*      ).
      "connection->carrier_id    = 'LH'.
      "connection->connection_id = '0400'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    " connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'AA'
        i_connection_id = '0017'
        ).


       " out->write( `Table /dmo/flight size is: ` + connection->lv_table_size ).
        out->write( `Table /dmo/flight size is: ` ).
        out->write( connection->lv_table_size ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'AA'
*        i_connection_id = '0017'
*      ).
      "connection->carrier_id = 'AA'.
      "connection->connection_id = '0017'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "connection = NEW #( ).
    TRY.
      connection = NEW #(
        i_carrier_id    = 'SQ'
        i_connection_id = '0001'
        ).

*      connection->set_attributes(
*        EXPORTING
*        i_carrier_id    = 'SQ'
*        i_connection_id = '0001'
*      ).
      "connection->carrier_id = 'SQ'.
      "connection->connection_id = '0001'.
      APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    TRY.
    "CREATE OBJECT connection.
      connection = NEW #(
        i_carrier_id    = 'QA'
        i_connection_id = '9999'
        ).

*    connection->set_attributes(
*      EXPORTING
*      i_carrier_id    = 'QA'
*      i_connection_id = '9999'
*    ).
    "connection->carrier_id = 'QA'.
    "connection->connection_id = '9999'.
    APPEND connection TO connections.
    CATCH cx_abap_invalid_value.
      out->write( `Method call failed` ).
    ENDTRY.

    "Task 4: Call a Functional Method
    "loop over the internal table connections with reference variable connection as a work area.
    LOOP AT connections INTO connection.
      out->write( connection->get_output( ) ).
    ENDLOOP.

    "Task 5: Use Code Completion and Handle Exceptions

    out->write( `Work will ya! - Will Yah Today - 21st Aug... Ex15` ).


  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
" Global Clean
CLASS zcl_ufh8n_itab_ex15b DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS ZCL_UFH8N_ITAB_EX15B IMPLEMENTATION.


    METHOD if_oo_adt_classrun~main.

    DATA connection TYPE REF TO lcl_connection.
    DATA connections TYPE TABLE OF REF TO lcl_connection.

* First Instance
**********************************************************************

    TRY.
        connection = NEW #(
                            i_carrier_id    = 'LH'
                            i_connection_id = '0400'
                          ).

*        connection->set_attributes(
*          EXPORTING
*            i_carrier_id    = 'LH'
*            i_connection_id = '0400'
*        ).

        APPEND connection TO connections.

      CATCH cx_abap_invalid_value.
        out->write( `Method call failed` ).
    ENDTRY.

* Second instance
**********************************************************************

    TRY.
        connection = NEW #(
                            i_carrier_id    = 'AA'
                            i_connection_id = '0017'
                          ).

        APPEND connection TO connections.

      CATCH cx_abap_invalid_value.
        out->write( `Method call failed` ).
    ENDTRY.

* Third instance
**********************************************************************

    TRY.
        connection = NEW #(
                             i_carrier_id    = 'SQ'
                             i_connection_id = '0001'
                          ).

        APPEND connection TO connections.

      CATCH cx_abap_invalid_value.
        out->write( `Method call failed` ).
    ENDTRY.

* Output
**********************************************************************

    LOOP AT connections INTO connection.

      out->write( connection->get_output( ) ).

    ENDLOOP.

  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-cyan">
Method call failed
--------------------------------                   
Carrier:     AA American Airlines Inc.             
Connection:  0017                                  
Departure:   MIA Miami International Airport       
Destination: HAV José Martí International Airport  
--------------------------------                      
Carrier:     SQ Singapore Airlines Limited            
Connection:  0001                                     
Departure:   SFO San Francisco International Airport  
Destination: SIN Singapore Changi Airport             
</pre>

<h2 id="S4D400_docx_Ex16">Exercise 16 - Analyze a Business Object</h2>
<pre class="pre-cyan">
" behavior definition /DMO/I_AGENCYTP

interface;
use draft;
extensible;

define behavior for /DMO/I_AgencyTP alias /DMO/Agency
{
  use create;
  use update;
  use delete;

  use action Resume;
  use action Edit;
  use action Activate;
  use action Discard;
  use action Prepare;
}
</pre>

<pre class="pre-cyan">
" /DMO/I_AgencyTP
@Metadata.ignorePropagatedAnnotations: true
@EndUserText.label: 'Agency'
@Search.searchable: true
@AccessControl.authorizationCheck: #NOT_REQUIRED

@AbapCatalog.extensibility: {
  extensible: true,
  dataSources: ['AGENCY'],
  elementSuffix: 'ZAG',
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  }, allowNewCompositions: true
}

define root view entity /DMO/I_AgencyTP
  provider contract transactional_interface
  as projection on /DMO/R_AgencyTP as Agency
{
      @ObjectModel.text.element: ['Name']
  key AgencyID,
  
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Semantics.text: true
      @Semantics.organization.name: true
      Name,
      
      @Semantics.address.street: true
      Street,
      
      @Semantics.address.zipCode: true
      PostalCode,
      
      @Search.defaultSearchElement: true
      @Semantics.address.city: true
      City,
      
      @Consumption.valueHelpDefinition: [{entity: { name: 'I_CountryVH', element: 'Country' } }]
      @Semantics.address.country: true
      CountryCode,
      
      @Semantics.telephone.type: [#WORK]
      PhoneNumber,
      
      @Semantics.eMail.address: true
      EMailAddress,
      WebAddress,
      
      @Semantics.largeObject: { mimeType: 'MimeType',
                                fileName: 'Filename',
                                contentDispositionPreference: #INLINE }
      Attachment,
      
      @Semantics.mimeType: true
      MimeType,
      Filename,
      
      @Semantics.user.createdBy: true
      LocalCreatedBy,
      
      @Semantics.systemDateTime.createdAt: true
      LocalCreatedAt,
      
      @Semantics.user.lastChangedBy: true
      LocalLastChangedBy,
      
      @Semantics.systemDateTime.localInstanceLastChangedAt: true
      LocalLastChangedAt,
      
      @Semantics.systemDateTime.lastChangedAt: true
      LastChangedAt,
      /* Associations */
      _Country
}
</pre>

<pre class="pre-cyan">
"Access /DMO/R_AgencyTP
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Agency'
@Search.searchable: true

@AbapCatalog.extensibility: {
  extensible: true,
  elementSuffix: 'ZAG',
  allowNewDatasources: false,
  dataSources: ['_Extension'],
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  },
  allowNewCompositions: true
}

define root view entity /DMO/R_AgencyTP
  as select from /DMO/I_Agency as Agency
  association [0..1] to I_Country     as _Country   on $projection.CountryCode = _Country.Country
  association [1]    to /DMO/E_Agency as _Extension on $projection.AgencyID = _Extension.AgencyId
{

  key AgencyID,

      Name,

      Street,
      PostalCode,
      City,
      CountryCode,

      PhoneNumber,
      EMailAddress,
      WebAddress,

      Attachment,
      MimeType,
      Filename,

      LocalCreatedBy,
      LocalCreatedAt,
      LocalLastChangedBy,
      LocalLastChangedAt,
      LastChangedAt,

      _Country
}
</pre>

<pre class="pre-cyan">
" behavior definition of the business object /DMO/R_AGENCYTP
managed implementation in class /dmo/bp_r_agencytp unique;
strict ( 2 );
with draft;
extensible
{
  with determinations on modify;
  with determinations on save;
  with validations on save;
  with additional save;
}

define behavior for /DMO/R_AgencyTP alias /DMO/Agency
persistent table /dmo/agency
draft table /dmo/agency_d query /DMO/R_AgencyDraft
lock master
total etag LastChangedAt
authorization master ( global )
etag master LocalLastChangedAt
late numbering
extensible
{
  create;
  update;
  delete;

  field ( readonly ) AgencyID, LocalCreatedBy, LocalCreatedAt, LocalLastChangedBy, LocalLastChangedAt, LastChangedAt;
  field ( mandatory ) CountryCode, EMailAddress, Name;

  draft action Resume;
  draft action Edit;
  draft action Activate optimized;
  draft action Discard;

  // Validations for mandatory fields
  validation /DMO/validateEMailAddress on save { create; field EMailAddress; }
  validation /DMO/validateCountryCode on save { create; field CountryCode; }
  validation /DMO/validateName on save { create; field Name; }

  validation /DMO/validateLargeObject on save { create; field Attachment; field MimeType; field Filename; }

  draft determine action Prepare extensible
  {
    validation /DMO/validateEMailAddress;
    validation /DMO/validateCountryCode;
    validation /DMO/validateName;
    validation /DMO/validateLargeObject;
  }

  mapping for /dmo/agency corresponding extensible
    {
      AgencyId           = agency_id;
      Name               = name;
      Street             = street;
      PostalCode         = postal_code;
      City               = city;
      CountryCode        = country_code;
      PhoneNumber        = phone_number;
      EmailAddress       = email_address;
      WebAddress         = web_address;
      Attachment         = attachment;
      MimeType           = mime_type;
      Filename           = filename;
      LocalCreatedBy     = local_created_by;
      LocalCreatedAt     = local_created_at;
      LocalLastChangedBy = local_last_changed_by;
      LocalLastChangedAt = local_last_changed_at;
      LastChangedAt      = last_changed_at;
    }
}
</pre>

<pre class="pre-cyan">
class /DMO/BP_R_AGENCYTP definition
  public
  abstract
  final
  create public .

public section.
protected section.
private section.
ENDCLASS.



CLASS /DMO/BP_R_AGENCYTP IMPLEMENTATION.
ENDCLASS.
</pre>

<pre class="pre-cyan">
" behavior implementation of the business object /DMO/R_AGENCYTP

managed implementation in class /dmo/bp_r_agencytp unique;
strict ( 2 );
with draft;
extensible
{
  with determinations on modify;
  with determinations on save;
  with validations on save;
  with additional save;
}

define behavior for /DMO/R_AgencyTP alias /DMO/Agency
persistent table /dmo/agency
draft table /dmo/agency_d query /DMO/R_AgencyDraft
lock master
total etag LastChangedAt
authorization master ( global )
etag master LocalLastChangedAt
late numbering
extensible
{
  create;
  update;
  delete;

  field ( readonly ) AgencyID, LocalCreatedBy, LocalCreatedAt, LocalLastChangedBy, LocalLastChangedAt, LastChangedAt;
  field ( mandatory ) CountryCode, EMailAddress, Name;

  draft action Resume;
  draft action Edit;
  draft action Activate optimized;
  draft action Discard;

  // Validations for mandatory fields
  validation /DMO/validateEMailAddress on save { create; field EMailAddress; }
  validation /DMO/validateCountryCode on save { create; field CountryCode; }
  validation /DMO/validateName on save { create; field Name; }

  validation /DMO/validateLargeObject on save { create; field Attachment; field MimeType; field Filename; }

  draft determine action Prepare extensible
  {
    validation /DMO/validateEMailAddress;
    validation /DMO/validateCountryCode;
    validation /DMO/validateName;
    validation /DMO/validateLargeObject;
  }

  mapping for /dmo/agency corresponding extensible
    {
      AgencyId           = agency_id;
      Name               = name;
      Street             = street;
      PostalCode         = postal_code;
      City               = city;
      CountryCode        = country_code;
      PhoneNumber        = phone_number;
      EmailAddress       = email_address;
      WebAddress         = web_address;
      Attachment         = attachment;
      MimeType           = mime_type;
      Filename           = filename;
      LocalCreatedBy     = local_created_by;
      LocalCreatedAt     = local_created_at;
      LocalLastChangedBy = local_last_changed_by;
      LocalLastChangedAt = local_last_changed_at;
      LastChangedAt      = last_changed_at;
    }
}
</pre>

<pre class="pre-cyan">
" ABAP class /DMO/BP_R_AGENCYTP

class /DMO/BP_R_AGENCYTP definition
  public
  abstract
  final
  create public .

public section.
protected section.
private section.
ENDCLASS.



CLASS /DMO/BP_R_AGENCYTP IMPLEMENTATION.
ENDCLASS.
</pre>

<h2 id="S4D400_docx_Ex17">Exercise 17 - Modify Data Using EML</h2>

<pre class="pre-cyan">
CLASS zcl_ufh8n_eml_ex17 DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_eml_ex17 IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
  "Implement an EML statement to change the name of the travel agency with ID “0700##”. ( ## stands for your group number.)
  "This is AgencyID of 0700032 assuming 32 was your group number.
  "Declare an internal table | derived type for an EML update of entity /DMO/I_AgencyTP
  DATA agencies_upd TYPE TABLE FOR UPDATE /DMO/I_AgencyTP. "Ex17
  "I will use 32
  agencies_upd = VALUE #( ( agencyid = '070032' name = 'Luke is AWSOME!' ) ). "Ex17
  "Implement an EML statement MODIFY ENTITIES for the business object interface /DMO/I_AgencyTP.
  "Update the data of the root entity, ensuring that only the field NAME is changed.
  "Hint: Remember that the interface behavior defines alias name /DMO/Agency for the root entity /DMO/I_AgencyTP.
   MODIFY ENTITIES OF /dmo/i_agencytp
     ENTITY /dmo/agency
     UPDATE FIELDS ( name )
       WITH agencies_upd.

  COMMIT ENTITIES.
  "text literal
  out->write( `Method execution finished!` ).

  ENDMETHOD.
ENDCLASS.
</pre>

<h2 id="S4D400_docx_Ex18">Exercise 18 - Copy a Database Table</h2>
<pre class="pre-cyan">
"Copy database table /LRN/S4D400_APT to Z##FLIGHT which is ZUFH8NFLIGHT

@EndUserText.label : 'Template: RAP application'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table zufh8nflight {

  key client            : abap.clnt not null;
  key carrier_id        : /dmo/carrier_id not null;
  key connection_id     : /dmo/connection_id not null;
  key flight_date       : /dmo/flight_date not null;
  @Semantics.amount.currencyCode : 'zufh8nflight.currency_code'
  price                 : /dmo/flight_price;
  currency_code         : /dmo/currency_code;
  plane_type_id         : /dmo/plane_type_id;
  local_created_by      : abp_creation_user;
  local_created_at      : abp_creation_tstmpl;
  local_last_changed_by : abp_locinst_lastchange_user;
  local_last_changed_at : abp_locinst_lastchange_tstmpl;
  last_changed_at       : abp_lastchange_tstmpl;

}
</pre>

<pre class="pre-cyan">
CLASS zcl_ufh8n_copy DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS ZCL_UFH8N_COPY IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.

    CONSTANTS table_name TYPE tabname VALUE 'ZUFH8NFLIGHT'.

    TRY.
        DATA(copier) = NEW lcl_copy_data( table_name ).
        copier->copy_data( ).

        out->write( |{ table_name } was filled with data| ).

      CATCH cx_abap_not_a_table.

        out->write( |{ table_name } is not a table of the right type.| ).

    ENDTRY.
  ENDMETHOD.
ENDCLASS.
</pre>

<h2 id="S4D400_docx_Ex19">Exercise 19 - Generate and Preview an OData UI Service</h2>
<pre class="pre-cyan">
"Not real code, there is this:

@EndUserText.label : 'Service Definition for ZC_UFH8NFLIGHT'
@ObjectModel.leadingEntity.name : 'ZC_UFH8NFLIGHT'
define service ZUI_UFH8NFLIGHT_O4 provider contracts odata_v4_ui { 
expose ZC_UFH8NFLIGHT as Flight;
}
</pre>

<h2 id="S4D400_docx_Ex20">Exercise 20 - Validate Price and Currency</h2>
<p>This a messy and involved exercise - Might be easier to just re-do!</p>
<pre class="pre-cyan">
" behavior definition ZR_##FLIGHT

managed implementation in class ZBP_R_UFH8NFLIGHT unique;
strict ( 2 );
with draft;
extensible;
define behavior for ZR_UFH8NFLIGHT alias Flight
persistent table ZUFH8NFLIGHT
extensible
draft table ZUFH8NFLIGHT_D
etag master LocalLastChangedAt
lock master total etag LastChangedAt
authorization master( global )
{
  field ( mandatory : create )
   CarrierID,
   ConnectionID,
   FlightDate;

  field ( readonly )
   LocalCreatedBy,
   LocalCreatedAt,
   LocalLastChangedBy,
   LocalLastChangedAt,
   LastChangedAt;

  field ( readonly : update )
   CarrierID,
   ConnectionID,
   FlightDate;


  create;
  update;
  delete;

  draft action Activate optimized;
  draft action Discard;
  draft action Edit;
  draft action Resume;
  draft determine action Prepare;

  mapping for ZUFH8NFLIGHT corresponding extensible
  {
    CarrierID = carrier_id;
    ConnectionID = connection_id;
    FlightDate = flight_date;
    Price = price;
    CurrencyCode = currency_code;
    PlaneTypeID = plane_type_id;
    LocalCreatedBy = local_created_by;
    LocalCreatedAt = local_created_at;
    LocalLastChangedBy = local_last_changed_by;
    LocalLastChangedAt = local_last_changed_at;
    LastChangedAt = last_changed_at;
  }

}
</pre>

<pre class="pre-cyan">
"Local Type
"Before Code Changes

CLASS LHC_ZR_UFH8NFLIGHT DEFINITION INHERITING FROM CL_ABAP_BEHAVIOR_HANDLER.
  PRIVATE SECTION.
    METHODS:
      GET_GLOBAL_AUTHORIZATIONS FOR GLOBAL AUTHORIZATION
        IMPORTING
           REQUEST requested_authorizations FOR Flight
        RESULT result,
      validatePrice FOR VALIDATE ON SAVE
            IMPORTING keys FOR Flight~validatePrice.
ENDCLASS.

CLASS LHC_ZR_UFH8NFLIGHT IMPLEMENTATION.
  METHOD GET_GLOBAL_AUTHORIZATIONS.
  ENDMETHOD.
  METHOD validatePrice.
  ENDMETHOD.

ENDCLASS.

</pre>

<pre class="pre-cyan">
managed implementation in class ZBP_R_UFH8NFLIGHT unique;
strict ( 2 );
with draft;
extensible;
define behavior for ZR_UFH8NFLIGHT alias Flight
persistent table ZUFH8NFLIGHT
extensible
draft table ZUFH8NFLIGHT_D
etag master LocalLastChangedAt
lock master total etag LastChangedAt
authorization master( global )
{
  field ( mandatory : create )
   CarrierID,
   ConnectionID,
   FlightDate;

  field ( readonly )
   LocalCreatedBy,
   LocalCreatedAt,
   LocalLastChangedBy,
   LocalLastChangedAt,
   LastChangedAt;

  field ( readonly : update )
   CarrierID,
   ConnectionID,
   FlightDate;


  create;
  update;
  delete;
  validation validatePrice on save { create; field Price; }
  validation validateCurrencyCode on save { create; field CurrencyCode; }

  draft action Activate optimized;
  draft action Discard;
  draft action Edit;
  draft action Resume;
  draft determine action Prepare;

  mapping for ZUFH8NFLIGHT corresponding extensible
  {
    CarrierID = carrier_id;
    ConnectionID = connection_id;
    FlightDate = flight_date;
    Price = price;
    CurrencyCode = currency_code;
    PlaneTypeID = plane_type_id;
    LocalCreatedBy = local_created_by;
    LocalCreatedAt = local_created_at;
    LocalLastChangedBy = local_last_changed_by;
    LocalLastChangedAt = local_last_changed_at;
    LastChangedAt = last_changed_at;
  }

}
</pre>

<pre class="pre-cyan">
CLASS LHC_ZR_UFH8NFLIGHT DEFINITION INHERITING FROM CL_ABAP_BEHAVIOR_HANDLER.
  PRIVATE SECTION.
    METHODS:
      GET_GLOBAL_AUTHORIZATIONS FOR GLOBAL AUTHORIZATION
        IMPORTING
           REQUEST requested_authorizations FOR Flight
        RESULT result,
      validatePrice FOR VALIDATE ON SAVE
            IMPORTING keys FOR Flight~validatePrice,
      validateCurrencyCode FOR VALIDATE ON SAVE
            IMPORTING keys FOR Flight~validateCurrencyCode.
ENDCLASS.

CLASS LHC_ZR_UFH8NFLIGHT IMPLEMENTATION.
  METHOD GET_GLOBAL_AUTHORIZATIONS.
  ENDMETHOD.
  METHOD validatePrice.
    DATA failed_record  LIKE LINE OF failed-flight.
    DATA reported_record LIKE LINE OF reported-flight.

    "READ ENTITIES always reads the key fields.
    READ ENTITIES OF zr_ufh8nflight IN LOCAL MODE
      ENTITY flight
      FIELDS ( price )
        WITH CORRESPONDING #( keys )
        RESULT DATA(flights).

    LOOP AT flights INTO DATA(flight).
      IF flight-price <= 0.
        failed_record-%tky = flight-%tky.
        APPEND failed_record TO failed-flight.
        reported_record-%tky = flight-%tky.

        "Start Step 8
        reported_record-%msg =
          new_message(
            id = '/LRN/S4D400'
            number = '101'
            severity = if_abap_behv_message=>severity-error
            ).
        "End Step 8

        APPEND reported_record TO reported-flight.
      ENDIF.
    ENDLOOP.

  ENDMETHOD.

  METHOD validateCurrencyCode.
    DATA failed_record   LIKE LINE OF failed-flight.
    DATA reported_record LIKE LINE OF reported-flight.
    DATA exists TYPE abap_bool. "Step 2.5

    READ ENTITIES OF zr_ufh8nflight IN LOCAL MODE
    ENTITY flight
    FIELDS ( currencycode )
      WITH CORRESPONDING #( keys )
      RESULT DATA(flights).

    LOOP AT flights INTO DATA(flight).
      exists = abap_false.
      SELECT SINGLE FROM i_currency
        FIELDS @abap_true
        WHERE currency = @flight-currencycode
        INTO @exists.

        IF exists = abap_false. " the currency code is not valid
          failed_record-%tky = flight-%tky.
          APPEND failed_record TO failed-flight.

          reported_record-%tky = flight-%tky.


          reported_record-%msg =
            new_message(
              id       = '/LRN/S4D400'
              number   = '102'
              severity = if_abap_behv_message=>severity-error
              v1       = flight-currencycode
            ).
          APPEND reported_record TO reported-flight.
        ENDIF.

    ENDLOOP.
  ENDMETHOD.

ENDCLASS.

</pre>

<h2 id="S4D400_docx_Ex21">Exercise 21 - Adjust the User Interface</h2>

<pre class="pre-cyan">
" Project Behavior Definition for ZC_UFH8NFLIGHT
projection implementation in class ZBP_C_UFH8NFLIGHT unique;
strict ( 2 );
extensible;
use draft;
use side effects;
define behavior for ZC_UFH8NFLIGHT alias Flight
extensible
use etag
{
  use create;
  use update;
  use delete;

  use action Edit;
  use action Activate;
  use action Discard;
  use action Resume;
  use action Prepare;

}
</pre>

<pre class="pre-cyan">
projection implementation in class ZBP_C_UFH8NFLIGHT unique;
strict ( 2 );
extensible;
use draft;
use side effects;
define behavior for ZC_UFH8NFLIGHT alias Flight
extensible
use etag
{
  //use create;
  use update;
  //use delete;

  use action Edit;
  use action Activate;
  use action Discard;
  use action Resume;
  use action Prepare;

}
</pre>

<pre class="pre-cyan">
"Metadata Extension for ZC_UFH8NFLIGHT
"Before
@Metadata.layer: #CORE
@UI.headerInfo.title.type: #STANDARD
@UI.headerInfo.title.value: 'CarrierID'
@UI.headerInfo.description.type: #STANDARD
@UI.headerInfo.description.value: 'CarrierID'
annotate view ZC_UFH8NFLIGHT with
{
  @UI.facet: [ {
    label: 'General Information', 
    id: 'GeneralInfo', 
    purpose: #STANDARD, 
    position: 10 , 
    type: #IDENTIFICATION_REFERENCE
  } ]
  @UI.identification: [ {
    position: 10 
  } ]
  @UI.lineItem: [ {
    position: 10 
  } ]
  @UI.selectionField: [ {
    position: 10 
  } ]
  CarrierID;
  
  @UI.identification: [ {
    position: 20 
  } ]
  @UI.lineItem: [ {
    position: 20 
  } ]
  @UI.selectionField: [ {
    position: 20 
  } ]
  ConnectionID;
  
  @UI.identification: [ {
    position: 30 
  } ]
  @UI.lineItem: [ {
    position: 30 
  } ]
  @UI.selectionField: [ {
    position: 30 
  } ]
  FlightDate;
  
  @UI.identification: [ {
    position: 40 
  } ]
  @UI.lineItem: [ {
    position: 40 
  } ]
  @UI.selectionField: [ {
    position: 40 
  } ]
  Price;
  
  @UI.identification: [ {
    position: 50 
  } ]
  @UI.lineItem: [ {
    position: 50 
  } ]
  @UI.selectionField: [ {
    position: 50 
  } ]
  PlaneTypeID;
  
  @UI.identification: [ {
    position: 60 
  } ]
  @UI.lineItem: [ {
    position: 60 
  } ]
  @UI.selectionField: [ {
    position: 60 
  } ]
  LocalCreatedBy;
  
  @UI.identification: [ {
    position: 70 
  } ]
  @UI.lineItem: [ {
    position: 70 
  } ]
  @UI.selectionField: [ {
    position: 70 
  } ]
  LocalCreatedAt;
  
  @UI.identification: [ {
    position: 80 
  } ]
  @UI.lineItem: [ {
    position: 80 
  } ]
  @UI.selectionField: [ {
    position: 80 
  } ]
  LocalLastChangedBy;
  
  @UI.identification: [ {
    position: 90 
  } ]
  @UI.lineItem: [ {
    position: 90 
  } ]
  @UI.selectionField: [ {
    position: 90 
  } ]
  LocalLastChangedAt;
  
  @UI.identification: [ {
    position: 100 
  } ]
  @UI.lineItem: [ {
    position: 100 
  } ]
  @UI.selectionField: [ {
    position: 100 
  } ]
  LastChangedAt;
  
  @EndUserText.label: '_BaseEntity'
  @UI.identification: [ {
    position: 110 , 
    label: '_BaseEntity'
  } ]
  @UI.lineItem: [ {
    position: 110 , 
    label: '_BaseEntity'
  } ]
  @UI.selectionField: [ {
    position: 110 
  } ]
  _BaseEntity;
}
</pre>

<pre class="pre-cyan">
"When Done:

@Metadata.layer: #CORE
@UI.headerInfo.title.type: #STANDARD
@UI.headerInfo.title.value: 'CarrierID'
@UI.headerInfo.description.type: #STANDARD
@UI.headerInfo.description.value: 'CarrierID'
annotate view ZC_UFH8NFLIGHT with
{
  @UI.facet: [ {
    label: 'General Information', 
    id: 'GeneralInfo', 
    purpose: #STANDARD, 
    position: 10 , 
    type: #IDENTIFICATION_REFERENCE
  } ]
  @UI.identification: [ {
    position: 10 
  } ]
  @UI.lineItem: [ {
    position: 10 
  } ]
  @UI.selectionField: [ {
    position: 10 
  } ]
  CarrierID;
  
  @UI.identification: [ {
    position: 20 
  } ]
  @UI.lineItem: [ {
    position: 20 
  } ]
  @UI.selectionField: [ {
    position: 20 
  } ]
  ConnectionID;
  
  @UI.identification: [ {
    position: 30 
  } ]
  @UI.lineItem: [ {
    position: 30 
  } ]
  FlightDate;
  
  @UI.identification: [ {
    position: 35 
  } ]
  @UI.lineItem: [ {
    position: 50 
  } ]
  PlaneTypeID;
  
    
  @UI.identification: [ {
    position: 40 
  } ]
  @UI.lineItem: [ {
    position: 40 
  } ]
  Price;
  

  @UI.identification: [ {
    position: 60 
  } ]
  @UI.lineItem: [ {
    position: 60 
  } ]
  
  @UI.hidden: true
  LocalCreatedBy;
  
  @UI.identification: [ {
    position: 70 
  } ]
  @UI.lineItem: [ {
    position: 70 
  } ]
  
  @UI.hidden: true
  LocalCreatedAt;
  
  @UI.identification: [ {
    position: 80 
  } ]
  @UI.lineItem: [ {
    position: 80 
  } ]
  
  @UI.hidden: true
  LocalLastChangedBy;
  
  @UI.identification: [ {
    position: 90 
  } ]
  @UI.lineItem: [ {
    position: 90 
  } ]
  
  @UI.hidden: true
  LocalLastChangedAt;
  
  @UI.identification: [ {
    position: 100 
  } ]
  @UI.lineItem: [ {
    position: 100 
  } ]
  
  @UI.hidden: true
  LastChangedAt;
  
  @EndUserText.label: '_BaseEntity'
  @UI.identification: [ {
    position: 110 , 
    label: '_BaseEntity'
  } ]
  @UI.lineItem: [ {
    position: 110 , 
    label: '_BaseEntity'
  } ]
  
  _BaseEntity;
}
</pre>

<h1>END: S4D400 - Basic ABAP Programming - Practice System</h1>

<h1 id="SAP_BTP_TrialSystm">Learning the Basics of ABAP Programming on SAP BTP</h1>
<h1>SAP_Training_Exercise.docx</h1>
<pre class="pre-yellow">
This is 150 page, 6.05MB file consisting of 20 exercises.
It is this file were I thought it would be great idea to use: T_02_E.. 
T_02 Learning the Basics of ABAP Programming on SAP BTP
T_01 S4D400 - Basic ABAP Programming

This was done around 23/09/2025 to 01/10/2025
</pre>


<a href="#SAP_BTP_TrialSystm_EX01">Exercise_01 - Customize ABAP Perspective in Eclipse</a><br/>
<a href="#SAP_BTP_TrialSystm_EX02">Exercise_02 - Create an ABAP Instance and Service Key</a><br/>
<a href="#SAP_BTP_TrialSystm_EX03">Exercise_03 - Create your ABAP Cloud Project</a><br/>
<a href="#SAP_BTP_TrialSystm_EX04">Exercise_04 - Create a Package</a><br/>
<a href="#SAP_BTP_TrialSystm_EX05">Exercise_05 - Create a Hello World Application</a><br/>
<a href="#SAP_BTP_TrialSystm_EX06">Exercise_06 - String Manipulation</a><br/>
<a href="#SAP_BTP_TrialSystm_EX07">Exercise_07 - Implement an IF statement</a><br/>
<a href="#SAP_BTP_TrialSystm_EX08">Exercise_08 - String Manipulation</a><br/>
<a href="#SAP_BTP_TrialSystm_EX09">Exercise_09 - Implement a DO - ENDDO Loop</a><br/>
<a href="#SAP_BTP_TrialSystm_EX10">Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition</a><br/>
<a href="#SAP_BTP_TrialSystm_EX11">Exercise_11 - Use Conditional Logic to Avoid a Runtime Error</a><br/>
<a href="#SAP_BTP_TrialSystm_EX12">Exercise_12 - Create a Database Table</a><br/>
<a href="#SAP_BTP_TrialSystm_EX13">Exercise_13 - Generate Additional Objects</a><br/>
<a href="#SAP_BTP_TrialSystm_EX14">Exercise_14 - Enable Search Capabilities</a><br/>
<a href="#SAP_BTP_TrialSystm_EX15">Exercise_15 - Modify Behaviour</a><br/>
<a href="#SAP_BTP_TrialSystm_EX16">Exercise_16 - Check Product Expiration</a><br/>
<a href="#SAP_BTP_TrialSystm_EX17">Exercise_17 - Enhance User Interface</a><br/>
<a href="#SAP_BTP_TrialSystm_EX18">Exercise_18 - Publish the Sustainable Grocery App</a><br/>
<a href="#SAP_BTP_TrialSystm_EX19">Exercise_19 - Test the Sustainable Grocery App</a><br/>
<a href="#SAP_BTP_TrialSystm_EX20">Exercise_20 - Debug an ABAP Application and Set a Watchpoint</a><br/>

<h2 id="SAP_BTP_TrialSystm_EX01">Exercise_01 - Customize ABAP Perspective in Eclipse</h2>
<pre class="pre-yellow">
No Code
</pre>

<h2 id="SAP_BTP_TrialSystm_EX02">Exercise_02 - Create an ABAP Instance and Service Key</h2>
<pre class="pre-yellow">
No Code
</pre>

<h2 id="SAP_BTP_TrialSystm_EX03">Exercise_03 - Create your ABAP Cloud Project</h2>
<pre class="pre-yellow">
No Code
</pre>

<h2 id="SAP_BTP_TrialSystm_EX04">Exercise_04 - Create a Package</h2>
<pre class="pre-yellow">
No Code
</pre>

<h2 id="SAP_BTP_TrialSystm_EX05">Exercise_05 - Create a Hello World Application</h2>
<pre class="pre-yellow">
CLASS zcl_01_hello_world_ufh8n DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_01_hello_world_ufh8n IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
  ENDMETHOD.
ENDCLASS.
</pre>

<pre class="pre-yellow">
  METHOD if_oo_adt_classrun~main.
    out->write(  | Hello World ~ From UFH8N! | ).
  ENDMETHOD.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX06">Exercise_06 - String Manipulation</h2>
<pre class="pre-yellow">
      WHEN 6.
        out->write( |Exercise06| ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Process Character Strings
        "Exercise_06 - String Manipulation
        "I will use this code and not make a new Class ZCL_S4D100_XX_COND or ZCL_S4D100_XX_CASE OR ZCL_S4D100_XX_CHAR

        "ToDo: I should proably do this step by step but I do not want heaps of different classes

        "DATA lv_06_c_number0
        DATA: lv_06_lv_full_name TYPE string VALUE 'Luke Lethborg',
              lv_first_name      TYPE string,
              lv_last_name       TYPE string.

       SPLIT lv_06_lv_full_name AT '' INTO lv_first_name lv_last_name.

       out->write(  |user: { lv_first_name  }| ).
</pre>

<h2 id="SAP_BTP_TrialSystm_EX07">Exercise_07 - Implement an IF statement</h2>
<pre class="pre-yellow">
      WHEN 8.
        out->write( 'Exercise_07 - Implement an IF statement' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implement an IF Statement
        "Exercise_07 - Implement an IF statement
        "Lesson: Implementing Conditional Logic

        "I will not create a new ABAP CLass ZCL_S4D100_XX_COND
        "Define constant C_NUMBER0 with value 0
        "Use if to show message when value of constant is zero or not

        CONSTANTS lv_08_c_number0 TYPE i VALUE 0.
        out->write( '--------------------------------' ).
        out->write( 'Example 1: IF..ELSE..ENDIF' ).
        out->write( '--------------------------------' ).

        IF lv_08_c_number0 = 0.
          out->write( 'The value of lv_08_c_number0 equals zero' ).
        ELSE.
          out->write( 'The value of lv_08_c_number0 equals some number other than zero' ).
        ENDIF.

</pre>

<h2 id="SAP_BTP_TrialSystm_EX08">Exercise_08 - String Manipulation</h2>
<pre class="pre-yellow">
      WHEN 10.
        out->write( 'WHEN 10' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Process Character Strings
        "Exercise_08 – String Manipulation
        "Lesson: Implementing Conditional Logic

        "I will not create class ZCL_S4D100_XX_COND or ZCL_S4D100_XX_CASE
        "Or ZCL_S4D100_XX_CHAR

        "Note: There is no need to do Step 2, that was the last exercise.

        "This exercise is the same as the one few exercises earlier.
        "The follow along is the same too.
        "It should be something about case statements

        DATA: lv_10_lv_full_name  TYPE string VALUE 'Luke Lethborg',
              lv_10_lv_first_name TYPE string,
              lv_10_lv_last_name  Type string.

        SPLIT lv_10_lv_full_name AT '' INTO lv_10_lv_first_name lv_10_lv_last_name.

        out->write(  |User: { lv_10_lv_first_name  }| ).
</pre>

<h2 id="SAP_BTP_TrialSystm_EX09">Exercise_09 - Implement a DO - ENDDO Loop</h2>
<pre class="pre-yellow">
      WHEN 12.
        out->write( 'Exercise_09 - Implement a DO - ENDDO Loop' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implementing Loops
        "Exercise_09 - Implement a DO - ENDDO Loop
        "Lesson:  Implement a DO - ENDDO Loop

        "I will not create a class ZCL_S4D100_XX_DO_ENDDO or ZCL_S4D100_XX_ENDDO
        CONSTANTS: c_12_number0 TYPE i VALUE 3.
        out->write( '--------------------------------' ).
        out->write( 'Example 1: DO...ENDDO with TIMES' ).
        out->write( '--------------------------------' ).

        DO c_12_number0 TIMES.
          out->write( 'Hello Luke!' ).
        ENDDO.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX10">Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition</h2>
<pre class="pre-yellow">
      WHEN 13.
        out->write( 'Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implementing Loops
        "Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition

        "I will not create the Class ZCL_S4D100_XX_DO_ENDDO
        "I will not create the Class ZCL_S4D100_XX_EXIT

        CONSTANTS: c_13_number0 TYPE i VALUE 3.
        DATA:      lv_13_number0 TYPE i.

        lv_13_number0 = c_13_number0 * c_13_number0.

        "Count backwards from lv_13_number0 to c_13_number0

        DO.
          out->write( |{ sy-index }: Value of lv_13_number0: { lv_13_number0 }| ).
          lv_13_number0 = lv_13_number0 - 1.
          "Question: Can we use -- like in other languages?

          "Abort condition
          IF lv_13_number0 <= c_13_number0. " If 3 = 3
            EXIT.
          ENDIF.
        ENDDO.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX11">Exercise_11 - Use Conditional Logic to Avoid a Runtime Error</h2>
<pre class="pre-yellow">
      WHEN 15.
        out->write(  |Exercise_11| ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Analyzing Runtime Error
        "Exercise_11 - Use Conditional Logic to Avoid a Runtime Error

        "I will not create a ABAP Class ZCL_XX_DUMP

        DATA: lv_15_mths     TYPE i VALUE 0,  "10, "No. of months remaining in year
              lv_15_hols     TYPE i VALUE 20, "No. of days untaken vacation
              lv_15_avg_hols TYPE i.

              IF lv_15_mths NE 0. "Could have used <>
                lv_15_avg_hols = lv_15_hols / lv_15_mths.
                out->write(  |Average vactaion days per month { lv_15_avg_hols }| ).
              ELSE.
                out->write( |Please ask to roll over remaining vacation| ).
              ENDIF.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX12">Exercise_12 - Create a Database Table</h2>
<pre class="pre-yellow">
"Default is:
@EndUserText.label : 'Groceries'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table zgrocery_ufh8n {

  key client : abap.clnt not null;

}
</pre>

<pre class="pre-yellow">
@EndUserText.label : 'Groceries'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table ZGrocery_UFH8N {

  key client : abap.clnt not null;
  key id : sysuuid_x16 not null;
  product : abap.char(40);
  category : abap.char(40);
  brand : abap.char(40);
  @Semantics.amount.currencyCode : 'ZGrocery_UFH8N.currency'
  price : abap.curr(10,2);
  currency : abap.cuky;
  quantity : abap.int2;
  purchasedate : abap.dats;
  expirationdate : abap.dats;
  expired : abap_boolean;
  rating : abap.fltp;
  note : abap.char(255);
  createdby : abp_creation_user;
  createdat : tzntstmpl;
  lastchangedby : abp_lastchange_user;
  lastchangedat : abp_lastchange_tstmpl;
  locallastchanged : abp_locinst_lastchange_tstmpl;

}
</pre>

<h2 id="SAP_BTP_TrialSystm_EX13">Exercise_13 - Generate Additional Objects</h2>
<pre class="pre-yellow">
" Mostly GUI based but there was some code:

@EndUserText.label : 'Service Definition for ZC_GROCERY_UFH8N'
@ObjectModel.leadingEntity.name : 'ZC_GROCERY_UFH8N'
define service ZUI_GROCERY_UFH8N_O4 provider contracts odata_v4_ui { 
expose ZC_GROCERY_UFH8N as Grocery;
}
</pre>

<h2 id="SAP_BTP_TrialSystm_EX14">Exercise_14 - Enable Search Capabilities</h2>
<pre class="pre-yellow">
@Metadata.allowExtensions: true
@Metadata.ignorePropagatedAnnotations: true
@Endusertext: {
  Label: '###GENERATED Core Data Service Entity'
}
@Objectmodel: {
  Sapobjectnodetype.Name: 'ZGROCERY_UFH8N'
}
@AccessControl.authorizationCheck: #MANDATORY
define root view entity ZC_GROCERY_UFH8N
  provider contract TRANSACTIONAL_QUERY
  as projection on ZR_GROCERY_UFH8N
  association [1..1] to ZR_GROCERY_UFH8N as _BaseEntity on $projection.ID = _BaseEntity.ID
{
  key ID,
  Product,
  Category,
  Brand,
  @Semantics: {
    Amount.Currencycode: 'Currency'
  }
  Price,
  @Consumption: {
    Valuehelpdefinition: [ {
      Entity.Element: 'Currency', 
      Entity.Name: 'I_CurrencyStdVH', 
      Useforvalidation: true
    } ]
  }
  Currency,
  Quantity,
  Purchasedate,
  Expirationdate,
  Expired,
  Rating,
  Note,
  @Semantics: {
    User.Createdby: true
  }
  Createdby,
  Createdat,
  @Semantics: {
    User.Lastchangedby: true
  }
  Lastchangedby,
  @Semantics: {
    Systemdatetime.Lastchangedat: true
  }
  Lastchangedat,
  @Semantics: {
    Systemdatetime.Localinstancelastchangedat: true
  }
  Locallastchanged,
  _BaseEntity
}
</pre>

<pre class="pre-yellow">
@AccessControl.authorizationCheck: #CHECK
 @Metadata.allowExtensions: true
 @Search: { searchable: true }
 @EndUserText.label: 'Projection View for ZR_GROCERY_UFH8N'
 define root view entity ZC_GROCERY_UFH8N
  provider contract transactional_query
  as projection on ZR_GROCERY_UFH8N
{
    key ID,
    @Search.defaultSearchElement: true
    Product,
    @Search.defaultSearchElement: true
    Category,
    @Search.defaultSearchElement: true
    Brand,
    Price,
    Currency,
    Quantity,
    Purchasedate,
    @Search.defaultSearchElement: true    
    Expirationdate,
    @Search.defaultSearchElement: true
    Expired,
    @Search.defaultSearchElement: true
    Rating,
    Note,
    Createdby,
    Createdat,
    Lastchangedby,
    Locallastchanged
}
</pre>

<h2 id="SAP_BTP_TrialSystm_EX15">Exercise_15 - Modify Behaviour</h2>
<pre class="pre-yellow">
Note: Would be easier to redo:
</pre>

<pre class="pre-yellow">
managed implementation in class ZBP_R_GROCERY_UFH8N unique;
strict ( 2 );
with draft;
extensible;
define behavior for ZR_GROCERY_UFH8N alias Grocery
persistent table ZGROCERY_UFH8N
extensible
draft table ZGROCERY_UFH8N_D
etag master Locallastchanged
lock master total etag Lastchangedat
authorization master( global )
{
  field ( readonly )
   ID,
   Createdby,
   Lastchangedby,
   Lastchangedat,
   Locallastchanged;

  field ( numbering : managed )
   ID;


  create;
  update;
  delete;

  draft action Activate optimized;
  draft action Discard;
  draft action Edit;
  draft action Resume;
  draft determine action Prepare;

  mapping for ZGROCERY_UFH8N corresponding extensible
  {
    ID = id;
    Product = product;
    Category = category;
    Brand = brand;
    Price = price;
    Currency = currency;
    Quantity = quantity;
    Purchasedate = purchasedate;
    Expirationdate = expirationdate;
    Expired = expired;
    Rating = rating;
    Note = note;
    Createdby = createdby;
    Createdat = createdat;
    Lastchangedby = lastchangedby;
    Lastchangedat = lastchangedat;
    Locallastchanged = locallastchanged;
  }

}
</pre>

<pre class="pre-yellow">
managed implementation in class ZBP_R_GROCERY_UFH8N unique;
strict ( 2 );
with draft;

define behavior for ZR_GROCERY_UFH8N alias Grocery
persistent table ZGrocery_UFH8N
draft table ZGROCERY_UFH8N_D
etag master LocalLastChanged
lock master total etag LastChangeDat
authorization master( global )

{
  field ( readonly )
  ID,


  field ( numbering : managed )
  ID;

  create;
  update;
  delete;

  draft action Edit;
  draft action Activate optimized;
  draft action Discard;
  draft action Resume;
  draft determine action Prepare;



  mapping for ZGrocery_UFH8N
  {
    ID = id;
    Product = product;
    Category = category;
    Brand = brand;
    Price = price;
    Currency = currency;
    Quantity = quantity;
    PurchaseDate = purchasedate;
    ExpirationDate = expirationdate;
    Expired = expired;
    Rating = rating;
    Note = note;
    CreatedBy = createdby;
    CreatedAt = createdat;
    LastChangedBy = lastchangedby;
    LastChangeDat = lastchangedat;
    LocalLastChanged = locallastchanged;
  }
}
</pre>

<pre class="pre-yellow">
"Mine when done:
managed implementation in class ZBP_R_GROCERY_UFH8N unique;
strict ( 2 );
with draft;
extensible;
define behavior for ZR_GROCERY_UFH8N alias Grocery
persistent table ZGROCERY_UFH8N
extensible
draft table ZGROCERY_UFH8N_D
etag master Locallastchanged
lock master total etag Lastchangedat
authorization master( global )
{
  field ( readonly )
   ID,
   Createdby,
   CreatedAt,
   Lastchangedby,
   Lastchangedat,
   Locallastchanged;

  action checkExpirationDate result[1] $self;

  field ( numbering : managed )
   ID;

  create;
  update;
  delete;

  draft action Activate optimized;
  draft action Discard;
  draft action Edit;
  draft action Resume;
  draft determine action Prepare;

  mapping for ZGROCERY_UFH8N corresponding extensible
  {
    ID = id;
    Product = product;
    Category = category;
    Brand = brand;
    Price = price;
    Currency = currency;
    Quantity = quantity;
    Purchasedate = purchasedate;
    Expirationdate = expirationdate;
    Expired = expired;
    Rating = rating;
    Note = note;
    Createdby = createdby;
    Createdat = createdat;
    Lastchangedby = lastchangedby;
    Lastchangedat = lastchangedat;
    Locallastchanged = locallastchanged;
  }

}
</pre>

<pre class="pre-yellow">
CLASS LHC_ZR_GROCERY_UFH8N DEFINITION INHERITING FROM CL_ABAP_BEHAVIOR_HANDLER.
  PRIVATE SECTION.
    METHODS:
      GET_GLOBAL_AUTHORIZATIONS FOR GLOBAL AUTHORIZATION
        IMPORTING
           REQUEST requested_authorizations FOR Grocery
        RESULT result,
      checkExpirationDate FOR MODIFY
            IMPORTING keys FOR ACTION Grocery~checkExpirationDate RESULT result.
ENDCLASS.

CLASS LHC_ZR_GROCERY_UFH8N IMPLEMENTATION.
  METHOD GET_GLOBAL_AUTHORIZATIONS.
  ENDMETHOD.
  METHOD checkExpirationDate.
  ENDMETHOD.

ENDCLASS.
</pre>

<pre class="pre-yellow">
"Code After I modified a little

projection implementation in class ZBP_C_GROCERY_UFH8N unique;
strict ( 2 );
extensible;
use draft;
use side effects;
define behavior for ZC_GROCERY_UFH8N alias Grocery
extensible
use etag
{
  use create;
  use update;
  use delete;

  use action Edit;
  use action Activate;
  use action Discard;
  use action Resume;
  use action Prepare;

  use action checkExpirationDate;
}
</pre>


<pre class="pre-yellow">
" Mine when done:

projection implementation in class ZBP_C_GROCERY_UFH8N unique;
strict ( 2 );
extensible;
use draft;
use side effects;
define behavior for ZC_GROCERY_UFH8N alias Grocery
extensible
use etag
{
  use create;
  use update;
  use delete;

  use action Edit;
  use action Activate;
  use action Discard;
  use action Resume;
  use action Prepare;

  use action checkExpirationDate;
}
</pre>

<h2 id="SAP_BTP_TrialSystm_EX16">Exercise_16 - Check Product Expiration</h2>
<pre class="pre-yellow">
Code a little hard to follow - Might be easier to redo.
</pre>

<pre class="pre-yellow">
CLASS LHC_ZR_GROCERY_UFH8N_B DEFINITION INHERITING FROM CL_ABAP_BEHAVIOR_HANDLER.
  PRIVATE SECTION.
    METHODS:
      GET_GLOBAL_AUTHORIZATIONS FOR GLOBAL AUTHORIZATION
        IMPORTING
           REQUEST requested_authorizations FOR Grocery
        RESULT result,
      checkExpirationDate FOR MODIFY
            IMPORTING keys FOR ACTION Grocery~checkExpirationDate RESULT result.
ENDCLASS.

CLASS LHC_ZR_GROCERY_UFH8N_B IMPLEMENTATION.
  METHOD GET_GLOBAL_AUTHORIZATIONS.
  ENDMETHOD.
  METHOD checkExpirationDate.
    DATA: lt_groceries TYPE TABLE FOR READ RESULT ZR_GROCERY_UFH8N_B,
          ls_grocery TYPE STRUCTURE FOR READ RESULT ZR_GROCERY_UFH8N_B,
          lv_expiration TYPE d,
          lv_current_date TYPE d,
          lv_expired TYPE abap_boolean,
          lt_update_groceries TYPE TABLE FOR UPDATE ZR_GROCERY_UFH8N_B  .

    READ ENTITIES OF ZR_GROCERY_UFH8N_B
      IN LOCAL MODE ENTITY Grocery
      ALL FIELDS WITH CORRESPONDING #( keys )
      RESULT lt_groceries.

    LOOP AT lt_groceries INTO ls_grocery.
      lv_expiration = ls_grocery-Expirationdate.
      lv_current_date = cl_abap_context_info=>get_system_date( ).
      IF lv_expiration < lv_current_date.
        lv_expired = abap_true.
      ELSE.
        lv_expired = abap_false.
      ENDIF.

    APPEND VALUE #( id = ls_grocery-Id expired = lv_expired )
      TO lt_update_groceries.
    MODIFY ENTITIES OF ZR_GROCERY_UFH8N_B IN LOCAL MODE
      ENTITY Grocery
      UPDATE FIELDS ( expired )
      WITH lt_update_groceries.
    ENDLOOP.

    result = VALUE #( FOR groceries IN lt_groceries
      ( id = groceries-id %param = groceries ) ).
  ENDMETHOD.

ENDCLASS.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX17">Exercise_17 - Enhance User Interface</h2>
<pre class="pre-yellow">
I ran into issues in this exercise. Might be better to re-try.
</pre>

<pre class="pre-yellow">
@Metadata.layer: #CORE
@UI.headerInfo.title.type: #STANDARD
@UI.headerInfo.title.value: 'ID'
@UI.headerInfo.description.type: #STANDARD
@UI.headerInfo.description.value: 'ID'
annotate view ZC_GROCERY_UFH8N_B with
{
  @EndUserText.label: 'ID'
  @UI.facet: [ {
    label: 'General Information', 
    id: 'GeneralInfo', 
    purpose: #STANDARD, 
    position: 10 , 
    type: #IDENTIFICATION_REFERENCE
  } ]
  @UI.identification: [ {
    position: 10 , 
    label: 'ID'
  } ]
  @UI.lineItem: [ {
    position: 10 , 
    label: 'ID'
  } ]
  @UI.selectionField: [ {
    position: 10 
  } ]
  ID;
  @EndUserText.label: 'Product'
  @UI.identification: [ {
    position: 20 , 
    label: 'Product'
  } ]
  @UI.lineItem: [ {
    position: 20 , 
    label: 'Product'
  } ]
  @UI.selectionField: [ {
    position: 20 
  } ]
  Product;
  
  @EndUserText.label: 'Category'
  @UI.identification: [ {
    position: 30 , 
    label: 'Category'
  } ]
  @UI.lineItem: [ {
    position: 30 , 
    label: 'Category'
  } ]
  @UI.selectionField: [ {
    position: 30 
  } ]
  Category;
  
  @EndUserText.label: 'Brand'
  @UI.identification: [ {
    position: 40 , 
    label: 'Brand'
  } ]
  @UI.lineItem: [ {
    position: 40 , 
    label: 'Brand'
  } ]
  @UI.selectionField: [ {
    position: 40 
  } ]
  Brand;
  
  @EndUserText.label: 'Price'
  @UI.identification: [ {
    position: 50 , 
    label: 'Price'
  } ]
  @UI.lineItem: [ {
    position: 50 , 
    label: 'Price'
  } ]
  @UI.selectionField: [ {
    position: 50 
  } ]
  Price;
  
  @EndUserText.label: 'Quantity'
  @UI.identification: [ {
    position: 60 , 
    label: 'Quantity'
  } ]
  @UI.lineItem: [ {
    position: 60 , 
    label: 'Quantity'
  } ]
  @UI.selectionField: [ {
    position: 60 
  } ]
  Quantity;
  
  @EndUserText.label: 'Purchasedate'
  @UI.identification: [ {
    position: 70 , 
    label: 'Purchasedate'
  } ]
  @UI.lineItem: [ {
    position: 70 , 
    label: 'Purchasedate'
  } ]
  @UI.selectionField: [ {
    position: 70 
  } ]
  Purchasedate;
  
  @EndUserText.label: 'Expirationdate'
  @UI.identification: [ {
    position: 80 , 
    label: 'Expirationdate'
  } ]
  @UI.lineItem: [ {
    position: 80 , 
    label: 'Expirationdate'
  } ]
  @UI.selectionField: [ {
    position: 80 
  } ]
  Expirationdate;
  
  @EndUserText.label: 'Expired'
  @UI.identification: [ {
    position: 90 , 
    label: 'Expired'
  } ]
  @UI.lineItem: [ {
    position: 90 , 
    label: 'Expired'
  } ]
  @UI.selectionField: [ {
    position: 90 
  } ]
  Expired;
  
  @EndUserText.label: 'Rating'
  @UI.identification: [ {
    position: 100 , 
    label: 'Rating'
  } ]
  @UI.lineItem: [ {
    position: 100 , 
    label: 'Rating'
  } ]
  @UI.selectionField: [ {
    position: 100 
  } ]
  Rating;
  
  @EndUserText.label: 'Note'
  @UI.identification: [ {
    position: 110 , 
    label: 'Note'
  } ]
  @UI.lineItem: [ {
    position: 110 , 
    label: 'Note'
  } ]
  @UI.selectionField: [ {
    position: 110 
  } ]
  Note;
  
  @UI.identification: [ {
    position: 120 
  } ]
  @UI.lineItem: [ {
    position: 120 
  } ]
  @UI.selectionField: [ {
    position: 120 
  } ]
  Createdby;
  
  @UI.identification: [ {
    position: 130 
  } ]
  @UI.lineItem: [ {
    position: 130 
  } ]
  @UI.selectionField: [ {
    position: 130 
  } ]
  Createdat;
  
  @UI.identification: [ {
    position: 140 
  } ]
  @UI.lineItem: [ {
    position: 140 
  } ]
  @UI.selectionField: [ {
    position: 140 
  } ]
  Lastchangedby;
  
  @UI.identification: [ {
    position: 150 
  } ]
  @UI.lineItem: [ {
    position: 150 
  } ]
  @UI.selectionField: [ {
    position: 150 
  } ]
  Lastchangedat;
  
  @UI.identification: [ {
    position: 160 
  } ]
  @UI.lineItem: [ {
    position: 160 
  } ]
  @UI.selectionField: [ {
    position: 160 
  } ]
  Locallastchanged;
  
  @EndUserText.label: '_BaseEntity'
  @UI.identification: [ {
    position: 170 , 
    label: '_BaseEntity'
  } ]
  @UI.lineItem: [ {
    position: 170 , 
    label: '_BaseEntity'
  } ]
  @UI.selectionField: [ {
    position: 170 
  } ]
  _BaseEntity;
}
</pre>

<pre class="pre-yellow">
</pre>

<h2 id="SAP_BTP_TrialSystm_EX18">Exercise_18 - Publish the Sustainable Grocery App</h2>

<pre class="pre-yellow">
No Code to add.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX19">Exercise_19 - Test the Sustainable Grocery App</h2>
<pre class="pre-yellow">
No Code to add.
</pre>

<h2 id="SAP_BTP_TrialSystm_EX20">Exercise_20 - Debug an ABAP Application and Set a Watchpoint</h2>
<pre class="pre-yellow">
No Code to add.
</pre>

<h2 id="Code_List_01">My Code: Tue 23_09_2025</h2>
<pre class="pre-yellow">
CLASS zcl_01_hello_world_ufh8n DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    METHODS code_run_01.
    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_01_hello_world_ufh8n IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
  "Rather than make 100 different classes, I will use this as my main class
  "Doing so I can try out the diagrams too.
  " Activate | CTRL+F3
  " Run      | F9
  " CTRL + Space for Code suggestions
  " F2 shows technical details like you see in SE11
  " F3 allows edits of technical details

    DATA code_run TYPE INT4.
    code_run = 2.


    CASE code_run.
      WHEN 1.
        "Exercise_05 - Create a Hello World Application
        "Source: Unit 2 - Getting Started on ABAP Development Environment
        "Lesson: 4      - Developing your first ABAP Application
        out->write(  | Hello World ~ From UFH8N! | ).
        code_run_01( ).
      WHEN 2.
        "Examples from 'Introducing ABAP syntax'
        DATA my_var1 TYPE i.
        DATA my_var2 TYPE string.
        DATA my_var3 TYPE string VALUE `Hello Luke`.
        DATA my_var4 TYPE string VALUE 'Hello there Luke'.
        TYPES my_type TYPE p LENGTH 3 DECIMALS 2.
        DATA my_var5 TYPE my_type.
        DATA airport TYPE /DMO/AIRPORT_ID. " Try F2 and F3 here
        CONSTANTS my_const1 TYPE i VALUE 12345.
        CONSTANTS my_const2 TYPE string VALUE `Hello Luke!`.
        CONSTANTS my_const3 TYPE c LENGTH 3 VALUE IS INITIAL.

        TYPES BEGIN OF my_struct1.
          TYPES name_first TYPE string.
          TYPES name_last  TYPE string.
        TYPES END OF my_struct1.

        TYPES: BEGIN OF my_struct2,
          name_first TYPE string,
          name_last  TYPE string,
        END OF my_struct2.

        "Examples from 'Processing Data'.
        DATA name TYPE c LENGTH 10.
        DATA my_var_i_1 TYPE i.
        DATA my_var_i_2 TYPE i.
        my_var2 = `Hello LukeO`.
        my_var1 =  17.
        my_var_i_1 =  my_var1.
        my_var_i_2 = my_var1 + my_var_i_1.

        CLEAR my_var2.

        DATA my_total TYPE i.
        DATA my_average TYPE i.
        DATA my_amount1 TYPE i VALUE 10.
        DATA my_amount2 TYPE i VALUE 20.
        my_total = my_amount1 + my_amount2.
        my_average = (  2 * my_amount1 + 3 * my_amount2 ) / 5.


        "Operators

        DATA my_value_01 TYPE i VALUE 10.
        DATA my_value_02 TYPE i VALUE 20.
        DATA my_math_01  TYPE i.

        DATA my_addition TYPE i.
        DATA my_subtraction TYPE i.
        DATA my_multiplication TYPE i.
        DATA my_division TYPE i.

        my_addition = my_value_01 + my_value_02.
        my_subtraction = my_value_01 - my_value_02.
        my_multiplication = my_value_01 * my_value_02.
        IF my_value_02 NE 0.
          my_division = my_value_01 / my_value_02.
        ENDIF.

        "Multiplication and Division before Addition and subtraction
        "Left to Right

        my_math_01 = 10 + 5 - 4 * 10 + 4 / 2 + 2.
        "It should be 4 * 10 = 40
        "10 + 5 - 40 + 4 / 2 + 2.
        "4 / 2 = 2
        "10 + 5 - 40 + 2 + 2.
        "10+5-40+2+2
        " = -21 | And so it is

        out->write(  | Show Value: | ).
        out->write(  my_math_01 ).

        "ToDo: sqrt()
        "ToDo: ipow()

        "Break at "Processing Data" -

        "ToDo: Exercise_06 – String Manipulation
      WHEN 3.

      WHEN OTHERS.
      out->write(  | Please enter a valid value. | ).
    ENDCASE.



  ENDMETHOD.

  METHOD code_run_01.
    "BREAK-POINT. "Not allowed in the current ABAP language version
  ENDMETHOD.
ENDCLASS.
</pre>

<h2 id="Code_List_02">My Code: Tue 25_09_2025</h2>
<pre class="pre-yellow">
CLASS zcl_01_hello_world_ufh8n DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    METHODS code_run_01.
    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_01_hello_world_ufh8n IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
  "Rather than make 100 different classes, I will use this as my main class
  "Doing so I can try out the diagrams too.
  " Activate | CTRL+F3
  " Run      | F9
  " CTRL + Space for Code suggestions
  " F2 shows technical details like you see in SE11
  " F3 allows edits of technical details
  " Code Completion is "CTRL + Space"
  " CTRL + F2 = Syntax Check
  " CTRL + F3 = Activation
    DATA code_run TYPE INT4.
    code_run = 15.


    CASE code_run.
      WHEN 1.
        "Exercise_05 - Create a Hello World Application
        "Source: Unit 2 - Getting Started on ABAP Development Environment
        "Lesson: 4      - Developing your first ABAP Application

        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Exercise_05 - Create a Hello World Application
        out->write(  | Hello World ~ From UFH8N! | ). "This was Exercise 'Create a Hello World Application'
        code_run_01( ).
      WHEN 2.
        "Examples from 'Introducing ABAP syntax'
        "Data Objects on in ABAP
        "Variables, Constants, Literals

        "Image01
        "Declaration of Variables
        "Data, Type, Value
        DATA my_var1 TYPE i.
        DATA my_var2 TYPE string.
        DATA my_var3 TYPE string VALUE `Hello Luke`.

        "Use of Data Types
        "ABAP Built-in, TYPES Statement, ABAP Dictionary

        "ABAP Built-in (Predefined ABAP Types)
        "Complete ABAP Types: String, i, d, t
        "Incomplete ABAP Types: c, n, p
        DATA my_var4 TYPE string VALUE 'Hello there Luke'.

        "Practice with ABAP Built-in (Predefined ABAP Types)
        out->write( 'Practice with ABAP Built-in (Predefined ABAP Types)' ).
        DATA my_02_value_01 TYPE string VALUE 'Luke'.
        DATA my_02_value_02 TYPE i VALUE 10.
        DATA my_02_value_03 TYPE d VALUE '20250925'.
        DATA my_02_value_04 TYPE t VALUE '151545'.
        DATA my_02_value_05 TYPE c LENGTH 10 VALUE 'HappyDays!'.
        DATA my_02_value_06 TYPE n LENGTH 10 VALUE '1456861356'. "Numbers only
        DATA my_02_value_pi TYPE p LENGTH 6 DECIMALS 5 VALUE 314159. "3.14159
        out->write( my_02_value_01 ).
        out->write( my_02_value_02 ).
        out->write( my_02_value_03 ).
        out->write( my_02_value_04 ).
        out->write( my_02_value_05 ).
        out->write( my_02_value_06 ).
        "out->write( my_02_value_pi ).
        out->write( |Pi not showing 3.14159: { my_02_value_pi }| ).


        "Use of Local Types
        TYPES my_type TYPE p LENGTH 3 DECIMALS 2.
        DATA my_var5 TYPE my_type.

        "Use of Global Types - ABAP Dictionary
        DATA airport TYPE /DMO/AIRPORT_ID. " Try F2 and F3 here

        "Constants and Literals
        "Declaration of Constants
        CONSTANTS my_const1 TYPE i VALUE 12345.
        CONSTANTS my_const2 TYPE string VALUE `Hello Luke!`.
        CONSTANTS my_const3 TYPE c LENGTH 3 VALUE IS INITIAL.
        "Declaration of Literals
        "Number Literals
        "Text Literals
        DATA lv_01_lit_01 TYPE i VALUE -123.
        DATA lv_01_lit_02 TYPE c LENGTH 2 VALUE 'LH'.
        DATA lv_01_lit_03 TYPE string VALUE `What's Up!`.

        "Chained Statements
        TYPES BEGIN OF my_struct1.
          TYPES name_first TYPE string.
          TYPES name_last  TYPE string.
        TYPES END OF my_struct1.

        "Compact form Chain Statement
        TYPES: BEGIN OF my_struct2,
          name_first TYPE string,
          name_last  TYPE string,
        END OF my_struct2.

        "Comments in ABAP
*       This is a comment too.

        "Process Data
        "Assing Values to Data Objects
        "Assignment Operator =

        "Examples from 'Processing Data'.
        DATA name TYPE c LENGTH 10.
        DATA my_var_i_1 TYPE i.
        DATA my_var_i_2 TYPE i VALUE 1234.
        my_var2 = `Hello LukeO`.
        my_var1 =  17.
        my_var_i_1 =  my_var1.
        my_var_i_2 = my_var1 + my_var_i_1.

        "Resetting Vaiables with CLEAR
        CLEAR my_var2.

        "Arithmetic Calculations
        "Operators
        "+ Addition
        "- Subtraction
        "* Multiplication
        "/ Division
        "Numeric Functions
        "sqrt() Square Root
        "ipow() inteer exponentiation

        "Rest of this WHEN is a little wonky!
        "Not sure where I got these from
        DATA my_total TYPE i.
        DATA my_average TYPE i.
        DATA my_amount1 TYPE i VALUE 10.
        DATA my_amount2 TYPE i VALUE 20.
        my_total = my_amount1 + my_amount2.
        my_average = (  2 * my_amount1 + 3 * my_amount2 ) / 5.

        "Operators
        DATA my_value_01 TYPE i VALUE 10.
        DATA my_value_02 TYPE i VALUE 20.
        DATA my_math_01  TYPE i.

        DATA my_addition TYPE i.
        DATA my_subtraction TYPE i.
        DATA my_multiplication TYPE i.
        DATA my_division TYPE i.

        my_addition = my_value_01 + my_value_02.
        my_subtraction = my_value_01 - my_value_02.
        my_multiplication = my_value_01 * my_value_02.
        IF my_value_02 NE 0.
          my_division = my_value_01 / my_value_02.
        ENDIF.

        "Multiplication and Division before Addition and subtraction
        "Left to Right

        my_math_01 = 10 + 5 - 4 * 10 + 4 / 2 + 2.
        "It should be 4 * 10 = 40
        "10 + 5 - 40 + 4 / 2 + 2.
        "4 / 2 = 2
        "10 + 5 - 40 + 2 + 2.
        "10+5-40+2+2
        " = -21 | And so it is

        out->write(  | Show Value: | ).
        out->write(  my_math_01 ).

        "ToDo: sqrt()
        "ToDo: ipow()

        "Break at "Processing Data" -

        "ToDo: Exercise_06 – String Manipulation
      WHEN 3.
        "26/09/2025
        "Learning Journeys --> Learning the Basics of ABAP Programming on SAP BTP
        "Understanding the ABAP Language Basics --> Processing Data

        "In this example onwards, I will start variables with lv_03
        "the 3 represent what case I am in

        "Image01
        "Assign Values to Data Objects ... Using Assignment Operator =
        DATA lv_03_my_var1 TYPE string.
        DATA lv_03_my_var2 TYPE int4.
        DATA lv_03_my_var3 TYPE int4.
        DATA lv_03_my_var4 TYPE int4.
        lv_03_my_var1 = `Hello World`.
        lv_03_my_var2 = 17.
        lv_03_my_var3 = lv_03_my_var2.
        lv_03_my_var4 = lv_03_my_var2 + lv_03_my_var3.

        "Image02
        CLEAR lv_03_my_var1.
        CLEAR lv_03_my_var2.

        "Image03 - Arithmetic Calculations
        "This was done in WHEN 2

        "In this example I will start calling out the image, such as im3
        out->write(  | Image3. | ).
        "Image4 of Processing Data
        DATA: lv_03_im3_lv_var1 TYPE string VALUE 'Hello from Dallas',
              lv_03_im3_lv_var2 TYPE i VALUE 6,
              lv_03_im3_lv_var3 TYPE i VALUE 2,
              lv_03_im3_lv_var4 TYPE i,
              lv_03_im3_lv_var5 TYPE i,
              lv_03_im3_lv_total TYPE i.

              lv_03_im3_lv_var4 = lv_03_im3_lv_var2.
              lv_03_im3_lv_var5 = lv_03_im3_lv_var2 + lv_03_im3_lv_var3.
              lv_03_im3_lv_total = lv_03_im3_lv_var2 + lv_03_im3_lv_var3.

              out->write( |var1: { lv_03_im3_lv_var1 }| ). "Hello from Dallas
              out->write( |var2: { lv_03_im3_lv_var2 }| ). "6
              out->write( |var3: { lv_03_im3_lv_var3 }| ). "2
              out->write( |var4: { lv_03_im3_lv_var4 }| ). "6
              out->write( |var5: { lv_03_im3_lv_var5 }| ). "8
              out->write( |total: { ( 2 * lv_03_im3_lv_var2 + 3 * lv_03_im3_lv_var3 ) / 5 }| ). "4

        "Using System Information.
        DATA lv_03_obj_01 TYPE REF TO CL_ABAP_CONTEXT_INFO.
        CREATE OBJECT lv_03_obj_01.

        "Creating them this way as am not sure what will come back
        "Why not use a Static Class
        "This is different to the example provided.
        DATA(lv_03_ob_val1) = lv_03_obj_01->get_system_date( ). "Current Date
        DATA(lv_03_ob_val2) = lv_03_obj_01->get_system_time( ). "Current Time
        DATA(lv_03_ob_val3) = lv_03_obj_01->get_user_technical_name( ). "Use ID of current user
        DATA(lv_03_ob_val4) = lv_03_obj_01->get_user_language_abap_format( ). "User login language

        out->write(  | Current Date (Same as sy-datum and sy-datlo) { lv_03_ob_val1 } | ).
        out->write(  | Current Time (Same as sy-uzeit and sy-timlo) { lv_03_ob_val2 }| ).
        out->write(  | Use ID of current user { lv_03_ob_val3 } | ).
        out->write(  | User login language { lv_03_ob_val4 } | ).

        DATA(lv_03_sy) = sy."The old variant of "SY" should not be used in the current ABAP langauge version
        out->write(  | Old SY Structure | ).
        out->write(  | Current date of Application Server (yyyymmdd): { sy-datum } | ).
        out->write(  | Local Date of Current User (yyyymmdd): { sy-datlo } | ).
        out->write(  | Current time of the application server (hhmmss)(2PM is 14): { sy-uzeit } | ).
        out->write(  | Local time of current user: (hhmmss)(2PM is 14) { sy-timlo } | ).
        out->write(  | Time Zone (Eg: 36000): { sy-tzone } | ).
        out->write(  | Time zone of current user (Eg: AUSACT): { sy-zonlo } | ).
        "More Fields
        out->write(  | Central Databas System (eg: DB2 (13.1.6)): { sy-dbsys } | ).
        out->write(  | Client ID of current Server (eg: 421): { sy-mandt } | ).
        out->write(  | Name of SAP System (eg: CD4): { sy-sysid } | ).
        out->write(  | Operating system of Application Server (eg: Linux (ppc64le): { sy-opsys } | ).
        out->write(  | SAP System Release (eg: 740): { sy-saprl } | ).
        out->write(  | Name of current applicaiton servier (eg: sap-cd4-ps01): { sy-host } | ).
        out->write(  | Name of current user (eg: UFH8N): { sy-uname } | ).
        "More Fields
        out->write(  | Calling Program (Eg: Z_UFH8N_RANDOM): { sy-cprog } | ).
        out->write(  | Language Key of text environment: { sy-langu } | ).

        "Original Tries"
        "DATA(lv_03_temp_01) = CL_ABAP_CONTEXT_INFO->
        "out->write( CL_ABAP_CONTEXT_INFO-> ).
      WHEN 4.
        out->write(  | Weclome to WHEN 4 | ).
        "Learning Journeys --> Learning the Basics of ABAP Programming on SAP BTP
        "Understanding the ABAP Language Basics --> Processing Character Strings

        "Character String Functions
        "Process Character Strings

        "Image01
        "String Templates
        DATA lv_04_string_01 TYPE string.
        DATA lv_04_amount_01 TYPE int4 VALUE 10.
        DATA lv_04_amount_02 TYPE int4 VALUE 20.
        DATA lv_04_curr_code TYPE string VALUE 'AUD'.

        out->write( |Hello World| ). "Literal text only
        out->write( |Total: { lv_04_amount_01 + lv_04_amount_02 }| ). " 1 Embedded Expression
        out->write( |Total: { lv_04_amount_01 + lv_04_amount_02 } EUR| ). "Text and 1 Expression
        out->write( |Total: { lv_04_amount_01 + lv_04_amount_02 } { lv_04_curr_code }| ). "Text and 2 Expressions

        "Image02
        out->write( |Image02| ).
        DATA: lv_04_img2_lv_amount1 TYPE i,
              lv_04_img2_lv_amount2 TYPE i,
              lv_04_img2_lv_curr_code TYPE string VALUE 'EUR'.
              "Note: the image is just: TYPE string 'EUR'.

              lv_04_img2_lv_amount1 = 3.
              lv_04_img2_lv_amount2 = 6.
              lv_04_img2_lv_curr_code = 'AUD'.

              out->write( |Hello World!| ).
              out->write( |{ lv_04_img2_lv_amount1 + lv_04_img2_lv_amount2 }| ).
              out->write( |{ lv_04_img2_lv_amount1 + lv_04_img2_lv_amount2 } EUR| ).
              out->write( |{ lv_04_img2_lv_amount1 + lv_04_img2_lv_amount2 } { lv_04_img2_lv_curr_code }| ).

        "Image03
        "Joining String using && Operator
        out->write( |Image03| ).
        DATA lv_04_img3_result1 TYPE string.
        DATA lv_04_img3_result2 TYPE string.
        DATA lv_04_img3_result2b TYPE string.
        DATA lv_04_img3_result3 TYPE string.
        DATA lv_04_img3_part1 TYPE string VALUE `Hello`.
        DATA lv_04_img3_part2 TYPE string VALUE `World`.

        "Question: What is with ` vs '
        DATA lv_04_img3_part1b TYPE string VALUE 'Super'.
        DATA lv_04_img3_part2b TYPE string VALUE 'Happy'.

        lv_04_img3_result1 = lv_04_img3_part1 && lv_04_img3_part2.
        lv_04_img3_result2 = lv_04_img3_part1 && | | && lv_04_img3_part2.
        lv_04_img3_result3 = lv_04_img3_part1 && |        | && lv_04_img3_part2. "Just a test for self
        "Yes. Adding 8 spaces will print 8 spaces
        lv_04_img3_result2b = lv_04_img3_part1b && | | && lv_04_img3_part2b.

        out->write( lv_04_img3_result1 ).
        out->write( lv_04_img3_result2 ).
        out->write( lv_04_img3_result3 ).

        out->write( lv_04_img3_result2b ).

        "Image04
        out->write( |Image04| ).
        DATA: lv_04_img4_lv_full_name  TYPE string VALUE 'Luke Lethborg',
              lv_04_img4_lv_first_name TYPE string,
              lv_04_img4_lv_last_name  TYPE string.

              SPLIT lv_04_img4_lv_full_name AT ' ' INTO lv_04_img4_lv_first_name lv_04_img4_lv_last_name.

              out->write( |user: { lv_04_img4_lv_first_name  }| ).
              out->write( |first name: { lv_04_img4_lv_first_name  }| ).
              out->write( |last name: { lv_04_img4_lv_last_name  }| ).
              out->write( |full name: { lv_04_img4_lv_full_name  }| ).

        WHEN 5.
          "From Lesson "Editing a Repository Object
          "DATA lv_05_gt_flights TYPE TABLE OF /dmo/flights."type unknown

          "SELECT * FROM /dmo/flights
          "  INTO TABLE DATA(tmp_lv_05_gt_flights).


          DATA lv_05_airport TYPE /DMO/AIRPORT_ID.
          "DATA lv_05_gt_flights TYPE /DMO/FLIGHTS. "Still unknown.
      WHEN 6.
        out->write( |Exercise06| ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Process Character Strings
        "Exercise_06 - String Manipulation
        "I will use this code and not make a new Class ZCL_S4D100_XX_COND or ZCL_S4D100_XX_CASE OR ZCL_S4D100_XX_CHAR

        "ToDo: I should proably do this step by step but I do not want heaps of different classes

        "DATA lv_06_c_number0
        DATA: lv_06_lv_full_name TYPE string VALUE 'Luke Lethborg',
              lv_first_name      TYPE string,
              lv_last_name       TYPE string.

       SPLIT lv_06_lv_full_name AT '' INTO lv_first_name lv_last_name.

       out->write(  |user: { lv_first_name  }| ).


      WHEN 7.
        out->write( |WHEN 7| ).
        "Learning Journey --> Learning the Basic of ABAP Programming on SAP BTP
        "Unit: Using Control Structures in ABAP
        "Lesson Implementing Conditional Logic

        "Implement Conditional Branching
        "Image01 - I made my own code for this image
        out->write( |Image01| ).
        DATA lv_07_img1_value_01 TYPE int4 VALUE 3.
        IF     lv_07_img1_value_01 EQ 1.
          out->write( |Value #1| ).
        ELSEIF lv_07_img1_value_01 EQ 2.
          out->write( |Value #2| ).
        ELSEIF lv_07_img1_value_01 EQ 3.
          out->write( |Value #3| ).
        ELSE.
          out->write( |Value Not Found!| ).
        ENDIF.

        "Logical Conditions
        "Comparison Operators
        " =  equal
        " <  less than
        " <= less than or equal
        " <> non-equal
        " >  greater than
        " >= greater than or equal

        IF lv_07_img1_value_01 = 3.
         out->write( |=  equal| ).
        ENDIF.

        IF lv_07_img1_value_01 < 4.
         out->write( |<  less than| ).
        ENDIF.

        IF lv_07_img1_value_01 <= 3.
         out->write( |<= less than or equal| ).
        ENDIF.

        IF lv_07_img1_value_01 <> 2.
         out->write( |<> non-equal| ).
        ENDIF.

        IF lv_07_img1_value_01 > 2.
         out->write( |>  greater than| ).
        ENDIF.

        IF lv_07_img1_value_01 >= 3.
         out->write( |>= greater than or equal| ).
        ENDIF.

        "Image02 - I made my own code for this image (I expanded a bit)
        out->write( |Image02| ).
        DATA lv_07_img2_x TYPE int4 VALUE 3.
        DATA lv_07_img2_y TYPE int4 VALUE 3.

        IF lv_07_img2_x = lv_07_img2_y.
          out->write( |X = Y| ).
        ELSE.
          out->write( |X does not = Y| ).
        ENDIF.
        "Note this is bad programming in some languages as this will assign the value.

       IF lv_07_img2_x EQ lv_07_img2_y.
          out->write( |X EQ Y| ).
        ELSE.
          out->write( |X does not EQ Y| ).
        ENDIF.

        lv_07_img2_x = 5.
        lv_07_img2_y = 4.
        IF ( lv_07_img2_y <=  lv_07_img2_x AND lv_07_img2_x < 2 * lv_07_img2_y )
        OR (  lv_07_img2_y >= lv_07_img2_x AND lv_07_img2_x > 2 * lv_07_img2_y ).
          out->write( |If Statement Trigged!| ).
        ENDIF.

        IF ( abs( lv_07_img2_x  ) ) BETWEEN abs( lv_07_img2_y ) AND abs( 2 * lv_07_img2_y ).
          out->write( |If Statement Trigged for abs!| ).
        ENDIF.
        "End Image Image02

        "Logical Operators: NOT, AND, OR
        "AND and OR are done above

        "Sequence of Evaluation
        "NOT before AND
        "AND before OR
        "ToDo: Try this out

        "ToDo: Make sure I practice these over time
        "Special Logical Expressions and Predicate Functions
        "<data object> IS INITIAL.
        "<data object> IS NOT INITIAL.
        "<expression1> BETWEEN <expression2> and <expression3>
        "contains(...)
        "line_exists(...)

      WHEN 8.
        out->write( 'Exercise_07 - Implement an IF statement' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implement an IF Statement
        "Exercise_07 - Implement an IF statement
        "Lesson: Implementing Conditional Logic

        "I will not create a new ABAP CLass ZCL_S4D100_XX_COND
        "Define constant C_NUMBER0 with value 0
        "Use if to show message when value of constant is zero or not

        CONSTANTS lv_08_c_number0 TYPE i VALUE 0.
        out->write( '--------------------------------' ).
        out->write( 'Example 1: IF..ELSE..ENDIF' ).
        out->write( '--------------------------------' ).

        IF lv_08_c_number0 = 0.
          out->write( 'The value of lv_08_c_number0 equals zero' ).
        ELSE.
          out->write( 'The value of lv_08_c_number0 equals some number other than zero' ).
        ENDIF.

      WHEN 9.
        out->write( 'WHEN 9' ).
        "Learning Journey --> Learning the Basic of ABAP Programming on SAP BTP
        "Unit: Using Control Structures in ABAP
        "Lesson Implementing Conditional Logic
        " ** Continued **
        "Case Statements
        DATA lv_09_number TYPE i VALUE 2.

        CASE lv_09_number.
          WHEN 1.
            out->write( 'Case is 1' ).
          WHEN 2.
            out->write( 'Case is 2' ).
          WHEN 3.
            out->write( 'Case is 3' ).
          WHEN OTHERS.
            out->write( 'Please use another number for Case!' ).
        ENDCASE.

        "What if you duplicate these up?
        "It will find the first instance and exit.
        CASE lv_09_number.
          WHEN 1.
            out->write( 'Case is 1$$' ).
          WHEN 2.
            out->write( 'Case is 2$$' ).
          WHEN 3.
            out->write( 'Case is 3$$' ).
           WHEN 2.
            out->write( 'Case is 2~~' ).
          WHEN OTHERS.
            out->write( 'Please use another number for Case!$$' ).
        ENDCASE.
      WHEN 10.
        out->write( 'WHEN 10' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Process Character Strings
        "Exercise_08 – String Manipulation
        "Lesson: Implementing Conditional Logic

        "I will not create class ZCL_S4D100_XX_COND or ZCL_S4D100_XX_CASE
        "Or ZCL_S4D100_XX_CHAR

        "Note: There is no need to do Step 2, that was the last exercise.

        "This exercise is the same as the one few exercises earlier.
        "The follow along is the same too.
        "It should be something about case statements

        DATA: lv_10_lv_full_name  TYPE string VALUE 'Luke Lethborg',
              lv_10_lv_first_name TYPE string,
              lv_10_lv_last_name  Type string.

        SPLIT lv_10_lv_full_name AT '' INTO lv_10_lv_first_name lv_10_lv_last_name.

        out->write(  |User: { lv_10_lv_first_name  }| ).

      WHEN 11.
        out->write(  | WHEN 11 - Continue learning from here. | ).
        "Learning Journey --> Learning the Basic of ABAP Programming on SAP BTP
        "Unit: Using Control Structures in ABAP
        "Lesson: Implementing Loops

        "Implementing Loops
        "With a specified number of iterations
        DO 10 TIMES.
          out->write(  |sy-index for Loop 1: { sy-index }| ).
        ENDDO.


       "With termination based on a logical condition
       DO.
         "Some Logic
         out->write(  |sy-index for Loop 2: { sy-index }| ).
         IF sy-index EQ 6.
           EXIT.
         ENDIF.
       ENDDO.

       "They have not discussed Internal Tables Yet but lets try and make one.

       TYPES BEGIN OF ltyp_11_One_Piece.
          TYPES name_first         TYPE string.
          TYPES age                TYPE int4.
          TYPES devilfruit         TYPE string.
          TYPES intro_anime_ep     TYPE string.
          TYPES join_team_anime_ep TYPE string.
        TYPES END OF ltyp_11_One_Piece.

        DATA lv_11_onepiece_tbl TYPE TABLE OF ltyp_11_One_Piece.
        DATA lv_11_onepiece_str TYPE ltyp_11_One_Piece.

        lv_11_onepiece_str-name_first         = 'Luffy'.
        lv_11_onepiece_str-age                = 19.
        lv_11_onepiece_str-devilfruit         = 'Gum-Gum'.
        lv_11_onepiece_str-intro_anime_ep     = 1.
        lv_11_onepiece_str-join_team_anime_ep = 1.
        APPEND lv_11_onepiece_str TO lv_11_onepiece_tbl.
        CLEAR lv_11_onepiece_str.

        lv_11_onepiece_str-name_first         = 'Luffy'.
        lv_11_onepiece_str-age                = 19.
        lv_11_onepiece_str-devilfruit         = ''.
        lv_11_onepiece_str-intro_anime_ep     = 4.
        lv_11_onepiece_str-join_team_anime_ep = 7.
        APPEND lv_11_onepiece_str TO lv_11_onepiece_tbl.
        CLEAR lv_11_onepiece_str.

        lv_11_onepiece_str-name_first         = 'Namie'.
        lv_11_onepiece_str-age                = 19.
        lv_11_onepiece_str-devilfruit         = ''.
        lv_11_onepiece_str-intro_anime_ep     = 15.
        lv_11_onepiece_str-join_team_anime_ep = 20.
        APPEND lv_11_onepiece_str TO lv_11_onepiece_tbl.
        CLEAR lv_11_onepiece_str.

        "Based on internal table content
        out->write(  |** The numbers are a little weird. May need more practice. | ).
        LOOP AT lv_11_onepiece_tbl INTO DATA(wa_11_onepiece_tbl).
          out->write(  |sy-index for Loop 3: { sy-index }| ).
          out->write(  |sy-tabix for Loop 3: { sy-tabix }| ).
        ENDLOOP.

        "Question: Does exit leave current loop, whole loop or whole program?
        "In this instance it does not leave loop, it inner loop runs 3 times
        " then a outer loops runs again an repeats.
        "Also the sy-index perhaps well

        out->write(  | Before Do Exit Test | ).
        DATA lv_11_counter_01 TYPE int4.
        DATA lv_11_counter_02 TYPE int4.
        DO 10 TIMES.
          lv_11_counter_01 = lv_11_counter_01 + 1.
          out->write(  |outer loop { lv_11_counter_01 } ~ outer loop sy-index: { sy-index }| ).
          DO 10 TIMES.
            lv_11_counter_02 = lv_11_counter_02 + 1.
            out->write(  |inner loop { lv_11_counter_02 } ~ inner loop sy-index: { sy-index }| ).
            IF lv_11_counter_02 EQ 3.
              out->write(  |Inner Exit Called | ).
              EXIT.
            ENDIF.
          ENDDO.
          CLEAR lv_11_counter_02.
          IF lv_11_counter_01 EQ 5.
            out->write(  | Outer Exit Called | ).
            EXIT.
          ENDIF.
        ENDDO.
        CLEAR lv_11_counter_01.
        out->write(  | After Do Exit Test | ).

      WHEN 12.
        out->write( 'Exercise_09 - Implement a DO - ENDDO Loop' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implementing Loops
        "Exercise_09 - Implement a DO - ENDDO Loop

        "I will not create a class ZCL_S4D100_XX_DO_ENDDO or ZCL_S4D100_XX_ENDDO
        CONSTANTS: c_12_number0 TYPE i VALUE 3.
        out->write( '--------------------------------' ).
        out->write( 'Example 1: DO...ENDDO with TIMES' ).
        out->write( '--------------------------------' ).

        DO c_12_number0 TIMES.
          out->write( 'Hello Luke!' ).
        ENDDO.
      WHEN 13.
        out->write( 'Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition' ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Implementing Loops
        "Exercise_10 - Implement a DO - ENDDO Loop with an Abort Condition

        "I will not create the Class ZCL_S4D100_XX_DO_ENDDO
        "I will not create the Class ZCL_S4D100_XX_EXIT

        CONSTANTS: c_13_number0 TYPE i VALUE 3.
        DATA:      lv_13_number0 TYPE i.

        lv_13_number0 = c_13_number0 * c_13_number0.

        "Count backwards from lv_13_number0 to c_13_number0

        DO.
          out->write( |{ sy-index }: Value of lv_13_number0: { lv_13_number0 }| ).
          lv_13_number0 = lv_13_number0 - 1.
          "Question: Can we use -- like in other languages?

          "Abort condition
          IF lv_13_number0 <= c_13_number0. " If 3 = 3
            EXIT.
          ENDIF.
        ENDDO.

      WHEN 14.
        out->write( |WHEN 14| ).
        "Learning Journey --> Learning the Basic of ABAP Programming on SAP BTP
        "Unit: Handling Runtime Error
        "Lesson: Analyzing Runtime Errors

        "Analyzing Runtime Errors
        "ABAP Short Dump
        "Rumtime Errors

        "Note I made variable names more clear
        DATA: lv_14_lv_months       TYPE i VALUE 0,   "Number of months remaining in year
              lv_14_lv_un_holidays  TYPE i VALUE 10,  "Number of days un-taken vacation
              lv_14_lv_avg_holidays TYPE i.            "Average days left per month

       "Calculate the number of days vacation per month, for the user's remaining vacation allowance.
       "This code will trigger "Exception: CX_SY_ZERODIVIDE" in the "Runtime Error: COMPUTE_INT_ZERODIVIDE"

       "lv_14_lv_avg_holidays = lv_14_lv_un_holidays / lv_14_lv_months. "Comment out code

       "Fix 1 - Use Try / Catch
       TRY.
         lv_14_lv_avg_holidays = lv_14_lv_un_holidays / lv_14_lv_months.
       CATCH CX_SY_ZERODIVIDE.
         out->write(  | Please do not divide by zero! | ).
       ENDTRY.
       "Fix 2 - Catch division by 0 in code and set value what the original was:
       IF lv_14_lv_months EQ 0.
         out->write(  | 0 division of { lv_14_lv_un_holidays } is { lv_14_lv_un_holidays }. | ).
       ENDIF.
       "Fix 3 - Use same approach as Fix 2 but tell the user off.

       "If I have $100 and I divided by 0 I still have $100

       "ABAP Short Dump
       "ToDo: Practice using Eclipse more by following the notes in the learning here

       "Code Snippet
       out->write(  |Corrected Example| ).
       DATA: lv_14_lv_months_v2       TYPE i VALUE 0,   "Number of months remaining in year
             lv_14_lv_un_holidays_v2  TYPE i VALUE 10,  "Number of days un-taken vacation
             lv_14_lv_avg_holidays_v2 TYPE i.           "Average days left per month

       "Calculate the number of days vacation per month, for the user's remaining vacation allowance.

        IF lv_14_lv_months_v2 NE 0.
          lv_14_lv_avg_holidays_v2 = lv_14_lv_un_holidays_v2 / lv_14_lv_months_v2.
          out->write(  |Average vacation days per month { lv_14_lv_avg_holidays_v2 }| ).
        ELSE.
          out->write(  |Please ask to roll over remaining vacation | ).
        ENDIF.

        "Note: Division by 0 only matters on the last value. The following code is fine.

        DATA lv_14_temp01 TYPE int4 VALUE 0.
        DATA lv_15_temp02 TYPE int4 VALUE 10.
        DATA lv_15_temp03 TYPE int4.

        lv_15_temp03 = lv_14_temp01 / lv_15_temp02.
        out->write(  |No issues with 0/10 = { lv_15_temp03 }| ).:

      WHEN 15.
        out->write(  |Exercise_11| ).
        "T_02 Learning the Basics of ABAP Programming on SAP BTP
        "Analyzing Runtime Error
        "Exercise_11 - Use Conditional Logic to Avoid a Runtime Error

        "I will not create a ABAP Class ZCL_XX_DUMP

        DATA: lv_15_mths     TYPE i VALUE 0,  "10, "No. of months remaining in year
              lv_15_hols     TYPE i VALUE 20, "No. of days untaken vacation
              lv_15_avg_hols TYPE i.

              IF lv_15_mths NE 0. "Could have used <>
                lv_15_avg_hols = lv_15_hols / lv_15_mths.
                out->write(  |Average vactaion days per month { lv_15_avg_hols }| ).
              ELSE.
                out->write( |Please ask to roll over remaining vacation| ).
              ENDIF.
      WHEN 16.
        "Learning Journey --> Learning the Basic of ABAP Programming on SAP BTP
        "Unit: Building an ABAP RESTful Application
        "Lesson: Building an ABAP RESTful Application
        
        "Create a Database Table
        "Database Table for Sustainable Grocery App
        "Create database table named Z01_GROCERY
        "Follow steps in Training. I my case the Pacakge is ZS4D100_01
      WHEN OTHERS.
      out->write(  | Please enter a valid value. | ).
    ENDCASE.



  ENDMETHOD.

  METHOD code_run_01.
    "BREAK-POINT. "Not allowed in the current ABAP language version
  ENDMETHOD.
ENDCLASS.
</pre>

<h2>My Code: Looks like I forgot the Local Class</h2>
<h1>End: Learning the Basics of ABAP Programming on SAP BTP | SAP_Training_Exercise.docx</h1>
<h1 id="ABAP_40hr_Part1_Sub1">ABAP 40hr - Part 1 - Sub-Part 1</h1>
<!-- <h1>ABAP_40_hr - Part1</h1> -->

<h1>Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 1 - Exercises.docx</h1>
<pre class="pre-green">
Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 1 - Exercises.docx
This is a 244 Page, 12.2MB, 36 Exercise file.
I worked on this from 28/10/2025 to 30/10/2025.
</pre>

<a href="#Part1_SubPart1_PracSyst_Ex01">Exercise01 - How to Create an ABAP Cloud Project</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex02">Exercise02 - Task 1: Create an ABAP Cloud Project</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex03">Exercise03 - Task 2: Analyze ABAP Class /DMO/CL_FLIGHT_LEGACY</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex04">Exercise04 - Create an ABAP Package</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex05">Exercise05 - How to Create a 'Hello World' Application</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex06">Exercise06 - How To Comment And Uncomment Code</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex07">Exercise07 - Predefined ABAP TYPES</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex08">Exercise08 - Data Objects</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex09">Exercise09 - Arithmetic Calculations</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex10">Exercise10 - String Processing</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex11">Exercise11 - Declare Variables and Process Data</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex12">Exercise12 - Conditional Branching</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex13">Exercise13 - Exception Handling</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex14">Exercise14 – Iterations</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex15">Exercise15 - Simple Internal Tables</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex16">Exercise 16 - Work with Simple Internal Tables</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex17">Exercise 17 - How To Start The Debugger</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex18">Exercise 18 - How To Control The Execution Of Code</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex19">Exercise 19 - How To Analyze The Contents Of Data Objects</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex20">Exercise 20 - How To Create A Local Class In A Global Class</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex21">Exercise 21 - ?????</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex22">Exercise 22 - How To Create A Local Class In A Global Class</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex23">Exercise 23 - Define a Local Class</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex24">Exercise 24 - How to Create Instances of an ABAP Class</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex25">Exercise 25 - How To Manage Instances in an Internal Table</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex26">Exercise 26 - Create and Manage Instances</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex27">Exercise 27 - How to Define Methods</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex28">Exercise 28 - How to Implement Methods</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex29">Exercise 29 - How to Call Methods</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex30">Exercise 30 - Method Calls and Exception Handling</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex31">Exercise 31 - Functional Methods</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex32">Exercise 32 - Define and Call Methods</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex33">Exercise 33 - How To Use Private Attributes</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex34">Exercise 34 - How To Define An Instance Constructor</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex35">Exercise 35 - How To Debug The Execution Of Constructors</a></br>
<a href="#Part1_SubPart1_PracSyst_Ex36">Exercise 36 - Use Private Attributes and a Constructor</a></br>


<h2 id="Part1_SubPart1_PracSyst_Ex01">Exercise01 - How to Create an ABAP Cloud Project</h2>
<pre class="pre-green">
No Code!
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex02">Exercise02 - Task 1: Create an ABAP Cloud Project</h2>
<pre class="pre-green">
No Code!
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex03">Exercise03 - Task 2: Analyze ABAP Class /DMO/CL_FLIGHT_LEGACY</h2>
<pre class="pre-green">
" Global Class /DMO/CL_FLIGHT_LEGACY
" Global Class /dmo/cl_flight_legacy

CLASS /dmo/cl_flight_legacy DEFINITION
  PUBLIC
  FINAL
  CREATE PRIVATE
  GLOBAL FRIENDS /dmo/cl_flight_data_generator.

  PUBLIC SECTION.
    INTERFACES /dmo/if_flight_legacy.

    TYPES: BEGIN OF ENUM ty_change_mode STRUCTURE change_mode," Key checks are done separately
             create,
             update," Only fields that have been changed need to be checked
           END OF ENUM ty_change_mode STRUCTURE change_mode.

    CLASS-METHODS: get_instance RETURNING VALUE(ro_instance) TYPE REF TO /dmo/cl_flight_legacy.

    "   With respect to the same method call of create/update/delete_travel() we have All or Nothing.
    "   I.e. when one of the levels contains an error, the complete call is refused.
    "   However, the buffer is not cleared in case of an error.
    "   I.e. when the caller wants to start over, he needs to call Initialize() explicitly.

    METHODS set_status_to_booked IMPORTING iv_travel_id TYPE /dmo/travel_id
                                 EXPORTING et_messages  TYPE /dmo/if_flight_legacy=>tt_if_t100_message.

    METHODS create_travel IMPORTING is_travel             TYPE /dmo/s_travel_in
                                    it_booking            TYPE /dmo/t_booking_in OPTIONAL
                                    it_booking_supplement TYPE /dmo/t_booking_supplement_in OPTIONAL
                                    iv_numbering_mode     TYPE /dmo/if_flight_legacy=>t_numbering_mode DEFAULT /dmo/if_flight_legacy=>numbering_mode-early
                          EXPORTING es_travel             TYPE /dmo/travel
                                    et_booking            TYPE /dmo/t_booking
                                    et_booking_supplement TYPE /dmo/t_booking_supplement
                                    et_messages           TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS update_travel IMPORTING is_travel              TYPE /dmo/s_travel_in
                                    is_travelx             TYPE /dmo/s_travel_inx
                                    it_booking             TYPE /dmo/t_booking_in OPTIONAL
                                    it_bookingx            TYPE /dmo/t_booking_inx OPTIONAL
                                    it_booking_supplement  TYPE /dmo/t_booking_supplement_in OPTIONAL
                                    it_booking_supplementx TYPE /dmo/t_booking_supplement_inx OPTIONAL
                          EXPORTING es_travel              TYPE /dmo/travel
                                    et_booking             TYPE /dmo/t_booking
                                    et_booking_supplement  TYPE /dmo/t_booking_supplement
                                    et_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS delete_travel IMPORTING iv_travel_id TYPE /dmo/travel_id
                          EXPORTING et_messages  TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS get_travel IMPORTING iv_travel_id           TYPE /dmo/travel_id
                                 iv_include_buffer      TYPE abap_boolean
                                 iv_include_temp_buffer TYPE abap_boolean OPTIONAL
                       EXPORTING es_travel              TYPE /dmo/travel
                                 et_booking             TYPE /dmo/t_booking
                                 et_booking_supplement  TYPE /dmo/t_booking_supplement
                                 et_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS adjust_numbers EXPORTING et_travel_mapping       TYPE /dmo/if_flight_legacy=>tt_ln_travel_mapping
                                     et_booking_mapping      TYPE /dmo/if_flight_legacy=>tt_ln_booking_mapping
                                     et_bookingsuppl_mapping TYPE /dmo/if_flight_legacy=>tt_ln_bookingsuppl_mapping.
    METHODS save.
    METHODS initialize.
    METHODS convert_messages IMPORTING it_messages TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                             EXPORTING et_messages TYPE /dmo/t_message.
  PROTECTED SECTION.
  PRIVATE SECTION.
    CLASS-DATA go_instance TYPE REF TO /dmo/cl_flight_legacy.

    CLASS-METHODS:
      "! Calculation of Price <br/>
      "!  <br/>
      "! Price will be calculated using distance multiplied and occupied seats.<br/>
      "! Depending on how many seats in percentage are occupied the formula <br/>
      "! 3/400·x² + 25<br/>
      "! will be applied.<br/>
      "!   0% seats occupied leads to 25% of distance as price.<br/>
      "!  75% seats occupied leads to 50% of distance as price.<br/>
      "! 100% seats occupied leads to 100% of distance as price.<br/>
      "! @parameter iv_seats_occupied_percent | occupied seats
      "! @parameter iv_flight_distance | flight distance in kilometer
      "! @parameter rv_price | calculated flight price
      calculate_flight_price
        IMPORTING
          iv_seats_occupied_percent TYPE /dmo/plane_seats_occupied
          iv_flight_distance        TYPE /dmo/flight_distance
        RETURNING
          VALUE(rv_price)           TYPE /dmo/flight_price ##RELAX.

    METHODS lock_travel IMPORTING iv_lock TYPE abap_bool
                        RAISING   /dmo/cx_flight_legacy ##RELAX ##NEEDED.

    METHODS _resolve_attribute IMPORTING iv_attrname      TYPE scx_attrname
                                         ix               TYPE REF TO /dmo/cx_flight_legacy
                               RETURNING VALUE(rv_symsgv) TYPE symsgv.
    "! Final determinations / derivations after all levels have been prepared, e.g. bottom-up derivations
    METHODS _determine EXPORTING et_messages           TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                       CHANGING  cs_travel             TYPE /dmo/travel
                                 ct_booking            TYPE /dmo/t_booking
                                 ct_booking_supplement TYPE /dmo/t_booking_supplement.
    METHODS _determine_travel_total_price CHANGING cs_travel             TYPE /dmo/travel
                                                   ct_booking            TYPE /dmo/t_booking
                                                   ct_booking_supplement TYPE /dmo/t_booking_supplement
                                                   ct_messages           TYPE /dmo/if_flight_legacy=>tt_if_t100_message ##NEEDED.
    METHODS _convert_currency IMPORTING iv_currency_code_source TYPE /dmo/currency_code
                                        iv_currency_code_target TYPE /dmo/currency_code
                                        iv_amount               TYPE /dmo/total_price
                              RETURNING VALUE(rv_amount)        TYPE /dmo/total_price.
ENDCLASS.



CLASS /DMO/CL_FLIGHT_LEGACY IMPLEMENTATION.


  METHOD adjust_numbers.
    et_travel_mapping       = lcl_travel_buffer=>get_instance( )->adjust_numbers( ).
    et_booking_mapping      = lcl_booking_buffer=>get_instance( )->adjust_numbers( et_travel_mapping ).
    et_bookingsuppl_mapping = lcl_booking_supplement_buffer=>get_instance( )->adjust_numbers( et_booking_mapping ).
  ENDMETHOD.


  METHOD calculate_flight_price.
    DATA: lv_percentage_of_max_price TYPE i.
    lv_percentage_of_max_price = ( 3 * iv_seats_occupied_percent ** 2 DIV 400 ) + 25 ##OPERATOR[**].
    rv_price = lv_percentage_of_max_price * iv_flight_distance DIV 100.
  ENDMETHOD.


  METHOD convert_messages.
    CLEAR et_messages.
    DATA ls_message TYPE symsg.
    LOOP AT it_messages INTO DATA(lr_error) ##INTO_OK.
      ls_message-msgty = 'E'.
      ls_message-msgid = lr_error->t100key-msgid.
      ls_message-msgno = lr_error->t100key-msgno.
      IF lr_error IS INSTANCE OF /dmo/cx_flight_legacy.
        DATA(lx) = CAST /dmo/cx_flight_legacy( lr_error ).
        ls_message-msgv1 = _resolve_attribute( iv_attrname = lr_error->t100key-attr1  ix = lx ).
        ls_message-msgv2 = _resolve_attribute( iv_attrname = lr_error->t100key-attr2  ix = lx ).
        ls_message-msgv3 = _resolve_attribute( iv_attrname = lr_error->t100key-attr3  ix = lx ).
        ls_message-msgv4 = _resolve_attribute( iv_attrname = lr_error->t100key-attr4  ix = lx ).
      ENDIF.
      APPEND ls_message TO et_messages.
    ENDLOOP.
  ENDMETHOD.


  METHOD create_travel.
    CLEAR: es_travel, et_booking, et_booking_supplement, et_messages.

    " Numbering mode has to be either Early or Late.
    ASSERT iv_numbering_mode EQ /dmo/if_flight_legacy=>numbering_mode-early OR
           iv_numbering_mode EQ /dmo/if_flight_legacy=>numbering_mode-late.

    " Travel
    lcl_travel_buffer=>get_instance( )->cud_prep( EXPORTING it_travel         = VALUE #( ( CORRESPONDING #( is_travel ) ) )
                                                            it_travelx        = VALUE #( ( travel_id = is_travel-travel_id  action_code = /dmo/if_flight_legacy=>action_code-create ) )
                                                            iv_numbering_mode = iv_numbering_mode
                                                  IMPORTING et_travel         = DATA(lt_travel)
                                                            et_messages       = et_messages ).
    IF et_messages IS INITIAL.
      ASSERT lines( lt_travel ) = 1.
      es_travel = lt_travel[ 1 ].
    ENDIF.

    " Bookings
    IF et_messages IS INITIAL.
      DATA lt_booking  TYPE /dmo/t_booking.
      DATA lt_bookingx TYPE /dmo/t_bookingx.
      LOOP AT it_booking INTO DATA(ls_booking_in).
        DATA ls_booking TYPE /dmo/booking.
        ls_booking = CORRESPONDING #( ls_booking_in ).
        ls_booking-travel_id = es_travel-travel_id.
        INSERT ls_booking INTO TABLE lt_booking.
        INSERT VALUE #( travel_id = ls_booking-travel_id  booking_id = ls_booking-booking_id  action_code = /dmo/if_flight_legacy=>action_code-create ) INTO TABLE lt_bookingx.
      ENDLOOP.
      lcl_booking_buffer=>get_instance( )->cud_prep( EXPORTING it_booking  = lt_booking
                                                               it_bookingx = lt_bookingx
                                                     IMPORTING et_booking  = et_booking
                                                               et_messages = DATA(lt_messages) ).
      APPEND LINES OF lt_messages TO et_messages.
    ENDIF.

    " Booking Supplements
    IF et_messages IS INITIAL.
      DATA lt_booking_supplement  TYPE /dmo/t_booking_supplement.
      DATA lt_booking_supplementx TYPE /dmo/t_booking_supplementx.
      LOOP AT it_booking_supplement INTO DATA(ls_booking_supplement_in).
        DATA ls_booking_supplement TYPE /dmo/book_suppl.
        ls_booking_supplement = CORRESPONDING #( ls_booking_supplement_in ).
        ls_booking_supplement-travel_id = es_travel-travel_id.
        IF lcl_booking_buffer=>get_instance( )->check_booking_id( EXPORTING iv_travel_id = ls_booking_supplement-travel_id  iv_booking_id = ls_booking_supplement-booking_id CHANGING ct_messages = et_messages ) = abap_false.
          EXIT.
        ENDIF.
        INSERT ls_booking_supplement INTO TABLE lt_booking_supplement.
        INSERT VALUE #( travel_id             = ls_booking_supplement-travel_id
                        booking_id            = ls_booking_supplement-booking_id
                        booking_supplement_id = ls_booking_supplement-booking_supplement_id
                        action_code           = /dmo/if_flight_legacy=>action_code-create ) INTO TABLE lt_booking_supplementx.
      ENDLOOP.
      IF et_messages IS INITIAL.
        lcl_booking_supplement_buffer=>get_instance( )->cud_prep( EXPORTING it_booking_supplement  = lt_booking_supplement
                                                                            it_booking_supplementx = lt_booking_supplementx
                                                                  IMPORTING et_booking_supplement  = et_booking_supplement
                                                                            et_messages            = lt_messages ).
        APPEND LINES OF lt_messages TO et_messages.
      ENDIF.
    ENDIF.

    " Now do any derivations that require the whole business object (not only a single node), but which may in principle result in an error
    IF et_messages IS INITIAL.
      _determine( IMPORTING et_messages           = et_messages
                  CHANGING  cs_travel             = es_travel
                            ct_booking            = et_booking
                            ct_booking_supplement = et_booking_supplement ).
    ENDIF.

    IF et_messages IS INITIAL.
      lcl_travel_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_copy( ).
    ELSE.
      CLEAR: es_travel, et_booking, et_booking_supplement.
      lcl_travel_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_disc( ).
    ENDIF.
  ENDMETHOD.


  METHOD delete_travel.
    CLEAR et_messages.

    get_travel( EXPORTING iv_travel_id           = iv_travel_id
                          iv_include_buffer      = abap_true
                          iv_include_temp_buffer = abap_true
                IMPORTING et_booking             = DATA(lt_booking)
                          et_booking_supplement  = DATA(lt_booking_supplement)
                          et_messages            = et_messages ).

    IF et_messages IS INITIAL.
      lcl_booking_supplement_buffer=>get_instance( )->cud_prep( EXPORTING it_booking_supplement  = CORRESPONDING #( lt_booking_supplement MAPPING travel_id             = travel_id
                                                                                                                                                  booking_id            = booking_id
                                                                                                                                                  booking_supplement_id = booking_supplement_id EXCEPT * )
                                                                          it_booking_supplementx = VALUE #( FOR ls_bs IN lt_booking_supplement ( action_code           = /dmo/if_flight_legacy=>action_code-delete
                                                                                                                                                 travel_id             = ls_bs-travel_id
                                                                                                                                                 booking_id            = ls_bs-booking_id
                                                                                                                                                 booking_supplement_id = ls_bs-booking_supplement_id ) )
                                                                          iv_no_delete_check     = abap_true " No existence check required
                                                                IMPORTING et_messages            = DATA(lt_messages) ).
      APPEND LINES OF lt_messages TO et_messages.
    ENDIF.

    IF et_messages IS INITIAL.
      lcl_booking_buffer=>get_instance( )->cud_prep( EXPORTING it_booking         = CORRESPONDING #( lt_booking MAPPING travel_id = travel_id  booking_id = booking_id EXCEPT * )
                                                               it_bookingx        = VALUE #( FOR ls_b IN lt_booking ( action_code = /dmo/if_flight_legacy=>action_code-delete  travel_id = ls_b-travel_id  booking_id = ls_b-booking_id ) )
                                                               iv_no_delete_check = abap_true " No existence check required
                                                     IMPORTING et_messages        = lt_messages ).
      APPEND LINES OF lt_messages TO et_messages.
    ENDIF.

    IF et_messages IS INITIAL.
      lcl_travel_buffer=>get_instance( )->cud_prep( EXPORTING it_travel          = VALUE #( ( travel_id = iv_travel_id ) )
                                                              it_travelx         = VALUE #( ( travel_id = iv_travel_id  action_code = /dmo/if_flight_legacy=>action_code-delete ) )
                                                              iv_no_delete_check = abap_true " No existence check required
                                                    IMPORTING et_messages        = lt_messages ).
      APPEND LINES OF lt_messages TO et_messages.
    ENDIF.

    IF et_messages IS INITIAL.
      lcl_travel_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_copy( ).
    ELSE.
      lcl_travel_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_disc( ).
    ENDIF.
  ENDMETHOD.


  METHOD get_instance.
    go_instance = COND #( WHEN go_instance IS BOUND THEN go_instance ELSE NEW #( ) ).
    ro_instance = go_instance.
  ENDMETHOD.


  METHOD get_travel.
    CLEAR: es_travel, et_booking, et_booking_supplement, et_messages.

    IF iv_travel_id IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO et_messages.
      RETURN.
    ENDIF.

    lcl_travel_buffer=>get_instance( )->get( EXPORTING it_travel              = VALUE #( ( travel_id = iv_travel_id ) )
                                                       iv_include_buffer      = iv_include_buffer
                                                       iv_include_temp_buffer = iv_include_temp_buffer
                                             IMPORTING et_travel              = DATA(lt_travel) ).
    IF lt_travel IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = iv_travel_id ) TO et_messages.
      RETURN.
    ENDIF.
    ASSERT lines( lt_travel ) = 1.
    es_travel = lt_travel[ 1 ].

    lcl_booking_buffer=>get_instance( )->get( EXPORTING it_booking             = VALUE #( ( travel_id = iv_travel_id ) )
                                                        iv_include_buffer      = iv_include_buffer
                                                        iv_include_temp_buffer = iv_include_temp_buffer
                                              IMPORTING et_booking             = et_booking ).

    lcl_booking_supplement_buffer=>get_instance( )->get( EXPORTING it_booking_supplement  = CORRESPONDING #( et_booking MAPPING travel_id = travel_id  booking_id = booking_id EXCEPT * )
                                                                   iv_include_buffer      = iv_include_buffer
                                                                   iv_include_temp_buffer = iv_include_temp_buffer
                                                         IMPORTING et_booking_supplement  = et_booking_supplement ).
  ENDMETHOD.


  METHOD initialize.
    lcl_travel_buffer=>get_instance( )->initialize( ).
    lcl_booking_buffer=>get_instance( )->initialize( ).
    lcl_booking_supplement_buffer=>get_instance( )->initialize( ).
  ENDMETHOD.


  METHOD lock_travel ##NEEDED.
*   IF iv_lock = abap_true.
*     CALL FUNCTION 'ENQUEUE_/DMO/ETRAVEL'
*       EXCEPTIONS
*         foreign_lock   = 1
*         system_failure = 2
*         OTHERS         = 3.
*     IF sy-subrc <> 0.
*       RAISE EXCEPTION TYPE /dmo/cx_flight_legacy
*         EXPORTING
*           textid = /dmo/cx_flight_legacy=>travel_lock.
*     ENDIF.
*   ELSE.
*     CALL FUNCTION 'DEQUEUE_/DMO/ETRAVEL'.
*   ENDIF.
  ENDMETHOD.


  METHOD save.
    lcl_travel_buffer=>get_instance( )->save( ).
    lcl_booking_buffer=>get_instance( )->save( ).
    lcl_booking_supplement_buffer=>get_instance( )->save( ).
    initialize( ).
  ENDMETHOD.


  METHOD set_status_to_booked.
    lcl_travel_buffer=>get_instance( )->set_status_to_booked( EXPORTING iv_travel_id = iv_travel_id
                                                              IMPORTING et_messages  = et_messages ).
  ENDMETHOD.


  METHOD update_travel.
    CLEAR es_travel.
    CLEAR et_booking.
    CLEAR et_booking_supplement.
    CLEAR et_messages.

    " Travel
    IF is_travel-travel_id IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO et_messages.
      RETURN.
    ENDIF.
    DATA ls_travelx TYPE /dmo/s_travelx.
    ls_travelx = CORRESPONDING #( is_travelx ).
    ls_travelx-action_code = /dmo/if_flight_legacy=>action_code-update.
    lcl_travel_buffer=>get_instance( )->cud_prep( EXPORTING it_travel   = VALUE #( ( CORRESPONDING #( is_travel ) ) )
                                                            it_travelx  = VALUE #( ( ls_travelx ) )
                                                  IMPORTING et_travel   = DATA(lt_travel)
                                                            et_messages = et_messages ).

    " We may need to delete Booking Supplements of deleted Bookings
    " Read all Booking Supplements before any Bookings are deleted
    get_travel( EXPORTING iv_travel_id           = is_travel-travel_id
                          iv_include_buffer      = abap_true
                          iv_include_temp_buffer = abap_true
                IMPORTING et_booking_supplement  = DATA(lt_booking_supplement_del) ).

    " Bookings
    IF et_messages IS INITIAL.
      " Ignore provided Travel ID of subnode tables
      DATA lt_booking  TYPE /dmo/t_booking.
      DATA lt_bookingx TYPE /dmo/t_bookingx.
      LOOP AT it_booking INTO DATA(ls_booking_in).
        DATA ls_booking TYPE /dmo/booking.
        ls_booking = CORRESPONDING #( ls_booking_in ).
        ls_booking-travel_id = is_travel-travel_id.
        INSERT ls_booking INTO TABLE lt_booking.
      ENDLOOP.
      LOOP AT it_bookingx INTO DATA(ls_booking_inx).
        DATA ls_bookingx TYPE /dmo/s_bookingx.
        ls_bookingx = CORRESPONDING #( ls_booking_inx ).
        ls_bookingx-travel_id = is_travel-travel_id.
        INSERT ls_bookingx INTO TABLE lt_bookingx.
      ENDLOOP.
      lcl_booking_buffer=>get_instance( )->cud_prep( EXPORTING it_booking  = lt_booking
                                                               it_bookingx = lt_bookingx
                                                     IMPORTING et_booking  = et_booking
                                                               et_messages = DATA(lt_messages) ).
      APPEND LINES OF lt_messages TO et_messages.
    ENDIF.

    " Booking Supplements
    IF et_messages IS INITIAL.
      " Ignore provided Travel ID of subnode tables
      DATA lt_booking_supplement  TYPE /dmo/t_booking_supplement.
      DATA lt_booking_supplementx TYPE /dmo/t_booking_supplementx.
      LOOP AT it_booking_supplement INTO DATA(ls_booking_supplement_in).
        DATA ls_booking_supplement TYPE /dmo/book_suppl.
        ls_booking_supplement = CORRESPONDING #( ls_booking_supplement_in ).
        ls_booking_supplement-travel_id = is_travel-travel_id.
        IF lcl_booking_buffer=>get_instance( )->check_booking_id( EXPORTING iv_travel_id  = ls_booking_supplement-travel_id
                                                                            iv_booking_id = ls_booking_supplement-booking_id
                                                                  CHANGING  ct_messages   = et_messages ) = abap_false.
          EXIT.
        ENDIF.
        INSERT ls_booking_supplement INTO TABLE lt_booking_supplement.
      ENDLOOP.
      IF et_messages IS INITIAL.
        LOOP AT it_booking_supplementx INTO DATA(ls_booking_supplement_inx).
          DATA ls_booking_supplementx TYPE /dmo/s_booking_supplementx.
          ls_booking_supplementx = CORRESPONDING #( ls_booking_supplement_inx ).
          ls_booking_supplementx-travel_id = is_travel-travel_id.
          INSERT ls_booking_supplementx INTO TABLE lt_booking_supplementx.
        ENDLOOP.
        lcl_booking_supplement_buffer=>get_instance( )->cud_prep( EXPORTING it_booking_supplement  = lt_booking_supplement
                                                                            it_booking_supplementx = lt_booking_supplementx
                                                                  IMPORTING et_booking_supplement  = et_booking_supplement
                                                                            et_messages            = lt_messages ).
        APPEND LINES OF lt_messages TO et_messages.
      ENDIF.
    ENDIF.

    " For Bookings to be deleted we also need to delete the Booking Supplements
    IF    et_messages IS INITIAL
      AND lt_booking_supplement_del IS NOT INITIAL
      AND line_exists( lt_bookingx[ action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-delete ) ] ). "#EC CI_SORTSEQ
      " Remove any Bookings from internal table that must not be deleted
      LOOP AT lt_booking_supplement_del ASSIGNING FIELD-SYMBOL(<s_booking_supplement_del>).
        READ TABLE lt_bookingx TRANSPORTING NO FIELDS WITH KEY action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-delete )
                                                               travel_id   = <s_booking_supplement_del>-travel_id
                                                               booking_id  = <s_booking_supplement_del>-booking_id.
        IF sy-subrc <> 0.
          DELETE lt_booking_supplement_del.
        ENDIF.
      ENDLOOP.
      lcl_booking_supplement_buffer=>get_instance( )->cud_prep( EXPORTING it_booking_supplement  = CORRESPONDING #( lt_booking_supplement_del MAPPING travel_id             = travel_id
                                                                                                                                                      booking_id            = booking_id
                                                                                                                                                      booking_supplement_id = booking_supplement_id EXCEPT * )
                                                                          it_booking_supplementx = VALUE #( FOR ls_bs IN lt_booking_supplement_del ( action_code           = /dmo/if_flight_legacy=>action_code-delete
                                                                                                                                                     travel_id             = ls_bs-travel_id
                                                                                                                                                     booking_id            = ls_bs-booking_id
                                                                                                                                                     booking_supplement_id = ls_bs-booking_supplement_id ) )
                                                                          iv_no_delete_check     = abap_true " No existence check required
                                                                IMPORTING et_messages            = et_messages ).
    ENDIF.

    IF et_messages IS INITIAL.
      ASSERT lines( lt_travel ) = 1.
      " Now do any derivations that require the whole business object (not only a single node), but which may in principle result in an error
      " The derivation may need the complete Business Object, i.e. including unchanged subnodes
      get_travel( EXPORTING iv_travel_id           = lt_travel[ 1 ]-travel_id
                            iv_include_buffer      = abap_true
                            iv_include_temp_buffer = abap_true
                  IMPORTING es_travel              = es_travel
                            et_booking             = et_booking
                            et_booking_supplement  = et_booking_supplement
                            et_messages            = et_messages ).
      ASSERT et_messages IS INITIAL.
      _determine( IMPORTING et_messages           = et_messages
                  CHANGING  cs_travel             = es_travel
                            ct_booking            = et_booking
                            ct_booking_supplement = et_booking_supplement ).
      IF et_messages IS INITIAL.
        " We do not want to return all subnodes, but only those that have been created or changed.
        " So currently it is not implemented that a determination of a booking changes another booking as the other booking cannot be properly returned.
        LOOP AT et_booking ASSIGNING FIELD-SYMBOL(<s_booking>).
          LOOP AT it_bookingx TRANSPORTING NO FIELDS WHERE booking_id = <s_booking>-booking_id
            AND ( action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-create )
               OR action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-update ) ). "#EC CI_SORTSEQ
            EXIT.
          ENDLOOP.
          IF sy-subrc <> 0.
            DELETE et_booking.
          ENDIF.
        ENDLOOP.
        LOOP AT et_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement>).
          LOOP AT it_booking_supplementx TRANSPORTING NO FIELDS WHERE booking_id = <s_booking_supplement>-booking_id AND booking_supplement_id = <s_booking_supplement>-booking_supplement_id
            AND ( action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-create )
               OR action_code = CONV /dmo/action_code( /dmo/if_flight_legacy=>action_code-update ) ). "#EC CI_SORTSEQ
            EXIT.
          ENDLOOP.
          IF sy-subrc <> 0.
            DELETE et_booking_supplement.
          ENDIF.
        ENDLOOP.
      ENDIF.
    ENDIF.

    IF et_messages IS INITIAL.
      lcl_travel_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_buffer=>get_instance( )->cud_copy( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_copy( ).
    ELSE.
      CLEAR: es_travel, et_booking, et_booking_supplement.
      lcl_travel_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_buffer=>get_instance( )->cud_disc( ).
      lcl_booking_supplement_buffer=>get_instance( )->cud_disc( ).
    ENDIF.
  ENDMETHOD.


  METHOD _convert_currency.
    DATA(lv_exchange_rate_date) = cl_abap_context_info=>get_system_date( )." Do not buffer: Current date may change during lifetime of session
    /dmo/cl_flight_amdp=>convert_currency(
      EXPORTING
        iv_amount               = iv_amount
        iv_currency_code_source = iv_currency_code_source
        iv_currency_code_target = iv_currency_code_target
        iv_exchange_rate_date   = lv_exchange_rate_date
      IMPORTING
        ev_amount               = rv_amount
    ).
  ENDMETHOD.


  METHOD _determine.
    ASSERT cs_travel-travel_id IS NOT INITIAL.
    LOOP AT ct_booking TRANSPORTING NO FIELDS WHERE travel_id <> cs_travel-travel_id. "#EC CI_SORTSEQ
      EXIT.
    ENDLOOP.
    ASSERT sy-subrc = 4.
    LOOP AT ct_booking_supplement TRANSPORTING NO FIELDS WHERE travel_id <> cs_travel-travel_id. "#EC CI_SORTSEQ
      EXIT.
    ENDLOOP.
    ASSERT sy-subrc = 4.
    CLEAR et_messages.
    _determine_travel_total_price( CHANGING cs_travel             = cs_travel
                                            ct_booking            = ct_booking
                                            ct_booking_supplement = ct_booking_supplement
                                            ct_messages           = et_messages ).
  ENDMETHOD.


  METHOD _determine_travel_total_price.
    DATA lv_add TYPE /dmo/total_price.
    DATA(lv_currency_code_target) = cs_travel-currency_code.

    " If we do not have a Travel Currency Code yet,
    " we may derive it when all the subnodes have the same non-initial Currency Code
    IF lv_currency_code_target IS INITIAL.
      DATA lv_ok TYPE abap_bool.
      lv_ok = abap_true.
      LOOP AT ct_booking ASSIGNING FIELD-SYMBOL(<s_booking>).
        IF sy-tabix = 1.
          lv_currency_code_target = <s_booking>-currency_code.
        ENDIF.
        IF <s_booking>-currency_code IS INITIAL.
          lv_ok = abap_false.
          EXIT.
        ENDIF.
        IF lv_currency_code_target <> <s_booking>-currency_code.
          lv_ok = abap_false.
          EXIT.
        ENDIF.
      ENDLOOP.
      IF lv_ok = abap_true.
        LOOP AT ct_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement>).
          IF <s_booking_supplement>-currency_code IS INITIAL.
            lv_ok = abap_false.
            EXIT.
          ENDIF.
          IF lv_currency_code_target <> <s_booking_supplement>-currency_code.
            lv_ok = abap_false.
            EXIT.
          ENDIF.
        ENDLOOP.
      ENDIF.
    ENDIF.

    IF lv_currency_code_target IS NOT INITIAL.
      " Total Price = Booking Fee + Booking Flight Prices + Booking Supplement Prices
      cs_travel-total_price   = cs_travel-booking_fee.
      cs_travel-currency_code = lv_currency_code_target.
      LOOP AT ct_booking ASSIGNING <s_booking>
          GROUP BY <s_booking>-currency_code INTO DATA(booking_currency_code).

        lv_add = REDUCE #( INIT sum = 0
                           FOR b IN GROUP booking_currency_code
                           NEXT  sum = sum + b-flight_price  ).

        IF booking_currency_code <> lv_currency_code_target.
          lv_add = _convert_currency( iv_currency_code_source = booking_currency_code
                                      iv_currency_code_target = lv_currency_code_target
                                      iv_amount               = lv_add ).
        ENDIF.
        cs_travel-total_price = cs_travel-total_price + lv_add.
      ENDLOOP.
      LOOP AT ct_booking_supplement ASSIGNING <s_booking_supplement>
          GROUP BY <s_booking_supplement>-currency_code INTO DATA(supplement_currency_code).

        lv_add = REDUCE #( INIT sum = 0
                           FOR s IN GROUP supplement_currency_code
                           NEXT  sum = sum + s-price  ).

        IF supplement_currency_code <> lv_currency_code_target.
          lv_add = _convert_currency( iv_currency_code_source = supplement_currency_code
                                      iv_currency_code_target = lv_currency_code_target
                                      iv_amount               = lv_add ).
        ENDIF.
        cs_travel-total_price = cs_travel-total_price + lv_add.
      ENDLOOP.
      lcl_travel_buffer=>get_instance( )->cud_prep( EXPORTING it_travel   = VALUE #( ( travel_id = cs_travel-travel_id  total_price = cs_travel-total_price  currency_code = cs_travel-currency_code ) )
                                                              it_travelx  = VALUE #( ( action_code = /dmo/if_flight_legacy=>action_code-update  travel_id = cs_travel-travel_id  total_price = abap_true  currency_code = abap_true ) )
                                                    IMPORTING et_messages = DATA(lt_messages) ).
      ASSERT lt_messages IS INITIAL.
    ENDIF.
  ENDMETHOD.


  METHOD _resolve_attribute.
    CLEAR rv_symsgv.
    CASE iv_attrname.
      WHEN ''.
        rv_symsgv = ''.
      WHEN 'MV_TRAVEL_ID'.
        rv_symsgv = |{ ix->mv_travel_id ALPHA = OUT }|.
      WHEN 'MV_BOOKING_ID'.
        rv_symsgv = |{ ix->mv_booking_id ALPHA = OUT }|.
      WHEN 'MV_BOOKING_SUPPLEMENT_ID'.
        rv_symsgv = |{ ix->mv_booking_supplement_id ALPHA = OUT }|.
      WHEN 'MV_AGENCY_ID'.
        rv_symsgv = |{ ix->mv_agency_id ALPHA = OUT }|.
      WHEN 'MV_CUSTOMER_ID'.
        rv_symsgv = |{ ix->mv_customer_id ALPHA = OUT }|.
      WHEN 'MV_CARRIER_ID'.
        rv_symsgv = |{ ix->mv_carrier_id ALPHA = OUT }|.
      WHEN 'MV_CONNECTION_ID'.
        rv_symsgv = |{ ix->mv_connection_id ALPHA = OUT }|.
      WHEN 'MV_SUPPLEMENT_ID'.
        rv_symsgv = ix->mv_supplement_id.
      WHEN 'MV_BEGIN_DATE'.
        rv_symsgv = |{ ix->mv_begin_date DATE = USER }|.
      WHEN 'MV_END_DATE'.
        rv_symsgv = |{ ix->mv_end_date DATE = USER }|.
      WHEN 'MV_BOOKING_DATE'.
        rv_symsgv = |{ ix->mv_booking_date DATE = USER }|.
      WHEN 'MV_FLIGHT_DATE'.
        rv_symsgv = |{ ix->mv_flight_date DATE = USER }|.
      WHEN 'MV_STATUS'.
        rv_symsgv = ix->mv_status.
      WHEN 'MV_CURRENCY_CODE'.
        rv_symsgv = ix->mv_currency_code.
      WHEN 'MV_UNAME'.
        rv_symsgv = ix->mv_uname.
      WHEN OTHERS.
        ASSERT 1 = 2.
    ENDCASE.
  ENDMETHOD.
ENDCLASS.

</pre>
<pre class="pre-green">
" Local Class  /DMO/CL_FLIGHT_LEGACY 

CLASS lcl_common_checks DEFINITION FINAL CREATE PRIVATE.
  PUBLIC SECTION.
    CLASS-METHODS is_currency_code_valid IMPORTING iv_currency_code   TYPE /dmo/currency_code
                                         CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                         RETURNING VALUE(rv_is_valid) TYPE abap_boolean.
    CLASS-METHODS is_customer_id_valid IMPORTING iv_customer_id     TYPE /dmo/customer_id
                                       CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                       RETURNING VALUE(rv_is_valid) TYPE abap_boolean.
  PRIVATE SECTION.
    CLASS-DATA mt_currency_code TYPE SORTED TABLE OF /dmo/currency_code WITH UNIQUE KEY table_line.
    CLASS-DATA mt_customer_id TYPE SORTED TABLE OF /dmo/customer_id WITH UNIQUE KEY table_line.
ENDCLASS.


CLASS lcl_common_checks IMPLEMENTATION.
  METHOD is_currency_code_valid.
    CLEAR rv_is_valid.
    IF mt_currency_code IS INITIAL.
      " We should use TCURC, but this is not released for "ABAP for SAP Cloud Platform"
      SELECT DISTINCT currency FROM i_currency INTO TABLE @mt_currency_code. "#EC CI_NOWHERE
    ENDIF.
    READ TABLE mt_currency_code TRANSPORTING NO FIELDS WITH TABLE KEY table_line = iv_currency_code.
    IF sy-subrc = 0.
      rv_is_valid = abap_true.
    ELSE.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>currency_unknown  currency_code = iv_currency_code ) TO ct_messages.
    ENDIF.
  ENDMETHOD.


  METHOD is_customer_id_valid.
    CLEAR rv_is_valid.
    IF mt_customer_id IS INITIAL.
      " There may be very many customers, but we only store the ID in the internal table
      SELECT DISTINCT customer_id FROM /dmo/customer INTO TABLE @mt_customer_id. "#EC CI_NOWHERE
    ENDIF.
    READ TABLE mt_customer_id TRANSPORTING NO FIELDS WITH TABLE KEY table_line = iv_customer_id.
    IF sy-subrc = 0.
      rv_is_valid = abap_true.
    ELSE.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>customer_unkown  customer_id = iv_customer_id ) TO ct_messages.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

CLASS ltc_booking_supplement DEFINITION DEFERRED.
CLASS lcl_booking_supplement_buffer DEFINITION FINAL CREATE PRIVATE FRIENDS ltc_booking_supplement.
  PUBLIC SECTION.
    CLASS-METHODS: get_instance RETURNING VALUE(ro_instance) TYPE REF TO lcl_booking_supplement_buffer.
    METHODS adjust_numbers IMPORTING it_booking_mapping             TYPE /dmo/if_flight_legacy=>tt_ln_booking_mapping
                           RETURNING VALUE(rt_bookingsuppl_mapping) TYPE /dmo/if_flight_legacy=>tt_ln_bookingsuppl_mapping.
    METHODS save.
    METHODS initialize.
    "! Prepare changes in a temporary buffer
    "! @parameter iv_no_delete_check | In some cases we do not need to check the existence of a record to be deleted, as this check has been done before.
    "!                               | E.g. delete all subnodes of a node to be deleted.  In this case we have read the subnodes to get their keys.
    METHODS cud_prep IMPORTING it_booking_supplement  TYPE /dmo/t_booking_supplement
                               it_booking_supplementx TYPE /dmo/t_booking_supplementx
                               iv_no_delete_check     TYPE abap_bool OPTIONAL
                     EXPORTING et_booking_supplement  TYPE /dmo/t_booking_supplement
                               et_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    "! Add content of the temporary buffer to the real buffer and clear the temporary buffer
    METHODS cud_copy.
    "! Discard content of the temporary buffer
    METHODS cud_disc.
    "! Get all Booking Supplements for given Bookings
    METHODS get IMPORTING it_booking_supplement  TYPE /dmo/t_booking_supplement
                          iv_include_buffer      TYPE abap_boolean
                          iv_include_temp_buffer TYPE abap_boolean
                EXPORTING et_booking_supplement  TYPE /dmo/t_booking_supplement.

  PRIVATE SECTION.
    CLASS-DATA go_instance TYPE REF TO lcl_booking_supplement_buffer.
    " Main buffer
    DATA: mt_create_buffer TYPE /dmo/t_booking_supplement,
          mt_update_buffer TYPE /dmo/t_booking_supplement,
          mt_delete_buffer TYPE /dmo/t_booking_supplement_key.
    " Temporary buffer valid during create / update / delete Travel
    DATA: mt_create_buffer_2 TYPE /dmo/t_booking_supplement,
          mt_update_buffer_2 TYPE /dmo/t_booking_supplement,
          mt_delete_buffer_2 TYPE /dmo/t_booking_supplement_key.

    DATA mt_supplement TYPE SORTED TABLE OF /dmo/supplement WITH UNIQUE KEY supplement_id.

    METHODS _create IMPORTING it_booking_supplement TYPE /dmo/t_booking_supplement
                    EXPORTING et_booking_supplement TYPE /dmo/t_booking_supplement
                              et_messages           TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _update IMPORTING it_booking_supplement  TYPE /dmo/t_booking_supplement
                              it_booking_supplementx TYPE /dmo/t_booking_supplementx
                    EXPORTING et_booking_supplement  TYPE /dmo/t_booking_supplement
                              et_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _delete IMPORTING it_booking_supplement TYPE /dmo/t_booking_supplement
                              iv_no_delete_check    TYPE abap_bool
                    EXPORTING et_messages           TYPE /dmo/if_flight_legacy=>tt_if_t100_message.

    METHODS _check IMPORTING is_booking_supplement  TYPE /dmo/book_suppl
                             is_booking_supplementx TYPE /dmo/s_booking_supplementx OPTIONAL
                             iv_change_mode         TYPE /dmo/cl_flight_legacy=>ty_change_mode
                   CHANGING  ct_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                   RETURNING VALUE(rv_is_valid)     TYPE abap_bool.
    METHODS _check_supplement IMPORTING is_booking_supplement  TYPE /dmo/book_suppl
                                        is_booking_supplementx TYPE /dmo/s_booking_supplementx OPTIONAL
                                        iv_change_mode         TYPE /dmo/cl_flight_legacy=>ty_change_mode
                              CHANGING  ct_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                              RETURNING VALUE(rv_is_valid)     TYPE abap_bool.
    METHODS _check_currency_code IMPORTING is_booking_supplement  TYPE /dmo/book_suppl
                                           is_booking_supplementx TYPE /dmo/s_booking_supplementx OPTIONAL
                                           iv_change_mode         TYPE /dmo/cl_flight_legacy=>ty_change_mode
                                 CHANGING  ct_messages            TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                 RETURNING VALUE(rv_is_valid)     TYPE abap_bool.
    METHODS _determine IMPORTING iv_change_mode        TYPE /dmo/cl_flight_legacy=>ty_change_mode
                       CHANGING  cs_booking_supplement TYPE /dmo/book_suppl.
ENDCLASS.


CLASS lcl_booking_supplement_buffer IMPLEMENTATION.
  METHOD get_instance.
    go_instance = COND #( WHEN go_instance IS BOUND THEN go_instance ELSE NEW #( ) ).
    ro_instance = go_instance.
  ENDMETHOD.


  METHOD _create.
    CLEAR et_booking_supplement.
    CLEAR et_messages.

    TYPES: BEGIN OF ts_travel_booking_suppl_id,
             travel_id             TYPE /dmo/travel_id,
             booking_id            TYPE /dmo/booking_id,
             booking_supplement_id TYPE /dmo/booking_supplement_id,
           END OF ts_travel_booking_suppl_id,
           tt_travel_booking_suppl_id TYPE SORTED TABLE OF ts_travel_booking_suppl_id WITH UNIQUE KEY travel_id  booking_id  booking_supplement_id.
    DATA lt_travel_booking_suppl_id TYPE tt_travel_booking_suppl_id.

    CHECK it_booking_supplement IS NOT INITIAL.

    SELECT FROM /dmo/book_suppl FIELDS travel_id, booking_id, booking_supplement_id
      FOR ALL ENTRIES IN @it_booking_supplement WHERE travel_id = @it_booking_supplement-travel_id AND booking_id = @it_booking_supplement-booking_id AND booking_supplement_id = @it_booking_supplement-booking_supplement_id
      INTO CORRESPONDING FIELDS OF TABLE @lt_travel_booking_suppl_id.

    LOOP AT it_booking_supplement INTO DATA(ls_booking_supplement_create) ##INTO_OK.
      " Booking_Supplement_ID key must not be initial
      IF ls_booking_supplement_create-booking_supplement_id IS INITIAL.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_supplement_no_key
                                          travel_id  = ls_booking_supplement_create-travel_id
                                          booking_id = ls_booking_supplement_create-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Booking_Supplement_ID key check DB
      READ TABLE lt_travel_booking_suppl_id TRANSPORTING NO FIELDS WITH TABLE KEY travel_id             = ls_booking_supplement_create-travel_id
                                                                                  booking_id            = ls_booking_supplement_create-booking_id
                                                                                  booking_supplement_id = ls_booking_supplement_create-booking_supplement_id.
      IF sy-subrc = 0.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_supplement_exists
                                          travel_id  = ls_booking_supplement_create-travel_id
                                          booking_id = ls_booking_supplement_create-booking_id
                                          booking_supplement_id = ls_booking_supplement_create-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Booking_Supplement_ID key check Buffer
      READ TABLE mt_create_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id             = ls_booking_supplement_create-travel_id
                                                                        booking_id            = ls_booking_supplement_create-booking_id
                                                                        booking_supplement_id = ls_booking_supplement_create-booking_supplement_id.
      IF sy-subrc = 0.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_supplement_exists
                                          travel_id  = ls_booking_supplement_create-travel_id
                                          booking_id = ls_booking_supplement_create-booking_id
                                          booking_supplement_id = ls_booking_supplement_create-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Checks
      IF _check( EXPORTING is_booking_supplement = ls_booking_supplement_create
                           iv_change_mode        = /dmo/cl_flight_legacy=>change_mode-create
                 CHANGING  ct_messages           = et_messages ) = abap_false.
        RETURN.
      ENDIF.

      " standard determinations
      _determine( EXPORTING iv_change_mode        = /dmo/cl_flight_legacy=>change_mode-create
                  CHANGING  cs_booking_supplement = ls_booking_supplement_create ).

      INSERT ls_booking_supplement_create INTO TABLE mt_create_buffer_2.
    ENDLOOP.

    et_booking_supplement = mt_create_buffer_2.
  ENDMETHOD.


  METHOD _update.
    CLEAR et_booking_supplement.
    CLEAR et_messages.

    CHECK it_booking_supplement IS NOT INITIAL.

    " Check for empty keys
    LOOP AT it_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement_update>) WHERE booking_supplement_id = 0. "#EC CI_SORTSEQ
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_supplement_no_key  travel_id = <s_booking_supplement_update>-travel_id  booking_id = <s_booking_supplement_update>-booking_id ) TO et_messages.
      RETURN.
    ENDLOOP.

    DATA lt_book_suppl TYPE SORTED TABLE OF /dmo/book_suppl WITH UNIQUE KEY travel_id  booking_id  booking_supplement_id.
    SELECT * FROM /dmo/book_suppl FOR ALL ENTRIES IN @it_booking_supplement WHERE travel_id             = @it_booking_supplement-travel_id
                                                                              AND booking_id            = @it_booking_supplement-booking_id
                                                                              AND booking_supplement_id = @it_booking_supplement-booking_supplement_id
                                                                            INTO TABLE @lt_book_suppl.

    FIELD-SYMBOLS <s_buffer_booking_supplement> TYPE /dmo/book_suppl.
    DATA ls_buffer_booking_supplement TYPE /dmo/book_suppl.
    LOOP AT it_booking_supplement ASSIGNING <s_booking_supplement_update>.
      UNASSIGN <s_buffer_booking_supplement>.

      READ TABLE mt_delete_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                        booking_id            = <s_booking_supplement_update>-booking_id
                                                                        booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
      IF sy-subrc = 0." Error: Record to be updated marked for deletion
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_unknown
                                          travel_id             = <s_booking_supplement_update>-travel_id
                                          booking_id            = <s_booking_supplement_update>-booking_id
                                          booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF <s_buffer_booking_supplement> IS NOT ASSIGNED." Special case: record already in temporary create buffer
        READ TABLE mt_create_buffer_2 ASSIGNING <s_buffer_booking_supplement> WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                             booking_id            = <s_booking_supplement_update>-booking_id
                                                                                             booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
      ENDIF.

      IF <s_buffer_booking_supplement> IS NOT ASSIGNED." Special case: record already in create buffer
        READ TABLE mt_create_buffer INTO ls_buffer_booking_supplement WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                     booking_id            = <s_booking_supplement_update>-booking_id
                                                                                     booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_booking_supplement INTO TABLE mt_create_buffer_2 ASSIGNING <s_buffer_booking_supplement>.
        ENDIF.
      ENDIF.

      IF <s_buffer_booking_supplement> IS NOT ASSIGNED." Special case: record already in temporary update buffer
        READ TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking_supplement> WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                             booking_id            = <s_booking_supplement_update>-booking_id
                                                                                             booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
      ENDIF.

      IF <s_buffer_booking_supplement> IS NOT ASSIGNED." Special case: record already in update buffer
        READ TABLE mt_update_buffer INTO ls_buffer_booking_supplement WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                     booking_id            = <s_booking_supplement_update>-booking_id
                                                                                     booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_booking_supplement INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking_supplement>.
        ENDIF.
      ENDIF.

      IF <s_buffer_booking_supplement> IS NOT ASSIGNED." Usual case: record not already in update buffer
        READ TABLE lt_book_suppl ASSIGNING FIELD-SYMBOL(<s_booking_supplement_old>) WITH TABLE KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                                   booking_id            = <s_booking_supplement_update>-booking_id
                                                                                                   booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id.
        IF sy-subrc = 0.
          INSERT <s_booking_supplement_old> INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking_supplement>.
          ASSERT sy-subrc = 0.
        ENDIF.
      ENDIF.

      " Error
      IF <s_buffer_booking_supplement> IS NOT ASSIGNED.
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_unknown
                                          travel_id             = <s_booking_supplement_update>-travel_id
                                          booking_id            = <s_booking_supplement_update>-booking_id
                                          booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Merge fields to be updated
      READ TABLE it_booking_supplementx ASSIGNING FIELD-SYMBOL(<s_booking_supplementx>) WITH KEY travel_id             = <s_booking_supplement_update>-travel_id
                                                                                                 booking_id            = <s_booking_supplement_update>-booking_id
                                                                                                 booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id
                                                                                                 action_code           = /dmo/if_flight_legacy=>action_code-update.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_no_control
                                          travel_id             = <s_booking_supplement_update>-travel_id
                                          booking_id            = <s_booking_supplement_update>-booking_id
                                          booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF <s_booking_supplementx>-supplement_id = abap_true AND <s_booking_supplement_update>-supplement_id <> <s_buffer_booking_supplement>-supplement_id.
        " The supplement ID must not be changed (delete the record and create a new one)
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_suppl_id_u
                                          travel_id             = <s_booking_supplement_update>-travel_id
                                          booking_id            = <s_booking_supplement_update>-booking_id
                                          booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF   ( <s_booking_supplementx>-price = abap_true  AND <s_booking_supplementx>-currency_code = abap_false )
        OR ( <s_booking_supplementx>-price = abap_false AND <s_booking_supplementx>-currency_code = abap_true  ).
        " Price and currency code must be changed together
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_pri_curr_u
                                          travel_id             = <s_booking_supplement_update>-travel_id
                                          booking_id            = <s_booking_supplement_update>-booking_id
                                          booking_supplement_id = <s_booking_supplement_update>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.

      DATA lv_field TYPE i.
      lv_field = 5.
      DO.
        ASSIGN COMPONENT lv_field OF STRUCTURE <s_booking_supplementx> TO FIELD-SYMBOL(<v_flag>).
        IF sy-subrc <> 0.
          EXIT.
        ENDIF.
        IF <v_flag> = abap_true.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_booking_supplement_update> TO FIELD-SYMBOL(<v_field_new>).
          ASSERT sy-subrc = 0.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_buffer_booking_supplement> TO FIELD-SYMBOL(<v_field_old>).
          ASSERT sy-subrc = 0.
          <v_field_old> = <v_field_new>.
        ENDIF.
        lv_field = lv_field + 1.
      ENDDO.

      " Checks
      IF _check( EXPORTING is_booking_supplement  = <s_buffer_booking_supplement>
                           is_booking_supplementx = <s_booking_supplementx>
                           iv_change_mode         = /dmo/cl_flight_legacy=>change_mode-update
                 CHANGING  ct_messages            = et_messages ) = abap_false.
        RETURN.
      ENDIF.

      " standard determinations
      DATA(ls_booking_supplement) = <s_buffer_booking_supplement>." Needed, as key fields must not be changed
      _determine( EXPORTING iv_change_mode        = /dmo/cl_flight_legacy=>change_mode-update
                  CHANGING  cs_booking_supplement = ls_booking_supplement ).
      <s_buffer_booking_supplement>-gr_data = ls_booking_supplement-gr_data.

      INSERT <s_buffer_booking_supplement> INTO TABLE et_booking_supplement.
    ENDLOOP.
  ENDMETHOD.


  METHOD _delete.
    CLEAR et_messages.

    CHECK it_booking_supplement IS NOT INITIAL.

    " Check for empty keys
    LOOP AT it_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement_delete>) WHERE booking_supplement_id = 0. "#EC CI_SORTSEQ
      APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_supplement_no_key
                                        travel_id  = <s_booking_supplement_delete>-travel_id
                                        booking_id = <s_booking_supplement_delete>-booking_id ) TO et_messages.
      RETURN.
    ENDLOOP.

    DATA(lt_booking_supplement) = it_booking_supplement.

    LOOP AT lt_booking_supplement ASSIGNING <s_booking_supplement_delete>.
      " Special case: record already in create buffer
      READ TABLE mt_create_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id             = <s_booking_supplement_delete>-travel_id
                                                                        booking_id            = <s_booking_supplement_delete>-booking_id
                                                                        booking_supplement_id = <s_booking_supplement_delete>-booking_supplement_id.
      IF sy-subrc = 0." Artificial case: Remove entry from create buffer
        INSERT VALUE #( travel_id             = <s_booking_supplement_delete>-travel_id
                        booking_id            = <s_booking_supplement_delete>-booking_id
                        booking_supplement_id = <s_booking_supplement_delete>-booking_supplement_id ) INTO TABLE mt_delete_buffer_2.
        DELETE lt_booking_supplement.
      ENDIF.
    ENDLOOP.

    IF iv_no_delete_check = abap_false.
      DATA lt_book_suppl_db TYPE /dmo/t_booking_supplement_key.
      SELECT travel_id, booking_id, booking_supplement_id FROM /dmo/book_suppl FOR ALL ENTRIES IN @lt_booking_supplement
        WHERE travel_id = @lt_booking_supplement-travel_id AND booking_id = @lt_booking_supplement-booking_id AND booking_supplement_id = @lt_booking_supplement-booking_supplement_id INTO CORRESPONDING FIELDS OF TABLE @lt_book_suppl_db.
    ENDIF.

    " Check existence and append to delete buffer
    LOOP AT lt_booking_supplement ASSIGNING <s_booking_supplement_delete>.
      IF iv_no_delete_check = abap_false.
        READ TABLE lt_book_suppl_db TRANSPORTING NO FIELDS WITH TABLE KEY travel_id             = <s_booking_supplement_delete>-travel_id
                                                                          booking_id            = <s_booking_supplement_delete>-booking_id
                                                                          booking_supplement_id = <s_booking_supplement_delete>-booking_supplement_id.
        IF sy-subrc <> 0.
          APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_unknown
                                            travel_id             = <s_booking_supplement_delete>-travel_id
                                            booking_id            = <s_booking_supplement_delete>-booking_id
                                            booking_supplement_id = <s_booking_supplement_delete>-booking_supplement_id ) TO et_messages.
          RETURN.
        ENDIF.
      ENDIF.
      INSERT VALUE #( travel_id             = <s_booking_supplement_delete>-travel_id
                      booking_id            = <s_booking_supplement_delete>-booking_id
                      booking_supplement_id = <s_booking_supplement_delete>-booking_supplement_id ) INTO TABLE mt_delete_buffer_2.
    ENDLOOP.
  ENDMETHOD.


  METHOD adjust_numbers.
    DATA: lt_create_buffer TYPE /dmo/t_booking_supplement.

    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    CHECK mt_create_buffer IS NOT INITIAL.    "Any Create to be processed?

    LOOP AT mt_create_buffer INTO DATA(ls_create_buffer).
      READ TABLE it_booking_mapping INTO DATA(ls_booking_mapping) WITH KEY preliminary-travel_id  = ls_create_buffer-travel_id
                                                                           preliminary-booking_id = ls_create_buffer-booking_id.
      " If found we replace the number - otherwise we simply return the mapping a=a
      IF sy-subrc EQ 0.
        APPEND VALUE #( preliminary = VALUE #( travel_id             = ls_create_buffer-travel_id
                                               booking_id            = ls_create_buffer-booking_id
                                               booking_supplement_id = ls_create_buffer-booking_supplement_id )
                        final       = VALUE #( travel_id             = ls_booking_mapping-final-travel_id
                                               booking_id            = ls_booking_mapping-final-booking_id
                                               booking_supplement_id = ls_create_buffer-booking_supplement_id ) ) TO rt_bookingsuppl_mapping.

        ls_create_buffer-travel_id  = ls_booking_mapping-final-travel_id.
        ls_create_buffer-booking_id = ls_booking_mapping-final-booking_id.
      ELSE.
        APPEND VALUE #( preliminary = VALUE #( travel_id             = ls_create_buffer-travel_id
                                               booking_id            = ls_create_buffer-booking_id
                                               booking_supplement_id = ls_create_buffer-booking_supplement_id )
                        final       = VALUE #( travel_id             = ls_create_buffer-travel_id
                                               booking_id            = ls_create_buffer-booking_id
                                               booking_supplement_id = ls_create_buffer-booking_supplement_id ) ) TO rt_bookingsuppl_mapping.
      ENDIF.
      INSERT ls_create_buffer INTO TABLE lt_create_buffer.
    ENDLOOP.
    mt_create_buffer = lt_create_buffer.
  ENDMETHOD.

  METHOD save.
    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    " Make sure no preliminary travel_id is remaining (late numbering use-case)
    " If this dump happens, call adjust numbers before executing save
    IF mt_create_buffer IS NOT INITIAL.
      ASSERT mt_create_buffer[ lines( mt_create_buffer ) ]-travel_id < /dmo/if_flight_legacy=>late_numbering_boundary.
    ENDIF.

    INSERT /dmo/book_suppl FROM TABLE @mt_create_buffer.
    UPDATE /dmo/book_suppl FROM TABLE @mt_update_buffer.
    DELETE /dmo/book_suppl FROM TABLE @( CORRESPONDING #( mt_delete_buffer ) ).
  ENDMETHOD.


  METHOD initialize.
    CLEAR: mt_create_buffer, mt_update_buffer, mt_delete_buffer.
  ENDMETHOD.


  METHOD _check.
    rv_is_valid = abap_true.

    IF NOT _check_supplement( EXPORTING is_booking_supplement  = is_booking_supplement
                                        is_booking_supplementx = is_booking_supplementx
                                        iv_change_mode         = iv_change_mode
                              CHANGING ct_messages             = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_currency_code( EXPORTING is_booking_supplement  = is_booking_supplement
                                           is_booking_supplementx = is_booking_supplementx
                                           iv_change_mode         = iv_change_mode
                                  CHANGING ct_messages             = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.
  ENDMETHOD.


  METHOD cud_prep.
    CLEAR et_booking_supplement.
    CLEAR et_messages.

    CHECK it_booking_supplement IS NOT INITIAL.

    DATA lt_booking_supplement_c  TYPE /dmo/t_booking_supplement.
    DATA lt_booking_supplement_u  TYPE /dmo/t_booking_supplement.
    DATA lt_booking_supplement_d  TYPE /dmo/t_booking_supplement.
    DATA lt_booking_supplementx_u TYPE /dmo/t_booking_supplementx.
    LOOP AT it_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement>).
      READ TABLE it_booking_supplementx ASSIGNING FIELD-SYMBOL(<s_booking_supplementx>) WITH TABLE KEY travel_id             = <s_booking_supplement>-travel_id
                                                                                                       booking_id            = <s_booking_supplement>-booking_id
                                                                                                       booking_supplement_id = <s_booking_supplement>-booking_supplement_id.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid                = /dmo/cx_flight_legacy=>booking_supplement_no_control
                                          travel_id             = <s_booking_supplement>-travel_id
                                          booking_id            = <s_booking_supplement>-booking_id
                                          booking_supplement_id = <s_booking_supplement>-booking_supplement_id ) TO et_messages.
        RETURN.
      ENDIF.
      CASE CONV /dmo/if_flight_legacy=>action_code_enum( <s_booking_supplementx>-action_code ).
        WHEN /dmo/if_flight_legacy=>action_code-create.
          INSERT <s_booking_supplement>  INTO TABLE lt_booking_supplement_c.
        WHEN /dmo/if_flight_legacy=>action_code-update.
          INSERT <s_booking_supplement>  INTO TABLE lt_booking_supplement_u.
          INSERT <s_booking_supplementx> INTO TABLE lt_booking_supplementx_u.
        WHEN /dmo/if_flight_legacy=>action_code-delete.
          INSERT <s_booking_supplement>  INTO TABLE lt_booking_supplement_d.
      ENDCASE.
    ENDLOOP.

    _create( EXPORTING it_booking_supplement = lt_booking_supplement_c
             IMPORTING et_booking_supplement = et_booking_supplement
                       et_messages           = et_messages ).

    _update( EXPORTING it_booking_supplement  = lt_booking_supplement_u
                       it_booking_supplementx = lt_booking_supplementx_u
             IMPORTING et_booking_supplement  = DATA(lt_booking_supplement)
                       et_messages            = DATA(lt_messages) ).
    INSERT LINES OF lt_booking_supplement INTO TABLE et_booking_supplement.
    APPEND LINES OF lt_messages TO et_messages.

    _delete( EXPORTING it_booking_supplement = lt_booking_supplement_d
                       iv_no_delete_check    = iv_no_delete_check
             IMPORTING et_messages           = lt_messages ).
    APPEND LINES OF lt_messages TO et_messages.
  ENDMETHOD.


  METHOD cud_copy.
    LOOP AT mt_create_buffer_2 ASSIGNING FIELD-SYMBOL(<s_create_buffer_2>).
      READ TABLE mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WITH TABLE KEY travel_id             = <s_create_buffer_2>-travel_id
                                                                                           booking_id            = <s_create_buffer_2>-booking_id
                                                                                           booking_supplement_id = <s_create_buffer_2>-booking_supplement_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id             = <s_create_buffer_2>-travel_id
                        booking_id            = <s_create_buffer_2>-booking_id
                        booking_supplement_id = <s_create_buffer_2>-booking_supplement_id ) INTO TABLE mt_create_buffer ASSIGNING <s_create_buffer>.
      ENDIF.
      <s_create_buffer>-gr_data = <s_create_buffer_2>-gr_data.
    ENDLOOP.
    LOOP AT mt_update_buffer_2 ASSIGNING FIELD-SYMBOL(<s_update_buffer_2>).
      READ TABLE mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WITH TABLE KEY travel_id             = <s_update_buffer_2>-travel_id
                                                                                           booking_id            = <s_update_buffer_2>-booking_id
                                                                                           booking_supplement_id = <s_update_buffer_2>-booking_supplement_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id             = <s_update_buffer_2>-travel_id
                        booking_id            = <s_update_buffer_2>-booking_id
                        booking_supplement_id = <s_update_buffer_2>-booking_supplement_id ) INTO TABLE mt_update_buffer ASSIGNING <s_update_buffer>.
      ENDIF.
      <s_update_buffer>-gr_data = <s_update_buffer_2>-gr_data.
    ENDLOOP.
    LOOP AT mt_delete_buffer_2 ASSIGNING FIELD-SYMBOL(<s_delete_buffer_2>).
      DELETE mt_create_buffer WHERE travel_id             = <s_delete_buffer_2>-travel_id
                                AND booking_id            = <s_delete_buffer_2>-booking_id
                                AND booking_supplement_id = <s_delete_buffer_2>-booking_supplement_id.
      IF sy-subrc = 0.
        CONTINUE.
      ENDIF.
      DELETE mt_update_buffer WHERE travel_id             = <s_delete_buffer_2>-travel_id
                                AND booking_id            = <s_delete_buffer_2>-booking_id
                                AND booking_supplement_id = <s_delete_buffer_2>-booking_supplement_id.
      INSERT <s_delete_buffer_2> INTO TABLE mt_delete_buffer.
    ENDLOOP.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD cud_disc.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD get.
    CLEAR et_booking_supplement.

    CHECK it_booking_supplement IS NOT INITIAL.

    SELECT * FROM /dmo/book_suppl FOR ALL ENTRIES IN @it_booking_supplement WHERE travel_id  = @it_booking_supplement-travel_id
                                                                              AND booking_id = @it_booking_supplement-booking_id
      INTO TABLE @et_booking_supplement ##SELECT_FAE_WITH_LOB[DESCRIPTION]. "#EC CI_SEL_DEL

    IF iv_include_buffer = abap_true.
      LOOP AT it_booking_supplement ASSIGNING FIELD-SYMBOL(<s_booking_supplement>).
        LOOP AT mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          INSERT <s_create_buffer> INTO TABLE et_booking_supplement.
        ENDLOOP.

        LOOP AT mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          MODIFY TABLE et_booking_supplement FROM <s_update_buffer>.
        ENDLOOP.

        LOOP AT mt_delete_buffer ASSIGNING FIELD-SYMBOL(<s_delete_buffer>) WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          DELETE et_booking_supplement WHERE travel_id             = <s_delete_buffer>-travel_id
                                         AND booking_id            = <s_delete_buffer>-booking_id
                                         AND booking_supplement_id = <s_delete_buffer>-booking_supplement_id. "#EC CI_SEL_DEL
        ENDLOOP.
      ENDLOOP.
    ENDIF.

    IF iv_include_temp_buffer = abap_true.
      LOOP AT it_booking_supplement ASSIGNING <s_booking_supplement>.
        LOOP AT mt_create_buffer_2 ASSIGNING <s_create_buffer> WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          DELETE et_booking_supplement WHERE travel_id             = <s_create_buffer>-travel_id
                                         AND booking_id            = <s_create_buffer>-booking_id
                                         AND booking_supplement_id = <s_create_buffer>-booking_supplement_id. "#EC CI_SEL_DEL
          INSERT <s_create_buffer> INTO TABLE et_booking_supplement.
        ENDLOOP.

        LOOP AT mt_update_buffer_2 ASSIGNING <s_update_buffer> WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          MODIFY TABLE et_booking_supplement FROM <s_update_buffer>.
        ENDLOOP.

        LOOP AT mt_delete_buffer_2 ASSIGNING <s_delete_buffer> WHERE travel_id = <s_booking_supplement>-travel_id AND booking_id = <s_booking_supplement>-booking_id.
          DELETE et_booking_supplement WHERE travel_id             = <s_delete_buffer>-travel_id
                                         AND booking_id            = <s_delete_buffer>-booking_id
                                         AND booking_supplement_id = <s_delete_buffer>-booking_supplement_id. "#EC CI_SEL_DEL
        ENDLOOP.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.


  METHOD _check_supplement.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_booking_supplementx-supplement_id = abap_true ).
      IF mt_supplement IS INITIAL.
        SELECT * FROM /dmo/supplement INTO TABLE @mt_supplement. "#EC CI_NOWHERE
      ENDIF.
      READ TABLE mt_supplement TRANSPORTING NO FIELDS WITH TABLE KEY supplement_id = is_booking_supplement-supplement_id.
      IF sy-subrc <> 0.
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>supplement_unknown  supplement_id = is_booking_supplement-supplement_id ) TO ct_messages.
      ENDIF.
    ENDIF.
  ENDMETHOD.


  METHOD _check_currency_code.
    rv_is_valid = abap_true.
    IF   ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create AND is_booking_supplement-currency_code IS NOT INITIAL ) " Will be derived if initial
      OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_booking_supplementx-currency_code = abap_true ).
      rv_is_valid = lcl_common_checks=>is_currency_code_valid( EXPORTING iv_currency_code = is_booking_supplement-currency_code CHANGING ct_messages = ct_messages ).
    ENDIF.
  ENDMETHOD.


  METHOD _determine.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create.
      " Derive price and currency code if one of the fields is initial
      IF cs_booking_supplement-price IS INITIAL OR cs_booking_supplement-currency_code IS INITIAL.
        IF mt_supplement IS INITIAL.
          SELECT * FROM /dmo/supplement INTO TABLE @mt_supplement. "#EC CI_NOWHERE
        ENDIF.
        READ TABLE mt_supplement ASSIGNING FIELD-SYMBOL(<s_supplement>) WITH TABLE KEY supplement_id = cs_booking_supplement-supplement_id.
        ASSERT sy-subrc = 0. " Check has been done before
        cs_booking_supplement-price         = <s_supplement>-price.
        cs_booking_supplement-currency_code = <s_supplement>-currency_code.
      ENDIF.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

CLASS ltc_booking DEFINITION DEFERRED.
CLASS lcl_booking_buffer DEFINITION FINAL CREATE PRIVATE FRIENDS ltc_booking.
  PUBLIC SECTION.
    CLASS-METHODS: get_instance RETURNING VALUE(ro_instance) TYPE REF TO lcl_booking_buffer.
    METHODS adjust_numbers IMPORTING it_travel_mapping         TYPE /dmo/if_flight_legacy=>tt_ln_travel_mapping
                           RETURNING VALUE(rt_booking_mapping) TYPE /dmo/if_flight_legacy=>tt_ln_booking_mapping.
    METHODS save.
    METHODS initialize.
    METHODS check_booking_id IMPORTING iv_travel_id       TYPE /dmo/travel_id
                                       iv_booking_id      TYPE /dmo/booking_id
                             CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                             RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    "! Prepare changes in a temporary buffer
    "! @parameter iv_no_delete_check | In some cases we do not need to check the existence of a record to be deleted, as this check has been done before.
    "!                               | E.g. delete all subnodes of a node to be deleted.  In this case we have read the subnodes to get their keys.
    METHODS cud_prep IMPORTING it_booking         TYPE /dmo/t_booking
                               it_bookingx        TYPE /dmo/t_bookingx
                               iv_no_delete_check TYPE abap_bool OPTIONAL
                     EXPORTING et_booking         TYPE /dmo/t_booking
                               et_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    "! Add content of the temporary buffer to the real buffer and clear the temporary buffer
    METHODS cud_copy.
    "! Discard content of the temporary buffer
    METHODS cud_disc.
    "! Get all Bookings for given Travels
    METHODS get IMPORTING it_booking             TYPE /dmo/t_booking
                          iv_include_buffer      TYPE abap_boolean
                          iv_include_temp_buffer TYPE abap_boolean
                EXPORTING et_booking             TYPE /dmo/t_booking.

  PRIVATE SECTION.
    CLASS-DATA go_instance TYPE REF TO lcl_booking_buffer.
    " Main buffer
    DATA: mt_create_buffer TYPE /dmo/t_booking,
          mt_update_buffer TYPE /dmo/t_booking,
          mt_delete_buffer TYPE /dmo/t_booking_key.
    " Temporary buffer valid during create / update / delete Travel
    DATA: mt_create_buffer_2 TYPE /dmo/t_booking,
          mt_update_buffer_2 TYPE /dmo/t_booking,
          mt_delete_buffer_2 TYPE /dmo/t_booking_key.

    TYPES: BEGIN OF ts_flight_key,
             carrier_id    TYPE /dmo/carrier_id,
             connection_id TYPE /dmo/connection_id,
             flight_date   TYPE /dmo/flight_date,
           END OF ts_flight_key.
    TYPES tt_flight_key TYPE SORTED TABLE OF ts_flight_key WITH UNIQUE KEY carrier_id  connection_id  flight_date.
    DATA mt_flight_key TYPE tt_flight_key.

    METHODS _create IMPORTING it_booking  TYPE /dmo/t_booking
                    EXPORTING et_booking  TYPE /dmo/t_booking
                              et_messages TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _update IMPORTING it_booking  TYPE /dmo/t_booking
                              it_bookingx TYPE /dmo/t_bookingx
                    EXPORTING et_booking  TYPE /dmo/t_booking
                              et_messages TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _delete IMPORTING it_booking         TYPE /dmo/t_booking
                              iv_no_delete_check TYPE abap_bool
                    EXPORTING et_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message.

    METHODS _check IMPORTING is_booking         TYPE /dmo/booking
                             is_bookingx        TYPE /dmo/s_bookingx OPTIONAL
                             iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                   CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                   RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_booking_date IMPORTING is_booking         TYPE /dmo/booking
                                          is_bookingx        TYPE /dmo/s_bookingx OPTIONAL
                                          iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                                CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_customer IMPORTING is_booking         TYPE /dmo/booking
                                      is_bookingx        TYPE /dmo/s_bookingx OPTIONAL
                                      iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                            CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                            RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_flight IMPORTING is_booking         TYPE /dmo/booking
                                    is_bookingx        TYPE /dmo/s_bookingx OPTIONAL
                                    iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                          CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                          RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_currency_code IMPORTING is_booking         TYPE /dmo/booking
                                           is_bookingx        TYPE /dmo/s_bookingx OPTIONAL
                                           iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                                 CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                 RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _determine IMPORTING iv_change_mode TYPE /dmo/cl_flight_legacy=>ty_change_mode
                       CHANGING  cs_booking     TYPE /dmo/booking.
ENDCLASS.

CLASS lcl_booking_buffer IMPLEMENTATION.
  METHOD get_instance.
    go_instance = COND #( WHEN go_instance IS BOUND THEN go_instance ELSE NEW #( ) ).
    ro_instance = go_instance.
  ENDMETHOD.


  METHOD _create.
    CLEAR et_booking.
    CLEAR et_messages.

    TYPES: BEGIN OF ts_travel_booking_id,
             travel_id  TYPE /dmo/travel_id,
             booking_id TYPE /dmo/booking_id,
           END OF ts_travel_booking_id,
           tt_travel_booking_id TYPE SORTED TABLE OF ts_travel_booking_id WITH UNIQUE KEY travel_id booking_id.
    DATA lt_travel_booking_id TYPE tt_travel_booking_id.

    CHECK it_booking IS NOT INITIAL.

    SELECT FROM /dmo/booking FIELDS travel_id, booking_id FOR ALL ENTRIES IN @it_booking WHERE travel_id = @it_booking-travel_id AND booking_id = @it_booking-booking_id INTO CORRESPONDING FIELDS OF TABLE @lt_travel_booking_id.

    LOOP AT it_booking INTO DATA(ls_booking_create) ##INTO_OK.
      " Booking_ID key must not be initial
      IF ls_booking_create-booking_id IS INITIAL.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_no_key  travel_id = ls_booking_create-travel_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Booking_ID key check DB
      READ TABLE lt_travel_booking_id TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = ls_booking_create-travel_id  booking_id = ls_booking_create-booking_id.
      IF sy-subrc = 0.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_exists  travel_id = ls_booking_create-travel_id  booking_id = ls_booking_create-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Booking_ID key check Buffer
      READ TABLE mt_create_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = ls_booking_create-travel_id  booking_id = ls_booking_create-booking_id.
      IF sy-subrc = 0.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_exists  travel_id = ls_booking_create-travel_id  booking_id = ls_booking_create-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Checks
      IF _check( EXPORTING is_booking     = ls_booking_create
                           iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create
                 CHANGING  ct_messages    = et_messages ) = abap_false.
        RETURN.
      ENDIF.

      " standard determinations
      _determine( EXPORTING iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create
                  CHANGING cs_booking      = ls_booking_create ).

      INSERT ls_booking_create INTO TABLE mt_create_buffer_2.
    ENDLOOP.

    et_booking = mt_create_buffer_2.
  ENDMETHOD.


  METHOD _update.
    CLEAR et_booking.
    CLEAR et_messages.

    CHECK it_booking IS NOT INITIAL.

    " Check for empty keys
    LOOP AT it_booking ASSIGNING FIELD-SYMBOL(<s_booking_update>) WHERE booking_id = 0. "#EC CI_SORTSEQ
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_no_key  travel_id = <s_booking_update>-travel_id ) TO et_messages.
      RETURN.
    ENDLOOP.

    DATA lt_booking TYPE SORTED TABLE OF /dmo/booking WITH UNIQUE KEY travel_id  booking_id.
    SELECT * FROM /dmo/booking FOR ALL ENTRIES IN @it_booking WHERE travel_id = @it_booking-travel_id AND booking_id = @it_booking-booking_id INTO TABLE @lt_booking.

    FIELD-SYMBOLS <s_buffer_booking> TYPE /dmo/booking.
    DATA ls_buffer_booking TYPE /dmo/booking.
    LOOP AT it_booking ASSIGNING <s_booking_update>.
      UNASSIGN <s_buffer_booking>.

      READ TABLE mt_delete_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
      IF sy-subrc = 0." Error: Record to be updated marked for deletion
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF <s_buffer_booking> IS NOT ASSIGNED." Special case: record already in temporary create buffer
        READ TABLE mt_create_buffer_2 ASSIGNING <s_buffer_booking> WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
      ENDIF.

      IF <s_buffer_booking> IS NOT ASSIGNED." Special case: record already in create buffer
        READ TABLE mt_create_buffer INTO ls_buffer_booking WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_booking INTO TABLE mt_create_buffer_2 ASSIGNING <s_buffer_booking>.
        ENDIF.
      ENDIF.

      IF <s_buffer_booking> IS NOT ASSIGNED." Special case: record already in temporary update buffer
        READ TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking> WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
      ENDIF.

      IF <s_buffer_booking> IS NOT ASSIGNED." Special case: record already in update buffer
        READ TABLE mt_update_buffer INTO ls_buffer_booking WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_booking INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking>.
        ENDIF.
      ENDIF.

      IF <s_buffer_booking> IS NOT ASSIGNED." Usual case: record not already in update buffer
        READ TABLE lt_booking ASSIGNING FIELD-SYMBOL(<s_booking_old>) WITH TABLE KEY travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id.
        IF sy-subrc = 0.
          INSERT <s_booking_old> INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_booking>.
          ASSERT sy-subrc = 0.
        ENDIF.
      ENDIF.

      " Error
      IF <s_buffer_booking> IS NOT ASSIGNED.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = <s_booking_update>-travel_id  booking_id = <s_booking_update>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Merge fields to be updated
      READ TABLE it_bookingx ASSIGNING FIELD-SYMBOL(<s_bookingx>) WITH KEY travel_id   = <s_booking_update>-travel_id
                                                                           booking_id  = <s_booking_update>-booking_id
                                                                           action_code = /dmo/if_flight_legacy=>action_code-update.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_no_control
                                          travel_id  = <s_booking_update>-travel_id
                                          booking_id = <s_booking_update>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF   ( <s_bookingx>-carrier_id    = abap_true AND ( <s_booking_update>-carrier_id    <> <s_buffer_booking>-carrier_id    ) )
        OR ( <s_bookingx>-connection_id = abap_true AND ( <s_booking_update>-connection_id <> <s_buffer_booking>-connection_id ) )
        OR ( <s_bookingx>-flight_date   = abap_true AND ( <s_booking_update>-flight_date   <> <s_buffer_booking>-flight_date   ) ).
        " The flight must not be changed (delete the record and create a new one)
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_flight_u
                                          travel_id  = <s_booking_update>-travel_id
                                          booking_id = <s_booking_update>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF   ( <s_bookingx>-flight_price = abap_true  AND <s_bookingx>-currency_code = abap_false )
        OR ( <s_bookingx>-flight_price = abap_false AND <s_bookingx>-currency_code = abap_true  ).
        " Price and currency code must be changed together
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_price_currency_u
                                          travel_id  = <s_booking_update>-travel_id
                                          booking_id = <s_booking_update>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.

      DATA lv_field TYPE i.
      lv_field = 4.
      DO.
        ASSIGN COMPONENT lv_field OF STRUCTURE <s_bookingx> TO FIELD-SYMBOL(<v_flag>).
        IF sy-subrc <> 0.
          EXIT.
        ENDIF.
        IF <v_flag> = abap_true.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_booking_update> TO FIELD-SYMBOL(<v_field_new>).
          ASSERT sy-subrc = 0.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_buffer_booking> TO FIELD-SYMBOL(<v_field_old>).
          ASSERT sy-subrc = 0.
          <v_field_old> = <v_field_new>.
        ENDIF.
        lv_field = lv_field + 1.
      ENDDO.

      " Checks
      IF _check( EXPORTING is_booking     = <s_buffer_booking>
                           is_bookingx    = <s_bookingx>
                           iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update
                 CHANGING  ct_messages    = et_messages ) = abap_false.
        RETURN.
      ENDIF.

      " standard determinations
      DATA(ls_booking) = <s_buffer_booking>." Needed, as key fields must not be changed
      _determine( EXPORTING iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update
                  CHANGING  cs_booking     = ls_booking ).
      <s_buffer_booking>-gr_data = ls_booking-gr_data.

      INSERT <s_buffer_booking> INTO TABLE et_booking.
    ENDLOOP.
  ENDMETHOD.


  METHOD _delete.
    CLEAR et_messages.

    CHECK it_booking IS NOT INITIAL.

    " Check for empty keys
    LOOP AT it_booking ASSIGNING FIELD-SYMBOL(<s_booking_delete>) WHERE booking_id = 0. "#EC CI_SORTSEQ
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_no_key  travel_id = <s_booking_delete>-travel_id ) TO et_messages.
      RETURN.
    ENDLOOP.

    DATA(lt_booking) = it_booking.

    LOOP AT lt_booking ASSIGNING <s_booking_delete>.
      " Special case: record already in create buffer
      READ TABLE mt_create_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_booking_delete>-travel_id  booking_id = <s_booking_delete>-booking_id.
      IF sy-subrc = 0.
        INSERT VALUE #( travel_id = <s_booking_delete>-travel_id  booking_id = <s_booking_delete>-booking_id ) INTO TABLE mt_delete_buffer_2.
        DELETE lt_booking.
      ENDIF.
    ENDLOOP.

    IF iv_no_delete_check = abap_false.
      DATA lt_booking_db TYPE /dmo/t_booking_key.
      SELECT travel_id, booking_id FROM /dmo/booking FOR ALL ENTRIES IN @lt_booking WHERE travel_id = @lt_booking-travel_id AND booking_id = @lt_booking-booking_id INTO CORRESPONDING FIELDS OF TABLE @lt_booking_db.
    ENDIF.

    " Check existence and append to delete buffer
    LOOP AT lt_booking ASSIGNING <s_booking_delete>.
      IF iv_no_delete_check = abap_false.
        READ TABLE lt_booking_db TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_booking_delete>-travel_id  booking_id = <s_booking_delete>-booking_id.
        IF sy-subrc <> 0.
          APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = <s_booking_delete>-travel_id  booking_id = <s_booking_delete>-booking_id ) TO et_messages.
          RETURN.
        ENDIF.
      ENDIF.
      INSERT VALUE #( travel_id = <s_booking_delete>-travel_id  booking_id = <s_booking_delete>-booking_id ) INTO TABLE mt_delete_buffer_2.
    ENDLOOP.
  ENDMETHOD.


  METHOD adjust_numbers.
    DATA: lt_create_buffer TYPE /dmo/t_booking.

    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    CHECK mt_create_buffer IS NOT INITIAL.   "Any Create to be processed?

    LOOP AT mt_create_buffer INTO DATA(ls_create_buffer).
      READ TABLE it_travel_mapping INTO DATA(ls_travel_mapping) WITH KEY preliminary-travel_id = ls_create_buffer-travel_id.

      " If found we replace the number - otherwise we simply return the mapping a=a
      IF sy-subrc EQ 0.
        APPEND VALUE #( preliminary = VALUE #( travel_id  = ls_create_buffer-travel_id
                                               booking_id = ls_create_buffer-booking_id )
                        final       = VALUE #( travel_id  = ls_travel_mapping-final-travel_id
                                               booking_id = ls_create_buffer-booking_id ) ) TO rt_booking_mapping.

        ls_create_buffer-travel_id = ls_travel_mapping-final-travel_id.
      ELSE.
        APPEND VALUE #( preliminary = VALUE #( travel_id  = ls_create_buffer-travel_id
                                               booking_id = ls_create_buffer-booking_id )
                        final       = VALUE #( travel_id  = ls_create_buffer-travel_id
                                               booking_id = ls_create_buffer-booking_id ) ) TO rt_booking_mapping.
      ENDIF.
      INSERT ls_create_buffer INTO TABLE lt_create_buffer.
    ENDLOOP.
    mt_create_buffer = lt_create_buffer.
  ENDMETHOD.

  METHOD save.
    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    " Make sure no preliminary travel_id is remaining (late numbering use-case)
    " If this dump happens, call adjust numbers before executing save
    IF mt_create_buffer IS NOT INITIAL.
      ASSERT mt_create_buffer[ lines( mt_create_buffer ) ]-travel_id < /dmo/if_flight_legacy=>late_numbering_boundary.
    ENDIF.

    INSERT /dmo/booking FROM TABLE @mt_create_buffer.
    UPDATE /dmo/booking FROM TABLE @mt_update_buffer.
    DELETE /dmo/booking FROM TABLE @( CORRESPONDING #( mt_delete_buffer ) ).
  ENDMETHOD.


  METHOD initialize.
    CLEAR: mt_create_buffer, mt_update_buffer, mt_delete_buffer.
  ENDMETHOD.


  METHOD check_booking_id." Here we can safely assume that the Travel ID has already been checked!
    rv_is_valid = abap_false.

    IF iv_booking_id IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_no_key  travel_id = iv_travel_id ) TO ct_messages.
      RETURN.
    ENDIF.

    IF line_exists( mt_delete_buffer[ travel_id = iv_travel_id  booking_id = iv_booking_id ] ).
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = iv_travel_id  booking_id = iv_booking_id ) TO ct_messages.
      RETURN.
    ENDIF.

    IF line_exists( mt_delete_buffer_2[ travel_id = iv_travel_id  booking_id = iv_booking_id ] ).
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = iv_travel_id  booking_id = iv_booking_id ) TO ct_messages.
      RETURN.
    ENDIF.

    IF line_exists( mt_create_buffer[ travel_id = iv_travel_id  booking_id = iv_booking_id ] ).
      rv_is_valid = abap_true.
      RETURN.
    ENDIF.

    IF line_exists( mt_create_buffer_2[ travel_id = iv_travel_id  booking_id = iv_booking_id ] ).
      rv_is_valid = abap_true.
      RETURN.
    ENDIF.

    SELECT SINGLE FROM /dmo/booking FIELDS @abap_true WHERE travel_id = @iv_travel_id AND booking_id = @iv_booking_id INTO @DATA(lv_db_exists).
    IF lv_db_exists = abap_true.
      rv_is_valid = abap_true.
      RETURN.
    ENDIF.

    APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_unknown  travel_id = iv_travel_id  booking_id = iv_booking_id ) TO ct_messages.
  ENDMETHOD.


  METHOD cud_prep.
    CLEAR et_booking.
    CLEAR et_messages.

    CHECK it_booking IS NOT INITIAL.

    DATA lt_booking_c  TYPE /dmo/t_booking.
    DATA lt_booking_u  TYPE /dmo/t_booking.
    DATA lt_booking_d  TYPE /dmo/t_booking.
    DATA lt_bookingx_u TYPE /dmo/t_bookingx.
    LOOP AT it_booking ASSIGNING FIELD-SYMBOL(<s_booking>).
      READ TABLE it_bookingx ASSIGNING FIELD-SYMBOL(<s_bookingx>) WITH TABLE KEY travel_id = <s_booking>-travel_id  booking_id = <s_booking>-booking_id.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>booking_no_control
                                          travel_id  = <s_booking>-travel_id
                                          booking_id = <s_booking>-booking_id ) TO et_messages.
        RETURN.
      ENDIF.
      CASE CONV /dmo/if_flight_legacy=>action_code_enum( <s_bookingx>-action_code ).
        WHEN /dmo/if_flight_legacy=>action_code-create.
          INSERT <s_booking>  INTO TABLE lt_booking_c.
        WHEN /dmo/if_flight_legacy=>action_code-update.
          INSERT <s_booking>  INTO TABLE lt_booking_u.
          INSERT <s_bookingx> INTO TABLE lt_bookingx_u.
        WHEN /dmo/if_flight_legacy=>action_code-delete.
          INSERT <s_booking>  INTO TABLE lt_booking_d.
      ENDCASE.
    ENDLOOP.

    _create( EXPORTING it_booking  = lt_booking_c
             IMPORTING et_booking  = et_booking
                       et_messages = et_messages ).

    _update( EXPORTING it_booking  = lt_booking_u
                       it_bookingx = lt_bookingx_u
             IMPORTING et_booking  = DATA(lt_booking)
                       et_messages = DATA(lt_messages) ).
    INSERT LINES OF lt_booking INTO TABLE et_booking.
    APPEND LINES OF lt_messages TO et_messages.

    _delete( EXPORTING it_booking         = lt_booking_d
                       iv_no_delete_check = iv_no_delete_check
             IMPORTING et_messages        = lt_messages ).
    APPEND LINES OF lt_messages TO et_messages.
  ENDMETHOD.


  METHOD cud_copy.
    LOOP AT mt_create_buffer_2 ASSIGNING FIELD-SYMBOL(<s_create_buffer_2>).
      READ TABLE mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WITH TABLE KEY travel_id = <s_create_buffer_2>-travel_id  booking_id = <s_create_buffer_2>-booking_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id = <s_create_buffer_2>-travel_id  booking_id = <s_create_buffer_2>-booking_id ) INTO TABLE mt_create_buffer ASSIGNING <s_create_buffer>.
      ENDIF.
      <s_create_buffer>-gr_data = <s_create_buffer_2>-gr_data.
    ENDLOOP.
    LOOP AT mt_update_buffer_2 ASSIGNING FIELD-SYMBOL(<s_update_buffer_2>).
      READ TABLE mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WITH TABLE KEY travel_id = <s_update_buffer_2>-travel_id  booking_id = <s_update_buffer_2>-booking_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id = <s_update_buffer_2>-travel_id  booking_id = <s_update_buffer_2>-booking_id ) INTO TABLE mt_update_buffer ASSIGNING <s_update_buffer>.
      ENDIF.
      <s_update_buffer>-gr_data = <s_update_buffer_2>-gr_data.
    ENDLOOP.
    LOOP AT mt_delete_buffer_2 ASSIGNING FIELD-SYMBOL(<s_delete_buffer_2>).
      DELETE mt_create_buffer WHERE travel_id = <s_delete_buffer_2>-travel_id AND booking_id = <s_delete_buffer_2>-booking_id.
      IF sy-subrc = 0.
        CONTINUE.
      ENDIF.
      DELETE mt_update_buffer WHERE travel_id = <s_delete_buffer_2>-travel_id AND booking_id = <s_delete_buffer_2>-booking_id.
      INSERT <s_delete_buffer_2> INTO TABLE mt_delete_buffer.
    ENDLOOP.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD cud_disc.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD get.
    CLEAR et_booking.

    CHECK it_booking IS NOT INITIAL.

    SELECT * FROM /dmo/booking FOR ALL ENTRIES IN @it_booking WHERE travel_id  = @it_booking-travel_id
      INTO TABLE @et_booking ##SELECT_FAE_WITH_LOB[DESCRIPTION]. "#EC CI_ALL_FIELDS_NEEDED "#EC CI_SEL_DEL

    IF iv_include_buffer = abap_true.
      LOOP AT it_booking ASSIGNING FIELD-SYMBOL(<s_booking>).
        LOOP AT mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WHERE travel_id = <s_booking>-travel_id.
          INSERT <s_create_buffer> INTO TABLE et_booking.
        ENDLOOP.

        LOOP AT mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WHERE travel_id = <s_booking>-travel_id.
          MODIFY TABLE et_booking FROM <s_update_buffer>.
        ENDLOOP.

        LOOP AT mt_delete_buffer ASSIGNING FIELD-SYMBOL(<s_delete_buffer>) WHERE travel_id = <s_booking>-travel_id.
          DELETE et_booking WHERE travel_id = <s_delete_buffer>-travel_id AND booking_id = <s_delete_buffer>-booking_id. "#EC CI_SEL_DEL
        ENDLOOP.
      ENDLOOP.
    ENDIF.

    IF iv_include_temp_buffer = abap_true.
      LOOP AT it_booking ASSIGNING <s_booking>.
        LOOP AT mt_create_buffer_2 ASSIGNING <s_create_buffer> WHERE travel_id = <s_booking>-travel_id.
          DELETE et_booking WHERE travel_id = <s_create_buffer>-travel_id AND booking_id = <s_create_buffer>-booking_id. "#EC CI_SEL_DEL
          INSERT <s_create_buffer> INTO TABLE et_booking.
        ENDLOOP.

        LOOP AT mt_update_buffer_2 ASSIGNING <s_update_buffer> WHERE travel_id = <s_booking>-travel_id.
          MODIFY TABLE et_booking FROM <s_update_buffer>.
        ENDLOOP.

        LOOP AT mt_delete_buffer_2 ASSIGNING <s_delete_buffer> WHERE travel_id = <s_booking>-travel_id.
          DELETE et_booking WHERE travel_id = <s_delete_buffer>-travel_id AND booking_id = <s_delete_buffer>-booking_id. "#EC CI_SEL_DEL
        ENDLOOP.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.


  METHOD _check.
    rv_is_valid = abap_true.

    IF NOT _check_booking_date( EXPORTING is_booking     = is_booking
                                          is_bookingx    = is_bookingx
                                          iv_change_mode = iv_change_mode
                                CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_customer( EXPORTING is_booking     = is_booking
                                      is_bookingx    = is_bookingx
                                      iv_change_mode = iv_change_mode
                            CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_flight( EXPORTING is_booking     = is_booking
                                    is_bookingx    = is_bookingx
                                    iv_change_mode = iv_change_mode
                          CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_currency_code( EXPORTING is_booking     = is_booking
                                           is_bookingx    = is_bookingx
                                           iv_change_mode = iv_change_mode
                                 CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.
  ENDMETHOD.


  METHOD _check_booking_date.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_bookingx-booking_date = abap_true ).

      " A. Booking Date must not be initial
      " B. When the record is created it must not be in the past
      IF is_booking-booking_date IS INITIAL OR is_booking-booking_date = '' OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create AND is_booking-booking_date < cl_abap_context_info=>get_system_date( ) ).
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>booking_booking_date_invalid  travel_id = is_booking-travel_id  booking_id = is_booking-booking_id  booking_date = is_booking-booking_date ) TO ct_messages.
      ENDIF.
    ENDIF.
  ENDMETHOD.


  METHOD _check_customer.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_bookingx-customer_id = abap_true ).
      rv_is_valid = lcl_common_checks=>is_customer_id_valid( EXPORTING iv_customer_id = is_booking-customer_id CHANGING ct_messages = ct_messages ).
    ENDIF.
  ENDMETHOD.


  METHOD _check_flight.
    rv_is_valid = abap_true.
    IF     iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create
      OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update
        AND ( is_bookingx-carrier_id = abap_true OR is_bookingx-connection_id = abap_true OR is_bookingx-flight_date = abap_true ) ).
      IF mt_flight_key IS INITIAL.
        SELECT carrier_id, connection_id, flight_date FROM /dmo/flight INTO CORRESPONDING FIELDS OF TABLE @mt_flight_key. "#EC CI_NOWHERE
      ENDIF.
      READ TABLE mt_flight_key TRANSPORTING NO FIELDS WITH TABLE KEY carrier_id = is_booking-carrier_id  connection_id = is_booking-connection_id  flight_date = is_booking-flight_date.
      IF sy-subrc <> 0.
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>flight_unknown  carrier_id = is_booking-carrier_id  connection_id = is_booking-connection_id  flight_date = is_booking-flight_date ) TO ct_messages.
      ENDIF.
    ENDIF.
  ENDMETHOD.


  METHOD _check_currency_code.
    rv_is_valid = abap_true.
    IF   ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create AND is_booking-currency_code IS NOT INITIAL ) " Will be derived if initial
      OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_bookingx-currency_code = abap_true ).
      rv_is_valid = lcl_common_checks=>is_currency_code_valid( EXPORTING iv_currency_code = is_booking-currency_code CHANGING ct_messages = ct_messages ).
    ENDIF.
  ENDMETHOD.


  METHOD _determine.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create.
      " Derive price and currency code if one of the fields is initial
      IF cs_booking-flight_price IS INITIAL OR cs_booking-currency_code IS INITIAL.
        " Flight price might have changed, we need to use current flight price
        SELECT SINGLE price, currency_code FROM /dmo/flight WHERE carrier_id    = @cs_booking-carrier_id
                                                              AND connection_id = @cs_booking-connection_id
                                                              AND flight_date   = @cs_booking-flight_date INTO ( @cs_booking-flight_price, @cs_booking-currency_code ).
        ASSERT sy-subrc = 0. " Check has been done before
      ENDIF.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

CLASS ltc_travel DEFINITION DEFERRED.
CLASS lcl_travel_buffer DEFINITION FINAL CREATE PRIVATE FRIENDS ltc_travel.
  PUBLIC SECTION.
    CLASS-METHODS: get_instance RETURNING VALUE(ro_instance) TYPE REF TO lcl_travel_buffer.
    METHODS set_status_to_booked IMPORTING iv_travel_id TYPE /dmo/travel_id
                                 EXPORTING et_messages  TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS adjust_numbers RETURNING VALUE(rt_travel_mapping) TYPE /dmo/if_flight_legacy=>tt_ln_travel_mapping.
    METHODS save.
    METHODS initialize.
    METHODS check_travel_id IMPORTING iv_travel_id       TYPE /dmo/travel_id
                            CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                            RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    "! Prepare changes in a temporary buffer
    "! @parameter iv_no_delete_check | In some cases we do not need to check the existence of a record to be deleted, as this check has been done before.
    "!                               | E.g. delete all subnodes of a node to be deleted.  In this case we have read the subnodes to get their keys.
    METHODS cud_prep IMPORTING it_travel          TYPE /dmo/t_travel
                               it_travelx         TYPE /dmo/t_travelx
                               iv_no_delete_check TYPE abap_bool OPTIONAL
                               iv_numbering_mode  TYPE /dmo/if_flight_legacy=>t_numbering_mode DEFAULT /dmo/if_flight_legacy=>numbering_mode-early
                     EXPORTING et_travel          TYPE /dmo/t_travel
                               et_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    "! Add content of the temporary buffer to the real buffer and clear the temporary buffer
    METHODS cud_copy.
    "! Discard content of the temporary buffer
    METHODS cud_disc.
    METHODS get IMPORTING it_travel              TYPE /dmo/t_travel
                          iv_include_buffer      TYPE abap_boolean
                          iv_include_temp_buffer TYPE abap_boolean
                EXPORTING et_travel              TYPE /dmo/t_travel.

  PRIVATE SECTION.
    CLASS-DATA go_instance TYPE REF TO lcl_travel_buffer.

    DATA: gv_last_late_number TYPE /dmo/travel_id VALUE /dmo/if_flight_legacy=>late_numbering_boundary.

    " Main buffer
    DATA: mt_create_buffer TYPE /dmo/t_travel,
          mt_update_buffer TYPE /dmo/t_travel,
          mt_delete_buffer TYPE /dmo/t_travel_key.
    " Temporary buffer valid during create / update / delete Travel
    DATA: mt_create_buffer_2 TYPE /dmo/t_travel,
          mt_update_buffer_2 TYPE /dmo/t_travel,
          mt_delete_buffer_2 TYPE /dmo/t_travel_key.

    DATA mt_agency_id   TYPE SORTED TABLE OF /dmo/agency_id   WITH UNIQUE KEY table_line.

    METHODS _create IMPORTING it_travel         TYPE /dmo/t_travel
                              iv_numbering_mode TYPE /dmo/if_flight_legacy=>t_numbering_mode
                    EXPORTING et_travel         TYPE /dmo/t_travel
                              et_messages       TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _update IMPORTING it_travel   TYPE /dmo/t_travel
                              it_travelx  TYPE /dmo/t_travelx
                    EXPORTING et_travel   TYPE /dmo/t_travel
                              et_messages TYPE /dmo/if_flight_legacy=>tt_if_t100_message.
    METHODS _delete IMPORTING it_travel          TYPE /dmo/t_travel
                              iv_no_delete_check TYPE abap_bool
                    EXPORTING et_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message.

    METHODS _check IMPORTING is_travel          TYPE /dmo/travel
                             is_travelx         TYPE /dmo/s_travelx OPTIONAL
                             iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                   CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                   RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_agency IMPORTING is_travel          TYPE /dmo/travel
                                    is_travelx         TYPE /dmo/s_travelx OPTIONAL
                                    iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                          CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                          RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_customer IMPORTING is_travel          TYPE /dmo/travel
                                      is_travelx         TYPE /dmo/s_travelx OPTIONAL
                                      iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                            CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                            RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_dates IMPORTING is_travel          TYPE /dmo/travel
                                   is_travelx         TYPE /dmo/s_travelx OPTIONAL
                                   iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                         CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                         RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_status IMPORTING is_travel          TYPE /dmo/travel
                                    is_travelx         TYPE /dmo/s_travelx OPTIONAL
                                    iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                          CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                          RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _check_currency_code IMPORTING is_travel          TYPE /dmo/travel
                                           is_travelx         TYPE /dmo/s_travelx OPTIONAL
                                           iv_change_mode     TYPE /dmo/cl_flight_legacy=>ty_change_mode
                                 CHANGING  ct_messages        TYPE /dmo/if_flight_legacy=>tt_if_t100_message
                                 RETURNING VALUE(rv_is_valid) TYPE abap_bool.
    METHODS _update_admin IMPORTING iv_new TYPE abap_bool CHANGING cs_travel_admin TYPE /dmo/travel_admin.
ENDCLASS.


CLASS lcl_travel_buffer IMPLEMENTATION.
  METHOD get_instance.
    go_instance = COND #( WHEN go_instance IS BOUND THEN go_instance ELSE NEW #( ) ).
    ro_instance = go_instance.
  ENDMETHOD.


  METHOD _create.
    CLEAR et_travel.
    CLEAR et_messages.

    CHECK it_travel IS NOT INITIAL.

    DATA lt_travel_to_process LIKE it_travel.
    DATA lv_travel_id_max     TYPE /dmo/travel_id.

    lt_travel_to_process = it_travel.

    " Checks
    LOOP AT it_travel INTO DATA(ls_travel_create) ##INTO_OK.
      IF _check( EXPORTING is_travel     = ls_travel_create
                           iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create
                 CHANGING  ct_messages   = et_messages ) = abap_false.
        DELETE lt_travel_to_process WHERE travel_id = ls_travel_create-travel_id.
      ENDIF.
    ENDLOOP.

    CHECK lt_travel_to_process IS NOT INITIAL.

    " Get Numbers
    IF iv_numbering_mode EQ /dmo/if_flight_legacy=>numbering_mode-late.

      LOOP AT lt_travel_to_process INTO ls_travel_create ##INTO_OK.
        " standard determinations
        ls_travel_create-createdby = sy-uname.
        GET TIME STAMP FIELD ls_travel_create-createdat.
        ls_travel_create-lastchangedby = ls_travel_create-createdby.
        ls_travel_create-lastchangedat = ls_travel_create-createdat.
        ls_travel_create-status = /dmo/if_flight_legacy=>travel_status-new.

        " Late Numbering - Assign a temporary Travel ID (starting with '9...').
        gv_last_late_number = gv_last_late_number + 1.
        ASSERT gv_last_late_number IS NOT INITIAL.
        ls_travel_create-travel_id = gv_last_late_number.

        INSERT ls_travel_create INTO TABLE mt_create_buffer_2.
      ENDLOOP.

    ELSE.
      TRY.
          cl_numberrange_runtime=>number_get(
            EXPORTING
              nr_range_nr       = '01'
              object            = '/DMO/TRAVL'
              quantity          = CONV #( lines( lt_travel_to_process ) )
            IMPORTING
              number            = DATA(lv_key)
              returncode        = DATA(lv_return_code)
              returned_quantity = DATA(lv_returned_quantity)
          ).
        CATCH cx_number_ranges INTO DATA(lx_number_ranges).
          APPEND lx_number_ranges TO et_messages.
          EXIT.
      ENDTRY.


      IF lv_return_code = '2' OR lv_return_code = '3'.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_nr_last_number ) TO et_messages.
        EXIT.
      ENDIF.

      ASSERT lv_returned_quantity = lines( lt_travel_to_process ).

      lv_travel_id_max = CONV i( lv_key ) - lines( lt_travel_to_process ).

      LOOP AT lt_travel_to_process INTO ls_travel_create ##INTO_OK.

        " standard determinations
        ls_travel_create-createdby = sy-uname.
        GET TIME STAMP FIELD ls_travel_create-createdat.
        ls_travel_create-lastchangedby = ls_travel_create-createdby.
        ls_travel_create-lastchangedat = ls_travel_create-createdat.
        ls_travel_create-status = /dmo/if_flight_legacy=>travel_status-new.



        " **Internal** numbering: Override travel_id
        lv_travel_id_max = lv_travel_id_max + 1.
        ASSERT lv_travel_id_max IS NOT INITIAL.
        ls_travel_create-travel_id = lv_travel_id_max.

        INSERT ls_travel_create INTO TABLE mt_create_buffer_2.
      ENDLOOP.
    ENDIF.
    et_travel = mt_create_buffer_2.
  ENDMETHOD.


  METHOD _update.
    DATA lv_new TYPE abap_bool.

    CLEAR et_travel.
    CLEAR et_messages.

    CHECK it_travel IS NOT INITIAL.

    " Check for empty keys
    READ TABLE it_travel TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = '0'.
    IF sy-subrc = 0.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO et_messages.
      RETURN.
    ENDIF.

    DATA lt_travel TYPE SORTED TABLE OF /dmo/travel WITH UNIQUE KEY travel_id.
    SELECT * FROM /dmo/travel FOR ALL ENTRIES IN @it_travel WHERE travel_id = @it_travel-travel_id INTO TABLE @lt_travel ##SELECT_FAE_WITH_LOB[DESCRIPTION].

    FIELD-SYMBOLS <s_buffer_travel> TYPE /dmo/travel.
    DATA ls_buffer_travel TYPE /dmo/travel.
    LOOP AT it_travel ASSIGNING FIELD-SYMBOL(<s_travel_update>).
      UNASSIGN <s_buffer_travel>.

      READ TABLE mt_delete_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
      IF sy-subrc = 0." Error: Record to be updated marked for deletion
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = <s_travel_update>-travel_id ) TO et_messages.
        RETURN.
      ENDIF.

      IF <s_buffer_travel> IS NOT ASSIGNED." Special case: record already in temporary create buffer
        READ TABLE mt_create_buffer_2 ASSIGNING <s_buffer_travel> WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
        IF sy-subrc = 0.
          lv_new = abap_true.
        ENDIF.
      ENDIF.

      IF <s_buffer_travel> IS NOT ASSIGNED." Special case: record already in create buffer
        lv_new = abap_false.
        READ TABLE mt_create_buffer INTO ls_buffer_travel WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_travel INTO TABLE mt_create_buffer_2 ASSIGNING <s_buffer_travel>.
          lv_new = abap_true.
        ENDIF.
      ENDIF.

      IF <s_buffer_travel> IS NOT ASSIGNED." Special case: record already in temporary update buffer
        READ TABLE mt_update_buffer_2 ASSIGNING <s_buffer_travel> WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
      ENDIF.

      IF <s_buffer_travel> IS NOT ASSIGNED." Special case: record already in update buffer
        READ TABLE mt_update_buffer INTO ls_buffer_travel WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
        IF sy-subrc = 0.
          INSERT ls_buffer_travel INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_travel>.
        ENDIF.
      ENDIF.

      IF <s_buffer_travel> IS NOT ASSIGNED." Usual case: record not already in update buffer
        READ TABLE lt_travel ASSIGNING FIELD-SYMBOL(<s_travel_old>) WITH TABLE KEY travel_id = <s_travel_update>-travel_id.
        IF sy-subrc = 0.
          INSERT <s_travel_old> INTO TABLE mt_update_buffer_2 ASSIGNING <s_buffer_travel>.
          ASSERT sy-subrc = 0.
        ENDIF.
      ENDIF.

      " Error
      IF <s_buffer_travel> IS NOT ASSIGNED.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = <s_travel_update>-travel_id ) TO et_messages.
        RETURN.
      ENDIF.

      " Merge fields to be updated
      READ TABLE it_travelx ASSIGNING FIELD-SYMBOL(<s_travelx>) WITH KEY travel_id = <s_travel_update>-travel_id  action_code = /dmo/if_flight_legacy=>action_code-update.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_control  travel_id = <s_travel_update>-travel_id ) TO et_messages.
        RETURN.
      ENDIF.
      DATA lv_field TYPE i.
      lv_field = 3.
      DO.
        ASSIGN COMPONENT lv_field OF STRUCTURE <s_travelx> TO FIELD-SYMBOL(<v_flag>).
        IF sy-subrc <> 0.
          EXIT.
        ENDIF.
        IF <v_flag> = abap_true.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_travel_update> TO FIELD-SYMBOL(<v_field_new>).
          ASSERT sy-subrc = 0.
          ASSIGN COMPONENT lv_field OF STRUCTURE <s_buffer_travel> TO FIELD-SYMBOL(<v_field_old>).
          ASSERT sy-subrc = 0.
          <v_field_old> = <v_field_new>.
        ENDIF.
        lv_field = lv_field + 1.
      ENDDO.

      " Checks
      IF _check( EXPORTING is_travel      = <s_buffer_travel>
                           is_travelx     = <s_travelx>
                           iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update
                 CHANGING  ct_messages    = et_messages ) = abap_false.
        RETURN.
      ENDIF.

      " Set administrative fields
      _update_admin( EXPORTING iv_new = lv_new CHANGING cs_travel_admin = <s_buffer_travel>-gr_admin ).

      " standard determinations

      INSERT <s_buffer_travel> INTO TABLE et_travel.
    ENDLOOP.
  ENDMETHOD.


  METHOD _delete.
    CLEAR et_messages.

    CHECK it_travel IS NOT INITIAL.

    " Check for empty keys
    READ TABLE it_travel TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = '0'.
    IF sy-subrc = 0.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO et_messages.
      RETURN.
    ENDIF.

    DATA(lt_travel) = it_travel.

    " Special case: record already in create buffer
    LOOP AT lt_travel ASSIGNING FIELD-SYMBOL(<s_travel_delete>).
      READ TABLE mt_create_buffer TRANSPORTING NO FIELDS WITH KEY travel_id = <s_travel_delete>-travel_id.
      IF sy-subrc = 0.
        INSERT VALUE #( travel_id = <s_travel_delete>-travel_id ) INTO TABLE mt_delete_buffer_2.
        DELETE lt_travel.
      ENDIF.
    ENDLOOP.

    IF iv_no_delete_check = abap_false.
      DATA lt_travel_db TYPE SORTED TABLE OF /dmo/travel_id WITH UNIQUE KEY table_line.
      SELECT travel_id FROM /dmo/travel FOR ALL ENTRIES IN @lt_travel WHERE travel_id = @lt_travel-travel_id INTO TABLE @lt_travel_db.
    ENDIF.

    " Check existence and append to delete buffer
    LOOP AT lt_travel ASSIGNING <s_travel_delete>.
      IF iv_no_delete_check = abap_false.
        READ TABLE lt_travel_db ASSIGNING FIELD-SYMBOL(<s_travel_old>) WITH TABLE KEY table_line = <s_travel_delete>-travel_id.
        IF sy-subrc <> 0.
          APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = <s_travel_delete>-travel_id ) TO et_messages.
          RETURN.
        ENDIF.
      ENDIF.
      INSERT VALUE #( travel_id = <s_travel_delete>-travel_id ) INTO TABLE mt_delete_buffer_2.
    ENDLOOP.
  ENDMETHOD.


  METHOD set_status_to_booked.
    DATA lv_new TYPE abap_bool.

    CLEAR et_messages.

    " Check for empty travel ID
    IF iv_travel_id IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO et_messages.
      RETURN.
    ENDIF.

    READ TABLE mt_delete_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = iv_travel_id.
    IF sy-subrc = 0." Error: Record of action marked for deletion
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = iv_travel_id ) TO et_messages.
      RETURN.
    ENDIF.

    " Special case: Record in CREATE buffer
    lv_new = abap_false.
    READ TABLE mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_travel>) WITH TABLE KEY travel_id = iv_travel_id.
    IF sy-subrc = 0.
      lv_new = abap_true.
    ENDIF.

    " Special case: Record in UPDATE buffer
    IF <s_travel> IS NOT ASSIGNED.
      READ TABLE mt_update_buffer ASSIGNING <s_travel> WITH TABLE KEY travel_id = iv_travel_id.
    ENDIF.

    " Usual case: Read record from DB and put it into the UPDATE buffer
    IF <s_travel> IS NOT ASSIGNED.
      SELECT SINGLE * FROM /dmo/travel WHERE travel_id = @iv_travel_id INTO @DATA(ls_travel) .
      IF sy-subrc = 0.
        INSERT ls_travel INTO TABLE mt_update_buffer ASSIGNING <s_travel>.
      ENDIF.
    ENDIF.

    " Error
    IF <s_travel> IS NOT ASSIGNED.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = iv_travel_id ) TO et_messages.
      RETURN.
    ENDIF.

    <s_travel>-status = /dmo/if_flight_legacy=>travel_status-booked.
    _update_admin( EXPORTING iv_new = lv_new CHANGING cs_travel_admin = <s_travel>-gr_admin ).
  ENDMETHOD.


  METHOD adjust_numbers.
    DATA: lv_is_early_numbering_used TYPE abap_bool VALUE abap_false,
          lv_is_late_numbering_used  TYPE abap_bool VALUE abap_false,
          lt_create_buffer           TYPE /dmo/t_travel,
          lv_travel_id               TYPE /dmo/travel_id.


    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    CHECK mt_create_buffer IS NOT INITIAL.  "Any Create to be processed?

    " As the table is sorted by the key travel_id the first entry will be the lowest travel_id and the last entry the highest travel_id
    IF mt_create_buffer[ 1 ]-travel_id > /dmo/if_flight_legacy=>late_numbering_boundary.
      lv_is_late_numbering_used = abap_true.
    ENDIF.
    IF mt_create_buffer[ lines( mt_create_buffer ) ]-travel_id < /dmo/if_flight_legacy=>late_numbering_boundary.
      lv_is_early_numbering_used = abap_true.
    ENDIF.

    " Mixed Numbering (late+early) is not supported
    ASSERT lv_is_late_numbering_used NE lv_is_early_numbering_used.

    " Are we in Late Numbering mode? -> Process Late Numbering
    IF lv_is_late_numbering_used EQ abap_true.
      TRY.
          cl_numberrange_runtime=>number_get(
            EXPORTING
              nr_range_nr       = '01'
              object            = '/DMO/TRAVL'
              quantity          = CONV #( lines( mt_create_buffer ) )
            IMPORTING
              number            = DATA(lv_key)
              returncode        = DATA(lv_return_code)
              returned_quantity = DATA(lv_returned_quantity)
          ).
        CATCH cx_number_ranges INTO DATA(lx_number_ranges).
          ASSERT 1 = 2.
      ENDTRY.
      ASSERT lv_returned_quantity = lines( mt_create_buffer ).

      lv_travel_id = CONV i( lv_key ) - lines( mt_create_buffer ).

      LOOP AT mt_create_buffer INTO DATA(ls_create_buffer).
        lv_travel_id = lv_travel_id + 1.
        ASSERT lv_travel_id IS NOT INITIAL.

        APPEND VALUE #( preliminary = VALUE #( travel_id = ls_create_buffer-travel_id )
                        final       = VALUE #( travel_id = lv_travel_id ) ) TO rt_travel_mapping.

        ls_create_buffer-travel_id = lv_travel_id.
        INSERT ls_create_buffer INTO TABLE lt_create_buffer.
      ENDLOOP.
      mt_create_buffer = lt_create_buffer.
    ENDIF.
  ENDMETHOD.

  METHOD save.
    ASSERT mt_create_buffer_2 IS INITIAL.
    ASSERT mt_update_buffer_2 IS INITIAL.
    ASSERT mt_delete_buffer_2 IS INITIAL.

    " Make sure no preliminary travel_id is remaining (late numbering use-case)
    " If this dump occurs, call adjust numbers before executing save
    IF mt_create_buffer IS NOT INITIAL.
      ASSERT mt_create_buffer[ lines( mt_create_buffer ) ]-travel_id < /dmo/if_flight_legacy=>late_numbering_boundary.
    ENDIF.

    INSERT /dmo/travel FROM TABLE @mt_create_buffer.
    UPDATE /dmo/travel FROM TABLE @mt_update_buffer.
    DELETE /dmo/travel FROM TABLE @( CORRESPONDING #( mt_delete_buffer ) ).
  ENDMETHOD.


  METHOD initialize.
    CLEAR: mt_create_buffer, mt_update_buffer, mt_delete_buffer.
  ENDMETHOD.


  METHOD check_travel_id.
    rv_is_valid = abap_false.

    IF iv_travel_id IS INITIAL.
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_no_key ) TO ct_messages.
      RETURN.
    ENDIF.

    IF line_exists( mt_delete_buffer[ travel_id = iv_travel_id ] ).
      APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = iv_travel_id ) TO ct_messages.
      RETURN.
    ENDIF.

    IF line_exists( mt_create_buffer[ travel_id = iv_travel_id ] ).
      rv_is_valid = abap_true.
      RETURN.
    ENDIF.

    SELECT SINGLE FROM /dmo/travel FIELDS @abap_true WHERE travel_id = @iv_travel_id INTO @DATA(lv_db_exists).
    IF lv_db_exists = abap_true.
      rv_is_valid = abap_true.
      RETURN.
    ENDIF.

    APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_unknown  travel_id = iv_travel_id ) TO ct_messages.
  ENDMETHOD.


  METHOD cud_prep.
    CLEAR et_travel.
    CLEAR et_messages.

    CHECK it_travel IS NOT INITIAL.

    DATA lt_travel_c  TYPE /dmo/t_travel.
    DATA lt_travel_u  TYPE /dmo/t_travel.
    DATA lt_travel_d  TYPE /dmo/t_travel.
    DATA lt_travelx_u TYPE /dmo/t_travelx.
    LOOP AT it_travel ASSIGNING FIELD-SYMBOL(<s_travel>).
      READ TABLE it_travelx ASSIGNING FIELD-SYMBOL(<s_travelx>) WITH TABLE KEY travel_id = <s_travel>-travel_id.
      IF sy-subrc <> 0.
        APPEND NEW /dmo/cx_flight_legacy( textid     = /dmo/cx_flight_legacy=>travel_no_control
                                          travel_id  = <s_travel>-travel_id ) TO et_messages.
        RETURN.
      ENDIF.
      CASE CONV /dmo/if_flight_legacy=>action_code_enum( <s_travelx>-action_code ).
        WHEN /dmo/if_flight_legacy=>action_code-create.
          INSERT <s_travel>  INTO TABLE lt_travel_c.
        WHEN /dmo/if_flight_legacy=>action_code-update.
          INSERT <s_travel>  INTO TABLE lt_travel_u.
          INSERT <s_travelx> INTO TABLE lt_travelx_u.
        WHEN /dmo/if_flight_legacy=>action_code-delete.
          INSERT <s_travel>  INTO TABLE lt_travel_d.
      ENDCASE.
    ENDLOOP.

    _create( EXPORTING it_travel         = lt_travel_c
                       iv_numbering_mode = iv_numbering_mode
             IMPORTING et_travel         = et_travel
                       et_messages       = et_messages ).

    _update( EXPORTING it_travel   = lt_travel_u
                       it_travelx  = lt_travelx_u
             IMPORTING et_travel   = DATA(lt_travel)
                       et_messages = DATA(lt_messages) ).
    INSERT LINES OF lt_travel INTO TABLE et_travel.
    APPEND LINES OF lt_messages TO et_messages.

    _delete( EXPORTING it_travel          = lt_travel_d
                       iv_no_delete_check = iv_no_delete_check
             IMPORTING et_messages        = lt_messages ).
    APPEND LINES OF lt_messages TO et_messages.
  ENDMETHOD.


  METHOD cud_copy.
    LOOP AT mt_create_buffer_2 ASSIGNING FIELD-SYMBOL(<s_create_buffer_2>).
      READ TABLE mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WITH TABLE KEY travel_id = <s_create_buffer_2>-travel_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id = <s_create_buffer_2>-travel_id ) INTO TABLE mt_create_buffer ASSIGNING <s_create_buffer>.
      ENDIF.
      <s_create_buffer>-gr_data  = <s_create_buffer_2>-gr_data.
      <s_create_buffer>-gr_admin = <s_create_buffer_2>-gr_admin.
    ENDLOOP.
    LOOP AT mt_update_buffer_2 ASSIGNING FIELD-SYMBOL(<s_update_buffer_2>).
      READ TABLE mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WITH TABLE KEY travel_id = <s_update_buffer_2>-travel_id.
      IF sy-subrc <> 0.
        INSERT VALUE #( travel_id = <s_update_buffer_2>-travel_id ) INTO TABLE mt_update_buffer ASSIGNING <s_update_buffer>.
      ENDIF.
      <s_update_buffer>-gr_data  = <s_update_buffer_2>-gr_data.
      <s_update_buffer>-gr_admin = <s_update_buffer_2>-gr_admin.
    ENDLOOP.
    LOOP AT mt_delete_buffer_2 ASSIGNING FIELD-SYMBOL(<s_delete_buffer_2>).
      DELETE mt_create_buffer WHERE travel_id = <s_delete_buffer_2>-travel_id.
      IF sy-subrc = 0.
        CONTINUE.
      ENDIF.
      DELETE mt_update_buffer WHERE travel_id = <s_delete_buffer_2>-travel_id.
      INSERT <s_delete_buffer_2> INTO TABLE mt_delete_buffer.
    ENDLOOP.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD cud_disc.
    CLEAR: mt_create_buffer_2, mt_update_buffer_2, mt_delete_buffer_2.
  ENDMETHOD.


  METHOD get.
    CLEAR et_travel.

    CHECK it_travel IS NOT INITIAL.

    SELECT * FROM /dmo/travel FOR ALL ENTRIES IN @it_travel WHERE travel_id = @it_travel-travel_id
      INTO TABLE @et_travel ##SELECT_FAE_WITH_LOB[DESCRIPTION]. "#EC CI_ALL_FIELDS_NEEDED "#EC CI_SEL_DEL

    IF iv_include_buffer = abap_true.
      LOOP AT it_travel ASSIGNING FIELD-SYMBOL(<s_travel>).
        READ TABLE mt_create_buffer ASSIGNING FIELD-SYMBOL(<s_create_buffer>) WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          INSERT <s_create_buffer> INTO TABLE et_travel.
        ENDIF.

        READ TABLE mt_update_buffer ASSIGNING FIELD-SYMBOL(<s_update_buffer>) WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          MODIFY TABLE et_travel FROM <s_update_buffer>.
        ENDIF.

        READ TABLE mt_delete_buffer TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          DELETE et_travel WHERE travel_id = <s_travel>-travel_id. "#EC CI_SEL_DEL
        ENDIF.
      ENDLOOP.
    ENDIF.

    IF iv_include_temp_buffer = abap_true.
      LOOP AT it_travel ASSIGNING <s_travel>.
        READ TABLE mt_create_buffer_2 ASSIGNING <s_create_buffer> WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          DELETE et_travel WHERE travel_id = <s_travel>-travel_id. "#EC CI_SEL_DEL
          INSERT <s_create_buffer> INTO TABLE et_travel.
        ENDIF.

        READ TABLE mt_update_buffer_2 ASSIGNING <s_update_buffer> WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          MODIFY TABLE et_travel FROM <s_update_buffer>.
        ENDIF.

        READ TABLE mt_delete_buffer_2 TRANSPORTING NO FIELDS WITH TABLE KEY travel_id = <s_travel>-travel_id.
        IF sy-subrc = 0.
          DELETE et_travel WHERE travel_id = <s_travel>-travel_id. "#EC CI_SEL_DEL
        ENDIF.
      ENDLOOP.
    ENDIF.
  ENDMETHOD.


  METHOD _check.
    rv_is_valid = abap_true.

    IF NOT _check_agency( EXPORTING is_travel        = is_travel
                                    is_travelx       = is_travelx
                                    iv_change_mode   = iv_change_mode
                          CHANGING  ct_messages      = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_customer( EXPORTING is_travel      = is_travel
                                      is_travelx     = is_travelx
                                      iv_change_mode = iv_change_mode
                            CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_dates( EXPORTING is_travel      = is_travel
                                   is_travelx     = is_travelx
                                   iv_change_mode = iv_change_mode
                         CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_status( EXPORTING is_travel      = is_travel
                                    is_travelx     = is_travelx
                                    iv_change_mode = iv_change_mode
                          CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.

    IF NOT _check_currency_code( EXPORTING is_travel      = is_travel
                                           is_travelx     = is_travelx
                                           iv_change_mode = iv_change_mode
                                 CHANGING  ct_messages    = ct_messages ).
      rv_is_valid = abap_false.
    ENDIF.
  ENDMETHOD.


  METHOD _check_agency.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-agency_id = abap_true ).
      IF mt_agency_id IS INITIAL.
        SELECT DISTINCT agency_id FROM /dmo/agency INTO TABLE @mt_agency_id. "#EC CI_NOWHERE
      ENDIF.
      READ TABLE mt_agency_id TRANSPORTING NO FIELDS WITH TABLE KEY table_line = is_travel-agency_id.
      IF sy-subrc <> 0.
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>agency_unkown  agency_id = is_travel-agency_id ) TO ct_messages.
      ENDIF.
    ENDIF.
  ENDMETHOD.


  METHOD _check_customer.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-customer_id = abap_true ).
      rv_is_valid = lcl_common_checks=>is_customer_id_valid( EXPORTING iv_customer_id = is_travel-customer_id CHANGING ct_messages = ct_messages ).
    ENDIF.
  ENDMETHOD.


  METHOD _check_dates.
    rv_is_valid = abap_true.

    " begin date
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-begin_date = abap_true ).
      IF is_travel-begin_date IS INITIAL OR is_travel-begin_date = ''.
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>no_begin_date  travel_id = is_travel-travel_id ) TO ct_messages.
      ENDIF.
    ENDIF.

    " end date
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-end_date = abap_true ).
      IF is_travel-end_date IS INITIAL OR is_travel-end_date = ''.
        rv_is_valid = abap_false.
        APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>no_end_date  travel_id = is_travel-travel_id ) TO ct_messages.
      ENDIF.
    ENDIF.

    " begin date < = end date
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-begin_date = abap_true )
                                                                  OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-end_date   = abap_true ).
      IF is_travel-begin_date IS NOT INITIAL AND is_travel-end_date IS NOT INITIAL.
        IF is_travel-begin_date > is_travel-end_date.
          rv_is_valid = abap_false.
          APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>end_date_before_begin_date  begin_date = is_travel-begin_date  end_date = is_travel-end_date  travel_id = is_travel-travel_id ) TO ct_messages.
        ENDIF.
      ENDIF.
    ENDIF.
  ENDMETHOD.


  METHOD _check_status.
    rv_is_valid = abap_true.
    IF iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-status = abap_true.
      CASE is_travel-status.
        WHEN CONV /dmo/travel_status( /dmo/if_flight_legacy=>travel_status-booked ).   " OK
        WHEN CONV /dmo/travel_status( /dmo/if_flight_legacy=>travel_status-cancelled )." OK
        WHEN CONV /dmo/travel_status( /dmo/if_flight_legacy=>travel_status-new ).      " OK
        WHEN CONV /dmo/travel_status( /dmo/if_flight_legacy=>travel_status-planned ).  " OK
        WHEN OTHERS.
          rv_is_valid = abap_false.
          APPEND NEW /dmo/cx_flight_legacy( textid = /dmo/cx_flight_legacy=>travel_status_invalid  status = is_travel-status ) TO ct_messages.
      ENDCASE.
    ENDIF.
  ENDMETHOD.


  METHOD _check_currency_code.
    rv_is_valid = abap_true.
    IF is_travel-total_price IS INITIAL AND is_travel-booking_fee IS INITIAL AND is_travel-currency_code IS INITIAL.
      " When no prices have been entered yet, the currency code may be initial
      RETURN.
    ENDIF.
    IF   iv_change_mode = /dmo/cl_flight_legacy=>change_mode-create
      OR ( iv_change_mode = /dmo/cl_flight_legacy=>change_mode-update AND is_travelx-currency_code = abap_true ).
      rv_is_valid = lcl_common_checks=>is_currency_code_valid( EXPORTING iv_currency_code = is_travel-currency_code CHANGING ct_messages = ct_messages ).
    ENDIF.
  ENDMETHOD.


  METHOD _update_admin.
    cs_travel_admin-lastchangedby = sy-uname.
    GET TIME STAMP FIELD cs_travel_admin-lastchangedat.
    IF iv_new = abap_true.
      " For a BO to be created we want created* and lastchanged* to be the same
      cs_travel_admin-createdby = cs_travel_admin-lastchangedby.
      cs_travel_admin-createdat = cs_travel_admin-lastchangedat.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex04">Exercise04 - Create an ABAP Package</h2>
<pre class="pre-green">
No Code
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex05">Exercise05 - How to Create a 'Hello World' Application</h2>
<pre class="pre-green">
      WHEN 1.
        out->write( 'Case 1 Run!' ).
        out->write( 'Hello World UFH8N!' ).
*        out->write( 'Hello World UFH8N!' ).
        "out->write( 'Hello World UFH8N!' ).

        "CTRL + zooms in, not comments out
        "CTRL + Shift + zooms in, not comments out and splits screen

        "CTRL + Shift + < does comment out and CTRL + Shift + > un-comments
        out->write( 'Hello World UFH8N!' ).
        out->write( 'Hello World UFH8N!' ).

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex06">Exercise06 - How To Comment And Uncomment Code</h2>
<pre class="pre-green">
No Code
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex07">Exercise07 - Predefined ABAP TYPES</h2>
<pre class="pre-green">
      WHEN 2.
          out->write( 'Case 2 Run!' ).
*         Data Objects with Built-in Types
*        *********************************************************************

            " comment/uncomment the following declarations and check the output
            DATA variable_s_02 TYPE string.
            DATA variable_i_02 TYPE i.
            DATA variable_d_02 TYPE d.
            DATA variable_c_02 TYPE c LENGTH 10.
            DATA variable_n_02 TYPE n LENGTH 10.
            DATA variable_p_02 TYPE p LENGTH 8 DECIMALS 2.

*         Output
*        *********************************************************************

            out->write( 'Result with Initial Value)' ).
            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            out->write( variable_p_02 ).

            out->write(  '---------' ).

            out->write(  'Result with Values' ).
            variable_s_02 = 'UFH8N'.
            variable_i_02 = 10.
            variable_d_02 = '20251028'.
            variable_c_02 = 'L'.
            variable_n_02 = '3'.
            variable_n_02 = 3. "Not sure if 3 or '3'
            "variable_p_02 = 3.14. "How to do packaged numbers?

            "variable_d_02 = '19891109'.

            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            "out->write( variable_p_02 ).
            out->write(  '---------' ).

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex08">Exercise08 - Data Objects</h2>
<pre class="pre-green">
      WHEN 3.
          out->write( 'Case 3 Run!' ).

*         Example 1: Local Types
*        *********************************************************************

*         Comment/Uncomment the following lines to change the type of my_var
            TYPES my_type_p_03 TYPE p LENGTH 3 DECIMALS 2.
            TYPES my_type_i_03 TYPE i .
            TYPES my_type_s_03 TYPE string.
            TYPES my_type_n_03 TYPE n length 10.

*         Variable based on local type
            DATA my_variable_n_03 TYPE my_type_n_03.

            out->write(  `my_variable (TYPE MY_TYPE)` ).
            out->write( my_variable_n_03 ).
            "Can't use a TYPE, must be a DATA

*         Example 2: Global Types
*        *********************************************************************

*         Variable based on global type .
            " Place cursor on variable and press F2 or F3
            DATA airport_03 TYPE /dmo/airport_id VALUE 'FRA'. "Char 3

            out->write(  `airport (TYPE /DMO/AIRPORT_ID )` ).
            out->write(   airport_03 ).

*         Example 3: Constants
*        *********************************************************************

            CONSTANTS c_text_03   TYPE string VALUE `Hello World`.
            CONSTANTS c_number_03 TYPE i      VALUE 12345.

            "Uncomment this line to see syntax error ( VALUE is mandatory)
          "constants c_text2   type string. "VALUE ... Not Specified
          "ToDo: Was there not a way to allow initial Constants

            out->write(  `c_text (TYPE STRING)` ).
            out->write(   c_text_03 ).
            out->write(  '---------' ).

            out->write(  `c_number (TYPE I )` ).
            out->write(   c_number_03 ).
            out->write(  `---------` ).

*         Example 4: Literals
*        *********************************************************************

            out->write(  '12345               ' ).    "Text Literal   (Type C)
            out->write(  `12345               ` ).    "String Literal (Type STRING)
            out->write(  12345                  ).    "Number Literal (Type I)

            "uncomment this line to see syntax error (no number literal with digits)
            "out->write(  12345.67                  ). "Ended unexpectedly

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex09">Exercise09 - Arithmetic Calculations</h2>
<pre class="pre-green">
      WHEN 4.
          out->write( 'Case 4 Run!' ).
*         Declarations
*        *********************************************************************

            " comment/uncomment these line for different result types
            TYPES t_result_1_04 TYPE p LENGTH 8 DECIMALS 2.
            TYPES t_result_2_04 TYPE p LENGTH 8 DECIMALS 0.
            TYPES t_result_3_04 TYPE i.

            DATA result_1_04 TYPE t_result_1_04.
            DATA result_2_04 TYPE t_result_2_04.
            DATA result_3_04 TYPE t_result_3_04.

*         Calculations
*        *********************************************************************
            " comment/uncomment these lines for different calculations
            out->write( '_____________________________________' ).

            result_1_04 = 2 + 3.
            result_2_04 = 2 + 3.
            result_3_04 = 2 + 3.
            out->write( '2 + 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 - 3.
            result_2_04 = 2 - 3.
            result_3_04 = 2 - 3.
            out->write( '2 - 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 * 3.
            result_2_04 = 2 * 3.
            result_3_04 = 2 * 3.
            out->write( '2 * 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 / 3.
            result_2_04 = 2 / 3.
            result_3_04 = 2 / 3.
            out->write( '2 / 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = sqrt( 2 ).
            result_2_04 = sqrt( 2 ).
            result_3_04 = sqrt( 2 ).
            out->write( 'sqrt( 2 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = ipow( base = 2 exp = 3 ).
            result_2_04 = ipow( base = 2 exp = 3 ).
            result_3_04 = ipow( base = 2 exp = 3 ).
            out->write( 'ipow( base = 2 exp = 3 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_2_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_3_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            out->write( '( 8 * 7 - 6 ) / ( 5 + 4 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 8 * 7 - 6 / 5 + 4.
            result_2_04 = 8 * 7 - 6 / 5 + 4.
            result_3_04 = 8 * 7 - 6 / 5 + 4.
            out->write( '8 * 7 - 6 / 5 + 4' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

*         Output
*        *********************************************************************
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex10">Exercise10 - String Processing</h2>
<pre class="pre-green">
      WHEN 5.
          out->write( 'Case 5 Run!' ).
*         Declarations
*        *********************************************************************
            TYPES t_amount_05 TYPE  p LENGTH 8 DECIMALS 2.

            DATA amount_05   TYPE t_amount_05 VALUE '3.30'. "3.3  
            DATA amount1_05  TYPE t_amount_05 VALUE '1.20'. "1.2  
            DATA amount2_05  TYPE t_amount_05 VALUE '2.10'. "2.1  

            DATA the_date_05  TYPE d                     VALUE '19891109'. "1989-11-09  
            DATA my_number_05 TYPE p LENGTH 3 DECIMALS 2 VALUE '-273.15'.  "-273.15  

            DATA part1_05 TYPE string VALUE `Hello`.    "Hello
            DATA part2_05 TYPE string VALUE `World`.    "World

            out->write( '_____________________________________' ).

            out->write( amount_05 ).    "3.3 
            out->write( amount1_05 ).   "1.2  
            out->write( amount2_05 ).   "2.1 
            out->write( the_date_05 ).  "1989-11-09  
            out->write( my_number_05 ). "-273.15  
            out->write( part1_05 ).     "Hello
            out->write( part2_05 ).     "World

            out->write( '_____________________________________' ).

*         String Templates
*        *********************************************************************

            " comment/uncomment the following lines for different examples
            DATA(text_1a_05) = |Hello World|.                               "Hello World
            DATA(text_1b_05) = |Total: { amount_05 } EUR|.                  "Total: 3.30 EUR
            DATA(text_1c_05) = |Total: { amount1_05 + amount2_05 } EUR|.    "Total: 3.30 EUR

            out->write( text_1a_05 ).   "Hello World
            out->write( text_1b_05 ).   "Total: 3.30 EUR
            out->write( text_1c_05 ).   "Total: 3.30 EUR

            out->write( '_____________________________________' ).

*         Format Options
*        *********************************************************************

            "Date
            DATA(text_2a_05) = |Raw Date: { the_date_05             }|. "Raw Date: 19891109
            DATA(text_2b_05) = |ISO Date: { the_date_05 Date = ISO  }|. "ISO Date: 1989-11-09
            DATA(text_2c_05) = |USER Date:{ the_date_05 Date = USER }|. "USER Date:11/09/1989

            out->write( text_2a_05 ).   "Raw Date: 19891109
            out->write( text_2b_05 ).   "ISO Date: 1989-11-09
            out->write( text_2c_05 ).   "USER Date:11/09/1989

            out->write( '_____________________________________' ).

            "Number
            DATA(text_3a_05) = |Raw Number { my_number_05                    }|.    "Raw Number -273.15
            DATA(text_3b_05) = |User Format{ my_number_05 NUMBER = USER      }|.    "User Format-273.15
            DATA(text_3c_05) = |Sign Right { my_number_05 SIGN = RIGHT       }|.    "Sign Right 273.15-
            DATA(text_3d_05) = |Scientific { my_number_05 STYLE = SCIENTIFIC }|.    "Scientific -2.7315E+02

            out->write( text_3a_05 ).   "Raw Number -273.15
            out->write( text_3b_05 ).   "User Format-273.15
            out->write( text_3c_05 ).   "Sign Right 273.15-
            out->write( text_3d_05 ).   "Scientific -2.7315E+02

            out->write( '_____________________________________' ).

*         String expression (concatenation Operator)
*        *********************************************************************

            DATA(text_4a_05) = part1_05 && part2_05.
            DATA(text_4b_05)  = part1_05 && | | && part2_05.
            DATA(text_4c_05)  = |{ amount1_05 } + { amount2_05 }| &&
                              | = | &&
                              |{ amount1_05 + amount2_05 }|.

            out->write( text_4a_05 ).   "HelloWorld
            out->write( text_4b_05 ).   "Hello World
            out->write( text_4c_05 ).   "1.20 + 2.10 = 3.30
            out->write( '_____________________________________' ).


*         Output
*        *********************************************************************

            "out->write( text_05 ).

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex11">Exercise11 - Declare Variables and Process Data</h2>
<pre class="pre-green">
      WHEN 6.
          out->write( 'Case 6 Run!' ).
          "Declare Variables and Process Data
          "ZCL_##_COMPUTE
          DATA number1_06 TYPE i.
          DATA number2_06 TYPE i.
          DATA result_06  TYPE p LENGTH 8 DECIMALS 2.

          number1_06 = -8.
          number2_06 =  3.

          result_06 = number1_06 / number2_06.

          DATA(output_06) = |{ number1_06 } / { number2_06 } = { result_06 }|.

          out->write( output_06 ).

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex12">Exercise12 - Conditional Branching</h2>
<pre class="pre-green">
      WHEN 7.
          out->write( 'Case 7 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_07 TYPE i VALUE 0.
*            CONSTANTS c_number_07 TYPE i VALUE 1.
*            CONSTANTS c_number_07 TYPE i VALUE 2.
*            CONSTANTS c_number_07 TYPE i VALUE -1.
*            CONSTANTS c_number_07 TYPE i VALUE -2.

*         Example 1: Simple IF ... ENDIF.
*        *********************************************************************

            out->write(  `--------------------------------` ).
            out->write(  `Example 1: Simple IF ... ENDIF.` ).
            out->write(  `-------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is NOT zero`   ).
            ENDIF.

*         Example 2: Optional Branches ELSEIF and ELSE
*        *********************************************************************

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 2: Optional Branches ELSEIF and ELSE` ).
            out->write(  `--------------------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`            ).
            ELSEIF c_number_07 > 0.
              out->write( `The value of C_NUMBER is greater than zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is less than zero`      ).
            ENDIF.

*         Example 3: CASE ... ENDCASE
*        *********************************************************************

            out->write(  `---------------------------` ).
            out->write(  `Example 3: CASE ... ENDCASE` ).
            out->write(  `---------------------------` ).

            CASE c_number_07.
              WHEN 0.
                out->write( `The value of C_NUMBER equals zero`             ).
              WHEN 1.
                out->write( `The value of C_NUMBER equals one`              ).
              WHEN 2.
                out->write( `The value of C_NUMBER equals two`              ).
              WHEN OTHERS.
                out->write( `The value of C_NUMBER equals non of the above` ).
            ENDCASE.

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex13">Exercise13 - Exception Handling</h2>
<pre class="pre-green">
      WHEN 8.
          out->write( 'Case 8 Run!' ).
*         Declarations
*        *********************************************************************
            DATA result_08 TYPE i.

            DATA numbers_08 TYPE TABLE OF i.

*         Preparation
*        *********************************************************************

            APPEND 123 TO numbers_08.

*         Example 1: Conversion Error (no Number)
*        *********************************************************************

            CONSTANTS c_text_08 TYPE string VALUE 'ABC'.
*            CONSTANTS c_text_08 TYPE string VALUE '123'.

            out->write(  `---------------------------` ).
            out->write(  `Example 1: Conversion Error` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = c_text_08.
                out->write( |Converted content is { result_08 }|  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_text_08 } is not a number!| ).
            ENDTRY.

*         Example 2: Division by Zero
*        *********************************************************************

            CONSTANTS c_number_08 TYPE i VALUE 0.
*            CONSTANTS c_number_08 TYPE i VALUE 7.

            out->write(  `---------------------------` ).
            out->write(  `Example 2: Division by Zero` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = 100 / c_number_08.
                out->write( |100 divided by { c_number_08 } equals { result_08 }| ).
              CATCH cx_sy_zerodivide.
                out->write(  `Error: Division by zero is not defined!` ).
            ENDTRY.

*         Example 3: Itab Error (Line Not Found)
*        *********************************************************************

            CONSTANTS c_index_08 TYPE i VALUE 2.
*            CONSTANTS c_index_08 TYPE i VALUE 1.

            out->write(  `-------------------------` ).
            out->write(  `Example 3: Line Not Found` ).
            out->write(  `-------------------------` ).

            TRY.
                result_08 = numbers_08[ c_index_08 ].
                out->write( |Content of row { c_index_08 } equals { result_08 }| ).
              CATCH cx_sy_itab_line_not_found.
                out->write(  `Error: Itab has less than { c_index } rows!` ).
            ENDTRY.


*         Example 4: Combination of Different Exceptions
*        *********************************************************************
*            CONSTANTS c_char TYPE c LENGTH 1 VALUE 'X'.
*            CONSTANTS c_char TYPE c length 1 value '0'.
            CONSTANTS c_char_08 TYPE c LENGTH 1 VALUE '1'.
*            CONSTANTS c_char TYPE c length 1 value '2'.

            out->write(  `----------------------` ).
            out->write(  `Example 4: Combination` ).
            out->write(  `----------------------` ).

            TRY.
                result_08 = numbers_08[ 2 / c_char_08 ].
                out->write( |Result: { result_08 } | ).
              CATCH cx_sy_zerodivide.
                out->write( `Error: Division by zero is not defined`  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_char_08 } is not a number! | ).
              CATCH cx_sy_itab_line_not_found.
                out->write( |Error: Itab contains less than { 2 / c_char_08 } rows| ).
            ENDTRY.
</pre>

<pre class="pre-green">
---------------------------
Error: ABC is not a number!
---------------------------
Example 2: Division by Zero
---------------------------
Error: Division by zero is not defined!
-------------------------
Example 3: Line Not Found
-------------------------
Error: Itab has less than { c_index } rows!
----------------------
Example 4: Combination
----------------------
Error: Itab contains less than 2 rows

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex14">Exercise14 – Iterations</h2>
<pre class="pre-green">
      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.

</pre>

<pre class="pre-green">
      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.
</pre>

<pre class="pre-green">
Case 9 Run!
----------------------------------
Example 1: DO ... ENDDO with TIMES
----------------------------------
Hello World
Hello World
Hello World
-------------------------------
Example 2: With Abort Condition
-------------------------------
1: Value of number: 9
2: Value of number: 8
3: Value of number: 7
4: Value of number: 6
5: Value of number: 5
6: Value of number: 4
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex15">Exercise15 - Simple Internal Tables</h2>
<pre class="pre-green">
      WHEN 10.
          out->write( 'Case 10 Run!' ).

*         Declarations
*        *********************************************************************

            " Internal tables
            DATA numbers_10 TYPE TABLE OF i.

            "Table type (local)
            TYPES tt_strings_10 TYPE TABLE OF string.
            DATA texts1_10      TYPE tt_strings_10.

            " Table type (global)
            DATA texts2_10 TYPE string_table.

            " work areas
            DATA number_10 TYPE i VALUE 1234.
            DATA text_10   TYPE string.

*         Example 1: APPEND
*        *********************************************************************

            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `-----------------` ).
            out->write(  `Example 1: APPEND` ).
            out->write(  `-----------------` ).

            out->write( numbers_10 ).

*         Example 2: CLEAR
*        *********************************************************************

            CLEAR numbers_10.

            out->write(  `----------------` ).
            out->write(  `Example 2: CLEAR` ).
            out->write(  `----------------` ).

            out->write( numbers_10 ).

*         Example 3: table expression
*        *********************************************************************
            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `---------------------------` ).
            out->write(  `Example 3: Table Expression` ).
            out->write(  `---------------------------` ).

            number_10 = numbers_10[ 2 ] .

            out->write( |Content of row 2: { number_10 }|    ).
            "Direct use of expression in string template
            out->write( |Content of row 1: { numbers_10[ 1 ]  }| ).

*         Example 4: LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `---------------------------` ).
            out->write(  `Example 4: LOOP ... ENDLOOP` ).
            out->write(  `---------------------------` ).

            LOOP AT numbers_10 INTO number_10.

              out->write( |Row: { sy-tabix } Content { number_10 }| ).

            ENDLOOP.

*         Example 5: Inline declaration in LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `-----------------------------` ).
            out->write(  `Example 5: Inline Declaration` ).
            out->write(  `-----------------------------` ).

            LOOP AT numbers_10 INTO DATA(number_inline_10).
              out->write( |Row: { sy-tabix } Content { number_inline_10 }| ).
            ENDLOOP.
</pre>

<pre class="pre-green">
Case 10 Run!
-----------------
Example 1: APPEND
-----------------
4711  
1234  
2468  
----------------
Example 2: CLEAR
----------------
---------------------------
Example 3: Table Expression
---------------------------
Content of row 2: 1234
Content of row 1: 4711
---------------------------
Example 4: LOOP ... ENDLOOP
---------------------------
Row: 1 Content 4711
Row: 2 Content 1234
Row: 3 Content 2468
-----------------------------
Example 5: Inline Declaration
-----------------------------
Row: 1 Content 4711
Row: 2 Content 1234
Row: 3 Content 2468
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex16">Exercise16 - Work with Simple Internal Tables</h2>
<pre class="pre-green">
      WHEN 11.
          out->write( 'Case 11 Run!' ).
          " ZCL_##_ITERATE
          CONSTANTS max_count_11 TYPE i VALUE 20.
          DATA numbers_11 TYPE TABLE OF i.

          DATA output_11 TYPE TABLE OF string. "Guess
          "DATA loop_count TYPE INT4.        "Guess

          DO max_count_11 TIMES.
            CASE sy-index.
              WHEN 1.
                APPEND 0 TO numbers_11.
              WHEN 2.
                APPEND 1 TO numbers_11.
              WHEN OTHERS.
                  APPEND numbers_11[  sy-index - 2 ]
                       + numbers_11[  sy-index - 1 ]
                      TO numbers_11.
            ENDCASE.

          ENDDO.

          DATA(counter_11) = 0.
          LOOP AT numbers_11 INTO DATA(number).
            counter_11 = counter_11 + 1.
            APPEND |{ counter_11 WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output_11.
          ENDLOOP.

         out->write(
         data   = output_11
         name   = |The first { max_count_11 } Fibonacci Numbers|
                ) .
</pre>
<pre class="pre-green">
The first 20 Fibonacci Numbers
1   :          0  
2   :          1  
3   :          1  
4   :          2  
5   :          3  
6   :          5  
7   :          8  
8   :         13  
9   :         21  
10  :         34  
11  :         55  
12  :         89  
13  :        144  
14  :        233  
15  :        377  
</pre>


<h2 id="Part1_SubPart1_PracSyst_Ex17">Exercise 17 - How To Start The Debugger</h2>
<pre class="pre-green">
ZCL_S4D400_DEBUGGING
No Code
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex18">Exercise 18 - How To Control The Execution Of Code</h2>
<pre class="pre-green">
ZCL_S4D400_DEBUGGING
No Code
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex19">Exercise 19 - How To Analyze The Contents Of Data Objects</h2>
<pre class="pre-green">
ZCL_S4D400_DEBUGGING
No Code
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex20">Exercise 20 - How To Create A Local Class In A Global Class</h2>
<pre class="pre-green">
No Code!
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex21">Exercise 21 - ?????</h2>
<pre class="pre-green">
?????
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex22">Exercise 22 - How To Create A Local Class In A Global Class</h2>
<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      CLASS-DATA conn_counter TYPE i.

  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
ENDCLASS.

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex23">Exercise 23 - Define a Local Class</h2>
<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      CLASS-DATA conn_counter TYPE i.

  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
ENDCLASS.
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex24">Exercise 24 - How to Create Instances of an ABAP Class</h2>
<pre class="pre-green">
      WHEN 12.
          out->write( 'Case 12 Run!' ).
          DATA lcl_ufh8n_connection_12 TYPE REF TO lcl_ufh8n_connection.
          DATA connections TYPE TABLE OF REF TO lcl_ufh8n_connection.
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.
          lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_b_12 = new #( ).

          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections.
          
          lcl_ufh8n_connection_12->carrier_id = 'LH2'.
          lcl_ufh8n_connection_12->connection_id = '0402'.    
          APPEND lcl_ufh8n_connection_12 TO connections.      

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex25">Exercise 25 - How To Manage Instances in an Internal Table</h2>
<pre class="pre-green">
      WHEN 12.
          out->write( 'Case 12 Run!' ).
          DATA lcl_ufh8n_connection_12 TYPE REF TO lcl_ufh8n_connection.
          DATA connections TYPE TABLE OF REF TO lcl_ufh8n_connection.
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH2'.
          lcl_ufh8n_connection_12->connection_id = '0402'.
          APPEND lcl_ufh8n_connection_12 TO connections.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex26">Exercise 26 - Create and Manage Instances</h2>
<pre class="pre-green">
      WHEN 12.
          out->write( 'Case 12 Run!' ).
          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'AA'.
          lcl_ufh8n_connection_12->connection_id = '0017'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          lcl_ufh8n_connection_12->connection_id = '0001'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex27">Exercise 27 - How to Define Methods</h2>

<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes,
               set_attributes.
               
      CLASS-DATA conn_counter TYPE i.
      
      

  PROTECTED SECTION.
  PRIVATE SECTION.  
  
ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.
  
  METHOD get_attributes.
  ENDMETHOD.
  
  METHOD set_attributes.
  ENDMETHOD.

ENDCLASS.
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex28">Exercise 28 - How to Implement Methods</h2>
<pre class="pre-green">
No Code!
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex29">Exercise 29 - How to Call Methods</h2>
<pre class="pre-green">
      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA carrier_id    TYPE /dmo/carrier_id.
          DATA connection_id TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'AA'.
          lcl_ufh8n_connection_12->connection_id = '0017'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          lcl_ufh8n_connection_12->connection_id = '0001'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id
                e_connection_id = connection_id ).
            out->write( |Flight Connection {  carrier_id } { connection_id }| ).
          ENDLOOP.
</pre>
<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id,
               set_attributes IMPORTING
                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
                 i_connection_id TYPE /dmo/connection_id.

      CLASS-DATA conn_counter TYPE i.



  PROTECTED SECTION.
  PRIVATE SECTION.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

  METHOD set_attributes.
    carrier_id    = i_carrier_id.
    connection_id = i_connection_id.
  ENDMETHOD.

ENDCLASS.
</pre>
<pre class="pre-green">
Case 12 Run!
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex30">Exercise 30 - Method Calls and Exception Handling</h2>
<h3 id="Code_List_03">Global Class zcl_ufh8n_hello_world (From Exercise 30)</h3>
<pre class="pre-green">
CLASS zcl_ufh8n_hello_world DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_hello_world IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA lv_switch TYPE int4.
    lv_switch = 12.

    CASE lv_switch.
      WHEN 1.
        out->write( 'Case 1 Run!' ).
        out->write( 'Hello World UFH8N!' ).
*        out->write( 'Hello World UFH8N!' ).
        "out->write( 'Hello World UFH8N!' ).

        "CTRL + zooms in, not comments out
        "CTRL + Shift + zooms in, not comments out and splits screen

        "CTRL + Shift + < does comment out and CTRL + Shift + > un-comments
        out->write( 'Hello World UFH8N!' ).
        out->write( 'Hello World UFH8N!' ).
      WHEN 2.
          out->write( 'Case 2 Run!' ).
*         Data Objects with Built-in Types
*        *********************************************************************

            " comment/uncomment the following declarations and check the output
            DATA variable_s_02 TYPE string.
            DATA variable_i_02 TYPE i.
            DATA variable_d_02 TYPE d.
            DATA variable_c_02 TYPE c LENGTH 10.
            DATA variable_n_02 TYPE n LENGTH 10.
            DATA variable_p_02 TYPE p LENGTH 8 DECIMALS 2.

*         Output
*        *********************************************************************

            out->write( 'Result with Initial Value)' ).
            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            out->write( variable_p_02 ).

            out->write(  '---------' ).

            out->write(  'Result with Values' ).
            variable_s_02 = 'UFH8N'.
            variable_i_02 = 10.
            variable_d_02 = '20251028'.
            variable_c_02 = 'L'.
            variable_n_02 = '3'.
            variable_n_02 = 3. "Not sure if 3 or '3'
            "variable_p_02 = 3.14. "How to do packaged numbers?

            "variable_d_02 = '19891109'.

            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            "out->write( variable_p_02 ).
            out->write(  '---------' ).

      WHEN 3.
          out->write( 'Case 3 Run!' ).

*         Example 1: Local Types
*        *********************************************************************

*         Comment/Uncomment the following lines to change the type of my_var
            TYPES my_type_p_03 TYPE p LENGTH 3 DECIMALS 2.
            TYPES my_type_i_03 TYPE i .
            TYPES my_type_s_03 TYPE string.
            TYPES my_type_n_03 TYPE n length 10.

*         Variable based on local type
            DATA my_variable_n_03 TYPE my_type_n_03.

            out->write(  `my_variable (TYPE MY_TYPE)` ).
            out->write( my_variable_n_03 ).
            "Can't use a TYPE, must be a DATA

*         Example 2: Global Types
*        *********************************************************************

*         Variable based on global type .
            " Place cursor on variable and press F2 or F3
            DATA airport_03 TYPE /dmo/airport_id VALUE 'FRA'. "Char 3

            out->write(  `airport (TYPE /DMO/AIRPORT_ID )` ).
            out->write(   airport_03 ).

*         Example 3: Constants
*        *********************************************************************

            CONSTANTS c_text_03   TYPE string VALUE `Hello World`.
            CONSTANTS c_number_03 TYPE i      VALUE 12345.

            "Uncomment this line to see syntax error ( VALUE is mandatory)
          "constants c_text2   type string. "VALUE ... Not Specified
          "ToDo: Was there not a way to allow initial Constants

            out->write(  `c_text (TYPE STRING)` ).
            out->write(   c_text_03 ).
            out->write(  '---------' ).

            out->write(  `c_number (TYPE I )` ).
            out->write(   c_number_03 ).
            out->write(  `---------` ).

*         Example 4: Literals
*        *********************************************************************

            out->write(  '12345               ' ).    "Text Literal   (Type C)
            out->write(  `12345               ` ).    "String Literal (Type STRING)
            out->write(  12345                  ).    "Number Literal (Type I)

            "uncomment this line to see syntax error (no number literal with digits)
            "out->write(  12345.67                  ). "Ended unexpectedly

      WHEN 4.
          out->write( 'Case 4 Run!' ).
*         Declarations
*        *********************************************************************

            " comment/uncomment these line for different result types
            TYPES t_result_1_04 TYPE p LENGTH 8 DECIMALS 2.
            TYPES t_result_2_04 TYPE p LENGTH 8 DECIMALS 0.
            TYPES t_result_3_04 TYPE i.

            DATA result_1_04 TYPE t_result_1_04.
            DATA result_2_04 TYPE t_result_2_04.
            DATA result_3_04 TYPE t_result_3_04.

*         Calculations
*        *********************************************************************
            " comment/uncomment these lines for different calculations
            out->write( '_____________________________________' ).

            result_1_04 = 2 + 3.
            result_2_04 = 2 + 3.
            result_3_04 = 2 + 3.
            out->write( '2 + 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 - 3.
            result_2_04 = 2 - 3.
            result_3_04 = 2 - 3.
            out->write( '2 - 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 * 3.
            result_2_04 = 2 * 3.
            result_3_04 = 2 * 3.
            out->write( '2 * 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 / 3.
            result_2_04 = 2 / 3.
            result_3_04 = 2 / 3.
            out->write( '2 / 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = sqrt( 2 ).
            result_2_04 = sqrt( 2 ).
            result_3_04 = sqrt( 2 ).
            out->write( 'sqrt( 2 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = ipow( base = 2 exp = 3 ).
            result_2_04 = ipow( base = 2 exp = 3 ).
            result_3_04 = ipow( base = 2 exp = 3 ).
            out->write( 'ipow( base = 2 exp = 3 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_2_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_3_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            out->write( '( 8 * 7 - 6 ) / ( 5 + 4 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 8 * 7 - 6 / 5 + 4.
            result_2_04 = 8 * 7 - 6 / 5 + 4.
            result_3_04 = 8 * 7 - 6 / 5 + 4.
            out->write( '8 * 7 - 6 / 5 + 4' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

*         Output
*        *********************************************************************
      WHEN 5.
          out->write( 'Case 5 Run!' ).
*         Declarations
*        *********************************************************************
            TYPES t_amount_05 TYPE  p LENGTH 8 DECIMALS 2.

            DATA amount_05   TYPE t_amount_05 VALUE '3.30'. "3.3
            DATA amount1_05  TYPE t_amount_05 VALUE '1.20'. "1.2
            DATA amount2_05  TYPE t_amount_05 VALUE '2.10'. "2.1

            DATA the_date_05  TYPE d                     VALUE '19891109'. "1989-11-09
            DATA my_number_05 TYPE p LENGTH 3 DECIMALS 2 VALUE '-273.15'.  "-273.15

            DATA part1_05 TYPE string VALUE `Hello`.    "Hello
            DATA part2_05 TYPE string VALUE `World`.    "World

            out->write( '_____________________________________' ).

            out->write( amount_05 ).    "3.3
            out->write( amount1_05 ).   "1.2
            out->write( amount2_05 ).   "2.1
            out->write( the_date_05 ).  "1989-11-09
            out->write( my_number_05 ). "-273.15
            out->write( part1_05 ).     "Hello
            out->write( part2_05 ).     "World

            out->write( '_____________________________________' ).

*         String Templates
*        *********************************************************************

            " comment/uncomment the following lines for different examples
            DATA(text_1a_05) = |Hello World|.                               "Hello World
            DATA(text_1b_05) = |Total: { amount_05 } EUR|.                  "Total: 3.30 EUR
            DATA(text_1c_05) = |Total: { amount1_05 + amount2_05 } EUR|.    "Total: 3.30 EUR

            out->write( text_1a_05 ).   "Hello World
            out->write( text_1b_05 ).   "Total: 3.30 EUR
            out->write( text_1c_05 ).   "Total: 3.30 EUR

            out->write( '_____________________________________' ).

*         Format Options
*        *********************************************************************

            "Date
            DATA(text_2a_05) = |Raw Date: { the_date_05             }|. "Raw Date: 19891109
            DATA(text_2b_05) = |ISO Date: { the_date_05 Date = ISO  }|. "ISO Date: 1989-11-09
            DATA(text_2c_05) = |USER Date:{ the_date_05 Date = USER }|. "USER Date:11/09/1989

            out->write( text_2a_05 ).   "Raw Date: 19891109
            out->write( text_2b_05 ).   "ISO Date: 1989-11-09
            out->write( text_2c_05 ).   "USER Date:11/09/1989

            out->write( '_____________________________________' ).

            "Number
            DATA(text_3a_05) = |Raw Number { my_number_05                    }|.    "Raw Number -273.15
            DATA(text_3b_05) = |User Format{ my_number_05 NUMBER = USER      }|.    "User Format-273.15
            DATA(text_3c_05) = |Sign Right { my_number_05 SIGN = RIGHT       }|.    "Sign Right 273.15-
            DATA(text_3d_05) = |Scientific { my_number_05 STYLE = SCIENTIFIC }|.    "Scientific -2.7315E+02

            out->write( text_3a_05 ).   "Raw Number -273.15
            out->write( text_3b_05 ).   "User Format-273.15
            out->write( text_3c_05 ).   "Sign Right 273.15-
            out->write( text_3d_05 ).   "Scientific -2.7315E+02

            out->write( '_____________________________________' ).

*         String expression (concatenation Operator)
*        *********************************************************************

            DATA(text_4a_05) = part1_05 && part2_05.
            DATA(text_4b_05)  = part1_05 && | | && part2_05.
            DATA(text_4c_05)  = |{ amount1_05 } + { amount2_05 }| &&
                              | = | &&
                              |{ amount1_05 + amount2_05 }|.

            out->write( text_4a_05 ).   "HelloWorld
            out->write( text_4b_05 ).   "Hello World
            out->write( text_4c_05 ).   "1.20 + 2.10 = 3.30
            out->write( '_____________________________________' ).


*         Output
*        *********************************************************************
            "out->write( text_05 ).
      WHEN 6.
          out->write( 'Case 6 Run!' ).
          "Declare Variables and Process Data
          "ZCL_##_COMPUTE
          DATA number1_06 TYPE i.
          DATA number2_06 TYPE i.
          DATA result_06  TYPE p LENGTH 8 DECIMALS 2.

          number1_06 = -8.
          number2_06 =  3.

          result_06 = number1_06 / number2_06.

          DATA(output_06) = |{ number1_06 } / { number2_06 } = { result_06 }|.

          out->write( output_06 ).

      WHEN 7.
          out->write( 'Case 7 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_07 TYPE i VALUE 0.
*            CONSTANTS c_number_07 TYPE i VALUE 1.
*            CONSTANTS c_number_07 TYPE i VALUE 2.
*            CONSTANTS c_number_07 TYPE i VALUE -1.
*            CONSTANTS c_number_07 TYPE i VALUE -2.

*         Example 1: Simple IF ... ENDIF.
*        *********************************************************************

            out->write(  `--------------------------------` ).
            out->write(  `Example 1: Simple IF ... ENDIF.` ).
            out->write(  `-------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is NOT zero`   ).
            ENDIF.

*         Example 2: Optional Branches ELSEIF and ELSE
*        *********************************************************************

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 2: Optional Branches ELSEIF and ELSE` ).
            out->write(  `--------------------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`            ).
            ELSEIF c_number_07 > 0.
              out->write( `The value of C_NUMBER is greater than zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is less than zero`      ).
            ENDIF.

*         Example 3: CASE ... ENDCASE
*        *********************************************************************

            out->write(  `---------------------------` ).
            out->write(  `Example 3: CASE ... ENDCASE` ).
            out->write(  `---------------------------` ).

            CASE c_number_07.
              WHEN 0.
                out->write( `The value of C_NUMBER equals zero`             ).
              WHEN 1.
                out->write( `The value of C_NUMBER equals one`              ).
              WHEN 2.
                out->write( `The value of C_NUMBER equals two`              ).
              WHEN OTHERS.
                out->write( `The value of C_NUMBER equals non of the above` ).
            ENDCASE.

      WHEN 8.
          out->write( 'Case 8 Run!' ).
*         Declarations
*        *********************************************************************
            DATA result_08 TYPE i.

            DATA numbers_08 TYPE TABLE OF i.

*         Preparation
*        *********************************************************************

            APPEND 123 TO numbers_08.

*         Example 1: Conversion Error (no Number)
*        *********************************************************************

            CONSTANTS c_text_08 TYPE string VALUE 'ABC'.
*            CONSTANTS c_text_08 TYPE string VALUE '123'.

            out->write(  `---------------------------` ).
            out->write(  `Example 1: Conversion Error` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = c_text_08.
                out->write( |Converted content is { result_08 }|  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_text_08 } is not a number!| ).
            ENDTRY.

*         Example 2: Division by Zero
*        *********************************************************************

            CONSTANTS c_number_08 TYPE i VALUE 0.
*            CONSTANTS c_number_08 TYPE i VALUE 7.

            out->write(  `---------------------------` ).
            out->write(  `Example 2: Division by Zero` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = 100 / c_number_08.
                out->write( |100 divided by { c_number_08 } equals { result_08 }| ).
              CATCH cx_sy_zerodivide.
                out->write(  `Error: Division by zero is not defined!` ).
            ENDTRY.

*         Example 3: Itab Error (Line Not Found)
*        *********************************************************************

            CONSTANTS c_index_08 TYPE i VALUE 2.
*            CONSTANTS c_index_08 TYPE i VALUE 1.

            out->write(  `-------------------------` ).
            out->write(  `Example 3: Line Not Found` ).
            out->write(  `-------------------------` ).

            TRY.
                result_08 = numbers_08[ c_index_08 ].
                out->write( |Content of row { c_index_08 } equals { result_08 }| ).
              CATCH cx_sy_itab_line_not_found.
                out->write(  `Error: Itab has less than { c_index } rows!` ).
            ENDTRY.


*         Example 4: Combination of Different Exceptions
*        *********************************************************************
*            CONSTANTS c_char TYPE c LENGTH 1 VALUE 'X'.
*            CONSTANTS c_char TYPE c length 1 value '0'.
            CONSTANTS c_char_08 TYPE c LENGTH 1 VALUE '1'.
*            CONSTANTS c_char TYPE c length 1 value '2'.

            out->write(  `----------------------` ).
            out->write(  `Example 4: Combination` ).
            out->write(  `----------------------` ).

            TRY.
                result_08 = numbers_08[ 2 / c_char_08 ].
                out->write( |Result: { result_08 } | ).
              CATCH cx_sy_zerodivide.
                out->write( `Error: Division by zero is not defined`  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_char_08 } is not a number! | ).
              CATCH cx_sy_itab_line_not_found.
                out->write( |Error: Itab contains less than { 2 / c_char_08 } rows| ).
            ENDTRY.

      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.

      WHEN 10.
          out->write( 'Case 10 Run!' ).

*         Declarations
*        *********************************************************************

            " Internal tables
            DATA numbers_10 TYPE TABLE OF i.

            "Table type (local)
            TYPES tt_strings_10 TYPE TABLE OF string.
            DATA texts1_10      TYPE tt_strings_10.

            " Table type (global)
            DATA texts2_10 TYPE string_table.

            " work areas
            DATA number_10 TYPE i VALUE 1234.
            DATA text_10   TYPE string.

*         Example 1: APPEND
*        *********************************************************************

            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `-----------------` ).
            out->write(  `Example 1: APPEND` ).
            out->write(  `-----------------` ).

            out->write( numbers_10 ).

*         Example 2: CLEAR
*        *********************************************************************

            CLEAR numbers_10.

            out->write(  `----------------` ).
            out->write(  `Example 2: CLEAR` ).
            out->write(  `----------------` ).

            out->write( numbers_10 ).

*         Example 3: table expression
*        *********************************************************************
            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `---------------------------` ).
            out->write(  `Example 3: Table Expression` ).
            out->write(  `---------------------------` ).

            number_10 = numbers_10[ 2 ] .

            out->write( |Content of row 2: { number_10 }|    ).
            "Direct use of expression in string template
            out->write( |Content of row 1: { numbers_10[ 1 ]  }| ).

*         Example 4: LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `---------------------------` ).
            out->write(  `Example 4: LOOP ... ENDLOOP` ).
            out->write(  `---------------------------` ).

            LOOP AT numbers_10 INTO number_10.

              out->write( |Row: { sy-tabix } Content { number_10 }| ).

            ENDLOOP.

*         Example 5: Inline declaration in LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `-----------------------------` ).
            out->write(  `Example 5: Inline Declaration` ).
            out->write(  `-----------------------------` ).

            LOOP AT numbers_10 INTO DATA(number_inline_10).
              out->write( |Row: { sy-tabix } Content { number_inline_10 }| ).
            ENDLOOP.

      WHEN 11.
          out->write( 'Case 11 Run!' ).
          " ZCL_##_ITERATE
          CONSTANTS max_count_11 TYPE i VALUE 20.
          DATA numbers_11 TYPE TABLE OF i.

          DATA output_11 TYPE TABLE OF string. "Guess
          "DATA loop_count TYPE INT4.        "Guess

          DO max_count_11 TIMES.
            CASE sy-index.
              WHEN 1.
                APPEND 0 TO numbers_11.
              WHEN 2.
                APPEND 1 TO numbers_11.
              WHEN OTHERS.
                  APPEND numbers_11[  sy-index - 2 ]
                       + numbers_11[  sy-index - 1 ]
                      TO numbers_11.
            ENDCASE.

          ENDDO.

          DATA(counter_11) = 0.
          LOOP AT numbers_11 INTO DATA(number).
            counter_11 = counter_11 + 1.
            APPEND |{ counter_11 WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output_11.
          ENDLOOP.

         out->write(
         data   = output_11
         name   = |The first { max_count_11 } Fibonacci Numbers|
                ) .

      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          lcl_ufh8n_connection_12 = new #( ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          carrier_id_12    = 'QA'.
          connection_id_12 = '0200'.
          out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          out->write(  |i_connection_id = '{ connection_id_12 }'| ).

        TRY.
            lcl_ufh8n_connection_12->set_attributes(
              EXPORTING
                i_carrier_id    = carrier_id_12
                i_connection_id = connection_id_12
            ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'AA'.
          lcl_ufh8n_connection_12->connection_id = '0017'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          lcl_ufh8n_connection_12->connection_id = '0001'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

      WHEN 13.
          out->write( 'Case 13 Run!' ).

          "ZCL__01_INSTANCE_ITAB
      WHEN OTHERS.
        out->write( 'Please enter a valid value for the CASE!' ).
    ENDCASE.
  ENDMETHOD.
ENDCLASS.

</pre>
<h3 id="Code_List_04">Local Class lcl_ufh8n_connection (From Exercise 30)</h3>
<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id,
               set_attributes IMPORTING
                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
                 i_connection_id TYPE /dmo/connection_id
                 RAISING cx_abap_invalid_value.

      CLASS-DATA conn_counter TYPE i.



  PROTECTED SECTION.
  PRIVATE SECTION.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

  METHOD set_attributes.
    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    carrier_id    = i_carrier_id.
    connection_id = i_connection_id.
  ENDMETHOD.

ENDCLASS.

</pre>
<pre class="pre-green">
Case 12 Run!
i_carrier_id    = 'QA' 
i_connection_id = '0200'
Method call successful
Flight Connection QA 0200
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
</pre>

<h3 id="Code_List_05">Global Class zcl_ufh8n_hello_world | Again</h3>
<pre class="pre-green">
" Code to Now: ZCL_UFH8N_HELLO_WORLD
" ZCL_UFH8N_HELLO_WORLD
" ** Global Class

CLASS zcl_ufh8n_hello_world DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_hello_world IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA lv_switch TYPE int4.
    lv_switch = 12.

    CASE lv_switch.
      WHEN 1.
        out->write( 'Case 1 Run!' ).
        out->write( 'Hello World UFH8N!' ).
*        out->write( 'Hello World UFH8N!' ).
        "out->write( 'Hello World UFH8N!' ).

        "CTRL + zooms in, not comments out
        "CTRL + Shift + zooms in, not comments out and splits screen

        "CTRL + Shift + < does comment out and CTRL + Shift + > un-comments
        out->write( 'Hello World UFH8N!' ).
        out->write( 'Hello World UFH8N!' ).
      WHEN 2.
          out->write( 'Case 2 Run!' ).
*         Data Objects with Built-in Types
*        *********************************************************************

            " comment/uncomment the following declarations and check the output
            DATA variable_s_02 TYPE string.
            DATA variable_i_02 TYPE i.
            DATA variable_d_02 TYPE d.
            DATA variable_c_02 TYPE c LENGTH 10.
            DATA variable_n_02 TYPE n LENGTH 10.
            DATA variable_p_02 TYPE p LENGTH 8 DECIMALS 2.

*         Output
*        *********************************************************************

            out->write( 'Result with Initial Value)' ).
            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            out->write( variable_p_02 ).

            out->write(  '---------' ).

            out->write(  'Result with Values' ).
            variable_s_02 = 'UFH8N'.
            variable_i_02 = 10.
            variable_d_02 = '20251028'.
            variable_c_02 = 'L'.
            variable_n_02 = '3'.
            variable_n_02 = 3. "Not sure if 3 or '3'
            "variable_p_02 = 3.14. "How to do packaged numbers?

            "variable_d_02 = '19891109'.

            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            "out->write( variable_p_02 ).
            out->write(  '---------' ).

      WHEN 3.
          out->write( 'Case 3 Run!' ).

*         Example 1: Local Types
*        *********************************************************************

*         Comment/Uncomment the following lines to change the type of my_var
            TYPES my_type_p_03 TYPE p LENGTH 3 DECIMALS 2.
            TYPES my_type_i_03 TYPE i .
            TYPES my_type_s_03 TYPE string.
            TYPES my_type_n_03 TYPE n length 10.

*         Variable based on local type
            DATA my_variable_n_03 TYPE my_type_n_03.

            out->write(  `my_variable (TYPE MY_TYPE)` ).
            out->write( my_variable_n_03 ).
            "Can't use a TYPE, must be a DATA

*         Example 2: Global Types
*        *********************************************************************

*         Variable based on global type .
            " Place cursor on variable and press F2 or F3
            DATA airport_03 TYPE /dmo/airport_id VALUE 'FRA'. "Char 3

            out->write(  `airport (TYPE /DMO/AIRPORT_ID )` ).
            out->write(   airport_03 ).

*         Example 3: Constants
*        *********************************************************************

            CONSTANTS c_text_03   TYPE string VALUE `Hello World`.
            CONSTANTS c_number_03 TYPE i      VALUE 12345.

            "Uncomment this line to see syntax error ( VALUE is mandatory)
          "constants c_text2   type string. "VALUE ... Not Specified
          "ToDo: Was there not a way to allow initial Constants

            out->write(  `c_text (TYPE STRING)` ).
            out->write(   c_text_03 ).
            out->write(  '---------' ).

            out->write(  `c_number (TYPE I )` ).
            out->write(   c_number_03 ).
            out->write(  `---------` ).

*         Example 4: Literals
*        *********************************************************************

            out->write(  '12345               ' ).    "Text Literal   (Type C)
            out->write(  `12345               ` ).    "String Literal (Type STRING)
            out->write(  12345                  ).    "Number Literal (Type I)

            "uncomment this line to see syntax error (no number literal with digits)
            "out->write(  12345.67                  ). "Ended unexpectedly

      WHEN 4.
          out->write( 'Case 4 Run!' ).
*         Declarations
*        *********************************************************************

            " comment/uncomment these line for different result types
            TYPES t_result_1_04 TYPE p LENGTH 8 DECIMALS 2.
            TYPES t_result_2_04 TYPE p LENGTH 8 DECIMALS 0.
            TYPES t_result_3_04 TYPE i.

            DATA result_1_04 TYPE t_result_1_04.
            DATA result_2_04 TYPE t_result_2_04.
            DATA result_3_04 TYPE t_result_3_04.

*         Calculations
*        *********************************************************************
            " comment/uncomment these lines for different calculations
            out->write( '_____________________________________' ).

            result_1_04 = 2 + 3.
            result_2_04 = 2 + 3.
            result_3_04 = 2 + 3.
            out->write( '2 + 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 - 3.
            result_2_04 = 2 - 3.
            result_3_04 = 2 - 3.
            out->write( '2 - 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 * 3.
            result_2_04 = 2 * 3.
            result_3_04 = 2 * 3.
            out->write( '2 * 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 / 3.
            result_2_04 = 2 / 3.
            result_3_04 = 2 / 3.
            out->write( '2 / 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = sqrt( 2 ).
            result_2_04 = sqrt( 2 ).
            result_3_04 = sqrt( 2 ).
            out->write( 'sqrt( 2 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = ipow( base = 2 exp = 3 ).
            result_2_04 = ipow( base = 2 exp = 3 ).
            result_3_04 = ipow( base = 2 exp = 3 ).
            out->write( 'ipow( base = 2 exp = 3 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_2_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_3_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            out->write( '( 8 * 7 - 6 ) / ( 5 + 4 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 8 * 7 - 6 / 5 + 4.
            result_2_04 = 8 * 7 - 6 / 5 + 4.
            result_3_04 = 8 * 7 - 6 / 5 + 4.
            out->write( '8 * 7 - 6 / 5 + 4' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

*         Output
*        *********************************************************************
      WHEN 5.
          out->write( 'Case 5 Run!' ).
*         Declarations
*        *********************************************************************
            TYPES t_amount_05 TYPE  p LENGTH 8 DECIMALS 2.

            DATA amount_05   TYPE t_amount_05 VALUE '3.30'. "3.3
            DATA amount1_05  TYPE t_amount_05 VALUE '1.20'. "1.2
            DATA amount2_05  TYPE t_amount_05 VALUE '2.10'. "2.1

            DATA the_date_05  TYPE d                     VALUE '19891109'. "1989-11-09
            DATA my_number_05 TYPE p LENGTH 3 DECIMALS 2 VALUE '-273.15'.  "-273.15

            DATA part1_05 TYPE string VALUE `Hello`.    "Hello
            DATA part2_05 TYPE string VALUE `World`.    "World

            out->write( '_____________________________________' ).

            out->write( amount_05 ).    "3.3
            out->write( amount1_05 ).   "1.2
            out->write( amount2_05 ).   "2.1
            out->write( the_date_05 ).  "1989-11-09
            out->write( my_number_05 ). "-273.15
            out->write( part1_05 ).     "Hello
            out->write( part2_05 ).     "World

            out->write( '_____________________________________' ).

*         String Templates
*        *********************************************************************

            " comment/uncomment the following lines for different examples
            DATA(text_1a_05) = |Hello World|.                               "Hello World
            DATA(text_1b_05) = |Total: { amount_05 } EUR|.                  "Total: 3.30 EUR
            DATA(text_1c_05) = |Total: { amount1_05 + amount2_05 } EUR|.    "Total: 3.30 EUR

            out->write( text_1a_05 ).   "Hello World
            out->write( text_1b_05 ).   "Total: 3.30 EUR
            out->write( text_1c_05 ).   "Total: 3.30 EUR

            out->write( '_____________________________________' ).

*         Format Options
*        *********************************************************************

            "Date
            DATA(text_2a_05) = |Raw Date: { the_date_05             }|. "Raw Date: 19891109
            DATA(text_2b_05) = |ISO Date: { the_date_05 Date = ISO  }|. "ISO Date: 1989-11-09
            DATA(text_2c_05) = |USER Date:{ the_date_05 Date = USER }|. "USER Date:11/09/1989

            out->write( text_2a_05 ).   "Raw Date: 19891109
            out->write( text_2b_05 ).   "ISO Date: 1989-11-09
            out->write( text_2c_05 ).   "USER Date:11/09/1989

            out->write( '_____________________________________' ).

            "Number
            DATA(text_3a_05) = |Raw Number { my_number_05                    }|.    "Raw Number -273.15
            DATA(text_3b_05) = |User Format{ my_number_05 NUMBER = USER      }|.    "User Format-273.15
            DATA(text_3c_05) = |Sign Right { my_number_05 SIGN = RIGHT       }|.    "Sign Right 273.15-
            DATA(text_3d_05) = |Scientific { my_number_05 STYLE = SCIENTIFIC }|.    "Scientific -2.7315E+02

            out->write( text_3a_05 ).   "Raw Number -273.15
            out->write( text_3b_05 ).   "User Format-273.15
            out->write( text_3c_05 ).   "Sign Right 273.15-
            out->write( text_3d_05 ).   "Scientific -2.7315E+02

            out->write( '_____________________________________' ).

*         String expression (concatenation Operator)
*        *********************************************************************

            DATA(text_4a_05) = part1_05 && part2_05.
            DATA(text_4b_05)  = part1_05 && | | && part2_05.
            DATA(text_4c_05)  = |{ amount1_05 } + { amount2_05 }| &&
                              | = | &&
                              |{ amount1_05 + amount2_05 }|.

            out->write( text_4a_05 ).   "HelloWorld
            out->write( text_4b_05 ).   "Hello World
            out->write( text_4c_05 ).   "1.20 + 2.10 = 3.30
            out->write( '_____________________________________' ).


*         Output
*        *********************************************************************
            "out->write( text_05 ).
      WHEN 6.
          out->write( 'Case 6 Run!' ).
          "Declare Variables and Process Data
          "ZCL_##_COMPUTE
          DATA number1_06 TYPE i.
          DATA number2_06 TYPE i.
          DATA result_06  TYPE p LENGTH 8 DECIMALS 2.

          number1_06 = -8.
          number2_06 =  3.

          result_06 = number1_06 / number2_06.

          DATA(output_06) = |{ number1_06 } / { number2_06 } = { result_06 }|.

          out->write( output_06 ).

      WHEN 7.
          out->write( 'Case 7 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_07 TYPE i VALUE 0.
*            CONSTANTS c_number_07 TYPE i VALUE 1.
*            CONSTANTS c_number_07 TYPE i VALUE 2.
*            CONSTANTS c_number_07 TYPE i VALUE -1.
*            CONSTANTS c_number_07 TYPE i VALUE -2.

*         Example 1: Simple IF ... ENDIF.
*        *********************************************************************

            out->write(  `--------------------------------` ).
            out->write(  `Example 1: Simple IF ... ENDIF.` ).
            out->write(  `-------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is NOT zero`   ).
            ENDIF.

*         Example 2: Optional Branches ELSEIF and ELSE
*        *********************************************************************

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 2: Optional Branches ELSEIF and ELSE` ).
            out->write(  `--------------------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`            ).
            ELSEIF c_number_07 > 0.
              out->write( `The value of C_NUMBER is greater than zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is less than zero`      ).
            ENDIF.

*         Example 3: CASE ... ENDCASE
*        *********************************************************************

            out->write(  `---------------------------` ).
            out->write(  `Example 3: CASE ... ENDCASE` ).
            out->write(  `---------------------------` ).

            CASE c_number_07.
              WHEN 0.
                out->write( `The value of C_NUMBER equals zero`             ).
              WHEN 1.
                out->write( `The value of C_NUMBER equals one`              ).
              WHEN 2.
                out->write( `The value of C_NUMBER equals two`              ).
              WHEN OTHERS.
                out->write( `The value of C_NUMBER equals non of the above` ).
            ENDCASE.

      WHEN 8.
          out->write( 'Case 8 Run!' ).
*         Declarations
*        *********************************************************************
            DATA result_08 TYPE i.

            DATA numbers_08 TYPE TABLE OF i.

*         Preparation
*        *********************************************************************

            APPEND 123 TO numbers_08.

*         Example 1: Conversion Error (no Number)
*        *********************************************************************

            CONSTANTS c_text_08 TYPE string VALUE 'ABC'.
*            CONSTANTS c_text_08 TYPE string VALUE '123'.

            out->write(  `---------------------------` ).
            out->write(  `Example 1: Conversion Error` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = c_text_08.
                out->write( |Converted content is { result_08 }|  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_text_08 } is not a number!| ).
            ENDTRY.

*         Example 2: Division by Zero
*        *********************************************************************

            CONSTANTS c_number_08 TYPE i VALUE 0.
*            CONSTANTS c_number_08 TYPE i VALUE 7.

            out->write(  `---------------------------` ).
            out->write(  `Example 2: Division by Zero` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = 100 / c_number_08.
                out->write( |100 divided by { c_number_08 } equals { result_08 }| ).
              CATCH cx_sy_zerodivide.
                out->write(  `Error: Division by zero is not defined!` ).
            ENDTRY.

*         Example 3: Itab Error (Line Not Found)
*        *********************************************************************

            CONSTANTS c_index_08 TYPE i VALUE 2.
*            CONSTANTS c_index_08 TYPE i VALUE 1.

            out->write(  `-------------------------` ).
            out->write(  `Example 3: Line Not Found` ).
            out->write(  `-------------------------` ).

            TRY.
                result_08 = numbers_08[ c_index_08 ].
                out->write( |Content of row { c_index_08 } equals { result_08 }| ).
              CATCH cx_sy_itab_line_not_found.
                out->write(  `Error: Itab has less than { c_index } rows!` ).
            ENDTRY.


*         Example 4: Combination of Different Exceptions
*        *********************************************************************
*            CONSTANTS c_char TYPE c LENGTH 1 VALUE 'X'.
*            CONSTANTS c_char TYPE c length 1 value '0'.
            CONSTANTS c_char_08 TYPE c LENGTH 1 VALUE '1'.
*            CONSTANTS c_char TYPE c length 1 value '2'.

            out->write(  `----------------------` ).
            out->write(  `Example 4: Combination` ).
            out->write(  `----------------------` ).

            TRY.
                result_08 = numbers_08[ 2 / c_char_08 ].
                out->write( |Result: { result_08 } | ).
              CATCH cx_sy_zerodivide.
                out->write( `Error: Division by zero is not defined`  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_char_08 } is not a number! | ).
              CATCH cx_sy_itab_line_not_found.
                out->write( |Error: Itab contains less than { 2 / c_char_08 } rows| ).
            ENDTRY.

      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.

      WHEN 10.
          out->write( 'Case 10 Run!' ).

*         Declarations
*        *********************************************************************

            " Internal tables
            DATA numbers_10 TYPE TABLE OF i.

            "Table type (local)
            TYPES tt_strings_10 TYPE TABLE OF string.
            DATA texts1_10      TYPE tt_strings_10.

            " Table type (global)
            DATA texts2_10 TYPE string_table.

            " work areas
            DATA number_10 TYPE i VALUE 1234.
            DATA text_10   TYPE string.

*         Example 1: APPEND
*        *********************************************************************

            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `-----------------` ).
            out->write(  `Example 1: APPEND` ).
            out->write(  `-----------------` ).

            out->write( numbers_10 ).

*         Example 2: CLEAR
*        *********************************************************************

            CLEAR numbers_10.

            out->write(  `----------------` ).
            out->write(  `Example 2: CLEAR` ).
            out->write(  `----------------` ).

            out->write( numbers_10 ).

*         Example 3: table expression
*        *********************************************************************
            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `---------------------------` ).
            out->write(  `Example 3: Table Expression` ).
            out->write(  `---------------------------` ).

            number_10 = numbers_10[ 2 ] .

            out->write( |Content of row 2: { number_10 }|    ).
            "Direct use of expression in string template
            out->write( |Content of row 1: { numbers_10[ 1 ]  }| ).

*         Example 4: LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `---------------------------` ).
            out->write(  `Example 4: LOOP ... ENDLOOP` ).
            out->write(  `---------------------------` ).

            LOOP AT numbers_10 INTO number_10.

              out->write( |Row: { sy-tabix } Content { number_10 }| ).

            ENDLOOP.

*         Example 5: Inline declaration in LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `-----------------------------` ).
            out->write(  `Example 5: Inline Declaration` ).
            out->write(  `-----------------------------` ).

            LOOP AT numbers_10 INTO DATA(number_inline_10).
              out->write( |Row: { sy-tabix } Content { number_inline_10 }| ).
            ENDLOOP.

      WHEN 11.
          out->write( 'Case 11 Run!' ).
          " ZCL_##_ITERATE
          CONSTANTS max_count_11 TYPE i VALUE 20.
          DATA numbers_11 TYPE TABLE OF i.

          DATA output_11 TYPE TABLE OF string. "Guess
          "DATA loop_count TYPE INT4.        "Guess

          DO max_count_11 TIMES.
            CASE sy-index.
              WHEN 1.
                APPEND 0 TO numbers_11.
              WHEN 2.
                APPEND 1 TO numbers_11.
              WHEN OTHERS.
                  APPEND numbers_11[  sy-index - 2 ]
                       + numbers_11[  sy-index - 1 ]
                      TO numbers_11.
            ENDCASE.

          ENDDO.

          DATA(counter_11) = 0.
          LOOP AT numbers_11 INTO DATA(number).
            counter_11 = counter_11 + 1.
            APPEND |{ counter_11 WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output_11.
          ENDLOOP.

         out->write(
         data   = output_11
         name   = |The first { max_count_11 } Fibonacci Numbers|
                ) .

      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          lcl_ufh8n_connection_12 = new #( ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          carrier_id_12    = 'QA'.
          connection_id_12 = '0200'.
          out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          out->write(  |i_connection_id = '{ connection_id_12 }'| ).

        TRY.
            lcl_ufh8n_connection_12->set_attributes(
              EXPORTING
                i_carrier_id    = carrier_id_12
                i_connection_id = connection_id_12
            ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'AA'.
          lcl_ufh8n_connection_12->connection_id = '0017'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          lcl_ufh8n_connection_12->connection_id = '0001'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

      WHEN 13.
          out->write( 'Case 13 Run!' ).

          "ZCL__01_INSTANCE_ITAB
      WHEN OTHERS.
        out->write( 'Please enter a valid value for the CASE!' ).
    ENDCASE.
  ENDMETHOD.
ENDCLASS.
</pre>

<h3 id="Code_List_06">Local Class lcl_ufh8n_connection | Again</h3>
<pre class="pre-green">
" Local Class

*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id,
               set_attributes IMPORTING
                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
                 i_connection_id TYPE /dmo/connection_id
                 RAISING cx_abap_invalid_value.

      CLASS-DATA conn_counter TYPE i.



  PROTECTED SECTION.
  PRIVATE SECTION.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

  METHOD set_attributes.
    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    carrier_id    = i_carrier_id.
    connection_id = i_connection_id.
  ENDMETHOD.

ENDCLASS.


</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex31">Exercise 31 - Functional Methods</h2>
<pre class="pre-green">
      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          lcl_ufh8n_connection_12 = new #( ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          "carrier_id_12    = 'QA'.
          "connection_id_12 = '0200'.

          out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          out->write(  |i_connection_id = '{ connection_id_12 }'| ).

        TRY.
            lcl_ufh8n_connection_12->set_attributes(
              EXPORTING
                i_carrier_id    = 'LH'
                i_connection_id = '0400'
            ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = new #( ).
          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'LH'.
          lcl_ufh8n_connection_12->connection_id = '0400'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'AA'.
          lcl_ufh8n_connection_12->connection_id = '0017'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          lcl_ufh8n_connection_12 = new #( ).
          lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          lcl_ufh8n_connection_12->connection_id = '0001'.
          APPEND lcl_ufh8n_connection_12 TO connections_12.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

          "For Exercise 31 - Functional Methods
          out->write( `Exercise 31`     ).
          " in a value assignment (with inline declaration for result)
          " I had to rewrite a bit
          DATA(result_12) = lcl_ufh8n_connection_12->get_output( ).

          " in logical expression
          IF connections_12 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_12 INTO DATA(line_12).
                line_12->get_output(  ).

            "  to supply input parameter of another method
            out->write( data = line_12->get_output( )
                        name = `  ` ).
            ENDLOOP.
          ENDIF.
</pre>

<pre class="pre-green">
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.
      DATA carrier_id         TYPE /dmo/carrier_id.
      DATA connection_id      TYPE /dmo/connection_id.
      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id,
               set_attributes IMPORTING
                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
                 i_connection_id TYPE /dmo/connection_id
                 RAISING cx_abap_invalid_value.

    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table.


      CLASS-DATA conn_counter TYPE i.



  PROTECTED SECTION.
  PRIVATE SECTION.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

  METHOD set_attributes.
    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    carrier_id    = i_carrier_id.
    connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_output.

    APPEND |------------------------------| TO r_output.
    APPEND |Carrier:     { carrier_id    }| TO r_output.
    APPEND |Connection:  { connection_id }| TO r_output.

  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-green">
Case 12 Run!
i_carrier_id    = '' 
i_connection_id = '0000'
Method call successful
Flight Connection LH 0400
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Exercise 31

------------------------------  
Carrier:     LH                 
Connection:  0400               

------------------------------  
Carrier:     LH                 
Connection:  0400               

------------------------------  
Carrier:     AA                 
Connection:  0017               

------------------------------  
Carrier:     SQ                 
Connection:  0001      
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex32">Exercise 32 - Define and Call Methods</h2>
<pre class="pre-green">
No Code !
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex33">Exercise 33 - How To Use Private Attributes</h2>
<pre class="pre-green">
No Code !
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex34">Exercise 34 - How To Define An Instance Constructor</h2>
<pre class="pre-green">
No Code !
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex35">Exercise 35 - How To Debug The Execution Of Constructors</h2>
<pre class="pre-green">
No Code !
</pre>

<h2 id="Part1_SubPart1_PracSyst_Ex36">Exercise 36 - Use Private Attributes and a Constructor</h2>
<pre class="pre-green">
No Code !
</pre>

<h3 id="Code_List_07">Globl Class zcl_ufh8n_hello_world | (From Exercise 36)</h3>
<pre class="pre-green">
" ZCL_UFH8N_HELLO_WORLD
" When done my code is:
" ZCL_UFH8N_HELLO_WORLD
" Global Class

CLASS zcl_ufh8n_hello_world DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_hello_world IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA lv_switch TYPE int4.
    lv_switch = 12.

    CASE lv_switch.
      WHEN 1.
        out->write( 'Case 1 Run!' ).
        out->write( 'Hello World UFH8N!' ).
*        out->write( 'Hello World UFH8N!' ).
        "out->write( 'Hello World UFH8N!' ).

        "CTRL + zooms in, not comments out
        "CTRL + Shift + zooms in, not comments out and splits screen

        "CTRL + Shift + < does comment out and CTRL + Shift + > un-comments
        out->write( 'Hello World UFH8N!' ).
        out->write( 'Hello World UFH8N!' ).
      WHEN 2.
          out->write( 'Case 2 Run!' ).
*         Data Objects with Built-in Types
*        *********************************************************************

            " comment/uncomment the following declarations and check the output
            DATA variable_s_02 TYPE string.
            DATA variable_i_02 TYPE i.
            DATA variable_d_02 TYPE d.
            DATA variable_c_02 TYPE c LENGTH 10.
            DATA variable_n_02 TYPE n LENGTH 10.
            DATA variable_p_02 TYPE p LENGTH 8 DECIMALS 2.

*         Output
*        *********************************************************************

            out->write( 'Result with Initial Value)' ).
            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            out->write( variable_p_02 ).

            out->write(  '---------' ).

            out->write(  'Result with Values' ).
            variable_s_02 = 'UFH8N'.
            variable_i_02 = 10.
            variable_d_02 = '20251028'.
            variable_c_02 = 'L'.
            variable_n_02 = '3'.
            variable_n_02 = 3. "Not sure if 3 or '3'
            "variable_p_02 = 3.14. "How to do packaged numbers?

            "variable_d_02 = '19891109'.

            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            "out->write( variable_p_02 ).
            out->write(  '---------' ).

      WHEN 3.
          out->write( 'Case 3 Run!' ).

*         Example 1: Local Types
*        *********************************************************************

*         Comment/Uncomment the following lines to change the type of my_var
            TYPES my_type_p_03 TYPE p LENGTH 3 DECIMALS 2.
            TYPES my_type_i_03 TYPE i .
            TYPES my_type_s_03 TYPE string.
            TYPES my_type_n_03 TYPE n length 10.

*         Variable based on local type
            DATA my_variable_n_03 TYPE my_type_n_03.

            out->write(  `my_variable (TYPE MY_TYPE)` ).
            out->write( my_variable_n_03 ).
            "Can't use a TYPE, must be a DATA

*         Example 2: Global Types
*        *********************************************************************

*         Variable based on global type .
            " Place cursor on variable and press F2 or F3
            DATA airport_03 TYPE /dmo/airport_id VALUE 'FRA'. "Char 3

            out->write(  `airport (TYPE /DMO/AIRPORT_ID )` ).
            out->write(   airport_03 ).

*         Example 3: Constants
*        *********************************************************************

            CONSTANTS c_text_03   TYPE string VALUE `Hello World`.
            CONSTANTS c_number_03 TYPE i      VALUE 12345.

            "Uncomment this line to see syntax error ( VALUE is mandatory)
          "constants c_text2   type string. "VALUE ... Not Specified
          "ToDo: Was there not a way to allow initial Constants

            out->write(  `c_text (TYPE STRING)` ).
            out->write(   c_text_03 ).
            out->write(  '---------' ).

            out->write(  `c_number (TYPE I )` ).
            out->write(   c_number_03 ).
            out->write(  `---------` ).

*         Example 4: Literals
*        *********************************************************************

            out->write(  '12345               ' ).    "Text Literal   (Type C)
            out->write(  `12345               ` ).    "String Literal (Type STRING)
            out->write(  12345                  ).    "Number Literal (Type I)

            "uncomment this line to see syntax error (no number literal with digits)
            "out->write(  12345.67                  ). "Ended unexpectedly

      WHEN 4.
          out->write( 'Case 4 Run!' ).
*         Declarations
*        *********************************************************************

            " comment/uncomment these line for different result types
            TYPES t_result_1_04 TYPE p LENGTH 8 DECIMALS 2.
            TYPES t_result_2_04 TYPE p LENGTH 8 DECIMALS 0.
            TYPES t_result_3_04 TYPE i.

            DATA result_1_04 TYPE t_result_1_04.
            DATA result_2_04 TYPE t_result_2_04.
            DATA result_3_04 TYPE t_result_3_04.

*         Calculations
*        *********************************************************************
            " comment/uncomment these lines for different calculations
            out->write( '_____________________________________' ).

            result_1_04 = 2 + 3.
            result_2_04 = 2 + 3.
            result_3_04 = 2 + 3.
            out->write( '2 + 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 - 3.
            result_2_04 = 2 - 3.
            result_3_04 = 2 - 3.
            out->write( '2 - 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 * 3.
            result_2_04 = 2 * 3.
            result_3_04 = 2 * 3.
            out->write( '2 * 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 / 3.
            result_2_04 = 2 / 3.
            result_3_04 = 2 / 3.
            out->write( '2 / 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = sqrt( 2 ).
            result_2_04 = sqrt( 2 ).
            result_3_04 = sqrt( 2 ).
            out->write( 'sqrt( 2 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = ipow( base = 2 exp = 3 ).
            result_2_04 = ipow( base = 2 exp = 3 ).
            result_3_04 = ipow( base = 2 exp = 3 ).
            out->write( 'ipow( base = 2 exp = 3 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_2_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_3_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            out->write( '( 8 * 7 - 6 ) / ( 5 + 4 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 8 * 7 - 6 / 5 + 4.
            result_2_04 = 8 * 7 - 6 / 5 + 4.
            result_3_04 = 8 * 7 - 6 / 5 + 4.
            out->write( '8 * 7 - 6 / 5 + 4' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

*         Output
*        *********************************************************************
      WHEN 5.
          out->write( 'Case 5 Run!' ).
*         Declarations
*        *********************************************************************
            TYPES t_amount_05 TYPE  p LENGTH 8 DECIMALS 2.

            DATA amount_05   TYPE t_amount_05 VALUE '3.30'. "3.3
            DATA amount1_05  TYPE t_amount_05 VALUE '1.20'. "1.2
            DATA amount2_05  TYPE t_amount_05 VALUE '2.10'. "2.1

            DATA the_date_05  TYPE d                     VALUE '19891109'. "1989-11-09
            DATA my_number_05 TYPE p LENGTH 3 DECIMALS 2 VALUE '-273.15'.  "-273.15

            DATA part1_05 TYPE string VALUE `Hello`.    "Hello
            DATA part2_05 TYPE string VALUE `World`.    "World

            out->write( '_____________________________________' ).

            out->write( amount_05 ).    "3.3
            out->write( amount1_05 ).   "1.2
            out->write( amount2_05 ).   "2.1
            out->write( the_date_05 ).  "1989-11-09
            out->write( my_number_05 ). "-273.15
            out->write( part1_05 ).     "Hello
            out->write( part2_05 ).     "World

            out->write( '_____________________________________' ).

*         String Templates
*        *********************************************************************

            " comment/uncomment the following lines for different examples
            DATA(text_1a_05) = |Hello World|.                               "Hello World
            DATA(text_1b_05) = |Total: { amount_05 } EUR|.                  "Total: 3.30 EUR
            DATA(text_1c_05) = |Total: { amount1_05 + amount2_05 } EUR|.    "Total: 3.30 EUR

            out->write( text_1a_05 ).   "Hello World
            out->write( text_1b_05 ).   "Total: 3.30 EUR
            out->write( text_1c_05 ).   "Total: 3.30 EUR

            out->write( '_____________________________________' ).

*         Format Options
*        *********************************************************************

            "Date
            DATA(text_2a_05) = |Raw Date: { the_date_05             }|. "Raw Date: 19891109
            DATA(text_2b_05) = |ISO Date: { the_date_05 Date = ISO  }|. "ISO Date: 1989-11-09
            DATA(text_2c_05) = |USER Date:{ the_date_05 Date = USER }|. "USER Date:11/09/1989

            out->write( text_2a_05 ).   "Raw Date: 19891109
            out->write( text_2b_05 ).   "ISO Date: 1989-11-09
            out->write( text_2c_05 ).   "USER Date:11/09/1989

            out->write( '_____________________________________' ).

            "Number
            DATA(text_3a_05) = |Raw Number { my_number_05                    }|.    "Raw Number -273.15
            DATA(text_3b_05) = |User Format{ my_number_05 NUMBER = USER      }|.    "User Format-273.15
            DATA(text_3c_05) = |Sign Right { my_number_05 SIGN = RIGHT       }|.    "Sign Right 273.15-
            DATA(text_3d_05) = |Scientific { my_number_05 STYLE = SCIENTIFIC }|.    "Scientific -2.7315E+02

            out->write( text_3a_05 ).   "Raw Number -273.15
            out->write( text_3b_05 ).   "User Format-273.15
            out->write( text_3c_05 ).   "Sign Right 273.15-
            out->write( text_3d_05 ).   "Scientific -2.7315E+02

            out->write( '_____________________________________' ).

*         String expression (concatenation Operator)
*        *********************************************************************

            DATA(text_4a_05) = part1_05 && part2_05.
            DATA(text_4b_05)  = part1_05 && | | && part2_05.
            DATA(text_4c_05)  = |{ amount1_05 } + { amount2_05 }| &&
                              | = | &&
                              |{ amount1_05 + amount2_05 }|.

            out->write( text_4a_05 ).   "HelloWorld
            out->write( text_4b_05 ).   "Hello World
            out->write( text_4c_05 ).   "1.20 + 2.10 = 3.30
            out->write( '_____________________________________' ).


*         Output
*        *********************************************************************
            "out->write( text_05 ).
      WHEN 6.
          out->write( 'Case 6 Run!' ).
          "Declare Variables and Process Data
          "ZCL_##_COMPUTE
          DATA number1_06 TYPE i.
          DATA number2_06 TYPE i.
          DATA result_06  TYPE p LENGTH 8 DECIMALS 2.

          number1_06 = -8.
          number2_06 =  3.

          result_06 = number1_06 / number2_06.

          DATA(output_06) = |{ number1_06 } / { number2_06 } = { result_06 }|.

          out->write( output_06 ).

      WHEN 7.
          out->write( 'Case 7 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_07 TYPE i VALUE 0.
*            CONSTANTS c_number_07 TYPE i VALUE 1.
*            CONSTANTS c_number_07 TYPE i VALUE 2.
*            CONSTANTS c_number_07 TYPE i VALUE -1.
*            CONSTANTS c_number_07 TYPE i VALUE -2.

*         Example 1: Simple IF ... ENDIF.
*        *********************************************************************

            out->write(  `--------------------------------` ).
            out->write(  `Example 1: Simple IF ... ENDIF.` ).
            out->write(  `-------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is NOT zero`   ).
            ENDIF.

*         Example 2: Optional Branches ELSEIF and ELSE
*        *********************************************************************

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 2: Optional Branches ELSEIF and ELSE` ).
            out->write(  `--------------------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`            ).
            ELSEIF c_number_07 > 0.
              out->write( `The value of C_NUMBER is greater than zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is less than zero`      ).
            ENDIF.

*         Example 3: CASE ... ENDCASE
*        *********************************************************************

            out->write(  `---------------------------` ).
            out->write(  `Example 3: CASE ... ENDCASE` ).
            out->write(  `---------------------------` ).

            CASE c_number_07.
              WHEN 0.
                out->write( `The value of C_NUMBER equals zero`             ).
              WHEN 1.
                out->write( `The value of C_NUMBER equals one`              ).
              WHEN 2.
                out->write( `The value of C_NUMBER equals two`              ).
              WHEN OTHERS.
                out->write( `The value of C_NUMBER equals non of the above` ).
            ENDCASE.

      WHEN 8.
          out->write( 'Case 8 Run!' ).
*         Declarations
*        *********************************************************************
            DATA result_08 TYPE i.

            DATA numbers_08 TYPE TABLE OF i.

*         Preparation
*        *********************************************************************

            APPEND 123 TO numbers_08.

*         Example 1: Conversion Error (no Number)
*        *********************************************************************

            CONSTANTS c_text_08 TYPE string VALUE 'ABC'.
*            CONSTANTS c_text_08 TYPE string VALUE '123'.

            out->write(  `---------------------------` ).
            out->write(  `Example 1: Conversion Error` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = c_text_08.
                out->write( |Converted content is { result_08 }|  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_text_08 } is not a number!| ).
            ENDTRY.

*         Example 2: Division by Zero
*        *********************************************************************

            CONSTANTS c_number_08 TYPE i VALUE 0.
*            CONSTANTS c_number_08 TYPE i VALUE 7.

            out->write(  `---------------------------` ).
            out->write(  `Example 2: Division by Zero` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = 100 / c_number_08.
                out->write( |100 divided by { c_number_08 } equals { result_08 }| ).
              CATCH cx_sy_zerodivide.
                out->write(  `Error: Division by zero is not defined!` ).
            ENDTRY.

*         Example 3: Itab Error (Line Not Found)
*        *********************************************************************

            CONSTANTS c_index_08 TYPE i VALUE 2.
*            CONSTANTS c_index_08 TYPE i VALUE 1.

            out->write(  `-------------------------` ).
            out->write(  `Example 3: Line Not Found` ).
            out->write(  `-------------------------` ).

            TRY.
                result_08 = numbers_08[ c_index_08 ].
                out->write( |Content of row { c_index_08 } equals { result_08 }| ).
              CATCH cx_sy_itab_line_not_found.
                out->write(  `Error: Itab has less than { c_index } rows!` ).
            ENDTRY.


*         Example 4: Combination of Different Exceptions
*        *********************************************************************
*            CONSTANTS c_char TYPE c LENGTH 1 VALUE 'X'.
*            CONSTANTS c_char TYPE c length 1 value '0'.
            CONSTANTS c_char_08 TYPE c LENGTH 1 VALUE '1'.
*            CONSTANTS c_char TYPE c length 1 value '2'.

            out->write(  `----------------------` ).
            out->write(  `Example 4: Combination` ).
            out->write(  `----------------------` ).

            TRY.
                result_08 = numbers_08[ 2 / c_char_08 ].
                out->write( |Result: { result_08 } | ).
              CATCH cx_sy_zerodivide.
                out->write( `Error: Division by zero is not defined`  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_char_08 } is not a number! | ).
              CATCH cx_sy_itab_line_not_found.
                out->write( |Error: Itab contains less than { 2 / c_char_08 } rows| ).
            ENDTRY.

      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.

      WHEN 10.
          out->write( 'Case 10 Run!' ).

*         Declarations
*        *********************************************************************

            " Internal tables
            DATA numbers_10 TYPE TABLE OF i.

            "Table type (local)
            TYPES tt_strings_10 TYPE TABLE OF string.
            DATA texts1_10      TYPE tt_strings_10.

            " Table type (global)
            DATA texts2_10 TYPE string_table.

            " work areas
            DATA number_10 TYPE i VALUE 1234.
            DATA text_10   TYPE string.

*         Example 1: APPEND
*        *********************************************************************

            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `-----------------` ).
            out->write(  `Example 1: APPEND` ).
            out->write(  `-----------------` ).

            out->write( numbers_10 ).

*         Example 2: CLEAR
*        *********************************************************************

            CLEAR numbers_10.

            out->write(  `----------------` ).
            out->write(  `Example 2: CLEAR` ).
            out->write(  `----------------` ).

            out->write( numbers_10 ).

*         Example 3: table expression
*        *********************************************************************
            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `---------------------------` ).
            out->write(  `Example 3: Table Expression` ).
            out->write(  `---------------------------` ).

            number_10 = numbers_10[ 2 ] .

            out->write( |Content of row 2: { number_10 }|    ).
            "Direct use of expression in string template
            out->write( |Content of row 1: { numbers_10[ 1 ]  }| ).

*         Example 4: LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `---------------------------` ).
            out->write(  `Example 4: LOOP ... ENDLOOP` ).
            out->write(  `---------------------------` ).

            LOOP AT numbers_10 INTO number_10.

              out->write( |Row: { sy-tabix } Content { number_10 }| ).

            ENDLOOP.

*         Example 5: Inline declaration in LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `-----------------------------` ).
            out->write(  `Example 5: Inline Declaration` ).
            out->write(  `-----------------------------` ).

            LOOP AT numbers_10 INTO DATA(number_inline_10).
              out->write( |Row: { sy-tabix } Content { number_inline_10 }| ).
            ENDLOOP.

      WHEN 11.
          out->write( 'Case 11 Run!' ).
          " ZCL_##_ITERATE
          CONSTANTS max_count_11 TYPE i VALUE 20.
          DATA numbers_11 TYPE TABLE OF i.

          DATA output_11 TYPE TABLE OF string. "Guess
          "DATA loop_count TYPE INT4.        "Guess

          DO max_count_11 TIMES.
            CASE sy-index.
              WHEN 1.
                APPEND 0 TO numbers_11.
              WHEN 2.
                APPEND 1 TO numbers_11.
              WHEN OTHERS.
                  APPEND numbers_11[  sy-index - 2 ]
                       + numbers_11[  sy-index - 1 ]
                      TO numbers_11.
            ENDCASE.

          ENDDO.

          DATA(counter_11) = 0.
          LOOP AT numbers_11 INTO DATA(number).
            counter_11 = counter_11 + 1.
            APPEND |{ counter_11 WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output_11.
          ENDLOOP.

         out->write(
         data   = output_11
         name   = |The first { max_count_11 } Fibonacci Numbers|
                ) .

      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA lv_str_tbl_12 TYPE string_table.
          APPEND |This covers a range of exercises:| TO lv_str_tbl_12.
          APPEND |How To Create A Local Class In A Global Class| TO lv_str_tbl_12.
          APPEND |Define a Local Class | TO lv_str_tbl_12.
          APPEND |How to Create Instances of an ABAP Class| TO lv_str_tbl_12.
          APPEND |How To Manage Instances in an Internal Table| TO lv_str_tbl_12.
          APPEND |Create and Manage Instances| TO lv_str_tbl_12.
          APPEND |How to Define Methods| TO lv_str_tbl_12.
          APPEND |How to Implement Methods| TO lv_str_tbl_12.
          APPEND |How to Call Methods| TO lv_str_tbl_12.
          APPEND |Method Calls and Exception Handling| TO lv_str_tbl_12.
          APPEND |Functional Methods| TO lv_str_tbl_12.
          APPEND |Define and Call Methods| TO lv_str_tbl_12.
          APPEND |How To Use Private Attributes| TO lv_str_tbl_12.
          APPEND |How To Define An Instance Constructor| TO lv_str_tbl_12.
          APPEND |How To Debug The Execution Of Constructors| TO lv_str_tbl_12.
          APPEND |Use Private Attributes and a Constructor| TO lv_str_tbl_12.
          APPEND |* * * * * * * * | TO lv_str_tbl_12.
          APPEND |Use of Static Constructor was not disccused.| TO lv_str_tbl_12.
          out->write( lv_str_tbl_12 ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          "carrier_id_12    = 'QA'.
          "connection_id_12 = '0200'.

          "out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ connection_id_12 }'| ).

          "lcl_ufh8n_connection_b_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12->carrier_id = 'LH'.
          "lcl_ufh8n_connection_12->connection_id = '0400'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.


        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'LH'
*                i_connection_id = '0400'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
          "lcl_ufh8n_connection_12->carrier_id = 'AA'.
          "lcl_ufh8n_connection_12->connection_id = '0017'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
          "lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          "lcl_ufh8n_connection_12->connection_id = '0001'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'SQ'
*                i_connection_id = '0001'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        "lcl_ufh8n_connection_12 = new #( ).
        "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

          "For Exercise 31 - Functional Methods
          "out->write( `Exercise 31`     ).
          " in a value assignment (with inline declaration for result)
          " I had to rewrite a bit
          DATA(result_12) = lcl_ufh8n_connection_12->get_output( ).

          " in logical expression
          IF connections_12 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_12 INTO DATA(line_12).

                out->write( line_12->get_output(  ) ).

            "  to supply input parameter of another method
            "out->write( data = line_12->get_output( )
            "            name = `  ` ).
            ENDLOOP.
          ENDIF.




      WHEN 13.
          out->write( 'Case 13 Run!' ).

          "ZCL__01_INSTANCE_ITAB
      WHEN OTHERS.
        out->write( 'Please enter a valid value for the CASE!' ).
    ENDCASE.
  ENDMETHOD.
ENDCLASS.
</pre>

<h3 id="Code_List_08">Local Class lcl_ufh8n_connection | (From Exercise 36)</h3>
<pre class="pre-green">
" Local Class
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.



  PROTECTED SECTION.
  PRIVATE SECTION.
    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

    APPEND |------------------------------| TO r_output.
    APPEND |Carrier:     { carrier_id    }| TO r_output.
    APPEND |Connection:  { connection_id }| TO r_output.

  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-green">
Case 12 Run!
This covers a range of exercises:              
How To Create A Local Class In A Global Class  
Define a Local Class                           
How to Create Instances of an ABAP Class       
How To Manage Instances in an Internal Table   
Create and Manage Instances                    
How to Define Methods                          
How to Implement Methods                       
How to Call Methods                            
Method Calls and Exception Handling            
Functional Methods                             
Define and Call Methods                        
How To Use Private Attributes                  
How To Define An Instance Constructor          
How To Debug The Execution Of Constructors     
Use Private Attributes and a Constructor       
* * * * * * * *                                
Use of Static Constructor was not disccused.   
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------  
Carrier:     LH                 
Connection:  0400               
------------------------------  
Carrier:     AA                 
Connection:  0017               
------------------------------  
Carrier:     SQ                 
Connection:  0001               
------------------------------  
Carrier:     AA                 
Connection:  0017               
</pre>

<h1>END: ABAP 40hr - Part 1 - Sub-Part 1</h1>

<h1 id="ABAP_40hr_Part1_Sub2">ABAP 40hr - Part 1 - Sub-Part 2</h1>
<!-- <h1>40hr - Part 1 - Sub-Part 2</h2> -->
<pre>
Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
This is 188 page, 6.09MB. Training from 04/11/2025 to 04/11/2025.
</pre>
<a href="#Part1_SubPart2_PracSyst_Ex01">Exercise 1 - How to Analyze a Database Table</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex02">Exercise 2 - SELECT Examples</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex03">Exercise 3 - Read Data from a Database Table</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex04">Exercise 4 - How to Analyze a CDS View</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex05">Exercise 5 - Analyze and Use a CDS View Entity</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex06">Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex07">Exercise 7 - Structured Data Types</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex08">Exercise 8 - Access to Structured Data Objects</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex09">Exercise 9 - Structured Data Objects in ABAP SQL</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex10">Exercise 10 - Use a Structured Data Object</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex11">Exercise 11 - Complex Table Types</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex12">Exercise 12 - How To Debug Complex Internal Tables</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex13">Exercise 13 - Filling Complex Internal Tables</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex14">Exercise 14 - Access to Complex Internal Tables</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex15">Exercise 15 - Internal Tables in ABAP SQL</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex16">Exercise 16 - Use a Complex Internal Table</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex17">Exercise 17 - How To Analyze A Business Object</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex18">Exercise 18 - Analyze a Business Object</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex19">Exercise 19 - How to Implement an EML Statement</a></br>
<a href="#Part1_SubPart2_PracSyst_Ex20">Exercise 20- Modify Data Using EML</a></br>

<h2 id="Part1_SubPart2_PracSyst_Ex01">Exercise 1 - How to Analyze a Database Table</h2>
<pre class="pre-cyan">
@EndUserText.label : 'Flight Reference Scenario: Connection'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/connection {

  key client        : abap.clnt not null;
  key carrier_id    : /dmo/carrier_id not null;
  key connection_id : /dmo/connection_id not null;
  airport_from_id   : /dmo/airport_from_id;
  airport_to_id     : /dmo/airport_to_id;
  departure_time    : /dmo/flight_departure_time;
  arrival_time      : /dmo/flight_arrival_time;
  distance          : /dmo/flight_distance;
  distance_unit     : msehi;

}
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex02">Exercise 2 - SELECT Examples</h2>
<pre class="pre-cyan">
" Global
      WHEN 13.
          out->write( 'Case 13 Run!' ).
          "From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx

          "Note: Exercise 1 - How to Analyze a Database Table
          ".. This was a follow along for table /dmo/connection



            "Other Files:   D:\Luke-No_C_Space          | S4D400.docx
            "               C:\Users\luke_\Downloads    | SAP_Training_Exercise.docx
            "               One Drive                   | S4D400 - Basic ABAP Programming – Exercises - Trail System.docx
          "ZCL__01_INSTANCE_ITAB "Random Comment

        "Exercise 2 - SELECT Examples
        DATA airport_from_id_13 TYPE /DMO/airport_from_id.
        DATA airport_to_id_13   TYPE /DMO/airport_to_id.

        DATA airports_13 TYPE TABLE OF /DMO/airport_from_id.

*     Example 1: Single field from Single Record
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id
          WHERE carrier_id    = 'LH'
            AND connection_id = '0400'
            INTO @airport_from_id_13. "Record did exist

        out->write( `----------`  ).
        out->write( `Example 1:`  ).

        out->write( |Flight LH 400 departs from {  airport_from_id_13 }.| ).

*     Example 2: Multiple Fields from Single Record
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id, airport_to_id
          WHERE carrier_id    = 'LH'
            AND connection_id = '0400'
            INTO (  @airport_from_id_13, @airport_to_id_13 ). "Record did exist

        out->write( `----------`  ).
        out->write( `Example 2:`  ).

        out->write( |Flight LH 400 flies from {  airport_from_id_13 } to { airport_to_id_13  }| ).

*     Example 3: Empty Result and sy-subrc
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id
          WHERE carrier_id    = 'XX'
            AND connection_id = '1234'
            INTO @airport_from_id_13. "Record does not exist

        IF sy-subrc = 0.

          out->write( `----------`  ).
          out->write( `Example 3:`  ).
          out->write( |Flight XX 1234 departs from {  airport_from_id_13 }.| ).

        ELSE.

          out->write( `----------`  ).
          out->write( `Example 3:`  ).
          out->write( |There is no flight XX 1234, but still airport_from_id = {  airport_from_id_13 }!| ).

        ENDIF.

        out->write( 'END: Case 13 Run!' ).
</pre>
"
<h2 id="Part1_SubPart2_PracSyst_Ex03">Exercise 3 - Read Data from a Database Table</h2>
<h3 id="Code_List_09">Code Back Up - WHEN 12.</h3>
<pre class="pre-cyan">
"Code Back Up	
"Only the case
" Global
      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA lv_str_tbl_12 TYPE string_table.
          APPEND |This covers a range of exercises:| TO lv_str_tbl_12.
          APPEND |How To Create A Local Class In A Global Class| TO lv_str_tbl_12.
          APPEND |Define a Local Class | TO lv_str_tbl_12.
          APPEND |How to Create Instances of an ABAP Class| TO lv_str_tbl_12.
          APPEND |How To Manage Instances in an Internal Table| TO lv_str_tbl_12.
          APPEND |Create and Manage Instances| TO lv_str_tbl_12.
          APPEND |How to Define Methods| TO lv_str_tbl_12.
          APPEND |How to Implement Methods| TO lv_str_tbl_12.
          APPEND |How to Call Methods| TO lv_str_tbl_12.
          APPEND |Method Calls and Exception Handling| TO lv_str_tbl_12.
          APPEND |Functional Methods| TO lv_str_tbl_12.
          APPEND |Define and Call Methods| TO lv_str_tbl_12.
          APPEND |How To Use Private Attributes| TO lv_str_tbl_12.
          APPEND |How To Define An Instance Constructor| TO lv_str_tbl_12.
          APPEND |How To Debug The Execution Of Constructors| TO lv_str_tbl_12.
          APPEND |Use Private Attributes and a Constructor| TO lv_str_tbl_12.
          "This concludes:
          "Done 30/10/2025 ##Exercise 36 - Use Private Attributes and a Constructor
          "Found in file: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 1 - Exercises.docx
          "Progress now to:
          "Exercise 1 - How to Analyze a Database Table
          "Found in file: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises.docx
          "That will be done in the next WHEN
          APPEND |* * * * * * * * | TO lv_str_tbl_12.
          APPEND |Use of Static Constructor was not disccused.| TO lv_str_tbl_12.
          out->write( lv_str_tbl_12 ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          "carrier_id_12    = 'QA'.
          "connection_id_12 = '0200'.

          "out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ connection_id_12 }'| ).

          "lcl_ufh8n_connection_b_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12->carrier_id = 'LH'.
          "lcl_ufh8n_connection_12->connection_id = '0400'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.


        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'LH'
*                i_connection_id = '0400'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
          "lcl_ufh8n_connection_12->carrier_id = 'AA'.
          "lcl_ufh8n_connection_12->connection_id = '0017'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
          "lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          "lcl_ufh8n_connection_12->connection_id = '0001'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'SQ'
*                i_connection_id = '0001'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        "lcl_ufh8n_connection_12 = new #( ).
        "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

          "For Exercise 31 - Functional Methods
          "out->write( `Exercise 31`     ).
          " in a value assignment (with inline declaration for result)
          " I had to rewrite a bit
          DATA(result_12) = lcl_ufh8n_connection_12->get_output( ).

          " in logical expression
          IF connections_12 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_12 INTO DATA(line_12).

                out->write( line_12->get_output(  ) ).

            "  to supply input parameter of another method
            "out->write( data = line_12->get_output( )
            "            name = `  ` ).
            ENDLOOP.
          ENDIF.

</pre>

<h3 id="Code_List_10">Code Back Up - Loca Class lcl_ufh8n_connection</h3>
<pre class="pre-cyan">
" Code Back Up
" Local
" All the code

*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.



  PROTECTED SECTION.
  PRIVATE SECTION.
    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

    APPEND |------------------------------| TO r_output.
    APPEND |Carrier:     { carrier_id    }| TO r_output.
    APPEND |Connection:  { connection_id }| TO r_output.

  ENDMETHOD.


ENDCLASS.
</pre>


<pre class="pre-cyan">
" This is mine:
@EndUserText.label : 'Flight Reference Scenario: Connection'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/connection {

  key client        : abap.clnt not null;
  key carrier_id    : /dmo/carrier_id not null;
  key connection_id : /dmo/connection_id not null;
  airport_from_id   : /dmo/airport_from_id;
  airport_to_id     : /dmo/airport_to_id;
  departure_time    : /dmo/flight_departure_time;
  arrival_time      : /dmo/flight_arrival_time;
  distance          : /dmo/flight_distance;
  distance_unit     : msehi;

}
</pre>

<pre class="pre-cyan">
" This is mine:
  SELECT SINGLE
    FROM /dmo/connection 
    FIELDS airport_from_id, airport_to_id
    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
    WHERE carrier_id    = @i_carrier_id
      AND connection_id = @i_connection_id 
    INTO ( @airport_from_id, @airport_to_id ). 

</pre>

<h3>Global Code for Exercise 3</h3>
<pre class="pre-cyan">
" Global
      WHEN 14.
          out->write( 'Case 14 Run!' ).
          "Template = /LRN/CL_S4D400_CLS_CONSTRUCTOR | Solution = /LRN/CL_S4D400_DBS_SELECT | ZCL_##_SELECT
          "Please note. I will use the base code that has been cleaned up from WHEN 12.
          "The Local Class lcl_ufh8n_connection will be modified and I will do a backup first.

          out->write( 'Case 14 Run!' ).

          DATA lv_str_tbl_14 TYPE string_table.
          APPEND |From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx| TO lv_str_tbl_14.
          APPEND |Exercise 3 - Read Data from a Database Table:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          out->write( lv_str_tbl_14 ).

          DATA carrier_id_14    TYPE /dmo/carrier_id.
          DATA connection_id_14 TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_14 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_14          TYPE TABLE OF REF TO lcl_ufh8n_connection.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          LOOP AT connections_14  INTO lcl_ufh8n_connection_14.
            lcl_ufh8n_connection_14->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_14
                e_connection_id = connection_id_14 ).
            out->write( |Flight Connection {  carrier_id_14 } { connection_id_14 }| ).
          ENDLOOP.

          DATA(result_14) = lcl_ufh8n_connection_14->get_output( ).

          " in logical expression
          IF connections_14 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_14 INTO DATA(line_14).

                out->write( line_14->get_output(  ) ).
            ENDLOOP.
          ENDIF.
</pre>

<h3>Local Code for Exercise 3</h3>
<pre class="pre-cyan">
" Local
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.



  PROTECTED SECTION.
  PRIVATE SECTION.
    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

    DATA airport_from_id    TYPE /dmo/airport_from_id.
    DATA airport_to_id      TYPE /dmo/airport_to_id.


ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

  SELECT SINGLE
    FROM /dmo/connection
    FIELDS airport_from_id, airport_to_id
    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
    WHERE carrier_id    = @i_carrier_id
      AND connection_id = @i_connection_id
    INTO ( @airport_from_id, @airport_to_id ).

   IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
   ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

    " String Templates
    " Embed the new attributes as expressions into the string templates.
    APPEND |------------------------------|   TO r_output.
    APPEND |Carrier:     { carrier_id    }|   TO r_output.
    APPEND |Connection:  { connection_id }|   TO r_output.
    APPEND |Departure:   { airport_from_id }| TO r_output.
    APPEND |Destination: { airport_to_id   }| TO r_output.


  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-cyan">
Case 14 Run!
Case 14 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx  
Exercise 3 - Read Data from a Database Table:                                                               
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------  
Carrier:     LH                 
Connection:  0400               
Departure:   FRA                
Destination: JFK                
------------------------------  
Carrier:     AA                 
Connection:  0017               
Departure:   MIA                
Destination: HAV                
------------------------------  
Carrier:     SQ                 
Connection:  0001               
Departure:   SFO                
Destination: SIN                
------------------------------  
Carrier:     AA                 
Connection:  0017               
Departure:   MIA                
Destination: HAV                
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex04">Exercise 4 - How to Analyze a CDS View</h2>
<pre class="pre-cyan">
" This is mine
@EndUserText.label : 'Flight Reference Scenario: Connection'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/connection {

  key client        : abap.clnt not null;
  key carrier_id    : /dmo/carrier_id not null;
  key connection_id : /dmo/connection_id not null;
  airport_from_id   : /dmo/airport_from_id;
  airport_to_id     : /dmo/airport_to_id;
  departure_time    : /dmo/flight_departure_time;
  arrival_time      : /dmo/flight_arrival_time;
  distance          : /dmo/flight_distance;
  distance_unit     : msehi;

}
</pre>

<pre class="pre-cyan">
" /DMO/I_CONNECTION_R "Data Definition
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Connection View - CDS Data Model'

define view entity /DMO/I_Connection_R
  as select from /dmo/connection as Connection

  association [1..*] to /DMO/I_Flight_R as _Flight      on  $projection.AirlineID    = _Flight.AirlineID
                                                        and $projection.ConnectionID = _Flight.ConnectionID

  association [1]    to /DMO/I_Carrier  as _Airline     on  $projection.AirlineID = _Airline.AirlineID
  association [1]    to /DMO/I_Airport  as _AirportFrom on  $projection.DepartureAirport = _AirportFrom.AirportID
  association [1]    to /DMO/I_Airport  as _AirportTo   on  $projection.DestinationAirport = _AirportTo.AirportID

{
        @ObjectModel.text.association: '_Airline'
  key   Connection.carrier_id      as AirlineID,
  key   Connection.connection_id   as ConnectionID,

        @ObjectModel.text.association: '_AirportFrom'
        Connection.airport_from_id as DepartureAirport,

        @ObjectModel.text.association: '_AirportTo'
        Connection.airport_to_id   as DestinationAirport,

        Connection.departure_time  as DepartureTime,
        Connection.arrival_time    as ArrivalTime,

//      @Semantics.quantity.unitOfMeasure: 'DistanceUnit'
        Connection.distance        as Distance,
        Connection.distance_unit   as DistanceUnit,

        /* Associations */
        _Flight,
        _Airline,
        _AirportFrom,
        _AirportTo
}
</pre>

<pre class="pre-cyan">
" /DMO/I_CONNECTION "Data Definition
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Connection View - CDS Data Model'

@Search.searchable: true

define view entity /DMO/I_Connection
  as select from /dmo/connection as Connection

  association [1..1] to /DMO/I_Carrier as _Airline            on $projection.AirlineID = _Airline.AirlineID
  association [1..1] to /DMO/I_Airport as _DepartureAirport   on $projection.DepartureAirport = _DepartureAirport.AirportID
  association [1..1] to /DMO/I_Airport as _DestinationAirport on $projection.DestinationAirport = _DestinationAirport.AirportID

{
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @ObjectModel.text.association: '_Airline'
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier', element: 'AirlineID' }, useForValidation: true}]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier_StdVH', element: 'AirlineID' }, useForValidation: true}]
  key Connection.carrier_id      as AirlineID,

      @Search.defaultSearchElement: true
  key Connection.connection_id   as ConnectionID,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_from_id as DepartureAirport,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_to_id   as DestinationAirport,

      Connection.departure_time  as DepartureTime,

      Connection.arrival_time    as ArrivalTime,

      //@Semantics.quantity.unitOfMeasure: 'DistanceUnit'
      Connection.distance        as Distance,

      Connection.distance_unit   as DistanceUnit,

      /* Associations */
      _Airline,
      _DepartureAirport,
      _DestinationAirport
}
</pre>

<pre class="pre-cyan">
" This is mine:
" See above for full code
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Connection View - CDS Data Model'

@Search.searchable: true

define view entity /DMO/I_Connection
  as select from /dmo/connection as Connection

  association [1..1] to /DMO/I_Carrier as _Airline            on $projection.AirlineID = _Airline.AirlineID
</pre>


<h2 id="Part1_SubPart2_PracSyst_Ex05">Exercise 5 - Analyze and Use a CDS View Entity</h2>
<pre class="pre-cyan">
</pre>

<pre class="pre-cyan">
" This is mine
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Connection View - CDS Data Model'

@Search.searchable: true

define view entity /DMO/I_Connection
  as select from /dmo/connection as Connection

  association [1..1] to /DMO/I_Carrier as _Airline            on $projection.AirlineID = _Airline.AirlineID
  association [1..1] to /DMO/I_Airport as _DepartureAirport   on $projection.DepartureAirport = _DepartureAirport.AirportID
  association [1..1] to /DMO/I_Airport as _DestinationAirport on $projection.DestinationAirport = _DestinationAirport.AirportID

{
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @ObjectModel.text.association: '_Airline'
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier', element: 'AirlineID' }, useForValidation: true}]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Carrier_StdVH', element: 'AirlineID' }, useForValidation: true}]
  key Connection.carrier_id      as AirlineID,

      @Search.defaultSearchElement: true
  key Connection.connection_id   as ConnectionID,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_from_id as DepartureAirport,

      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport', element: 'AirportID' }, useForValidation: true }]
      //@Consumption.valueHelpDefinition: [{entity: {name: '/DMO/I_Airport_StdVH', element: 'AirportID' }, useForValidation: true }]
      Connection.airport_to_id   as DestinationAirport,

      Connection.departure_time  as DepartureTime,

      Connection.arrival_time    as ArrivalTime,

      //@Semantics.quantity.unitOfMeasure: 'DistanceUnit'
      Connection.distance        as Distance,

      Connection.distance_unit   as DistanceUnit,

      /* Associations */
      _Airline,
      _DepartureAirport,
      _DestinationAirport
}
</pre>

<pre class="pre-cyan">
" This is mine
  SELECT SINGLE
    FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
    WHERE AirlineID    = @i_carrier_id
      AND ConnectionID = @i_connection_id
    INTO ( @airport_from_id, @airport_to_id, @carrier_name ).
</pre>

<pre class="pre-cyan">
" Global Class – Only the WHEN
      WHEN 14.
          out->write( 'Case 14 Run!' ).
          "Template = /LRN/CL_S4D400_CLS_CONSTRUCTOR | Solution = /LRN/CL_S4D400_DBS_SELECT | ZCL_##_SELECT
          "Template = /LRN/CL_S4D400_DBS_SELECT      | Solution = /LRN/CL_S4D400_DBS_CDS    | ZCL_##_CDS
          "Please note. I will use the base code that has been cleaned up from WHEN 12.
          "The Local Class lcl_ufh8n_connection will be modified and I will do a backup first.

          DATA lv_str_tbl_14 TYPE string_table.
          APPEND |From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:| TO lv_str_tbl_14.
          APPEND |SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples| TO lv_str_tbl_14.
          APPEND |Exercise 3 - Read Data from a Database Table:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:| TO lv_str_tbl_14.
          APPEND |Exercise 5 - Analyze and Use a CDS View Entity| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          out->write( lv_str_tbl_14 ).

          DATA carrier_id_14    TYPE /dmo/carrier_id.
          DATA connection_id_14 TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_14 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_14          TYPE TABLE OF REF TO lcl_ufh8n_connection.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          LOOP AT connections_14  INTO lcl_ufh8n_connection_14.
            lcl_ufh8n_connection_14->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_14
                e_connection_id = connection_id_14 ).
            out->write( |Flight Connection {  carrier_id_14 } { connection_id_14 }| ).
          ENDLOOP.

          DATA(result_14) = lcl_ufh8n_connection_14->get_output( ).

          " in logical expression
          IF connections_14 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_14 INTO DATA(line_14).

                out->write( line_14->get_output(  ) ).
            ENDLOOP.
          ENDIF.
</pre>

<pre class="pre-cyan">
" Local Class All
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.



  PROTECTED SECTION.
  PRIVATE SECTION.
    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

    DATA airport_from_id    TYPE /dmo/airport_from_id.
    DATA airport_to_id      TYPE /dmo/airport_to_id.
    DATA carrier_name       TYPE /dmo/carrier_name.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*  SELECT SINGLE
*    FROM /dmo/connection
*    FIELDS airport_from_id, airport_to_id
*    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
*    WHERE carrier_id    = @i_carrier_id
*      AND connection_id = @i_connection_id
*    INTO ( @airport_from_id, @airport_to_id ).

  SELECT SINGLE
    FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
    WHERE AirlineID    = @i_carrier_id
      AND ConnectionID = @i_connection_id
    INTO ( @airport_from_id, @airport_to_id, @carrier_name ).


   IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
   ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

    " String Templates
    " Embed the new attributes as expressions into the string templates.
    APPEND |------------------------------|   TO r_output.
    APPEND |Carrier:     { carrier_id    }|   TO r_output.
    APPEND |Carrier:     { carrier_id } { carrier_name }| TO r_output. "They Said replace line above but whatever
    APPEND |Connection:  { connection_id }|   TO r_output.
    APPEND |Departure:   { airport_from_id }| TO r_output.
    APPEND |Destination: { airport_to_id   }| TO r_output.


  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-cyan">
Case 14 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx  
FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:                                            
SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples                                                      
Exercise 3 - Read Data from a Database Table:                                                               
FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:                                                  
Exercise 5 - Analyze and Use a CDS View Entity                                                              
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------         
Carrier:     LH                        
Carrier:     LH Deutsche Lufthansa AG  
Connection:  0400                      
Departure:   FRA                       
Destination: JFK                       
------------------------------          
Carrier:     AA                         
Carrier:     AA American Airlines Inc.  
Connection:  0017                       
Departure:   MIA                        
Destination: HAV                        
------------------------------              
Carrier:     SQ                             
Carrier:     SQ Singapore Airlines Limited  
Connection:  0001                           
Departure:   SFO                            
Destination: SIN                            
------------------------------          
Carrier:     AA                         
Carrier:     AA American Airlines Inc.  
Connection:  0017                       
Departure:   MIA                        
Destination: HAV                        
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex06">Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective</h2>
<pre class="pre-cyan">
No Code!
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex07">Exercise 7 - Structured Data Types</h2>
<pre class="pre-cyan">
      WHEN 15.
          out->write( 'Case 15 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 7 - Structured Data Types' ).

*         Example 1 : Motivation for Structured Variables
*        *********************************************************************

            DATA connection_full_15 TYPE /DMO/I_Connection.

            SELECT SINGLE
             FROM /dmo/I_Connection
           FIELDS AirlineID, ConnectionID, DepartureAirport, DestinationAirport,
                  DepartureTime, ArrivalTime, Distance, DistanceUnit
            WHERE AirlineId    = 'LH'
              AND ConnectionId = '0400'
             INTO @connection_full_15.

            out->write(  `--------------------------------------` ).
            out->write(  `Example 1: CDS View as Structured Type` ).
            out->write( connection_full_15 ).

*         Example 2: Global Structured Type
*        *********************************************************************

            DATA message_15 TYPE symsg.

            out->write(  `---------------------------------` ).
            out->write(  `Example 2: Global Structured Type` ).
            out->write( message_15 ).

*         Example 3 : Local Structured Type
*        *********************************************************************

            TYPES: BEGIN OF st_connection_15,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_15.

            DATA connection_15 TYPE st_connection_15.

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
             WHERE AirlineID = 'LH'
               AND ConnectionID = '0400'
              INTO @connection_15.

            out->write(  `---------------------------------------` ).
            out->write(  `Example 3: Local Structured Type` ).
            out->write( connection_15 ).

*         Example 4 : Nested Structured Type
*        *********************************************************************

            TYPES: BEGIN OF st_nested_15,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     message         TYPE symsg,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_nested_15.

            DATA connection_nested_15 TYPE st_nested_15.

            out->write(  `---------------------------------` ).
            out->write(  `Example 4: Nested Structured Type` ).
            out->write( connection_nested_15 ).
</pre>
<pre class="pre-cyan">
Case 15 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 7 - Structured Data Types
--------------------------------------
Example 1: CDS View as Structured Type
AIRLINEID  CONNECTIONID  DEPARTUREAIRPORT  DESTINATIONAIRPORT  DEPARTURETIME  ARRIVALTIME  DISTANCE  DISTANCEUNIT  
LH         0400          FRA               JFK                 10:10:00       11:34:00     6162      KM            
---------------------------------
Example 2: Global Structured Type
MSGTY  MSGID  MSGNO  MSGV1  MSGV2  MSGV3  MSGV4  
              000                                
---------------------------------------
Example 3: Local Structured Type
AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME           
FRA              JFK            Deutsche Lufthansa AG  
---------------------------------
Example 4: Nested Structured Type
AIRPORT_FROM_ID    AIRPORT_TO_ID    MESSAGE                                                                    CARRIER_NAME
                                    MSGTY      MSGID      MSGNO    MSGV1      MSGV2      MSGV3      MSGV4                  
                                                          000                                                              
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex08">Exercise 8 - Access to Structured Data Objects</h2>
<pre class="pre-cyan">
      WHEN 16.
          out->write( 'Case 16 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 8 - Access to Structured Data Objects' ).

            TYPES: BEGIN OF st_connection_16,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_16.

            TYPES: BEGIN OF st_connection_nested_16,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     message         TYPE symsg,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_nested_16.

            DATA connection_16 TYPE st_connection_16.
            DATA connection_nested_16 TYPE st_Connection_nested_16.

*         Example 1: Access to structure components
*        *********************************************************************

            connection_16-airport_from_id = 'ABC'.
            connection_16-airport_to_id   = 'XYZ'.
            connection_16-carrier_name    = 'My Airline'.

            "Access to sub-components of nested structure
            connection_nested_16-message-msgty = 'E'.
            connection_nested_16-message-msgid = 'ABC'.
            connection_nested_16-message-msgno = '123'.

*         Example 2: Filling a structure with VALUE #(    ).
*        *********************************************************************

          CLEAR connection_16.

            connection_16 = VALUE #( airport_from_id = 'ABC'
                                     airport_to_id   = 'XYZ'
                                     carrier_name    = 'My Airline'
                                ).

            " Nested VALUE to fill nested structure
            connection_nested_16 = VALUE #( airport_from_id = 'ABC'
                                            airport_to_id   = 'XYZ'
                                            message         = VALUE #( msgty = 'E'
                                                                       msgid = 'ABC'
                                                                       msgno = '123' )
                                         carrier_name    = 'My Airline'
                                 ).

*         Example 3: Wrong result after direct assignment
*        *********************************************************************

            connection_nested_16 = connection_16.

            out->write(  `-------------------------------------------------------------` ).
            out->write(  `Example 3: Wrong Result after direct assignment` ).

            out->write( data = connection_16
                        name = `Source Structure:`).

            out->write( |Component connection_nested-message-msgid: { connection_nested_16-message-msgid }| ).
            out->write( |Component connection_nested-carrier_name : { connection_nested_16-carrier_name  }| ).

*         Example 4: Assigning Structures using CORRESPONDING #( )
*        *********************************************************************
            CLEAR connection_nested_16.
            connection_nested_16 = CORRESPONDING #(  connection_16 ).  "

            out->write(  `-------------------------------------------------------------` ).
            out->write(  `Example 4: Correct Result after assignment with CORRESPONDING` ).

            out->write( data = connection_16
                        name = `Source Structure:`).

            out->write( |Component connection_nested-message-msgid: { connection_nested_16-message-msgid }| ).
            out->write( |Component connection_nested-carrier_name : { connection_nested_16-carrier_name  }| ).
</pre>

<pre class="pre-cyan">
Case 16 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 8 - Access to Structured Data Objects
-------------------------------------------------------------
Example 3: Wrong Result after direct assignment
Source Structure:
AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME  
ABC              XYZ            My Airline    
Component connection_nested-message-msgid: y Airline
Component connection_nested-carrier_name : 
-------------------------------------------------------------
Example 4: Correct Result after assignment with CORRESPONDING
Source Structure:
AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME  
ABC              XYZ            My Airline    
Component connection_nested-message-msgid: 
Component connection_nested-carrier_name : My Airline
</pre>



<h2 id="Part1_SubPart2_PracSyst_Ex09">Exercise 9 - Structured Data Objects in ABAP SQL</h2>
<pre class="pre-cyan">
      WHEN 17.
          out->write( 'Case 17 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 9 - Structured Data Objects in ABAP SQL' ).

             TYPES: BEGIN OF st_connection_17,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_17.

            TYPES: BEGIN OF st_connection_short_17,
                     DepartureAirport   TYPE /dmo/airport_from_id,
                     DestinationAirport TYPE /dmo/airport_to_id,
                   END OF st_connection_short_17.


            DATA connection_17 TYPE st_connection_17.

            DATA connection_short_17 TYPE st_connection_short_17.

            DATA connection_full_17 TYPE /DMO/I_Connection.

*         Example 1: Correspondence between FIELDS and INTO
*        *********************************************************************

            SELECT SINGLE
               FROM /DMO/I_Connection
             FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
              WHERE AirlineID = 'LH'
                AND ConnectionID = '0400'
               INTO @connection_17.

            out->write(  `------------------------------` ).
            out->write(  `Example 1: Field List and INTO` ).
            out->write( connection_17 ).

*         Example 2: FIELDS *
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS *
             WHERE AirlineID = 'LH'
               AND ConnectionID = '0400'
              INTO @connection_full_17.

            out->write(  `----------------------------` ).
            out->write(  `Example 2: FIELDS * and INTO` ).
            out->write( connection_full_17 ).

*         Example 3: INTO CORRESPONDING FIELDS
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS *
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO CORRESPONDING FIELDS OF @connection_short_17.

            out->write(  `----------------------------------------------------` ).
            out->write(  `Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF` ).
            out->write( connection_short_17 ).

*         Example 4: Alias Names for Fields
*        *********************************************************************

            CLEAR connection_17.

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport AS airport_from_id,
                   \_Airline-Name   AS carrier_name
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO CORRESPONDING FIELDS OF @connection_17.

            out->write(  `---------------------------------------------------` ).
            out->write(  `Example 4: Aliases and INTO CORRESPONDING FIELDS OF` ).
            out->write( connection_17 ).

*         Example 5: Inline Declaration
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport,
                   DestinationAirport AS ArrivalAirport,
                   \_Airline-Name     AS carrier_name
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO @DATA(connection_inline_17).

            out->write(  `-----------------------------------------` ).
            out->write(  `Example 5: Aliases and Inline Declaration` ).
            out->write( connection_inline_17 ).

*         Example 6: Joins
*        *********************************************************************

            SELECT SINGLE
              FROM (  /dmo/connection AS c
              LEFT OUTER JOIN /dmo/airport AS f
                ON c~airport_from_id = f~airport_id )
              LEFT OUTER JOIN /dmo/airport AS t
                ON c~airport_to_id = t~airport_id
            FIELDS c~airport_from_id, c~airport_to_id,
                   f~name AS airport_from_name, t~name AS airport_to_name
             WHERE c~carrier_id    = 'LH'
               AND c~connection_id = '0400'
              INTO @DATA(connection_join_17).

            out->write(  `------------------------------------------` ).
            out->write(  `Example 6: Join of Connection and Airports` ).
            out->write( connection_join_17 ).
</pre>
<pre class="pre-cyan">
Case 17 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 9 - Structured Data Objects in ABAP SQL
------------------------------
Example 1: Field List and INTO
AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME           
FRA              JFK            Deutsche Lufthansa AG  
----------------------------
Example 2: FIELDS * and INTO
AIRLINEID  CONNECTIONID  DEPARTUREAIRPORT  DESTINATIONAIRPORT  DEPARTURETIME  ARRIVALTIME  DISTANCE  DISTANCEUNIT  
LH         0400          FRA               JFK                 10:10:00       11:34:00     6162      KM            
----------------------------------------------------
Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF
DEPARTUREAIRPORT  DESTINATIONAIRPORT  
FRA               JFK                 
---------------------------------------------------
Example 4: Aliases and INTO CORRESPONDING FIELDS OF
AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME           
FRA                             Deutsche Lufthansa AG  
-----------------------------------------
Example 5: Aliases and Inline Declaration
DEPARTUREAIRPORT  ARRIVALAIRPORT  CARRIER_NAME           
FRA               JFK             Deutsche Lufthansa AG  
------------------------------------------
Example 6: Join of Connection and Airports
AIRPORT_FROM_ID  AIRPORT_TO_ID  AIRPORT_FROM_NAME  AIRPORT_TO_NAME                        
FRA              JFK            Frankfurt Airport  John F. Kennedy International Airport  
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex10">Exercise 10 - Use a Structured Data Object</h2>
<pre class="pre-cyan">
" Global Class – When Only
      WHEN 14.
          out->write( 'Case 14 Run!' ).
          "Template = /LRN/CL_S4D400_CLS_CONSTRUCTOR | Solution = /LRN/CL_S4D400_DBS_SELECT    | ZCL_##_SELECT
          "Template = /LRN/CL_S4D400_DBS_SELECT      | Solution = /LRN/CL_S4D400_DBS_CDS       | ZCL_##_CDS
          "Template = /LRN/CL_S4D400_DBS_CDS         | Solution = /LRN/CL_S4D400_STS_STRUCTURE | ZCL_##_STRUCTURE
          "Please note. I will use the base code that has been cleaned up from WHEN 12.
          "The Local Class lcl_ufh8n_connection will be modified and I will do a backup first.

          DATA lv_str_tbl_14 TYPE string_table.
          APPEND |From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:| TO lv_str_tbl_14.
          APPEND |SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples| TO lv_str_tbl_14.
          APPEND |Exercise 3 - Read Data from a Database Table:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:| TO lv_str_tbl_14.
          APPEND |Exercise 5 - Analyze and Use a CDS View Entity| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:| TO lv_str_tbl_14.
          APPEND |See WHEN 15: Exercise 7 - Structured Data Types:| TO lv_str_tbl_14.
          APPEND |See WHEN 16: Exercise 8 - Access to Structured Data Objects:| TO lv_str_tbl_14.
          APPEND |See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL| TO lv_str_tbl_14.
          APPEND |Exercise 10 - Use a Structured Data Object| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          out->write( lv_str_tbl_14 ).

          DATA carrier_id_14    TYPE /dmo/carrier_id.
          DATA connection_id_14 TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_14 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_14          TYPE TABLE OF REF TO lcl_ufh8n_connection.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          LOOP AT connections_14  INTO lcl_ufh8n_connection_14.
            lcl_ufh8n_connection_14->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_14
                e_connection_id = connection_id_14 ).
            out->write( |Flight Connection {  carrier_id_14 } { connection_id_14 }| ).
          ENDLOOP.

          DATA(result_14) = lcl_ufh8n_connection_14->get_output( ).

          " in logical expression
          IF connections_14 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_14 INTO DATA(line_14).

                out->write( line_14->get_output(  ) ).
            ENDLOOP.
          ENDIF.
</pre>
<pre class="pre-cyan">
" Local Class - All
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.



  PROTECTED SECTION.
  PRIVATE SECTION.

    TYPES:
      BEGIN OF st_details,
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE   /dmo/airport_to_id,
        AirlineName        TYPE   /dmo/carrier_name,
      END OF st_details.

    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

    "DATA airport_from_id    TYPE /dmo/airport_from_id.  "scalar attributes
    "DATA airport_to_id      TYPE /dmo/airport_to_id.    "scalar attributes
    "DATA carrier_name       TYPE /dmo/carrier_name.     "scalar attributes

    DATA details TYPE st_details.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*  SELECT SINGLE
*    FROM /dmo/connection
*    FIELDS airport_from_id, airport_to_id
*    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
*    WHERE carrier_id    = @i_carrier_id
*      AND connection_id = @i_connection_id
*    INTO ( @airport_from_id, @airport_to_id ).

  SELECT SINGLE
    FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name as AirlineName
    WHERE AirlineID    = @i_carrier_id
      AND ConnectionID = @i_connection_id
    "INTO ( @airport_from_id, @airport_to_id, @carrier_name ).
    INTO CORRESPONDING FIELDS OF @details.
    "INTO @details.
    "Optional was" INTO CORRESPONDING FIELDS OF @details.
    "Add alias name AirlineName for the path expression.

   IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
   ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

    " String Templates
    " Embed the new attributes as expressions into the string templates.
    APPEND |------------------------------|   TO r_output.
    "APPEND |Carrier:     { carrier_id    }|   TO r_output.
    "APPEND |Carrier:     { carrier_id } { carrier_name }| TO r_output. "They Said replace line above but whatever
    "APPEND |Connection:  { connection_id }|   TO r_output.
    "APPEND |Departure:   { airport_from_id }| TO r_output.
    "APPEND |Destination: { airport_to_id   }| TO r_output.

    APPEND |--------------------------------|                    TO r_output.
    APPEND |Carrier:     { carrier_id } { details-airlinename }| TO r_output.
    APPEND |Connection:  { connection_id   }|                    TO r_output.
    APPEND |Departure:   { details-departureairport     }|       TO r_output.
    APPEND |Destination: { details-destinationairport   }|       TO r_output.


  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-cyan">
Case 14 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx  
FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:                                            
SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples                                                      
Exercise 3 - Read Data from a Database Table:                                                               
FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:                                                  
Exercise 5 - Analyze and Use a CDS View Entity                                                              
FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:         
See WHEN 15: Exercise 7 - Structured Data Types:                                                            
See WHEN 16: Exercise 8 - Access to Structured Data Objects:                                                
See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL                                               
Exercise 10 - Use a Structured Data Object                                                                  
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------         
--------------------------------       
Carrier:     LH Deutsche Lufthansa AG  
Connection:  0400                      
Departure:   FRA                       
Destination: JFK                       
------------------------------          
--------------------------------        
Carrier:     AA American Airlines Inc.  
Connection:  0017                       
Departure:   MIA                        
Destination: HAV                        
------------------------------              
--------------------------------            
Carrier:     SQ Singapore Airlines Limited  
Connection:  0001                           
Departure:   SFO                            
Destination: SIN                            
------------------------------          
--------------------------------        
Carrier:     AA American Airlines Inc.  
Connection:  0017                       
Departure:   MIA                        
Destination: HAV                        
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex11">Exercise 11 - Complex Table Types</h2>
<pre class="pre-cyan">
      WHEN 18.
          out->write( 'Case 18 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 11 - Complex Table Types' ).


    TYPES: BEGIN OF st_connection_18 ,
             carrier_id      TYPE /dmo/carrier_id,
             connection_id   TYPE /dmo/connection_id,
             airport_from_id TYPE /dmo/airport_from_id,
             airport_to_id   TYPE /dmo/airport_to_id,
             carrier_name    TYPE /dmo/carrier_name,
           END OF st_connection_18 .


*         Example 1 : Simple and Complex Internal Table
*        *********************************************************************

            " simple table (scalar row type)
            DATA numbers_18 TYPE TABLE OF i.
            " complex table (structured row type)
            DATA connections_18  TYPE TABLE OF st_connection_18 .

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 1: Simple and Complex Internal Table` ).
            out->write( data = numbers_18
                        name = `Simple Table NUMBERS:`).
            out->write( data = connections_18
                        name = `Complex Table CONNECTIONS:`).

*         Example 2 : Complex Internal Tables
*        *********************************************************************

            " standard table with non-unique standard key (short form)
            DATA connections_1_18  TYPE TABLE OF st_connection_18 .

            " standard table with non-unique standard key (explicit form)
            DATA connections_2_18  TYPE STANDARD TABLE OF st_connection_18
                                    WITH NON-UNIQUE DEFAULT KEY.

            " sorted table with non-unique explicit key
            DATA connections_3_18   TYPE SORTED TABLE OF st_connection_18
                                     WITH NON-UNIQUE KEY airport_from_id
                                                         airport_to_id.

            " sorted hashed with unique explicit key
            DATA connections_4_18   TYPE HASHED TABLE OF st_connection_18
                                     WITH UNIQUE KEY carrier_id
                                                     connection_id.

*         Example 3 : Local Table Type
*        *********************************************************************

            TYPES tt_connections_18  TYPE SORTED TABLE OF st_connection_18
                                      WITH UNIQUE KEY carrier_id
                                                      connection_id.

            DATA connections_5_18  TYPE tt_connections_18.

*         Example 4 : Global Table Type
*        *********************************************************************

            DATA flights_18   TYPE /dmo/t_flight.

            out->write(  `------------------------------------------` ).
            out->write(  `Example 4: Global Table TYpe /DMO/T_FLIGHT` ).
            out->write(  data = flights_18
                         name = `Internal Table FLIGHTS:` ).
</pre>

<pre class="pre-cyan">
Case 18 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 11 - Complex Table Types
--------------------------------------------
Example 1: Simple and Complex Internal Table
Simple Table NUMBERS:
  
Complex Table CONNECTIONS:
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME  
------------------------------------------
Example 4: Global Table TYpe /DMO/T_FLIGHT
Internal Table FLIGHTS:
CLIENT  CARRIER_ID  CONNECTION_ID  FLIGHT_DATE  PRICE  CURRENCY_CODE  PLANE_TYPE_ID  SEATS_MAX  SEATS_OCCUPIED  
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex12">Exercise 12 - How To Debug Complex Internal Tables</h2>
<pre class="pre-cyan">
No Code!
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex13">Exercise 13 - Filling Complex Internal Tables</h2>
<pre class="pre-cyan">
      WHEN 19.
          out->write( 'Case 19 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 13 - Filling Complex Internal Tables' ).

        TYPES: BEGIN OF st_connection_19,
                 carrier_id      TYPE /dmo/carrier_id,
                 connection_id   TYPE /dmo/connection_id,
                 airport_from_id TYPE /dmo/airport_from_id,
                 airport_to_id   TYPE /dmo/airport_to_id,
                 carrier_name    TYPE /dmo/carrier_name,
               END OF st_connection_19.

        TYPES tt_connections_19 TYPE STANDARD TABLE OF   st_connection_19
                                  WITH NON-UNIQUE KEY carrier_id
                                                      connection_id.

        DATA connections_19 TYPE tt_connections_19.

        TYPES: BEGIN OF st_carrier_19,
                 carrier_id    TYPE /dmo/carrier_id,
                 carrier_name  TYPE /dmo/carrier_name,
                 currency_code TYPE /dmo/currency_code,
               END OF st_carrier_19.

        TYPES tt_carriers_19 TYPE STANDARD TABLE OF st_carrier_19
                              WITH NON-UNIQUE KEY carrier_id.

        DATA carriers_19 TYPE tt_carriers_19.

*     Example 1: APPEND with structured data object (work area)
*    *********************************************************************

*        DATA connection  TYPE st_connection.
        " Declare the work area with LIKE LINE OF
        DATA connection_19 LIKE LINE OF connections_19.


*        connection-carrier_id       = 'NN'.
*        connection-connection_id    = '1234'.
*        connection-airport_from_id  = 'ABC'.
*        connection-airport_to_id    = 'XYZ'.
*        connection-carrier_name     = 'My Airline'.

        " Use VALUE #( ) instead assignment to individual components
        connection_19 = VALUE #( carrier_id       = 'NN'
                              connection_id    = '1234'
                              airport_from_id  = 'ABC'
                              airport_to_id    = 'XYZ'
                              carrier_name     = 'My Airline' ).

        APPEND connection_19 TO connections_19.

        out->write(  `--------------------------------` ).
        out->write(  `Example 1: APPEND with Work Area` ).
        out->write(  connections_19 ).

*     Example 2: APPEND with VALUE #( ) expression
*    *********************************************************************

        APPEND VALUE #( carrier_id       = 'NN'
                        connection_id    = '1234'
                        airport_from_id  = 'ABC'
                        airport_to_id    = 'XYZ'
                        carrier_name     = 'My Airline'
                      )
           TO connections_19.

        out->write(  `----------------------------` ).
        out->write(  `Example 2: Append with VALUE` ).
        out->write(  connections_19 ).

*     Example 3: Filling an Internal Table with Several Rows
*    *********************************************************************

        carriers_19 = VALUE #(  (  carrier_id = 'AA' carrier_name = 'American Airlines' )
                             (  carrier_id = 'JL' carrier_name = 'Japan Airlines'    )
                             (  carrier_id = 'SQ' carrier_name = 'Singapore Airlines')
                          ).

        out->write(  `-----------------------------------------` ).
        out->write(  `Example 3: Fill Internal Table with VALUE` ).
        out->write(  carriers_19 ).

*     Example 4: Filling one Internal Table from Another
*    *********************************************************************

        connections_19 = CORRESPONDING #( carriers_19 ).

        out->write(  `--------------------------------------------` ).
        out->write(  `Example 4: CORRESPONDING for Internal Tables` ).
        out->write(  data = carriers_19
                     name = `Source Table CARRIERS:`).
        out->write(  data = connections_19
                     name = `Target Table CONNECTIONS:`).
</pre>
<pre class="pre-cyan">
Case 19 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 13 - Filling Complex Internal Tables
--------------------------------
Example 1: APPEND with Work Area
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME  
NN          1234           ABC              XYZ            My Airline    
----------------------------
Example 2: Append with VALUE
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME  
NN          1234           ABC              XYZ            My Airline    
NN          1234           ABC              XYZ            My Airline    
-----------------------------------------
Example 3: Fill Internal Table with VALUE
CARRIER_ID  CARRIER_NAME        CURRENCY_CODE  
AA          American Airlines                  
JL          Japan Airlines                     
SQ          Singapore Airlines                 
--------------------------------------------
Example 4: CORRESPONDING for Internal Tables
Source Table CARRIERS:
CARRIER_ID  CARRIER_NAME        CURRENCY_CODE  
AA          American Airlines                  
JL          Japan Airlines                     
SQ          Singapore Airlines                 
Target Table CONNECTIONS:
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME        
AA          0000                                           American Airlines   
JL          0000                                           Japan Airlines      
SQ          0000                                           Singapore Airlines  
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex14">Exercise 14 - Access to Complex Internal Tables</h2>
<pre class="pre-cyan">
      WHEN 20.
          out->write( 'Case 20 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 14 - Access to Complex Internal Tables' ).

          TYPES: BEGIN OF st_connection_20,
                     carrier_id      TYPE /dmo/carrier_id,
                     connection_id   TYPE /dmo/connection_id,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_20.

            TYPES tt_connections_20 TYPE SORTED TABLE OF   st_connection_20
                                      WITH NON-UNIQUE KEY  carrier_id
                                                           connection_id.

            DATA connections_20 TYPE tt_connections_20.
            DATA connection_20  LIKE LINE OF connections_20.

            TYPES: BEGIN OF st_carrier_20,
                     carrier_id    TYPE /dmo/carrier_id,
                     currency_code TYPE /dmo/currency_code,
                   END OF st_carrier_20.

            DATA carriers_20 TYPE STANDARD TABLE OF st_carrier_20
                               WITH NON-UNIQUE KEY carrier_id.

            DATA carrier_20 LIKE LINE OF carriers_20.

*         Preparation: Fill internal tables with data
*        *********************************************************************
            connections_20 = VALUE #(  ( carrier_id      = 'JL'
                                         connection_id   = '0408'
                                         airport_from_id = 'FRA'
                                         airport_to_id   = 'NRT'
                                         carrier_name    = 'Japan Airlines'
                                    )
                                    (    carrier_id      = 'AA'
                                         connection_id   = '0017'
                                         airport_from_id = 'MIA'
                                         airport_to_id   = 'HAV'
                                         carrier_name    = 'American Airlines'
                                    )
                                    (   carrier_id      = 'SQ'
                                        connection_id   = '0001'
                                        airport_from_id = 'SFO'
                                        airport_to_id   = 'SIN'
                                        carrier_name    = 'Singapore Airlines'
                                    )
                                    (   carrier_id      = 'UA'
                                        connection_id   = '0078'
                                        airport_from_id = 'SFO'
                                        airport_to_id   = 'SIN'
                                        carrier_name    = 'United Airlines'
                                    )
                                   ).

            carriers_20 = VALUE #(  (  carrier_id    = 'SQ'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'JL'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'AA'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'UA'
                                       currency_code = ' '
                                 )
                              ).

*         Example 1: Table Expression with Key Access
*        *********************************************************************
            out->write(  `--------------------------------------------` ).
            out->write(  `Example 1: Table Expressions with Key Access` ).

            out->write(  data = connections_20
                         name = `Internal Table CONNECTIONS: ` ).

            " with key fields
            connection_20 = connections_20[ carrier_id    = 'SQ'
                                            connection_id = '0001' ].

            out->write(  data = connection_20
                         name = `CARRIER_ID = 'SQ' AND CONNECTION_ID = '001':` ).

            " with non-key fields
            connection_20 = connections_20[ airport_from_id = 'SFO'
                                      airport_to_id   = 'SIN' ].
            out->write(  data = connection_20
                         name = `AIRPORT_FROM_ID = 'SFO' AND AIRPORT_TO_ID = 'SIN':` ).

*         Example 2: LOOP with key access
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: LOOP with Key Access` ).

            LOOP AT connections_20 INTO connection_20
                               WHERE airport_from_id <> 'MIA'.

              "do something with the content of connection
              out->write( data = connection_20
                          name = |This is row number { sy-tabix }: | ).

            ENDLOOP.

*         Example 3: MODIFY TABLE (key access)
*        *********************************************************************
            out->write(  `-----------------------------------` ).
            out->write(  `Example 3: MODIFY TABLE (key access` ).

            out->write(  data = carriers_20
                         name = `Table CARRRIERS before MODIFY TABLE:`).

            carrier_20 = carriers_20[  carrier_id = 'JL' ].
            carrier_20-currency_code = 'JPY'.
            MODIFY TABLE carriers_20 FROM carrier_20.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after MODIFY TABLE:`).

*         Example 4: MODIFY (index access)
*        *********************************************************************
            out->write(  `--------------------------------` ).
            out->write(  `Example 4: MODIFY (index access)` ).

            carrier_20-carrier_id    = 'LH'.
            carrier_20-currency_code = 'EUR'.
            MODIFY carriers_20 FROM carrier_20 INDEX 1.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after MODIFY:`).

*         Example 5: MODIFY in a LOOP
*        *********************************************************************
            out->write(  `----------------------------` ).
            out->write(  `Example 5: MODIFY  in a LOOP` ).

            LOOP AT carriers_20 INTO carrier_20
                            WHERE currency_code IS INITIAL.

              carrier_20-currency_code = 'USD'.
              MODIFY carriers_20 FROM carrier_20.

            ENDLOOP.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after the LOOP:`).

</pre>

<pre class="pre-cyan">
Case 20 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 14 - Access to Complex Internal Tables
--------------------------------------------
Example 1: Table Expressions with Key Access
Internal Table CONNECTIONS: 
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME        
AA          0017           MIA              HAV            American Airlines   
JL          0408           FRA              NRT            Japan Airlines      
SQ          0001           SFO              SIN            Singapore Airlines  
UA          0078           SFO              SIN            United Airlines     
CARRIER_ID = 'SQ' AND CONNECTION_ID = '001':
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME        
SQ          0001           SFO              SIN            Singapore Airlines  
AIRPORT_FROM_ID = 'SFO' AND AIRPORT_TO_ID = 'SIN':
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME        
SQ          0001           SFO              SIN            Singapore Airlines  
-------------------------------
Example 2: LOOP with Key Access
This is row number 2: 
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME    
JL          0408           FRA              NRT            Japan Airlines  
This is row number 3: 
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME        
SQ          0001           SFO              SIN            Singapore Airlines  
This is row number 4: 
CARRIER_ID  CONNECTION_ID  AIRPORT_FROM_ID  AIRPORT_TO_ID  CARRIER_NAME     
UA          0078           SFO              SIN            United Airlines  
-----------------------------------
Example 3: MODIFY TABLE (key access
Table CARRRIERS before MODIFY TABLE:
CARRIER_ID  CURRENCY_CODE  
SQ                         
JL                         
AA                         
UA                         
Table CARRRIERS after MODIFY TABLE:
CARRIER_ID  CURRENCY_CODE  
SQ                         
JL          JPY            
AA                         
UA                         
--------------------------------
Example 4: MODIFY (index access)
Table CARRRIERS after MODIFY:
CARRIER_ID  CURRENCY_CODE  
LH          EUR            
JL          JPY            
AA                         
UA                         
----------------------------
Example 5: MODIFY  in a LOOP
Table CARRRIERS after the LOOP:
CARRIER_ID  CURRENCY_CODE  
LH          EUR            
JL          JPY            
AA          USD            
UA          USD 
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex15">Exercise 15 - Internal Tables in ABAP SQL</h2>
<pre class="pre-cyan">
      WHEN 21.
          out->write( 'Case 21 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 15 - Internal Tables in ABAP SQL' ).

            TYPES: BEGIN OF st_airport_21,
                     airportid TYPE /dmo/airport_id,
                     name      TYPE /dmo/airport_name,
                   END OF st_airport_21.

            TYPES tt_airports_21 TYPE STANDARD TABLE OF st_airport_21
                                  WITH NON-UNIQUE KEY airportid.

            DATA airports_21 TYPE tt_airports_21.


*         Example 1: Structured Variables in SELECT SINGLE ... INTO ...
*        *********************************************************************

            DATA airport_full_21 TYPE /DMO/I_Airport.

            SELECT SINGLE
              FROM /DMO/I_Airport
            FIELDS AirportID, Name, City, CountryCode
             WHERE City = 'Zurich'
              INTO @airport_full_21.

            out->write(  `-------------------------------------` ).
            out->write(  `Example 1: SELECT SINGLE ... INTO ...` ).
            out->write(  data = airport_full_21
                         name = `One of the airports in Zurich (Structure):` ).

*         Example 2: Internal Tables in SELECT ... INTO TABLE ...
*        *********************************************************************

            DATA airports_full_21 TYPE STANDARD TABLE OF /DMO/I_Airport
                                    WITH NON-UNIQUE KEY AirportID.

            SELECT
              FROM /DMO/I_Airport
            FIELDS airportid, Name, City, CountryCode
             WHERE City = 'London'
              INTO TABLE @airports_full_21.

            out->write(  `------------------------------------` ).
            out->write(  `Example 2: SELECT ... INTO TABLE ...` ).
            out->write(  data = airports_full_21
                         name = `All airports in London (Internal Table):` ).

*         Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF TABLE
*        *********************************************************************

            SELECT
              FROM /DMO/I_Airport
            FIELDS *
             WHERE City = 'London'
              INTO CORRESPONDING FIELDS OF TABLE @airports_21.

            out->write(  `----------------------------------------------------------` ).
            out->write(  `Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF TABLE` ).
            out->write(  data = airports_21
                         name = `Internal Table AIRPORTS:` ).

*         Example 4: Inline Declaration
*        *********************************************************************

            SELECT
              FROM /DMO/I_airport
            FIELDS AirportID, Name AS AirportName
             WHERE City = 'London'
             INTO TABLE @DATA(airports_inline_21).

            out->write(  `----------------------------------------------------------` ).
            out->write(  `Example 4: Inline Declaration after INTO TABLE` ).
            out->write(  data = airports_inline_21
                         name = `Internal Table AIRPORTS_INLINE:` ).

*        * Example 4: ORDER BY and DISTINCT
*        **********************************************************************
*
*            SELECT
*              FROM /DMO/I_Airport
*            FIELDS DISTINCT CountryCode
*             ORDER BY CountryCode
*             INTO TABLE @DATA(countryCodes).
*
*            out->write(  countryCodes ).

*         Example 5: UNION (ALL)
*        *********************************************************************

            SELECT FROM /DMO/I_Carrier
                   FIELDS 'Airline' AS type, AirlineID AS Id, Name
                   WHERE CurrencyCode = 'GBP'

            UNION ALL

            SELECT FROM /DMO/I_Airport
                   FIELDS 'Airport' AS type, AirportID AS Id,  Name
                   WHERE City = 'London'
*            ORDER BY type, Id
            INTO TABLE @DATA(names_21).

            out->write(  `----------------------------------------------` ).
            out->write(  `Example 5: UNION ALL of Airlines and Airports ` ).
            out->write(  data = names_21
                         name = `ID and Name of Airlines and Airports:` ).
</pre>

<pre class="pre-cyan">
Case 21 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 15 - Internal Tables in ABAP SQL
-------------------------------------
Example 1: SELECT SINGLE ... INTO ...
One of the airports in Zurich (Structure):
AIRPORTID  NAME            CITY    COUNTRYCODE  
ZRH        Zürich Airport  Zurich  CH           
------------------------------------
Example 2: SELECT ... INTO TABLE ...
All airports in London (Internal Table):
AIRPORTID  NAME                 CITY    COUNTRYCODE  
LCY        London City Airport  London  GB           
LGW        Gatwick Airport      London  GB           
LHR        Heathrow Airport     London  GB           
----------------------------------------------------------
Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF TABLE
Internal Table AIRPORTS:
AIRPORTID  NAME                 
LCY        London City Airport  
LGW        Gatwick Airport      
LHR        Heathrow Airport     
----------------------------------------------------------
Example 4: Inline Declaration after INTO TABLE
Internal Table AIRPORTS_INLINE:
AIRPORTID  AIRPORTNAME          
LCY        London City Airport  
LGW        Gatwick Airport      
LHR        Heathrow Airport     
----------------------------------------------
Example 5: UNION ALL of Airlines and Airports 
ID and Name of Airlines and Airports:
TYPE     ID   NAME                    
Airline  BA   British Airways p.l.c.  
Airport  LCY  London City Airport     
Airport  LGW  Gatwick Airport         
Airport  LHR  Heathrow Airport        
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex16">Exercise 16 - Use a Complex Internal Table</h2>
<pre class="pre-cyan">
      WHEN 14.
          out->write( 'Case 14 Run!' ).
          "Template = /LRN/CL_S4D400_CLS_CONSTRUCTOR | Solution = /LRN/CL_S4D400_DBS_SELECT    | ZCL_##_SELECT
          "Template = /LRN/CL_S4D400_DBS_SELECT      | Solution = /LRN/CL_S4D400_DBS_CDS       | ZCL_##_CDS
          "Template = /LRN/CL_S4D400_DBS_CDS         | Solution = /LRN/CL_S4D400_STS_STRUCTURE | ZCL_##_STRUCTURE
          "Template = /LRN/CL_S4D400_STS_STRUCTURE   | Solution = /LRN/CL_S4D400_ITS_ITAB      | ZCL_##_ITAB
          "Please note. I will use the base code that has been cleaned up from WHEN 12.
          "The Local Class lcl_ufh8n_connection will be modified and I will do a backup first.

          DATA lv_str_tbl_14 TYPE string_table.
          APPEND |From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:| TO lv_str_tbl_14.
          APPEND |SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples| TO lv_str_tbl_14.
          APPEND |Exercise 3 - Read Data from a Database Table:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:| TO lv_str_tbl_14.
          APPEND |Exercise 5 - Analyze and Use a CDS View Entity| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:| TO lv_str_tbl_14.
          APPEND |See WHEN 15: Exercise 7 - Structured Data Types:| TO lv_str_tbl_14.
          APPEND |See WHEN 16: Exercise 8 - Access to Structured Data Objects:| TO lv_str_tbl_14.
          APPEND |See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL| TO lv_str_tbl_14.
          APPEND |Exercise 10 - Use a Structured Data Object| TO lv_str_tbl_14.
          APPEND |See WHEN 18: Exercise 11 - Complex Table Types:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 12 - How To Debug Complex Internal Tables:| TO lv_str_tbl_14.
          APPEND |See WHEN 19: Exercise 13 - Filling Complex Internal Tables| TO lv_str_tbl_14.
          APPEND |See WHEN 20: Exercise 14 - Access to Complex Internal Tables| TO lv_str_tbl_14.
          APPEND |See WHEN 21: Exercise 15 - Internal Tables in ABAP SQL| TO lv_str_tbl_14.
          APPEND |Exercise 16 - Use a Complex Internal Table| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          out->write( lv_str_tbl_14 ).

          DATA carrier_id_14    TYPE /dmo/carrier_id.
          DATA connection_id_14 TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_14 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_14          TYPE TABLE OF REF TO lcl_ufh8n_connection.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          LOOP AT connections_14  INTO lcl_ufh8n_connection_14.
            lcl_ufh8n_connection_14->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_14
                e_connection_id = connection_id_14 ).
            out->write( |Flight Connection {  carrier_id_14 } { connection_id_14 }| ).
          ENDLOOP.

          DATA(result_14) = lcl_ufh8n_connection_14->get_output( ).

          " in logical expression
          IF connections_14 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_14 INTO DATA(line_14).

                out->write( line_14->get_output(  ) ).
            ENDLOOP.
          ENDIF.
</pre>

<pre class="pre-cyan">
 " Local Class – All
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.
      CLASS-METHODS class_constructor.



  PROTECTED SECTION.
  PRIVATE SECTION.

    TYPES:
      BEGIN OF st_details,
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE   /dmo/airport_to_id,
        AirlineName        TYPE   /dmo/carrier_name,
      END OF st_details.

    TYPES:
      BEGIN OF st_airport,
        AirportId TYPE /dmo/airport_id,
        Name      TYPE /dmo/airport_name,
      END OF st_airport.

    TYPES tt_airports TYPE STANDARD TABLE OF st_airport
                           WITH NON-UNIQUE DEFAULT KEY.

    "declare a static, table-like attribute airports to buffer detail information on all available airports.
    "Declare a new private static attribute airports and type it with table type tt_airports.
    CLASS-DATA airports TYPE tt_airports.

    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

    "DATA airport_from_id    TYPE /dmo/airport_from_id.  "scalar attributes
    "DATA airport_to_id      TYPE /dmo/airport_to_id.    "scalar attributes
    "DATA carrier_name       TYPE /dmo/carrier_name.     "scalar attributes

    DATA details TYPE st_details.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD class_constructor.
    "Implement a SELECT statement that reads all available airports from the CDS view entity /DMO/I_Airports
    "into the static attribute Airports.
     SELECT FROM /DMO/I_Airport
          FIELDS AirportID, Name
            INTO TABLE @airports.



  ENDMETHOD.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*  SELECT SINGLE
*    FROM /dmo/connection
*    FIELDS airport_from_id, airport_to_id
*    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
*    WHERE carrier_id    = @i_carrier_id
*      AND connection_id = @i_connection_id
*    INTO ( @airport_from_id, @airport_to_id ).

  SELECT SINGLE
    FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name as AirlineName
    WHERE AirlineID    = @i_carrier_id
      AND ConnectionID = @i_connection_id
    "INTO ( @airport_from_id, @airport_to_id, @carrier_name ).
    INTO CORRESPONDING FIELDS OF @details.
    "INTO @details.
    "Optional was" INTO CORRESPONDING FIELDS OF @details.
    "Add alias name AirlineName for the path expression.

   IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
   ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

  DATA(departure)   = airports[ airportID = details-departureairport ].
  DATA(destination) = airports[ airportID = details-destinationairport ].


    " String Templates
    " Embed the new attributes as expressions into the string templates.
    APPEND |------------------------------|   TO r_output.
    "APPEND |Carrier:     { carrier_id    }|   TO r_output.
    "APPEND |Carrier:     { carrier_id } { carrier_name }| TO r_output. "They Said replace line above but whatever
    "APPEND |Connection:  { connection_id }|   TO r_output.
    "APPEND |Departure:   { airport_from_id }| TO r_output.
    "APPEND |Destination: { airport_to_id   }| TO r_output.

    APPEND |--------------------------------|                    TO r_output.
    APPEND |Carrier:     { carrier_id } { details-airlinename }| TO r_output.
    APPEND |Connection:  { connection_id   }|                    TO r_output.
    "APPEND |Departure:   { details-departureairport     }|       TO r_output.
    "APPEND |Destination: { details-destinationairport   }|       TO r_output.

    "APPEND |Departure:   { details-departureairport   } { departure-name   }| TO r_output.
    "APPEND |Destination: { details-destinationairport } { destination-name }| TO r_output.

    APPEND |Departure:   { details-departureairport   } { airports[ airportid = details-departureairport ]-name   }| TO r_output.
    APPEND |Destination: { details-destinationairport } { airports[ airportid = details-destinationairport ]-name }| TO r_output.

    " Use a table expression Airports[ ... ] and an inline declaration for the data object departure.


  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-cyan">
Case 14 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx  
FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:                                            
SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples                                                      
Exercise 3 - Read Data from a Database Table:                                                               
FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:                                                  
Exercise 5 - Analyze and Use a CDS View Entity                                                              
FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:         
See WHEN 15: Exercise 7 - Structured Data Types:                                                            
See WHEN 16: Exercise 8 - Access to Structured Data Objects:                                                
See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL                                               
Exercise 10 - Use a Structured Data Object                                                                  
See WHEN 18: Exercise 11 - Complex Table Types:                                                             
FOLLOW ALONG ONLY: Exercise 12 - How To Debug Complex Internal Tables:                                      
See WHEN 19: Exercise 13 - Filling Complex Internal Tables                                                  
See WHEN 20: Exercise 14 - Access to Complex Internal Tables                                                
See WHEN 21: Exercise 15 - Internal Tables in ABAP SQL                                                      
Exercise 16 - Use a Complex Internal Table                                                                  
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
xxx:                                                                                                        
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------                          
--------------------------------                        
Carrier:     LH Deutsche Lufthansa AG                   
Connection:  0400                                       
Departure:   FRA Frankfurt Airport                      
Destination: JFK John F. Kennedy International Airport  
------------------------------                     
--------------------------------                   
Carrier:     AA American Airlines Inc.             
Connection:  0017                                  
Departure:   MIA Miami International Airport       
Destination: HAV José Martí International Airport  
------------------------------                        
--------------------------------                      
Carrier:     SQ Singapore Airlines Limited            
Connection:  0001                                     
Departure:   SFO San Francisco International Airport  
Destination: SIN Singapore Changi Airport             
------------------------------                     
--------------------------------                   
Carrier:     AA American Airlines Inc.             
Connection:  0017                                  
Departure:   MIA Miami International Airport       
Destination: HAV José Martí International Airport  
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex17">Exercise 17 - How To Analyze A Business Object</h2>
<pre class="pre-cyan">
" This is my code snippet
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Agency'
@Search.searchable: true

@AbapCatalog.extensibility: {
  extensible: true,
  elementSuffix: 'ZAG',
  allowNewDatasources: false,
  dataSources: ['_Extension'],
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  },
  allowNewCompositions: true
}

define root view entity /DMO/R_AgencyTP
  as select from /DMO/I_Agency as Agency
  association [0..1] to I_Country     as _Country   on $projection.CountryCode = _Country.Country
  association [1]    to /DMO/E_Agency as _Extension on $projection.AgencyID = _Extension.AgencyId
{

  key AgencyID,

      Name,

      Street,
      PostalCode,
      City,
      CountryCode,

      PhoneNumber,
      EMailAddress,
      WebAddress,

      Attachment,
      MimeType,
      Filename,

      LocalCreatedBy,
      LocalCreatedAt,
      LocalLastChangedBy,
      LocalLastChangedAt,
      LastChangedAt,

      _Country
}
</pre>
<pre class="pre-cyan">
" This is my code snippet

managed implementation in class /dmo/bp_r_agencytp unique;
strict ( 2 );
with draft;
extensible
{
  with determinations on modify;
  with determinations on save;
  with validations on save;
  with additional save;
}

define behavior for /DMO/R_AgencyTP alias /DMO/Agency
persistent table /dmo/agency
draft table /dmo/agency_d query /DMO/R_AgencyDraft
lock master
total etag LastChangedAt
authorization master ( none )
etag master LocalLastChangedAt
late numbering
extensible
{
  create;
  update;
  delete;

  field ( readonly ) AgencyID, LocalCreatedBy, LocalCreatedAt, LocalLastChangedBy, LocalLastChangedAt, LastChangedAt;
  field ( mandatory ) CountryCode, EMailAddress, Name;

  draft action Resume;
  draft action Edit;
  draft action Activate optimized;
  draft action Discard;

  // Validations for mandatory fields
  validation /DMO/validateEMailAddress on save { create; field EMailAddress; }
  validation /DMO/validateCountryCode on save { create; field CountryCode; }
  validation /DMO/validateName on save { create; field Name; }

  validation /DMO/validateLargeObject on save { create; field Attachment; field MimeType; field Filename; }

  draft determine action Prepare extensible
  {
    validation /DMO/validateEMailAddress;
    validation /DMO/validateCountryCode;
    validation /DMO/validateName;
    validation /DMO/validateLargeObject;
  }

  mapping for /dmo/agency corresponding extensible
    {
      AgencyId           = agency_id;
      Name               = name;
      Street             = street;
      PostalCode         = postal_code;
      City               = city;
      CountryCode        = country_code;
      PhoneNumber        = phone_number;
      EmailAddress       = email_address;
      WebAddress         = web_address;
      Attachment         = attachment;
      MimeType           = mime_type;
      Filename           = filename;
      LocalCreatedBy     = local_created_by;
      LocalCreatedAt     = local_created_at;
      LocalLastChangedBy = local_last_changed_by;
      LocalLastChangedAt = local_last_changed_at;
      LastChangedAt      = last_changed_at;
    }
}
</pre>
<pre class="pre-cyan">
"Random Code #1
ls-lv_test_used = 'A1'.   ls-exemption_reason_cd = 'INC'.   ls-iv_appt_req = abap_true.   APPEND ls TO lt.  CLEAR ls.

"Random Code #2
iv_bool_type = 'abap_false'.

"Random Code #3
iv_bool_type = 'abap__true'.

"Random Code #4
  SELECT tbname, seq_num, code_internal, col1, col2, desc_standard
    FROM zrd_incore_code WHERE tbname EQ 'PBI.BICO.PLAN.ERR.CODE'
    INTO TABLE @DATA(temp_tbl_incore_read01).

"Random Code #5
  DATA lt_inner_filter_opt    TYPE /iwbep/t_cod_select_options.
  DATA wa_inner_lt_filter_opt LIKE LINE OF lt_inner_filter_opt.

  LOOP AT lt_web INTO DATA(wa_lt_web).
    wa_inner_lt_filter_opt-sign   = 'I'.
    wa_inner_lt_filter_opt-option = 'EQ'.
    wa_inner_lt_filter_opt-low    = wa_lt_web-activitycode. 
    wa_inner_lt_filter_opt-high   = ''.
</pre>

<pre class="pre-cyan">
" This is my code snippet
CLASS /dmo/bp_r_agencytp DEFINITION PUBLIC ABSTRACT FINAL FOR BEHAVIOR OF /dmo/r_agencytp.
protected section.
private section.
ENDCLASS.



CLASS /DMO/BP_R_AGENCYTP IMPLEMENTATION.
ENDCLASS.
</pre>

<pre class="pre-cyan">
" This is my code snippet
CLASS ltc_agency_handler DEFINITION DEFERRED FOR TESTING.
CLASS lhc_agency DEFINITION
  INHERITING FROM cl_abap_behavior_handler
  FRIENDS ltc_agency_handler.

  PUBLIC SECTION.
    CONSTANTS state_area_validate_attachment TYPE string VALUE 'VALIDATE_ATTACHMENT' ##NO_TEXT.
    CONSTANTS state_area_validate_name       TYPE string VALUE 'VALIDATE_NAME'       ##NO_TEXT.
    CONSTANTS state_area_validate_email      TYPE string VALUE 'VALIDATE_EMAIL'      ##NO_TEXT.
    CONSTANTS state_area_validate_country    TYPE string VALUE 'VALIDATE_COUNTRY'    ##NO_TEXT.
    CONSTANTS state_area_validate_lob        TYPE string VALUE 'VALIDATE_LOB'     ##NO_TEXT.

    TYPES: BEGIN OF t_mimetypes,
             file_extension TYPE string,
             mimetype       TYPE string,
           END OF t_mimetypes.

    CLASS-DATA allowed_mimetypes TYPE STANDARD TABLE OF t_mimetypes WITH KEY mimetype.

    CLASS-METHODS class_constructor.

  PRIVATE SECTION.
*    METHODS get_global_authorizations FOR GLOBAL AUTHORIZATION IMPORTING REQUEST requested_authorizations FOR /dmo/agency RESULT result.

    METHODS validatecountrycode FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatecountrycode.

    METHODS validateemailaddress FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validateemailaddress.

    METHODS validatename FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatename.

    METHODS validatelargeobject FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatelargeobject.

ENDCLASS.



CLASS lhc_agency IMPLEMENTATION.

  METHOD class_constructor.
    allowed_mimetypes = VALUE #( ( file_extension = '.txt' mimetype = 'text/plain' )
                                 ( file_extension = '.jpg' mimetype = 'image/jpeg' )
                                 ( file_extension = '.png' mimetype = 'image/png' )
                                 ( file_extension = '.bmp' mimetype = 'image/bmp' ) ).

  ENDMETHOD.


*  METHOD get_global_authorizations.
*  ENDMETHOD.


  METHOD validatecountrycode.
    DATA countries TYPE SORTED TABLE OF i_country WITH UNIQUE KEY country.

    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( countrycode )
         WITH CORRESPONDING #(  keys )
         RESULT DATA(agencies).


    countries = CORRESPONDING #( agencies DISCARDING DUPLICATES MAPPING country = countrycode EXCEPT * ).
    DELETE countries WHERE country IS INITIAL.

    IF countries IS NOT INITIAL.
      SELECT FROM i_country FIELDS country
        FOR ALL ENTRIES IN @countries
        WHERE country = @countries-country
        INTO TABLE @DATA(countries_db).
    ENDIF.

    LOOP AT agencies INTO DATA(agency).
      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_country )
             TO reported-/dmo/agency.

      IF        agency-countrycode IS INITIAL
         OR NOT line_exists( countries_db[ country = agency-countrycode ] ).

        APPEND VALUE #(  %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky                 = agency-%tky
                        %state_area          = state_area_validate_country
                        %msg                 = NEW /dmo/cx_agency( textid      = /dmo/cx_agency=>country_code_invalid
                                                                   countrycode = agency-countrycode )
                        %element-countrycode = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validateemailaddress.
    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( emailaddress )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).

      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_email )
             TO reported-/dmo/agency.

      " Conversion to string to truncate trailing spaces, so + doesn't match space.
      IF CONV string( agency-emailaddress ) NP '+*@+*.+*' ##OPERATOR[STRING].

        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.

        APPEND VALUE #( %tky                  = agency-%tky
                        %state_area           = state_area_validate_email
                        %msg                  = NEW /dmo/cx_agency( /dmo/cx_agency=>email_invalid_format )
                        %element-emailaddress = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validatename.
    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( name )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).
      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_name )
             TO reported-/dmo/agency.

      IF agency-name IS INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.

        APPEND VALUE #( %tky          = agency-%tky
                        %state_area   = state_area_validate_name
                        %msg          = NEW /dmo/cx_agency( /dmo/cx_agency=>name_required )
                        %element-name = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validatelargeobject.

    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( attachment mimetype filename )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).

      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_lob ) TO reported-/dmo/agency.

      " No mimetype for attachment
      IF agency-attachment IS NOT INITIAL AND agency-mimetype IS INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky              = agency-%tky
                        %state_area       = state_area_validate_lob
                        %msg              = NEW /dmo/cx_agency( textid     = /dmo/cx_agency=>mimetype_missing
                                                                attachment = agency-attachment )
                        %element-mimetype = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.

      ENDIF.

      IF agency-mimetype IS NOT INITIAL.

        " No (empty) attachment for mimetype
        IF agency-attachment IS INITIAL.
          APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
          APPEND VALUE #(
              %tky                = agency-%tky
              %state_area         = state_area_validate_lob
              %msg                = NEW /dmo/cx_agency( textid     = /dmo/cx_agency=>attachment_empty_missing
                                                        attachment = agency-attachment )
              %element-attachment = if_abap_behv=>mk-on )
                 TO reported-/dmo/agency.
        ENDIF.

        " Mimetype is not supported
        IF NOT line_exists( allowed_mimetypes[ mimetype = agency-mimetype ] ).
          APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
          APPEND VALUE #( %tky              = agency-%tky
                          %state_area       = state_area_validate_lob
                          %msg              = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>mimetype_not_supported
                                                                  mimetype = agency-mimetype )
                          %element-mimetype = if_abap_behv=>mk-on )
                 TO reported-/dmo/agency.
        ELSE.

          IF agency-filename IS NOT INITIAL.
            DATA(file_extension) = substring_from( val = agency-filename pcre = '(.[^.]*)$' ).

            " File extension does not match mimetype
            IF file_extension <> allowed_mimetypes[ mimetype = agency-mimetype ]-file_extension.
              APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
              APPEND VALUE #(
                  %tky              = agency-%tky
                  %state_area       = state_area_validate_lob
                  %msg              = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>extension_mimetype_mismatch
                                                          mimetype = agency-mimetype )
                  %element-mimetype = if_abap_behv=>mk-on
                  %element-filename = if_abap_behv=>mk-on )
                     TO reported-/dmo/agency.
            ENDIF.

          ENDIF.

        ENDIF.

      ELSEIF agency-attachment IS INITIAL AND agency-filename IS NOT INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky                = agency-%tky
                        %state_area         = state_area_validate_lob
                        %msg                = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>only_filename
                                                                  filename = agency-filename )
                        %element-attachment = if_abap_behv=>mk-on
                        %element-mimetype   = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.

      ENDIF.

    ENDLOOP.

  ENDMETHOD.

ENDCLASS.

CLASS ltc_agency_saver DEFINITION DEFERRED FOR TESTING.
CLASS lsc_agency DEFINITION
  INHERITING FROM cl_abap_behavior_saver
  FRIENDS ltc_agency_saver.

  PROTECTED SECTION.
    METHODS adjust_numbers REDEFINITION.
ENDCLASS.



CLASS lsc_agency IMPLEMENTATION.

  METHOD adjust_numbers.
    DATA agency_id_max TYPE /dmo/agency_id.
    DATA entity        TYPE STRUCTURE FOR MAPPED LATE /dmo/r_agencytp.

    DATA(entities_wo_agencyid) = mapped-/dmo/agency.
    DELETE entities_wo_agencyid WHERE agencyid IS NOT INITIAL.

    IF entities_wo_agencyid IS INITIAL.
      EXIT.
    ENDIF.

    " Get Numbers
    TRY.
        cl_numberrange_runtime=>number_get( EXPORTING nr_range_nr       = '01'
                                                      object            = '/DMO/AGNCY'
                                                      quantity          = CONV #( lines( entities_wo_agencyid  ) )
                                            IMPORTING number            = DATA(number_range_key)
                                                      returncode        = DATA(number_range_return_code)
                                                      returned_quantity = DATA(number_range_returned_quantity) ).
      CATCH cx_number_ranges INTO DATA(lx_number_ranges).
        RAISE SHORTDUMP lx_number_ranges.

    ENDTRY.

    CASE number_range_return_code.
      WHEN '1'.
        " 1 - the returned number is in a critical range (specified under “percentage warning” in the object definition)
        LOOP AT entities_wo_agencyid INTO entity.
          APPEND VALUE #( %pid = entity-%pid
                          %key = entity-%key
                          %msg = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>number_range_depleted
                                                     severity = if_abap_behv_message=>severity-warning ) )
                 TO reported-/dmo/agency.
        ENDLOOP.

      WHEN '2' OR '3'.
        " 2 - the last number of the interval was returned
        " 3 - if fewer numbers are available than requested,  the return code is 3
        RAISE SHORTDUMP NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>not_sufficient_numbers
                                            severity = if_abap_behv_message=>severity-warning ).
    ENDCASE.

    " At this point ALL entities get a number!
    ASSERT number_range_returned_quantity = lines( entities_wo_agencyid ).

    agency_id_max = number_range_key - number_range_returned_quantity.

    " Set Agency ID
    LOOP AT mapped-/dmo/agency ASSIGNING FIELD-SYMBOL(<agency>). " USING KEY entity" WHERE agencyid IS INITIAL.
      IF <agency>-agencyid IS INITIAL. " If condition necessary?
        agency_id_max += 1.
        <agency>-agencyid = agency_id_max.

        " Read table mapped assign
      ENDIF.
    ENDLOOP.

    ASSERT agency_id_max = number_range_key.

  ENDMETHOD.

ENDCLASS.
</pre>

<pre class="pre-cyan">
" This is my code snippet. Just the method. Full class is above.
  METHOD validatename.
    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( name )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).
      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_name )
             TO reported-/dmo/agency.

      IF agency-name IS INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.

        APPEND VALUE #( %tky          = agency-%tky
                        %state_area   = state_area_validate_name
                        %msg          = NEW /dmo/cx_agency( /dmo/cx_agency=>name_required )
                        %element-name = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex18">Exercise 18 - Analyze a Business Object</h2>
<pre class="pre-cyan">
" /DMO/I_AGENCYTP (Behavior Definition) Agency
interface;
use draft;
extensible;

define behavior for /DMO/I_AgencyTP alias /DMO/Agency
{
  use create;
  use update;
  use delete;

  use action Resume;
  use action Edit;
  use action Activate;
  use action Discard;
  use action Prepare;
}
</pre>
<pre class="pre-cyan">
" This is mine
@Metadata.ignorePropagatedAnnotations: true
@EndUserText.label: 'Agency'
@Search.searchable: true
@AccessControl.authorizationCheck: #NOT_REQUIRED

@AbapCatalog.extensibility: {
  extensible: true,
  dataSources: ['AGENCY'],
  elementSuffix: 'ZAG',
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  }, allowNewCompositions: true
}

define root view entity /DMO/I_AgencyTP
  provider contract transactional_interface
  as projection on /DMO/R_AgencyTP as Agency
{
      @ObjectModel.text.element: ['Name']
  key AgencyID,
  
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Semantics.text: true
      @Semantics.organization.name: true
      Name,
      
      @Semantics.address.street: true
      Street,
      
      @Semantics.address.zipCode: true
      PostalCode,
      
      @Search.defaultSearchElement: true
      @Semantics.address.city: true
      City,
      
      @Consumption.valueHelpDefinition: [{entity: { name: 'I_CountryVH', element: 'Country' } }]
      @Semantics.address.country: true
      CountryCode,
      
      @Semantics.telephone.type: [#WORK]
      PhoneNumber,
      
      @Semantics.eMail.address: true
      EMailAddress,
      WebAddress,
      
      @Semantics.largeObject: { mimeType: 'MimeType',
                                fileName: 'Filename',
                                contentDispositionPreference: #INLINE }
      Attachment,
      
      @Semantics.mimeType: true
      MimeType,
      Filename,
      
      @Semantics.user.createdBy: true
      LocalCreatedBy,
      
      @Semantics.systemDateTime.createdAt: true
      LocalCreatedAt,
      
      @Semantics.user.lastChangedBy: true
      LocalLastChangedBy,
      
      @Semantics.systemDateTime.localInstanceLastChangedAt: true
      LocalLastChangedAt,
      
      @Semantics.systemDateTime.lastChangedAt: true
      LastChangedAt,
      /* Associations */
      _Country
}
</pre>

<pre class="pre-cyan">
define root view entity /DMO/I_AgencyTP
  provider contract transactional_interface
  as projection on /DMO/R_AgencyTP as Agency
{
</pre>
<pre class="pre-cyan">
" My code is:
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Agency'
@Search.searchable: true

@AbapCatalog.extensibility: {
  extensible: true,
  elementSuffix: 'ZAG',
  allowNewDatasources: false,
  dataSources: ['_Extension'],
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  },
  allowNewCompositions: true
}

define root view entity /DMO/R_AgencyTP
  as select from /DMO/I_Agency as Agency
  association [0..1] to I_Country     as _Country   on $projection.CountryCode = _Country.Country
  association [1]    to /DMO/E_Agency as _Extension on $projection.AgencyID = _Extension.AgencyId
{

  key AgencyID,

      Name,

      Street,
      PostalCode,
      City,
      CountryCode,

      PhoneNumber,
      EMailAddress,
      WebAddress,

      Attachment,
      MimeType,
      Filename,

      LocalCreatedBy,
      LocalCreatedAt,
      LocalLastChangedBy,
      LocalLastChangedAt,
      LastChangedAt,

      _Country
}
</pre>
<pre class="pre-cyan">
" This is mine
managed implementation in class /dmo/bp_r_agencytp unique;
strict ( 2 );
with draft;
extensible
{
  with determinations on modify;
  with determinations on save;
  with validations on save;
  with additional save;
}

define behavior for /DMO/R_AgencyTP alias /DMO/Agency
persistent table /dmo/agency
draft table /dmo/agency_d query /DMO/R_AgencyDraft
lock master
total etag LastChangedAt
authorization master ( none )
etag master LocalLastChangedAt
late numbering
extensible
{
  create;
  update;
  delete;

  field ( readonly ) AgencyID, LocalCreatedBy, LocalCreatedAt, LocalLastChangedBy, LocalLastChangedAt, LastChangedAt;
  field ( mandatory ) CountryCode, EMailAddress, Name;

  draft action Resume;
  draft action Edit;
  draft action Activate optimized;
  draft action Discard;

  // Validations for mandatory fields
  validation /DMO/validateEMailAddress on save { create; field EMailAddress; }
  validation /DMO/validateCountryCode on save { create; field CountryCode; }
  validation /DMO/validateName on save { create; field Name; }

  validation /DMO/validateLargeObject on save { create; field Attachment; field MimeType; field Filename; }

  draft determine action Prepare extensible
  {
    validation /DMO/validateEMailAddress;
    validation /DMO/validateCountryCode;
    validation /DMO/validateName;
    validation /DMO/validateLargeObject;
  }

  mapping for /dmo/agency corresponding extensible
    {
      AgencyId           = agency_id;
      Name               = name;
      Street             = street;
      PostalCode         = postal_code;
      City               = city;
      CountryCode        = country_code;
      PhoneNumber        = phone_number;
      EmailAddress       = email_address;
      WebAddress         = web_address;
      Attachment         = attachment;
      MimeType           = mime_type;
      Filename           = filename;
      LocalCreatedBy     = local_created_by;
      LocalCreatedAt     = local_created_at;
      LocalLastChangedBy = local_last_changed_by;
      LocalLastChangedAt = local_last_changed_at;
      LastChangedAt      = last_changed_at;
    }
}
</pre>
<pre class="pre-cyan">
managed implementation in class /dmo/bp_r_agencytp unique;
strict ( 2 );
with draft;
extensible
</pre>
<pre class="pre-cyan">
CLASS /dmo/bp_r_agencytp DEFINITION PUBLIC ABSTRACT FINAL FOR BEHAVIOR OF /dmo/r_agencytp.
protected section.
private section.
ENDCLASS.



CLASS /DMO/BP_R_AGENCYTP IMPLEMENTATION.
ENDCLASS.
</pre>
<pre class="pre-cyan">
CLASS ltc_agency_handler DEFINITION DEFERRED FOR TESTING.
CLASS lhc_agency DEFINITION
  INHERITING FROM cl_abap_behavior_handler
  FRIENDS ltc_agency_handler.

  PUBLIC SECTION.
    CONSTANTS state_area_validate_attachment TYPE string VALUE 'VALIDATE_ATTACHMENT' ##NO_TEXT.
    CONSTANTS state_area_validate_name       TYPE string VALUE 'VALIDATE_NAME'       ##NO_TEXT.
    CONSTANTS state_area_validate_email      TYPE string VALUE 'VALIDATE_EMAIL'      ##NO_TEXT.
    CONSTANTS state_area_validate_country    TYPE string VALUE 'VALIDATE_COUNTRY'    ##NO_TEXT.
    CONSTANTS state_area_validate_lob        TYPE string VALUE 'VALIDATE_LOB'     ##NO_TEXT.

    TYPES: BEGIN OF t_mimetypes,
             file_extension TYPE string,
             mimetype       TYPE string,
           END OF t_mimetypes.

    CLASS-DATA allowed_mimetypes TYPE STANDARD TABLE OF t_mimetypes WITH KEY mimetype.

    CLASS-METHODS class_constructor.

  PRIVATE SECTION.
*    METHODS get_global_authorizations FOR GLOBAL AUTHORIZATION IMPORTING REQUEST requested_authorizations FOR /dmo/agency RESULT result.

    METHODS validatecountrycode FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatecountrycode.

    METHODS validateemailaddress FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validateemailaddress.

    METHODS validatename FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatename.

    METHODS validatelargeobject FOR VALIDATE ON SAVE IMPORTING keys FOR /dmo/agency~/dmo/validatelargeobject.

ENDCLASS.



CLASS lhc_agency IMPLEMENTATION.

  METHOD class_constructor.
    allowed_mimetypes = VALUE #( ( file_extension = '.txt' mimetype = 'text/plain' )
                                 ( file_extension = '.jpg' mimetype = 'image/jpeg' )
                                 ( file_extension = '.png' mimetype = 'image/png' )
                                 ( file_extension = '.bmp' mimetype = 'image/bmp' ) ).

  ENDMETHOD.


*  METHOD get_global_authorizations.
*  ENDMETHOD.


  METHOD validatecountrycode.
    DATA countries TYPE SORTED TABLE OF i_country WITH UNIQUE KEY country.

    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( countrycode )
         WITH CORRESPONDING #(  keys )
         RESULT DATA(agencies).


    countries = CORRESPONDING #( agencies DISCARDING DUPLICATES MAPPING country = countrycode EXCEPT * ).
    DELETE countries WHERE country IS INITIAL.

    IF countries IS NOT INITIAL.
      SELECT FROM i_country FIELDS country
        FOR ALL ENTRIES IN @countries
        WHERE country = @countries-country
        INTO TABLE @DATA(countries_db).
    ENDIF.

    LOOP AT agencies INTO DATA(agency).
      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_country )
             TO reported-/dmo/agency.

      IF        agency-countrycode IS INITIAL
         OR NOT line_exists( countries_db[ country = agency-countrycode ] ).

        APPEND VALUE #(  %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky                 = agency-%tky
                        %state_area          = state_area_validate_country
                        %msg                 = NEW /dmo/cx_agency( textid      = /dmo/cx_agency=>country_code_invalid
                                                                   countrycode = agency-countrycode )
                        %element-countrycode = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validateemailaddress.
    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( emailaddress )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).

      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_email )
             TO reported-/dmo/agency.

      " Conversion to string to truncate trailing spaces, so + doesn't match space.
      IF CONV string( agency-emailaddress ) NP '+*@+*.+*' ##OPERATOR[STRING].

        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.

        APPEND VALUE #( %tky                  = agency-%tky
                        %state_area           = state_area_validate_email
                        %msg                  = NEW /dmo/cx_agency( /dmo/cx_agency=>email_invalid_format )
                        %element-emailaddress = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validatename.
    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( name )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).
      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_name )
             TO reported-/dmo/agency.

      IF agency-name IS INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.

        APPEND VALUE #( %tky          = agency-%tky
                        %state_area   = state_area_validate_name
                        %msg          = NEW /dmo/cx_agency( /dmo/cx_agency=>name_required )
                        %element-name = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.
      ENDIF.
    ENDLOOP.
  ENDMETHOD.


  METHOD validatelargeobject.

    READ ENTITIES OF /dmo/r_agencytp IN LOCAL MODE
         ENTITY /dmo/agency
         FIELDS ( attachment mimetype filename )
         WITH CORRESPONDING #( keys )
         RESULT DATA(agencies).

    LOOP AT agencies INTO DATA(agency).

      APPEND VALUE #( %tky        = agency-%tky
                      %state_area = state_area_validate_lob ) TO reported-/dmo/agency.

      " No mimetype for attachment
      IF agency-attachment IS NOT INITIAL AND agency-mimetype IS INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky              = agency-%tky
                        %state_area       = state_area_validate_lob
                        %msg              = NEW /dmo/cx_agency( textid     = /dmo/cx_agency=>mimetype_missing
                                                                attachment = agency-attachment )
                        %element-mimetype = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.

      ENDIF.

      IF agency-mimetype IS NOT INITIAL.

        " No (empty) attachment for mimetype
        IF agency-attachment IS INITIAL.
          APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
          APPEND VALUE #(
              %tky                = agency-%tky
              %state_area         = state_area_validate_lob
              %msg                = NEW /dmo/cx_agency( textid     = /dmo/cx_agency=>attachment_empty_missing
                                                        attachment = agency-attachment )
              %element-attachment = if_abap_behv=>mk-on )
                 TO reported-/dmo/agency.
        ENDIF.

        " Mimetype is not supported
        IF NOT line_exists( allowed_mimetypes[ mimetype = agency-mimetype ] ).
          APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
          APPEND VALUE #( %tky              = agency-%tky
                          %state_area       = state_area_validate_lob
                          %msg              = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>mimetype_not_supported
                                                                  mimetype = agency-mimetype )
                          %element-mimetype = if_abap_behv=>mk-on )
                 TO reported-/dmo/agency.
        ELSE.

          IF agency-filename IS NOT INITIAL.
            DATA(file_extension) = substring_from( val = agency-filename pcre = '(.[^.]*)$' ).

            " File extension does not match mimetype
            IF file_extension <> allowed_mimetypes[ mimetype = agency-mimetype ]-file_extension.
              APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
              APPEND VALUE #(
                  %tky              = agency-%tky
                  %state_area       = state_area_validate_lob
                  %msg              = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>extension_mimetype_mismatch
                                                          mimetype = agency-mimetype )
                  %element-mimetype = if_abap_behv=>mk-on
                  %element-filename = if_abap_behv=>mk-on )
                     TO reported-/dmo/agency.
            ENDIF.

          ENDIF.

        ENDIF.

      ELSEIF agency-attachment IS INITIAL AND agency-filename IS NOT INITIAL.
        APPEND VALUE #( %tky = agency-%tky ) TO failed-/dmo/agency.
        APPEND VALUE #( %tky                = agency-%tky
                        %state_area         = state_area_validate_lob
                        %msg                = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>only_filename
                                                                  filename = agency-filename )
                        %element-attachment = if_abap_behv=>mk-on
                        %element-mimetype   = if_abap_behv=>mk-on )
               TO reported-/dmo/agency.

      ENDIF.

    ENDLOOP.

  ENDMETHOD.

ENDCLASS.

CLASS ltc_agency_saver DEFINITION DEFERRED FOR TESTING.
CLASS lsc_agency DEFINITION
  INHERITING FROM cl_abap_behavior_saver
  FRIENDS ltc_agency_saver.

  PROTECTED SECTION.
    METHODS adjust_numbers REDEFINITION.
ENDCLASS.



CLASS lsc_agency IMPLEMENTATION.

  METHOD adjust_numbers.
    DATA agency_id_max TYPE /dmo/agency_id.
    DATA entity        TYPE STRUCTURE FOR MAPPED LATE /dmo/r_agencytp.

    DATA(entities_wo_agencyid) = mapped-/dmo/agency.
    DELETE entities_wo_agencyid WHERE agencyid IS NOT INITIAL.

    IF entities_wo_agencyid IS INITIAL.
      EXIT.
    ENDIF.

    " Get Numbers
    TRY.
        cl_numberrange_runtime=>number_get( EXPORTING nr_range_nr       = '01'
                                                      object            = '/DMO/AGNCY'
                                                      quantity          = CONV #( lines( entities_wo_agencyid  ) )
                                            IMPORTING number            = DATA(number_range_key)
                                                      returncode        = DATA(number_range_return_code)
                                                      returned_quantity = DATA(number_range_returned_quantity) ).
      CATCH cx_number_ranges INTO DATA(lx_number_ranges).
        RAISE SHORTDUMP lx_number_ranges.

    ENDTRY.

    CASE number_range_return_code.
      WHEN '1'.
        " 1 - the returned number is in a critical range (specified under “percentage warning” in the object definition)
        LOOP AT entities_wo_agencyid INTO entity.
          APPEND VALUE #( %pid = entity-%pid
                          %key = entity-%key
                          %msg = NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>number_range_depleted
                                                     severity = if_abap_behv_message=>severity-warning ) )
                 TO reported-/dmo/agency.
        ENDLOOP.

      WHEN '2' OR '3'.
        " 2 - the last number of the interval was returned
        " 3 - if fewer numbers are available than requested,  the return code is 3
        RAISE SHORTDUMP NEW /dmo/cx_agency( textid   = /dmo/cx_agency=>not_sufficient_numbers
                                            severity = if_abap_behv_message=>severity-warning ).
    ENDCASE.

    " At this point ALL entities get a number!
    ASSERT number_range_returned_quantity = lines( entities_wo_agencyid ).

    agency_id_max = number_range_key - number_range_returned_quantity.

    " Set Agency ID
    LOOP AT mapped-/dmo/agency ASSIGNING FIELD-SYMBOL(<agency>). " USING KEY entity" WHERE agencyid IS INITIAL.
      IF <agency>-agencyid IS INITIAL. " If condition necessary?
        agency_id_max += 1.
        <agency>-agencyid = agency_id_max.

        " Read table mapped assign
      ENDIF.
    ENDLOOP.

    ASSERT agency_id_max = number_range_key.

  ENDMETHOD.

ENDCLASS.
</pre>
<pre class="pre-cyan">
</pre>
<pre class="pre-cyan">
</pre>

<h2 id="Part1_SubPart2_PracSyst_Ex19">Exercise 19 - How to Implement an EML Statement</h2>
<pre class="pre-cyan">
@EndUserText.label : 'Flight Reference Scenario: Managing Agencies'
@AbapCatalog.enhancement.category : #EXTENSIBLE_ANY
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/agency {

  key client            : abap.clnt not null;
  key agency_id         : /dmo/agency_id not null;
  name                  : /dmo/agency_name;
  street                : /dmo/street;
  postal_code           : /dmo/postal_code;
  city                  : /dmo/city;
  country_code          : land1;
  phone_number          : /dmo/phone_number;
  email_address         : /dmo/email_address;
  web_address           : /dmo/web_address;
  attachment            : /dmo/attachment;
  mime_type             : /dmo/mime_type;
  filename              : /dmo/filename;
  local_created_by      : abp_creation_user;
  local_created_at      : abp_creation_tstmpl;
  local_last_changed_by : abp_locinst_lastchange_user;
  local_last_changed_at : abp_locinst_lastchange_tstmpl;
  last_changed_at       : abp_lastchange_tstmpl;
  include /dmo/s_ext_incl_agency;

}
</pre>

<pre class="pre-cyan">
" This is mine
@EndUserText.label : 'Flight Reference Scenario: Managing Agencies'
@AbapCatalog.enhancement.category : #EXTENSIBLE_ANY
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table /dmo/agency {

  key client            : abap.clnt not null;
  key agency_id         : /dmo/agency_id not null;
  name                  : /dmo/agency_name;
  street                : /dmo/street;
  postal_code           : /dmo/postal_code;
  city                  : /dmo/city;
  country_code          : land1;
  phone_number          : /dmo/phone_number;
  email_address         : /dmo/email_address;
  web_address           : /dmo/web_address;
  attachment            : /dmo/attachment;
  mime_type             : /dmo/mime_type;
  filename              : /dmo/filename;
  local_created_by      : abp_creation_user;
  local_created_at      : abp_creation_tstmpl;
  local_last_changed_by : abp_locinst_lastchange_user;
  local_last_changed_at : abp_locinst_lastchange_tstmpl;
  last_changed_at       : abp_lastchange_tstmpl;
  include /dmo/s_ext_incl_agency;

}
</pre>

<pre class="pre-cyan">
" Global Class – Case Only
	      WHEN 22.
          out->write( 'Case 22 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 19 - How to Implement an EML Statement' ).
          " This will update Table /DMO/AGENCY
          " Business Object /DMO/R_AgencyTP has something to do with this too.

          DATA update_tab_22 TYPE TABLE FOR UPDATE /DMO/R_AgencyTP.
          update_tab_22 = VALUE #(  ( agencyID = '070002' Name = 'MODIFIED Agency' ) ). " 'MODIFIED Agency'
          "AGENCY_ID = 070002
          "NAME      = Fly High
          " I will change back from 'MODIFIED Agency' to 'Fly High'

          MODIFY ENTITIES OF /DMO/R_AgencyTP
          ENTITY /DMO/Agency "The Table
          UPDATE FIELDS ( name )
          WITH update_tab_22.

          out->write( 'Code run to update 1 field in 1 row in table /DMO/Agency' ).
          out->write( 'THe change has not been applied in column NAME beacuse you have not commited the changes!' ).
          COMMIT ENTITIES.
          out->write( 'Code run to update 1 field in 1 row in table /DMO/Agency with commit.' ).
</pre>



<h2 id="Part1_SubPart2_PracSyst_Ex20">Exercise 20- Modify Data Using EML</h2>
<pre class="pre-cyan">
" data definition /DMO/I_AGENCYTP
@Metadata.ignorePropagatedAnnotations: true
@EndUserText.label: 'Agency'
@Search.searchable: true
@AccessControl.authorizationCheck: #NOT_REQUIRED

@AbapCatalog.extensibility: {
  extensible: true,
  dataSources: ['AGENCY'],
  elementSuffix: 'ZAG',
  quota: {
    maximumFields: 500,
    maximumBytes: 50000
  }, allowNewCompositions: true
}

define root view entity /DMO/I_AgencyTP
  provider contract transactional_interface
  as projection on /DMO/R_AgencyTP as Agency
{
      @ObjectModel.text.element: ['Name']
  key AgencyID,
  
      @Search.defaultSearchElement: true
      @Search.fuzzinessThreshold: 0.8
      @Semantics.text: true
      @Semantics.organization.name: true
      Name,
      
      @Semantics.address.street: true
      Street,
      
      @Semantics.address.zipCode: true
      PostalCode,
      
      @Search.defaultSearchElement: true
      @Semantics.address.city: true
      City,
      
      @Consumption.valueHelpDefinition: [{entity: { name: 'I_CountryVH', element: 'Country' } }]
      @Semantics.address.country: true
      CountryCode,
      
      @Semantics.telephone.type: [#WORK]
      PhoneNumber,
      
      @Semantics.eMail.address: true
      EMailAddress,
      WebAddress,
      
      @Semantics.largeObject: { mimeType: 'MimeType',
                                fileName: 'Filename',
                                contentDispositionPreference: #INLINE }
      Attachment,
      
      @Semantics.mimeType: true
      MimeType,
      Filename,
      
      @Semantics.user.createdBy: true
      LocalCreatedBy,
      
      @Semantics.systemDateTime.createdAt: true
      LocalCreatedAt,
      
      @Semantics.user.lastChangedBy: true
      LocalLastChangedBy,
      
      @Semantics.systemDateTime.localInstanceLastChangedAt: true
      LocalLastChangedAt,
      
      @Semantics.systemDateTime.lastChangedAt: true
      LastChangedAt,
      /* Associations */
      _Country
}
</pre>

<pre class="pre-cyan">
" Global Class – Case Only
      WHEN 23.
          out->write( 'Case 23 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 20- Modify Data Using EML' ).

          " Use EML to perform the standard operation update for the root entity of the business object /DMO/R_AGENCYTP.
          " Don not access the business object directly but via its released stable interface /DMO/_I_AGENCYTP

          " Template: none
          " Solution: /LRN/CL_S4D400_BOS_EML (global Class)
          " ZCL_##_EML

          " Implement an EML statement to change the name of the travel agency with ID "0700##".
          " ( ## stands for your group number.)

          DATA agencies_upd_23 TYPE TABLE FOR UPDATE /DMO/I_AgencyTP.

          "070020,No Return,Wahnheider Str. 57,51105,Koeln,DE,+49 221-5689-100,info@bye-bye.sap,http://www.bye-bye.sap,,,,,0.0000000,,0.0000000,0.0000000,No Return is the leader in business!
          agencies_upd_23 = VALUE #( ( agencyid = '070020' name = 'Some fancy new name') ). "'Some fancy new name' " 'No Return'
          "Latter I changed it back.

          "Implement an EML statement MODIFY ENTITIES for the business object interface /DMO/I_AgencyTP.
          "Update the data of the root entity, ensuring that only the field NAME is changed.
          "Remember that the interface behavior defines alias name /DMO/Agency for the root entity /DMO/I_AgencyTP.
             MODIFY ENTITIES OF /dmo/i_agencytp
                ENTITY /dmo/agency
                UPDATE FIELDS ( name )
                  WITH agencies_upd_23.

          COMMIT ENTITIES.

          out->write( `Method execution finished to update /DMO/I_AgencyTP!`  ).
</pre>

<pre class="pre-cyan">
Case 23 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx
Exercise 20- Modify Data Using EML
Method execution finished to update /DMO/I_AgencyTP!
</pre>

<h3 id="Code_List_11">Global Class zcl_ufh8n_hello_world (End of ABAP 40hr - Part 1 - Sub-Part 2)</h3>
<pre class="pre-cyan">
" Complete Code 
" ZCL_UFH8N_HELLO_WORLD
" Global Class
" Global Class – All
" This is 1721 lines of code

CLASS zcl_ufh8n_hello_world DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.

    INTERFACES if_oo_adt_classrun .
  PROTECTED SECTION.
  PRIVATE SECTION.
ENDCLASS.



CLASS zcl_ufh8n_hello_world IMPLEMENTATION.


  METHOD if_oo_adt_classrun~main.
    DATA lv_switch TYPE int4.
    lv_switch = 14."14.

    CASE lv_switch.
      WHEN 1.
        out->write( 'Case 1 Run!' ).
        out->write( 'Hello World UFH8N!' ).
*        out->write( 'Hello World UFH8N!' ).
        "out->write( 'Hello World UFH8N!' ).

        "CTRL + zooms in, not comments out
        "CTRL + Shift + zooms in, not comments out and splits screen

        "CTRL + Shift + < does comment out and CTRL + Shift + > un-comments
        out->write( 'Hello World UFH8N!' ).
        out->write( 'Hello World UFH8N!' ).
      WHEN 2.
          out->write( 'Case 2 Run!' ).
*         Data Objects with Built-in Types
*        *********************************************************************

            " comment/uncomment the following declarations and check the output
            DATA variable_s_02 TYPE string.
            DATA variable_i_02 TYPE i.
            DATA variable_d_02 TYPE d.
            DATA variable_c_02 TYPE c LENGTH 10.
            DATA variable_n_02 TYPE n LENGTH 10.
            DATA variable_p_02 TYPE p LENGTH 8 DECIMALS 2.

*         Output
*        *********************************************************************

            out->write( 'Result with Initial Value)' ).
            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            out->write( variable_p_02 ).

            out->write(  '---------' ).

            out->write(  'Result with Values' ).
            variable_s_02 = 'UFH8N'.
            variable_i_02 = 10.
            variable_d_02 = '20251028'.
            variable_c_02 = 'L'.
            variable_n_02 = '3'.
            variable_n_02 = 3. "Not sure if 3 or '3'
            "variable_p_02 = 3.14. "How to do packaged numbers?

            "variable_d_02 = '19891109'.

            out->write( variable_s_02 ).
            out->write( variable_i_02 ).
            out->write( variable_d_02 ).
            out->write( variable_c_02 ).
            out->write( variable_n_02 ).
            "out->write( variable_p_02 ).
            out->write(  '---------' ).

      WHEN 3.
          out->write( 'Case 3 Run!' ).

*         Example 1: Local Types
*        *********************************************************************

*         Comment/Uncomment the following lines to change the type of my_var
            TYPES my_type_p_03 TYPE p LENGTH 3 DECIMALS 2.
            TYPES my_type_i_03 TYPE i .
            TYPES my_type_s_03 TYPE string.
            TYPES my_type_n_03 TYPE n length 10.

*         Variable based on local type
            DATA my_variable_n_03 TYPE my_type_n_03.

            out->write(  `my_variable (TYPE MY_TYPE)` ).
            out->write( my_variable_n_03 ).
            "Can't use a TYPE, must be a DATA

*         Example 2: Global Types
*        *********************************************************************

*         Variable based on global type .
            " Place cursor on variable and press F2 or F3
            DATA airport_03 TYPE /dmo/airport_id VALUE 'FRA'. "Char 3

            out->write(  `airport (TYPE /DMO/AIRPORT_ID )` ).
            out->write(   airport_03 ).

*         Example 3: Constants
*        *********************************************************************

            CONSTANTS c_text_03   TYPE string VALUE `Hello World`.
            CONSTANTS c_number_03 TYPE i      VALUE 12345.

            "Uncomment this line to see syntax error ( VALUE is mandatory)
          "constants c_text2   type string. "VALUE ... Not Specified
          "ToDo: Was there not a way to allow initial Constants

            out->write(  `c_text (TYPE STRING)` ).
            out->write(   c_text_03 ).
            out->write(  '---------' ).

            out->write(  `c_number (TYPE I )` ).
            out->write(   c_number_03 ).
            out->write(  `---------` ).

*         Example 4: Literals
*        *********************************************************************

            out->write(  '12345               ' ).    "Text Literal   (Type C)
            out->write(  `12345               ` ).    "String Literal (Type STRING)
            out->write(  12345                  ).    "Number Literal (Type I)

            "uncomment this line to see syntax error (no number literal with digits)
            "out->write(  12345.67                  ). "Ended unexpectedly

      WHEN 4.
          out->write( 'Case 4 Run!' ).
*         Declarations
*        *********************************************************************

            " comment/uncomment these line for different result types
            TYPES t_result_1_04 TYPE p LENGTH 8 DECIMALS 2.
            TYPES t_result_2_04 TYPE p LENGTH 8 DECIMALS 0.
            TYPES t_result_3_04 TYPE i.

            DATA result_1_04 TYPE t_result_1_04.
            DATA result_2_04 TYPE t_result_2_04.
            DATA result_3_04 TYPE t_result_3_04.

*         Calculations
*        *********************************************************************
            " comment/uncomment these lines for different calculations
            out->write( '_____________________________________' ).

            result_1_04 = 2 + 3.
            result_2_04 = 2 + 3.
            result_3_04 = 2 + 3.
            out->write( '2 + 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 - 3.
            result_2_04 = 2 - 3.
            result_3_04 = 2 - 3.
            out->write( '2 - 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 * 3.
            result_2_04 = 2 * 3.
            result_3_04 = 2 * 3.
            out->write( '2 * 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 2 / 3.
            result_2_04 = 2 / 3.
            result_3_04 = 2 / 3.
            out->write( '2 / 3' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = sqrt( 2 ).
            result_2_04 = sqrt( 2 ).
            result_3_04 = sqrt( 2 ).
            out->write( 'sqrt( 2 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = ipow( base = 2 exp = 3 ).
            result_2_04 = ipow( base = 2 exp = 3 ).
            result_3_04 = ipow( base = 2 exp = 3 ).
            out->write( 'ipow( base = 2 exp = 3 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).
*
            result_1_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_2_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            result_3_04 = ( 8 * 7 - 6 ) / ( 5 + 4 ).
            out->write( '( 8 * 7 - 6 ) / ( 5 + 4 )' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

            result_1_04 = 8 * 7 - 6 / 5 + 4.
            result_2_04 = 8 * 7 - 6 / 5 + 4.
            result_3_04 = 8 * 7 - 6 / 5 + 4.
            out->write( '8 * 7 - 6 / 5 + 4' ).
            out->write( result_1_04 ).
            out->write( result_2_04 ).
            out->write( result_3_04 ).
            out->write( '_____________________________________' ).

*         Output
*        *********************************************************************
      WHEN 5.
          out->write( 'Case 5 Run!' ).
*         Declarations
*        *********************************************************************
            TYPES t_amount_05 TYPE  p LENGTH 8 DECIMALS 2.

            DATA amount_05   TYPE t_amount_05 VALUE '3.30'. "3.3
            DATA amount1_05  TYPE t_amount_05 VALUE '1.20'. "1.2
            DATA amount2_05  TYPE t_amount_05 VALUE '2.10'. "2.1

            DATA the_date_05  TYPE d                     VALUE '19891109'. "1989-11-09
            DATA my_number_05 TYPE p LENGTH 3 DECIMALS 2 VALUE '-273.15'.  "-273.15

            DATA part1_05 TYPE string VALUE `Hello`.    "Hello
            DATA part2_05 TYPE string VALUE `World`.    "World

            out->write( '_____________________________________' ).

            out->write( amount_05 ).    "3.3
            out->write( amount1_05 ).   "1.2
            out->write( amount2_05 ).   "2.1
            out->write( the_date_05 ).  "1989-11-09
            out->write( my_number_05 ). "-273.15
            out->write( part1_05 ).     "Hello
            out->write( part2_05 ).     "World

            out->write( '_____________________________________' ).

*         String Templates
*        *********************************************************************

            " comment/uncomment the following lines for different examples
            DATA(text_1a_05) = |Hello World|.                               "Hello World
            DATA(text_1b_05) = |Total: { amount_05 } EUR|.                  "Total: 3.30 EUR
            DATA(text_1c_05) = |Total: { amount1_05 + amount2_05 } EUR|.    "Total: 3.30 EUR

            out->write( text_1a_05 ).   "Hello World
            out->write( text_1b_05 ).   "Total: 3.30 EUR
            out->write( text_1c_05 ).   "Total: 3.30 EUR

            out->write( '_____________________________________' ).

*         Format Options
*        *********************************************************************

            "Date
            DATA(text_2a_05) = |Raw Date: { the_date_05             }|. "Raw Date: 19891109
            DATA(text_2b_05) = |ISO Date: { the_date_05 Date = ISO  }|. "ISO Date: 1989-11-09
            DATA(text_2c_05) = |USER Date:{ the_date_05 Date = USER }|. "USER Date:11/09/1989

            out->write( text_2a_05 ).   "Raw Date: 19891109
            out->write( text_2b_05 ).   "ISO Date: 1989-11-09
            out->write( text_2c_05 ).   "USER Date:11/09/1989

            out->write( '_____________________________________' ).

            "Number
            DATA(text_3a_05) = |Raw Number { my_number_05                    }|.    "Raw Number -273.15
            DATA(text_3b_05) = |User Format{ my_number_05 NUMBER = USER      }|.    "User Format-273.15
            DATA(text_3c_05) = |Sign Right { my_number_05 SIGN = RIGHT       }|.    "Sign Right 273.15-
            DATA(text_3d_05) = |Scientific { my_number_05 STYLE = SCIENTIFIC }|.    "Scientific -2.7315E+02

            out->write( text_3a_05 ).   "Raw Number -273.15
            out->write( text_3b_05 ).   "User Format-273.15
            out->write( text_3c_05 ).   "Sign Right 273.15-
            out->write( text_3d_05 ).   "Scientific -2.7315E+02

            out->write( '_____________________________________' ).

*         String expression (concatenation Operator)
*        *********************************************************************

            DATA(text_4a_05) = part1_05 && part2_05.
            DATA(text_4b_05)  = part1_05 && | | && part2_05.
            DATA(text_4c_05)  = |{ amount1_05 } + { amount2_05 }| &&
                              | = | &&
                              |{ amount1_05 + amount2_05 }|.

            out->write( text_4a_05 ).   "HelloWorld
            out->write( text_4b_05 ).   "Hello World
            out->write( text_4c_05 ).   "1.20 + 2.10 = 3.30
            out->write( '_____________________________________' ).


*         Output
*        *********************************************************************
            "out->write( text_05 ).
      WHEN 6.
          out->write( 'Case 6 Run!' ).
          "Declare Variables and Process Data
          "ZCL_##_COMPUTE
          DATA number1_06 TYPE i.
          DATA number2_06 TYPE i.
          DATA result_06  TYPE p LENGTH 8 DECIMALS 2.

          number1_06 = -8.
          number2_06 =  3.

          result_06 = number1_06 / number2_06.

          DATA(output_06) = |{ number1_06 } / { number2_06 } = { result_06 }|.

          out->write( output_06 ).

      WHEN 7.
          out->write( 'Case 7 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_07 TYPE i VALUE 0.
*            CONSTANTS c_number_07 TYPE i VALUE 1.
*            CONSTANTS c_number_07 TYPE i VALUE 2.
*            CONSTANTS c_number_07 TYPE i VALUE -1.
*            CONSTANTS c_number_07 TYPE i VALUE -2.

*         Example 1: Simple IF ... ENDIF.
*        *********************************************************************

            out->write(  `--------------------------------` ).
            out->write(  `Example 1: Simple IF ... ENDIF.` ).
            out->write(  `-------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is NOT zero`   ).
            ENDIF.

*         Example 2: Optional Branches ELSEIF and ELSE
*        *********************************************************************

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 2: Optional Branches ELSEIF and ELSE` ).
            out->write(  `--------------------------------------------` ).

            IF c_number_07 = 0.
              out->write( `The value of C_NUMBER equals zero`            ).
            ELSEIF c_number_07 > 0.
              out->write( `The value of C_NUMBER is greater than zero`   ).
            ELSE.
              out->write( `The value of C_NUMBER is less than zero`      ).
            ENDIF.

*         Example 3: CASE ... ENDCASE
*        *********************************************************************

            out->write(  `---------------------------` ).
            out->write(  `Example 3: CASE ... ENDCASE` ).
            out->write(  `---------------------------` ).

            CASE c_number_07.
              WHEN 0.
                out->write( `The value of C_NUMBER equals zero`             ).
              WHEN 1.
                out->write( `The value of C_NUMBER equals one`              ).
              WHEN 2.
                out->write( `The value of C_NUMBER equals two`              ).
              WHEN OTHERS.
                out->write( `The value of C_NUMBER equals non of the above` ).
            ENDCASE.

      WHEN 8.
          out->write( 'Case 8 Run!' ).
*         Declarations
*        *********************************************************************
            DATA result_08 TYPE i.

            DATA numbers_08 TYPE TABLE OF i.

*         Preparation
*        *********************************************************************

            APPEND 123 TO numbers_08.

*         Example 1: Conversion Error (no Number)
*        *********************************************************************

            CONSTANTS c_text_08 TYPE string VALUE 'ABC'.
*            CONSTANTS c_text_08 TYPE string VALUE '123'.

            out->write(  `---------------------------` ).
            out->write(  `Example 1: Conversion Error` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = c_text_08.
                out->write( |Converted content is { result_08 }|  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_text_08 } is not a number!| ).
            ENDTRY.

*         Example 2: Division by Zero
*        *********************************************************************

            CONSTANTS c_number_08 TYPE i VALUE 0.
*            CONSTANTS c_number_08 TYPE i VALUE 7.

            out->write(  `---------------------------` ).
            out->write(  `Example 2: Division by Zero` ).
            out->write(  `---------------------------` ).

            TRY.
                result_08 = 100 / c_number_08.
                out->write( |100 divided by { c_number_08 } equals { result_08 }| ).
              CATCH cx_sy_zerodivide.
                out->write(  `Error: Division by zero is not defined!` ).
            ENDTRY.

*         Example 3: Itab Error (Line Not Found)
*        *********************************************************************

            CONSTANTS c_index_08 TYPE i VALUE 2.
*            CONSTANTS c_index_08 TYPE i VALUE 1.

            out->write(  `-------------------------` ).
            out->write(  `Example 3: Line Not Found` ).
            out->write(  `-------------------------` ).

            TRY.
                result_08 = numbers_08[ c_index_08 ].
                out->write( |Content of row { c_index_08 } equals { result_08 }| ).
              CATCH cx_sy_itab_line_not_found.
                out->write(  `Error: Itab has less than { c_index } rows!` ).
            ENDTRY.


*         Example 4: Combination of Different Exceptions
*        *********************************************************************
*            CONSTANTS c_char TYPE c LENGTH 1 VALUE 'X'.
*            CONSTANTS c_char TYPE c length 1 value '0'.
            CONSTANTS c_char_08 TYPE c LENGTH 1 VALUE '1'.
*            CONSTANTS c_char TYPE c length 1 value '2'.

            out->write(  `----------------------` ).
            out->write(  `Example 4: Combination` ).
            out->write(  `----------------------` ).

            TRY.
                result_08 = numbers_08[ 2 / c_char_08 ].
                out->write( |Result: { result_08 } | ).
              CATCH cx_sy_zerodivide.
                out->write( `Error: Division by zero is not defined`  ).
              CATCH cx_sy_conversion_no_number.
                out->write( |Error: { c_char_08 } is not a number! | ).
              CATCH cx_sy_itab_line_not_found.
                out->write( |Error: Itab contains less than { 2 / c_char_08 } rows| ).
            ENDTRY.

      WHEN 9.
          out->write( 'Case 9 Run!' ).

*         Declarations
*        *********************************************************************

            CONSTANTS c_number_09 TYPE i VALUE 3.
*            CONSTANTS c_number TYPE i VALUE 5.
*            CONSTANTS c_number TYPE i VALUE 10.

            DATA number_09 TYPE i.

*         Example 1: DO ... ENDDO with TIMES
*        *********************************************************************

            out->write(  `----------------------------------` ).
            out->write(  `Example 1: DO ... ENDDO with TIMES` ).
            out->write(  `----------------------------------` ).

            DO c_number_09 TIMES.
              out->write(  `Hello World` ).
            ENDDO.

*         Example 2: DO ... ENDDO with Abort Condition
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: With Abort Condition` ).
            out->write(  `-------------------------------` ).

            number_09 = c_number_09 * c_number_09.

            " count backwards from number to c_number.
            DO.

              out->write( |{ sy-index }: Value of number: {  number_09 }| ).
              number_09 = number_09 - 1.

              "abort condition
              IF number_09 <= c_number_09.
                EXIT.
              ENDIF.

            ENDDO.

      WHEN 10.
          out->write( 'Case 10 Run!' ).

*         Declarations
*        *********************************************************************

            " Internal tables
            DATA numbers_10 TYPE TABLE OF i.

            "Table type (local)
            TYPES tt_strings_10 TYPE TABLE OF string.
            DATA texts1_10      TYPE tt_strings_10.

            " Table type (global)
            DATA texts2_10 TYPE string_table.

            " work areas
            DATA number_10 TYPE i VALUE 1234.
            DATA text_10   TYPE string.

*         Example 1: APPEND
*        *********************************************************************

            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `-----------------` ).
            out->write(  `Example 1: APPEND` ).
            out->write(  `-----------------` ).

            out->write( numbers_10 ).

*         Example 2: CLEAR
*        *********************************************************************

            CLEAR numbers_10.

            out->write(  `----------------` ).
            out->write(  `Example 2: CLEAR` ).
            out->write(  `----------------` ).

            out->write( numbers_10 ).

*         Example 3: table expression
*        *********************************************************************
            APPEND 4711          TO numbers_10.
            APPEND number_10     TO numbers_10.
            APPEND 2 * number_10 TO numbers_10.

            out->write(  `---------------------------` ).
            out->write(  `Example 3: Table Expression` ).
            out->write(  `---------------------------` ).

            number_10 = numbers_10[ 2 ] .

            out->write( |Content of row 2: { number_10 }|    ).
            "Direct use of expression in string template
            out->write( |Content of row 1: { numbers_10[ 1 ]  }| ).

*         Example 4: LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `---------------------------` ).
            out->write(  `Example 4: LOOP ... ENDLOOP` ).
            out->write(  `---------------------------` ).

            LOOP AT numbers_10 INTO number_10.

              out->write( |Row: { sy-tabix } Content { number_10 }| ).

            ENDLOOP.

*         Example 5: Inline declaration in LOOP ... ENDLOOP
*        *********************************************************************
            out->write(  `-----------------------------` ).
            out->write(  `Example 5: Inline Declaration` ).
            out->write(  `-----------------------------` ).

            LOOP AT numbers_10 INTO DATA(number_inline_10).
              out->write( |Row: { sy-tabix } Content { number_inline_10 }| ).
            ENDLOOP.

      WHEN 11.
          out->write( 'Case 11 Run!' ).
          " ZCL_##_ITERATE
          CONSTANTS max_count_11 TYPE i VALUE 20.
          DATA numbers_11 TYPE TABLE OF i.

          DATA output_11 TYPE TABLE OF string. "Guess
          "DATA loop_count TYPE INT4.        "Guess

          DO max_count_11 TIMES.
            CASE sy-index.
              WHEN 1.
                APPEND 0 TO numbers_11.
              WHEN 2.
                APPEND 1 TO numbers_11.
              WHEN OTHERS.
                  APPEND numbers_11[  sy-index - 2 ]
                       + numbers_11[  sy-index - 1 ]
                      TO numbers_11.
            ENDCASE.

          ENDDO.

          DATA(counter_11) = 0.
          LOOP AT numbers_11 INTO DATA(number).
            counter_11 = counter_11 + 1.
            APPEND |{ counter_11 WIDTH = 4 }: { number WIDTH = 10 ALIGN = RIGHT }| TO output_11.
          ENDLOOP.

         out->write(
         data   = output_11
         name   = |The first { max_count_11 } Fibonacci Numbers|
                ) .

      WHEN 12.
          out->write( 'Case 12 Run!' ).

          DATA lv_str_tbl_12 TYPE string_table.
          APPEND |This covers a range of exercises:| TO lv_str_tbl_12.
          APPEND |How To Create A Local Class In A Global Class| TO lv_str_tbl_12.
          APPEND |Define a Local Class | TO lv_str_tbl_12.
          APPEND |How to Create Instances of an ABAP Class| TO lv_str_tbl_12.
          APPEND |How To Manage Instances in an Internal Table| TO lv_str_tbl_12.
          APPEND |Create and Manage Instances| TO lv_str_tbl_12.
          APPEND |How to Define Methods| TO lv_str_tbl_12.
          APPEND |How to Implement Methods| TO lv_str_tbl_12.
          APPEND |How to Call Methods| TO lv_str_tbl_12.
          APPEND |Method Calls and Exception Handling| TO lv_str_tbl_12.
          APPEND |Functional Methods| TO lv_str_tbl_12.
          APPEND |Define and Call Methods| TO lv_str_tbl_12.
          APPEND |How To Use Private Attributes| TO lv_str_tbl_12.
          APPEND |How To Define An Instance Constructor| TO lv_str_tbl_12.
          APPEND |How To Debug The Execution Of Constructors| TO lv_str_tbl_12.
          APPEND |Use Private Attributes and a Constructor| TO lv_str_tbl_12.
          "This concludes:
          "Done 30/10/2025 ##Exercise 36 - Use Private Attributes and a Constructor
          "Found in file: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 1 - Exercises.docx
          "Progress now to:
          "Exercise 1 - How to Analyze a Database Table
          "Found in file: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises.docx
          "That will be done in the next WHEN
          APPEND |* * * * * * * * | TO lv_str_tbl_12.
          APPEND |Use of Static Constructor was not disccused.| TO lv_str_tbl_12.
          out->write( lv_str_tbl_12 ).

          DATA carrier_id_12    TYPE /dmo/carrier_id.
          DATA connection_id_12 TYPE /dmo/connection_id.

          "CONSTANTS c_carrier_id_12    TYPE /dmo/carrier_id    VALUE 'LH'.
          "CONSTANTS c_connection_id_12 TYPE /dmo/connection_id VALUE '0400'.


          DATA lcl_ufh8n_connection_12 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_12          TYPE TABLE OF REF TO lcl_ufh8n_connection.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).
          "DATA lcl_ufh8n_connection_b_12 TYPE REF TO lcl_ufh8n_connection.

          "out->write(  |i_carrier_id    = '{ c_carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ c_connection_id_12 }'| ).

          "carrier_id_12    = 'QA'.
          "connection_id_12 = '0200'.

          "out->write(  |i_carrier_id    = '{ carrier_id_12 }' | ).
          "out->write(  |i_connection_id = '{ connection_id_12 }'| ).

          "lcl_ufh8n_connection_b_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12->carrier_id = 'LH'.
          "lcl_ufh8n_connection_12->connection_id = '0400'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.


        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'LH'
*                i_connection_id = '0400'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
          "lcl_ufh8n_connection_12->carrier_id = 'AA'.
          "lcl_ufh8n_connection_12->connection_id = '0017'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).
            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_12 = new #( ).
          "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
          "lcl_ufh8n_connection_12->carrier_id = 'SQ'.
          "lcl_ufh8n_connection_12->connection_id = '0001'.
          "APPEND lcl_ufh8n_connection_12 TO connections_12.

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'SQ'
*                i_connection_id = '0001'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        "lcl_ufh8n_connection_12 = new #( ).
        "lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).

        TRY.
*            lcl_ufh8n_connection_12->set_attributes(
*              EXPORTING
*                i_carrier_id    = 'AA'
*                i_connection_id = '0017'
*            ).

            lcl_ufh8n_connection_12 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_12 TO connections_12.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             out->write( `Method call failed`     ).
         ENDTRY.

          "lcl_ufh8n_connection_b_12 = lcl_ufh8n_connection_a_12.

          LOOP AT connections_12  INTO lcl_ufh8n_connection_12.
            lcl_ufh8n_connection_12->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_12
                e_connection_id = connection_id_12 ).
            out->write( |Flight Connection {  carrier_id_12 } { connection_id_12 }| ).
          ENDLOOP.

          "For Exercise 31 - Functional Methods
          "out->write( `Exercise 31`     ).
          " in a value assignment (with inline declaration for result)
          " I had to rewrite a bit
          DATA(result_12) = lcl_ufh8n_connection_12->get_output( ).

          " in logical expression
          IF connections_12 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_12 INTO DATA(line_12).

                out->write( line_12->get_output(  ) ).

            "  to supply input parameter of another method
            "out->write( data = line_12->get_output( )
            "            name = `  ` ).
            ENDLOOP.
          ENDIF.




      WHEN 13.
          out->write( 'Case 13 Run!' ).
          "From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx

          "Note: Exercise 1 - How to Analyze a Database Table
          ".. This was a follow along for table /dmo/connection



            "Other Files:   D:\Luke-No_C_Space          | S4D400.docx
            "               C:\Users\luke_\Downloads    | SAP_Training_Exercise.docx
            "               One Drive                   | S4D400 - Basic ABAP Programming – Exercises - Trail System.docx
          "ZCL__01_INSTANCE_ITAB "Random Comment

        "Exercise 2 - SELECT Examples
        DATA airport_from_id_13 TYPE /DMO/airport_from_id.
        DATA airport_to_id_13   TYPE /DMO/airport_to_id.

        DATA airports_13 TYPE TABLE OF /DMO/airport_from_id.

*     Example 1: Single field from Single Record
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id
          WHERE carrier_id    = 'LH'
            AND connection_id = '0400'
            INTO @airport_from_id_13. "Record did exist

        out->write( `----------`  ).
        out->write( `Example 1:`  ).

        out->write( |Flight LH 400 departs from {  airport_from_id_13 }.| ).

*     Example 2: Multiple Fields from Single Record
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id, airport_to_id
          WHERE carrier_id    = 'LH'
            AND connection_id = '0400'
            INTO (  @airport_from_id_13, @airport_to_id_13 ). "Record did exist

        out->write( `----------`  ).
        out->write( `Example 2:`  ).

        out->write( |Flight LH 400 flies from {  airport_from_id_13 } to { airport_to_id_13  }| ).

*     Example 3: Empty Result and sy-subrc
*    *********************************************************************
        SELECT SINGLE
          FROM /dmo/connection
          FIELDS airport_from_id
          WHERE carrier_id    = 'XX'
            AND connection_id = '1234'
            INTO @airport_from_id_13. "Record does not exist

        IF sy-subrc = 0.

          out->write( `----------`  ).
          out->write( `Example 3:`  ).
          out->write( |Flight XX 1234 departs from {  airport_from_id_13 }.| ).

        ELSE.

          out->write( `----------`  ).
          out->write( `Example 3:`  ).
          out->write( |There is no flight XX 1234, but still airport_from_id = {  airport_from_id_13 }!| ).

        ENDIF.

        out->write( 'END: Case 13 Run!' ).
      WHEN 14.
          out->write( 'Case 14 Run!' ).
          "Template = /LRN/CL_S4D400_CLS_CONSTRUCTOR | Solution = /LRN/CL_S4D400_DBS_SELECT    | ZCL_##_SELECT
          "Template = /LRN/CL_S4D400_DBS_SELECT      | Solution = /LRN/CL_S4D400_DBS_CDS       | ZCL_##_CDS
          "Template = /LRN/CL_S4D400_DBS_CDS         | Solution = /LRN/CL_S4D400_STS_STRUCTURE | ZCL_##_STRUCTURE
          "Template = /LRN/CL_S4D400_STS_STRUCTURE   | Solution = /LRN/CL_S4D400_ITS_ITAB      | ZCL_##_ITAB
          "Please note. I will use the base code that has been cleaned up from WHEN 12.
          "The Local Class lcl_ufh8n_connection will be modified and I will do a backup first.

          DATA lv_str_tbl_14 TYPE string_table.
          APPEND |From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:| TO lv_str_tbl_14.
          APPEND |SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples| TO lv_str_tbl_14.
          APPEND |Exercise 3 - Read Data from a Database Table:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:| TO lv_str_tbl_14.
          APPEND |Exercise 5 - Analyze and Use a CDS View Entity| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:| TO lv_str_tbl_14.
          APPEND |See WHEN 15: Exercise 7 - Structured Data Types:| TO lv_str_tbl_14.
          APPEND |See WHEN 16: Exercise 8 - Access to Structured Data Objects:| TO lv_str_tbl_14.
          APPEND |See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL| TO lv_str_tbl_14.
          APPEND |Exercise 10 - Use a Structured Data Object| TO lv_str_tbl_14.
          APPEND |See WHEN 18: Exercise 11 - Complex Table Types:| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 12 - How To Debug Complex Internal Tables:| TO lv_str_tbl_14.
          APPEND |See WHEN 19: Exercise 13 - Filling Complex Internal Tables| TO lv_str_tbl_14.
          APPEND |See WHEN 20: Exercise 14 - Access to Complex Internal Tables| TO lv_str_tbl_14.
          APPEND |See WHEN 21: Exercise 15 - Internal Tables in ABAP SQL| TO lv_str_tbl_14.
          APPEND |Exercise 16 - Use a Complex Internal Table| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 17 - How To Analyze A Business Object| TO lv_str_tbl_14.
          APPEND |FOLLOW ALONG ONLY: Exercise 18 - Analyze a Business Object| TO lv_str_tbl_14.
          APPEND |See WHEN 22: Exercise 19 - How to Implement an EML Statement:| TO lv_str_tbl_14.
          APPEND |See WHEN 23: Exercise 20 - Modify Data Using EML:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          APPEND |xxx:| TO lv_str_tbl_14.
          out->write( lv_str_tbl_14 ).

          DATA carrier_id_14    TYPE /dmo/carrier_id.
          DATA connection_id_14 TYPE /dmo/connection_id.

          DATA lcl_ufh8n_connection_14 TYPE REF TO          lcl_ufh8n_connection.
          DATA connections_14          TYPE TABLE OF REF TO lcl_ufh8n_connection.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'LH' i_connection_id = '0400' ).

             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'SQ' i_connection_id = '0001' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.


        TRY.
            lcl_ufh8n_connection_14 = new #(  i_carrier_id =  'AA' i_connection_id = '0017' ).
             APPEND lcl_ufh8n_connection_14 TO connections_14.
             "out->write( `Method call successful` ).
         CATCH cx_abap_invalid_value.
             "out->write( `Method call failed`     ).
         ENDTRY.

          LOOP AT connections_14  INTO lcl_ufh8n_connection_14.
            lcl_ufh8n_connection_14->get_attributes(
              IMPORTING
                e_carrier_id = carrier_id_14
                e_connection_id = connection_id_14 ).
            out->write( |Flight Connection {  carrier_id_14 } { connection_id_14 }| ).
          ENDLOOP.

          DATA(result_14) = lcl_ufh8n_connection_14->get_output( ).

          " in logical expression
          IF connections_14 IS NOT INITIAL.

            " as operand in a statement
            LOOP AT connections_14 INTO DATA(line_14).

                out->write( line_14->get_output(  ) ).
            ENDLOOP.
          ENDIF.

      WHEN 15.
          out->write( 'Case 15 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 7 - Structured Data Types' ).

*         Example 1 : Motivation for Structured Variables
*        *********************************************************************

            DATA connection_full_15 TYPE /DMO/I_Connection.

            SELECT SINGLE
             FROM /dmo/I_Connection
           FIELDS AirlineID, ConnectionID, DepartureAirport, DestinationAirport,
                  DepartureTime, ArrivalTime, Distance, DistanceUnit
            WHERE AirlineId    = 'LH'
              AND ConnectionId = '0400'
             INTO @connection_full_15.

            out->write(  `--------------------------------------` ).
            out->write(  `Example 1: CDS View as Structured Type` ).
            out->write( connection_full_15 ).

*         Example 2: Global Structured Type
*        *********************************************************************

            DATA message_15 TYPE symsg.

            out->write(  `---------------------------------` ).
            out->write(  `Example 2: Global Structured Type` ).
            out->write( message_15 ).

*         Example 3 : Local Structured Type
*        *********************************************************************

            TYPES: BEGIN OF st_connection_15,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_15.

            DATA connection_15 TYPE st_connection_15.

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
             WHERE AirlineID = 'LH'
               AND ConnectionID = '0400'
              INTO @connection_15.

            out->write(  `---------------------------------------` ).
            out->write(  `Example 3: Local Structured Type` ).
            out->write( connection_15 ).

*         Example 4 : Nested Structured Type
*        *********************************************************************

            TYPES: BEGIN OF st_nested_15,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     message         TYPE symsg,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_nested_15.

            DATA connection_nested_15 TYPE st_nested_15.

            out->write(  `---------------------------------` ).
            out->write(  `Example 4: Nested Structured Type` ).
            out->write( connection_nested_15 ).

      WHEN 16.
          out->write( 'Case 16 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 8 - Access to Structured Data Objects' ).

            TYPES: BEGIN OF st_connection_16,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_16.

            TYPES: BEGIN OF st_connection_nested_16,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     message         TYPE symsg,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_nested_16.

            DATA connection_16 TYPE st_connection_16.
            DATA connection_nested_16 TYPE st_Connection_nested_16.

*         Example 1: Access to structure components
*        *********************************************************************

            connection_16-airport_from_id = 'ABC'.
            connection_16-airport_to_id   = 'XYZ'.
            connection_16-carrier_name    = 'My Airline'.

            "Access to sub-components of nested structure
            connection_nested_16-message-msgty = 'E'.
            connection_nested_16-message-msgid = 'ABC'.
            connection_nested_16-message-msgno = '123'.

*         Example 2: Filling a structure with VALUE #(    ).
*        *********************************************************************

          CLEAR connection_16.

            connection_16 = VALUE #( airport_from_id = 'ABC'
                                     airport_to_id   = 'XYZ'
                                     carrier_name    = 'My Airline'
                                ).

            " Nested VALUE to fill nested structure
            connection_nested_16 = VALUE #( airport_from_id = 'ABC'
                                            airport_to_id   = 'XYZ'
                                            message         = VALUE #( msgty = 'E'
                                                                       msgid = 'ABC'
                                                                       msgno = '123' )
                                         carrier_name    = 'My Airline'
                                 ).

*         Example 3: Wrong result after direct assignment
*        *********************************************************************

            connection_nested_16 = connection_16.

            out->write(  `-------------------------------------------------------------` ).
            out->write(  `Example 3: Wrong Result after direct assignment` ).

            out->write( data = connection_16
                        name = `Source Structure:`).

            out->write( |Component connection_nested-message-msgid: { connection_nested_16-message-msgid }| ).
            out->write( |Component connection_nested-carrier_name : { connection_nested_16-carrier_name  }| ).

*         Example 4: Assigning Structures using CORRESPONDING #( )
*        *********************************************************************
            CLEAR connection_nested_16.
            connection_nested_16 = CORRESPONDING #(  connection_16 ).  "

            out->write(  `-------------------------------------------------------------` ).
            out->write(  `Example 4: Correct Result after assignment with CORRESPONDING` ).

            out->write( data = connection_16
                        name = `Source Structure:`).

            out->write( |Component connection_nested-message-msgid: { connection_nested_16-message-msgid }| ).
            out->write( |Component connection_nested-carrier_name : { connection_nested_16-carrier_name  }| ).

      WHEN 17.
          out->write( 'Case 17 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 9 - Structured Data Objects in ABAP SQL' ).

             TYPES: BEGIN OF st_connection_17,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_17.

            TYPES: BEGIN OF st_connection_short_17,
                     DepartureAirport   TYPE /dmo/airport_from_id,
                     DestinationAirport TYPE /dmo/airport_to_id,
                   END OF st_connection_short_17.


            DATA connection_17 TYPE st_connection_17.

            DATA connection_short_17 TYPE st_connection_short_17.

            DATA connection_full_17 TYPE /DMO/I_Connection.

*         Example 1: Correspondence between FIELDS and INTO
*        *********************************************************************

            SELECT SINGLE
               FROM /DMO/I_Connection
             FIELDS DepartureAirport, DestinationAirport, \_Airline-Name
              WHERE AirlineID = 'LH'
                AND ConnectionID = '0400'
               INTO @connection_17.

            out->write(  `------------------------------` ).
            out->write(  `Example 1: Field List and INTO` ).
            out->write( connection_17 ).

*         Example 2: FIELDS *
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS *
             WHERE AirlineID = 'LH'
               AND ConnectionID = '0400'
              INTO @connection_full_17.

            out->write(  `----------------------------` ).
            out->write(  `Example 2: FIELDS * and INTO` ).
            out->write( connection_full_17 ).

*         Example 3: INTO CORRESPONDING FIELDS
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS *
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO CORRESPONDING FIELDS OF @connection_short_17.

            out->write(  `----------------------------------------------------` ).
            out->write(  `Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF` ).
            out->write( connection_short_17 ).

*         Example 4: Alias Names for Fields
*        *********************************************************************

            CLEAR connection_17.

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport AS airport_from_id,
                   \_Airline-Name   AS carrier_name
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO CORRESPONDING FIELDS OF @connection_17.

            out->write(  `---------------------------------------------------` ).
            out->write(  `Example 4: Aliases and INTO CORRESPONDING FIELDS OF` ).
            out->write( connection_17 ).

*         Example 5: Inline Declaration
*        *********************************************************************

            SELECT SINGLE
              FROM /DMO/I_Connection
            FIELDS DepartureAirport,
                   DestinationAirport AS ArrivalAirport,
                   \_Airline-Name     AS carrier_name
             WHERE AirlineID    = 'LH'
               AND ConnectionID = '0400'
              INTO @DATA(connection_inline_17).

            out->write(  `-----------------------------------------` ).
            out->write(  `Example 5: Aliases and Inline Declaration` ).
            out->write( connection_inline_17 ).

*         Example 6: Joins
*        *********************************************************************

            SELECT SINGLE
              FROM (  /dmo/connection AS c
              LEFT OUTER JOIN /dmo/airport AS f
                ON c~airport_from_id = f~airport_id )
              LEFT OUTER JOIN /dmo/airport AS t
                ON c~airport_to_id = t~airport_id
            FIELDS c~airport_from_id, c~airport_to_id,
                   f~name AS airport_from_name, t~name AS airport_to_name
             WHERE c~carrier_id    = 'LH'
               AND c~connection_id = '0400'
              INTO @DATA(connection_join_17).

            out->write(  `------------------------------------------` ).
            out->write(  `Example 6: Join of Connection and Airports` ).
            out->write( connection_join_17 ).

      WHEN 18.
          out->write( 'Case 18 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 11 - Complex Table Types' ).


    TYPES: BEGIN OF st_connection_18 ,
             carrier_id      TYPE /dmo/carrier_id,
             connection_id   TYPE /dmo/connection_id,
             airport_from_id TYPE /dmo/airport_from_id,
             airport_to_id   TYPE /dmo/airport_to_id,
             carrier_name    TYPE /dmo/carrier_name,
           END OF st_connection_18 .


*         Example 1 : Simple and Complex Internal Table
*        *********************************************************************

            " simple table (scalar row type)
            DATA numbers_18 TYPE TABLE OF i.
            " complex table (structured row type)
            DATA connections_18  TYPE TABLE OF st_connection_18 .

            out->write(  `--------------------------------------------` ).
            out->write(  `Example 1: Simple and Complex Internal Table` ).
            out->write( data = numbers_18
                        name = `Simple Table NUMBERS:`).
            out->write( data = connections_18
                        name = `Complex Table CONNECTIONS:`).

*         Example 2 : Complex Internal Tables
*        *********************************************************************

            " standard table with non-unique standard key (short form)
            DATA connections_1_18  TYPE TABLE OF st_connection_18 .

            " standard table with non-unique standard key (explicit form)
            DATA connections_2_18  TYPE STANDARD TABLE OF st_connection_18
                                    WITH NON-UNIQUE DEFAULT KEY.

            " sorted table with non-unique explicit key
            DATA connections_3_18   TYPE SORTED TABLE OF st_connection_18
                                     WITH NON-UNIQUE KEY airport_from_id
                                                         airport_to_id.

            " sorted hashed with unique explicit key
            DATA connections_4_18   TYPE HASHED TABLE OF st_connection_18
                                     WITH UNIQUE KEY carrier_id
                                                     connection_id.

*         Example 3 : Local Table Type
*        *********************************************************************

            TYPES tt_connections_18  TYPE SORTED TABLE OF st_connection_18
                                      WITH UNIQUE KEY carrier_id
                                                      connection_id.

            DATA connections_5_18  TYPE tt_connections_18.

*         Example 4 : Global Table Type
*        *********************************************************************

            DATA flights_18   TYPE /dmo/t_flight.

            out->write(  `------------------------------------------` ).
            out->write(  `Example 4: Global Table TYpe /DMO/T_FLIGHT` ).
            out->write(  data = flights_18
                         name = `Internal Table FLIGHTS:` ).

      WHEN 19.
          out->write( 'Case 19 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 13 - Filling Complex Internal Tables' ).

        TYPES: BEGIN OF st_connection_19,
                 carrier_id      TYPE /dmo/carrier_id,
                 connection_id   TYPE /dmo/connection_id,
                 airport_from_id TYPE /dmo/airport_from_id,
                 airport_to_id   TYPE /dmo/airport_to_id,
                 carrier_name    TYPE /dmo/carrier_name,
               END OF st_connection_19.

        TYPES tt_connections_19 TYPE STANDARD TABLE OF   st_connection_19
                                  WITH NON-UNIQUE KEY carrier_id
                                                      connection_id.

        DATA connections_19 TYPE tt_connections_19.

        TYPES: BEGIN OF st_carrier_19,
                 carrier_id    TYPE /dmo/carrier_id,
                 carrier_name  TYPE /dmo/carrier_name,
                 currency_code TYPE /dmo/currency_code,
               END OF st_carrier_19.

        TYPES tt_carriers_19 TYPE STANDARD TABLE OF st_carrier_19
                              WITH NON-UNIQUE KEY carrier_id.

        DATA carriers_19 TYPE tt_carriers_19.

*     Example 1: APPEND with structured data object (work area)
*    *********************************************************************

*        DATA connection  TYPE st_connection.
        " Declare the work area with LIKE LINE OF
        DATA connection_19 LIKE LINE OF connections_19.


*        connection-carrier_id       = 'NN'.
*        connection-connection_id    = '1234'.
*        connection-airport_from_id  = 'ABC'.
*        connection-airport_to_id    = 'XYZ'.
*        connection-carrier_name     = 'My Airline'.

        " Use VALUE #( ) instead assignment to individual components
        connection_19 = VALUE #( carrier_id       = 'NN'
                              connection_id    = '1234'
                              airport_from_id  = 'ABC'
                              airport_to_id    = 'XYZ'
                              carrier_name     = 'My Airline' ).

        APPEND connection_19 TO connections_19.

        out->write(  `--------------------------------` ).
        out->write(  `Example 1: APPEND with Work Area` ).
        out->write(  connections_19 ).

*     Example 2: APPEND with VALUE #( ) expression
*    *********************************************************************

        APPEND VALUE #( carrier_id       = 'NN'
                        connection_id    = '1234'
                        airport_from_id  = 'ABC'
                        airport_to_id    = 'XYZ'
                        carrier_name     = 'My Airline'
                      )
           TO connections_19.

        out->write(  `----------------------------` ).
        out->write(  `Example 2: Append with VALUE` ).
        out->write(  connections_19 ).

*     Example 3: Filling an Internal Table with Several Rows
*    *********************************************************************

        carriers_19 = VALUE #(  (  carrier_id = 'AA' carrier_name = 'American Airlines' )
                             (  carrier_id = 'JL' carrier_name = 'Japan Airlines'    )
                             (  carrier_id = 'SQ' carrier_name = 'Singapore Airlines')
                          ).

        out->write(  `-----------------------------------------` ).
        out->write(  `Example 3: Fill Internal Table with VALUE` ).
        out->write(  carriers_19 ).

*     Example 4: Filling one Internal Table from Another
*    *********************************************************************

        connections_19 = CORRESPONDING #( carriers_19 ).

        out->write(  `--------------------------------------------` ).
        out->write(  `Example 4: CORRESPONDING for Internal Tables` ).
        out->write(  data = carriers_19
                     name = `Source Table CARRIERS:`).
        out->write(  data = connections_19
                     name = `Target Table CONNECTIONS:`).

      WHEN 20.
          out->write( 'Case 20 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 14 - Access to Complex Internal Tables' ).

          TYPES: BEGIN OF st_connection_20,
                     carrier_id      TYPE /dmo/carrier_id,
                     connection_id   TYPE /dmo/connection_id,
                     airport_from_id TYPE /dmo/airport_from_id,
                     airport_to_id   TYPE /dmo/airport_to_id,
                     carrier_name    TYPE /dmo/carrier_name,
                   END OF st_connection_20.

            TYPES tt_connections_20 TYPE SORTED TABLE OF   st_connection_20
                                      WITH NON-UNIQUE KEY  carrier_id
                                                           connection_id.

            DATA connections_20 TYPE tt_connections_20.
            DATA connection_20  LIKE LINE OF connections_20.

            TYPES: BEGIN OF st_carrier_20,
                     carrier_id    TYPE /dmo/carrier_id,
                     currency_code TYPE /dmo/currency_code,
                   END OF st_carrier_20.

            DATA carriers_20 TYPE STANDARD TABLE OF st_carrier_20
                               WITH NON-UNIQUE KEY carrier_id.

            DATA carrier_20 LIKE LINE OF carriers_20.

*         Preparation: Fill internal tables with data
*        *********************************************************************
            connections_20 = VALUE #(  ( carrier_id      = 'JL'
                                         connection_id   = '0408'
                                         airport_from_id = 'FRA'
                                         airport_to_id   = 'NRT'
                                         carrier_name    = 'Japan Airlines'
                                    )
                                    (    carrier_id      = 'AA'
                                         connection_id   = '0017'
                                         airport_from_id = 'MIA'
                                         airport_to_id   = 'HAV'
                                         carrier_name    = 'American Airlines'
                                    )
                                    (   carrier_id      = 'SQ'
                                        connection_id   = '0001'
                                        airport_from_id = 'SFO'
                                        airport_to_id   = 'SIN'
                                        carrier_name    = 'Singapore Airlines'
                                    )
                                    (   carrier_id      = 'UA'
                                        connection_id   = '0078'
                                        airport_from_id = 'SFO'
                                        airport_to_id   = 'SIN'
                                        carrier_name    = 'United Airlines'
                                    )
                                   ).

            carriers_20 = VALUE #(  (  carrier_id    = 'SQ'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'JL'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'AA'
                                       currency_code = ' '
                                 )
                                 (     carrier_id    = 'UA'
                                       currency_code = ' '
                                 )
                              ).

*         Example 1: Table Expression with Key Access
*        *********************************************************************
            out->write(  `--------------------------------------------` ).
            out->write(  `Example 1: Table Expressions with Key Access` ).

            out->write(  data = connections_20
                         name = `Internal Table CONNECTIONS: ` ).

            " with key fields
            connection_20 = connections_20[ carrier_id    = 'SQ'
                                            connection_id = '0001' ].

            out->write(  data = connection_20
                         name = `CARRIER_ID = 'SQ' AND CONNECTION_ID = '001':` ).

            " with non-key fields
            connection_20 = connections_20[ airport_from_id = 'SFO'
                                      airport_to_id   = 'SIN' ].
            out->write(  data = connection_20
                         name = `AIRPORT_FROM_ID = 'SFO' AND AIRPORT_TO_ID = 'SIN':` ).

*         Example 2: LOOP with key access
*        *********************************************************************

            out->write(  `-------------------------------` ).
            out->write(  `Example 2: LOOP with Key Access` ).

            LOOP AT connections_20 INTO connection_20
                               WHERE airport_from_id <> 'MIA'.

              "do something with the content of connection
              out->write( data = connection_20
                          name = |This is row number { sy-tabix }: | ).

            ENDLOOP.

*         Example 3: MODIFY TABLE (key access)
*        *********************************************************************
            out->write(  `-----------------------------------` ).
            out->write(  `Example 3: MODIFY TABLE (key access` ).

            out->write(  data = carriers_20
                         name = `Table CARRRIERS before MODIFY TABLE:`).

            carrier_20 = carriers_20[  carrier_id = 'JL' ].
            carrier_20-currency_code = 'JPY'.
            MODIFY TABLE carriers_20 FROM carrier_20.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after MODIFY TABLE:`).

*         Example 4: MODIFY (index access)
*        *********************************************************************
            out->write(  `--------------------------------` ).
            out->write(  `Example 4: MODIFY (index access)` ).

            carrier_20-carrier_id    = 'LH'.
            carrier_20-currency_code = 'EUR'.
            MODIFY carriers_20 FROM carrier_20 INDEX 1.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after MODIFY:`).

*         Example 5: MODIFY in a LOOP
*        *********************************************************************
            out->write(  `----------------------------` ).
            out->write(  `Example 5: MODIFY  in a LOOP` ).

            LOOP AT carriers_20 INTO carrier_20
                            WHERE currency_code IS INITIAL.

              carrier_20-currency_code = 'USD'.
              MODIFY carriers_20 FROM carrier_20.

            ENDLOOP.

            out->write(  data = carriers_20
                         name = `Table CARRRIERS after the LOOP:`).

      WHEN 21.
          out->write( 'Case 21 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 15 - Internal Tables in ABAP SQL' ).

            TYPES: BEGIN OF st_airport_21,
                     airportid TYPE /dmo/airport_id,
                     name      TYPE /dmo/airport_name,
                   END OF st_airport_21.

            TYPES tt_airports_21 TYPE STANDARD TABLE OF st_airport_21
                                  WITH NON-UNIQUE KEY airportid.

            DATA airports_21 TYPE tt_airports_21.


*         Example 1: Structured Variables in SELECT SINGLE ... INTO ...
*        *********************************************************************

            DATA airport_full_21 TYPE /DMO/I_Airport.

            SELECT SINGLE
              FROM /DMO/I_Airport
            FIELDS AirportID, Name, City, CountryCode
             WHERE City = 'Zurich'
              INTO @airport_full_21.

            out->write(  `-------------------------------------` ).
            out->write(  `Example 1: SELECT SINGLE ... INTO ...` ).
            out->write(  data = airport_full_21
                         name = `One of the airports in Zurich (Structure):` ).

*         Example 2: Internal Tables in SELECT ... INTO TABLE ...
*        *********************************************************************

            DATA airports_full_21 TYPE STANDARD TABLE OF /DMO/I_Airport
                                    WITH NON-UNIQUE KEY AirportID.

            SELECT
              FROM /DMO/I_Airport
            FIELDS airportid, Name, City, CountryCode
             WHERE City = 'London'
              INTO TABLE @airports_full_21.

            out->write(  `------------------------------------` ).
            out->write(  `Example 2: SELECT ... INTO TABLE ...` ).
            out->write(  data = airports_full_21
                         name = `All airports in London (Internal Table):` ).

*         Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF TABLE
*        *********************************************************************

            SELECT
              FROM /DMO/I_Airport
            FIELDS *
             WHERE City = 'London'
              INTO CORRESPONDING FIELDS OF TABLE @airports_21.

            out->write(  `----------------------------------------------------------` ).
            out->write(  `Example 3: FIELDS * and INTO CORRESPONDING FIELDS OF TABLE` ).
            out->write(  data = airports_21
                         name = `Internal Table AIRPORTS:` ).

*         Example 4: Inline Declaration
*        *********************************************************************

            SELECT
              FROM /DMO/I_airport
            FIELDS AirportID, Name AS AirportName
             WHERE City = 'London'
             INTO TABLE @DATA(airports_inline_21).

            out->write(  `----------------------------------------------------------` ).
            out->write(  `Example 4: Inline Declaration after INTO TABLE` ).
            out->write(  data = airports_inline_21
                         name = `Internal Table AIRPORTS_INLINE:` ).

*        * Example 4: ORDER BY and DISTINCT
*        **********************************************************************
*
*            SELECT
*              FROM /DMO/I_Airport
*            FIELDS DISTINCT CountryCode
*             ORDER BY CountryCode
*             INTO TABLE @DATA(countryCodes).
*
*            out->write(  countryCodes ).

*         Example 5: UNION (ALL)
*        *********************************************************************

            SELECT FROM /DMO/I_Carrier
                   FIELDS 'Airline' AS type, AirlineID AS Id, Name
                   WHERE CurrencyCode = 'GBP'

            UNION ALL

            SELECT FROM /DMO/I_Airport
                   FIELDS 'Airport' AS type, AirportID AS Id,  Name
                   WHERE City = 'London'
*            ORDER BY type, Id
            INTO TABLE @DATA(names_21).

            out->write(  `----------------------------------------------` ).
            out->write(  `Example 5: UNION ALL of Airlines and Airports ` ).
            out->write(  data = names_21
                         name = `ID and Name of Airlines and Airports:` ).

      WHEN 22.
          out->write( 'Case 22 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 19 - How to Implement an EML Statement' ).
          " This will update Table /DMO/AGENCY
          " Business Object /DMO/R_AgencyTP has something to do with this too.

          DATA update_tab_22 TYPE TABLE FOR UPDATE /DMO/R_AgencyTP.
          update_tab_22 = VALUE #(  ( agencyID = '070002' Name = 'MODIFIED Agency' ) ). " 'MODIFIED Agency'
          "AGENCY_ID = 070002
          "NAME      = Fly High
          " I will change back from 'MODIFIED Agency' to 'Fly High'

          MODIFY ENTITIES OF /DMO/R_AgencyTP
          ENTITY /DMO/Agency "The Table
          UPDATE FIELDS ( name )
          WITH update_tab_22.

          out->write( 'Code run to update 1 field in 1 row in table /DMO/Agency' ).
          out->write( 'THe change has not been applied in column NAME beacuse you have not commited the changes!' ).
          COMMIT ENTITIES.
          out->write( 'Code run to update 1 field in 1 row in table /DMO/Agency with commit.' ).
      WHEN 23.
          out->write( 'Case 23 Run!' ).
          out->write( 'From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx' ).
          out->write( 'Exercise 20- Modify Data Using EML' ).

          " Use EML to perform the standard operation update for the root entity of the business object /DMO/R_AGENCYTP.
          " Don not access the business object directly but via its released stable interface /DMO/_I_AGENCYTP

          " Template: none
          " Solution: /LRN/CL_S4D400_BOS_EML (global Class)
          " ZCL_##_EML5:25 PM 6/11/2025

          " Implement an EML statement to change the name of the travel agency with ID "0700##".
          " ( ## stands for your group number.)

          DATA agencies_upd_23 TYPE TABLE FOR UPDATE /DMO/I_AgencyTP.

          "070020,No Return,Wahnheider Str. 57,51105,Koeln,DE,+49 221-5689-100,info@bye-bye.sap,http://www.bye-bye.sap,,,,,0.0000000,,0.0000000,0.0000000,No Return is the leader in business!
          agencies_upd_23 = VALUE #( ( agencyid = '070020' name = 'Some fancy new name') ). "'Some fancy new name' " 'No Return'
          "Latter I changed it back.

          "Implement an EML statement MODIFY ENTITIES for the business object interface /DMO/I_AgencyTP.
          "Update the data of the root entity, ensuring that only the field NAME is changed.
          "Remember that the interface behavior defines alias name /DMO/Agency for the root entity /DMO/I_AgencyTP.
             MODIFY ENTITIES OF /dmo/i_agencytp
                ENTITY /dmo/agency
                UPDATE FIELDS ( name )
                  WITH agencies_upd_23.

          COMMIT ENTITIES.

          out->write( `Method execution finished to update /DMO/I_AgencyTP!`  ).

      WHEN OTHERS.
        out->write( 'Please enter a valid value for the CASE!' ).
    ENDCASE.
  ENDMETHOD.
ENDCLASS.
</pre>

<h3 id="Code_List_12">Local Class lcl_ufh8n_connection (End of ABAP 40hr - Part 1 - Sub-Part 2)</h3>
<pre class="pre-cyan">
" Local Class
" Local Class
" 184 Lines of code
*"* use this source file for the definition and implementation of
*"* local helper classes, interface definitions and type
*"* declarations

CLASS lcl_ufh8n_connection DEFINITION.
  PUBLIC SECTION.


      METHODS: get_carrier_id RETURNING value(r_result) TYPE /dmo/carrier_id,
               set_carrier_id IMPORTING i_carrier_id TYPE /dmo/carrier_id,
               get_connection_id RETURNING value(r_result) TYPE /dmo/connection_id,
               set_connection_id IMPORTING i_connection_id TYPE /dmo/connection_id,
               get_attributes EXPORTING
               e_carrier_id    TYPE /dmo/carrier_id
               e_connection_id TYPE /dmo/connection_id.
*               set_attributes IMPORTING
*                 i_carrier_id    TYPE /dmo/carrier_id OPTIONAL
*                 i_connection_id TYPE /dmo/connection_id
*                 RAISING cx_abap_invalid_value.

    METHODS constructor
      IMPORTING
        i_carrier_id TYPE /dmo/carrier_id
        i_connection_id TYPE /dmo/connection_id
        RAISING cx_abap_invalid_value.

    ""??? What about the Class Constructor?
    " Functional Method
    METHODS get_output
      RETURNING VALUE(r_output) TYPE string_table. "global table type


      "CLASS-DATA conn_counter TYPE i.
      CLASS-DATA conn_counter TYPE i READ-ONLY.
      CLASS-METHODS class_constructor.



  PROTECTED SECTION.
  PRIVATE SECTION.

    TYPES:
      BEGIN OF st_details,
        DepartureAirport   TYPE /dmo/airport_from_id,
        DestinationAirport TYPE   /dmo/airport_to_id,
        AirlineName        TYPE   /dmo/carrier_name,
      END OF st_details.

    TYPES:
      BEGIN OF st_airport,
        AirportId TYPE /dmo/airport_id,
        Name      TYPE /dmo/airport_name,
      END OF st_airport.

    TYPES tt_airports TYPE STANDARD TABLE OF st_airport
                           WITH NON-UNIQUE DEFAULT KEY.

    "declare a static, table-like attribute airports to buffer detail information on all available airports.
    "Declare a new private static attribute airports and type it with table type tt_airports.
    CLASS-DATA airports TYPE tt_airports.

    DATA carrier_id         TYPE /dmo/carrier_id.
    DATA connection_id      TYPE /dmo/connection_id.

    "DATA airport_from_id    TYPE /dmo/airport_from_id.  "scalar attributes
    "DATA airport_to_id      TYPE /dmo/airport_to_id.    "scalar attributes
    "DATA carrier_name       TYPE /dmo/carrier_name.     "scalar attributes

    DATA details TYPE st_details.

ENDCLASS.

CLASS lcl_ufh8n_connection IMPLEMENTATION.

  METHOD class_constructor.
    "Implement a SELECT statement that reads all available airports from the CDS view entity /DMO/I_Airports
    "into the static attribute Airports.
     SELECT FROM /DMO/I_Airport
          FIELDS AirportID, Name
            INTO TABLE @airports.



  ENDMETHOD.

  METHOD constructor.

    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
    ENDIF.

*  SELECT SINGLE
*    FROM /dmo/connection
*    FIELDS airport_from_id, airport_to_id
*    "Note: Their snippet had: FIELDS DepartureAirport, DestinationAirport
*    WHERE carrier_id    = @i_carrier_id
*      AND connection_id = @i_connection_id
*    INTO ( @airport_from_id, @airport_to_id ).

  SELECT SINGLE
    FROM /DMO/I_Connection
    FIELDS DepartureAirport, DestinationAirport, \_Airline-Name as AirlineName
    WHERE AirlineID    = @i_carrier_id
      AND ConnectionID = @i_connection_id
    "INTO ( @airport_from_id, @airport_to_id, @carrier_name ).
    INTO CORRESPONDING FIELDS OF @details.
    "INTO @details.
    "Optional was" INTO CORRESPONDING FIELDS OF @details.
    "Add alias name AirlineName for the path expression.

   IF sy-subrc <> 0.
      RAISE EXCEPTION TYPE cx_abap_invalid_value.
   ENDIF.

    me->carrier_id    = i_carrier_id.
    me->connection_id = i_connection_id.

    conn_counter = conn_counter + 1.

  ENDMETHOD.
  METHOD get_carrier_id.
    r_result = me->carrier_id.
  ENDMETHOD.

  METHOD set_carrier_id.
    me->carrier_id = i_carrier_id.
  ENDMETHOD.

  METHOD get_connection_id.
    r_result = me->connection_id.
  ENDMETHOD.

  METHOD set_connection_id.
    me->connection_id = i_connection_id.
  ENDMETHOD.

  METHOD get_attributes.
     e_carrier_id    = carrier_id.
     e_connection_id = connection_id.
  ENDMETHOD.

*  METHOD set_attributes.
*    IF i_carrier_id IS INITIAL OR i_connection_id IS INITIAL.
*      RAISE EXCEPTION TYPE cx_abap_invalid_value.
*    ENDIF.
*
*    carrier_id    = i_carrier_id.
*    connection_id = i_connection_id.
*  ENDMETHOD.

  METHOD get_output.

  DATA(departure)   = airports[ airportID = details-departureairport ].
  DATA(destination) = airports[ airportID = details-destinationairport ].


    " String Templates
    " Embed the new attributes as expressions into the string templates.
    APPEND |------------------------------|   TO r_output.
    "APPEND |Carrier:     { carrier_id    }|   TO r_output.
    "APPEND |Carrier:     { carrier_id } { carrier_name }| TO r_output. "They Said replace line above but whatever
    "APPEND |Connection:  { connection_id }|   TO r_output.
    "APPEND |Departure:   { airport_from_id }| TO r_output.
    "APPEND |Destination: { airport_to_id   }| TO r_output.

    APPEND |--------------------------------|                    TO r_output.
    APPEND |Carrier:     { carrier_id } { details-airlinename }| TO r_output.
    APPEND |Connection:  { connection_id   }|                    TO r_output.
    "APPEND |Departure:   { details-departureairport     }|       TO r_output.
    "APPEND |Destination: { details-destinationairport   }|       TO r_output.

    "APPEND |Departure:   { details-departureairport   } { departure-name   }| TO r_output.
    "APPEND |Destination: { details-destinationairport } { destination-name }| TO r_output.

    APPEND |Departure:   { details-departureairport   } { airports[ airportid = details-departureairport ]-name   }| TO r_output.
    APPEND |Destination: { details-destinationairport } { airports[ airportid = details-destinationairport ]-name }| TO r_output.

    " Use a table expression Airports[ ... ] and an inline declaration for the data object departure.


  ENDMETHOD.


ENDCLASS.
</pre>

<pre class="pre-cyan">
"Output for Case 14 – This is what calls the Local Class

Case 14 Run!
From File: Acquiring Core ABAP Skills – Part 1 - Basic ABAP Programming – Part 2 - Exercises - MyTurn.docx  
FOLLOW ALONG ONLY: Exercise 1 - How to Analyze a Database Table:                                            
SEE WHEN 13: Exercise 2 - Exercise 2 - SELECT Examples                                                      
Exercise 3 - Read Data from a Database Table:                                                               
FOLLOW ALONG ONLY: Exercise 4 - How to Analyze a CDS View:                                                  
Exercise 5 - Analyze and Use a CDS View Entity                                                              
FOLLOW ALONG ONLY: Exercise 6 - How To Analyze Structured Data Objects Using The Debug Perspective:         
See WHEN 15: Exercise 7 - Structured Data Types:                                                            
See WHEN 16: Exercise 8 - Access to Structured Data Objects:                                                
See WHEN 17: Exercise 9 - Structured Data Objects in ABAP SQL                                               
Exercise 10 - Use a Structured Data Object                                                                  
See WHEN 18: Exercise 11 - Complex Table Types:                                                             
FOLLOW ALONG ONLY: Exercise 12 - How To Debug Complex Internal Tables:                                      
See WHEN 19: Exercise 13 - Filling Complex Internal Tables                                                  
See WHEN 20: Exercise 14 - Access to Complex Internal Tables                                                
See WHEN 21: Exercise 15 - Internal Tables in ABAP SQL                                                      
Exercise 16 - Use a Complex Internal Table                                                                  
FOLLOW ALONG ONLY: Exercise 17 - How To Analyze A Business Object                                           
FOLLOW ALONG ONLY: Exercise 18 - Analyze a Business Object                                                  
See WHEN 22: Exercise 19 - How to Implement an EML Statement:                                               
See WHEN 23: Exercise 20 - Modify Data Using EML:                                                           
xxx:                                                                                                        
xxx:                                                                                                        
Flight Connection LH 0400
Flight Connection AA 0017
Flight Connection SQ 0001
Flight Connection AA 0017
------------------------------                          
--------------------------------                        
Carrier:     LH Deutsche Lufthansa AG                   
Connection:  0400                                       
Departure:   FRA Frankfurt Airport                      
Destination: JFK John F. Kennedy International Airport  
------------------------------                     
--------------------------------                   
Carrier:     AA American Airlines Inc.             
Connection:  0017                                  
Departure:   MIA Miami International Airport       
Destination: HAV José Martí International Airport  
------------------------------                        
--------------------------------                      
Carrier:     SQ Singapore Airlines Limited            
Connection:  0001                                     
Departure:   SFO San Francisco International Airport  
Destination: SIN Singapore Changi Airport             
------------------------------                     
--------------------------------                   
Carrier:     AA American Airlines Inc.             
Connection:  0017                                  
Departure:   MIA Miami International Airport       
Destination: HAV José Martí International Airport  
</pre>

<h1>END: ABAP 40hr - Part 1 - Sub-Part 2</h1>

<pre class="pre-green">
Test 1
</pre>

<pre class="pre-cyan">
Test 2
</pre>

<pre class="pre-yellow">
Test 3
</pre>

<h2 id="End_link">Your at the bottom</h2>

</body>
</html>
